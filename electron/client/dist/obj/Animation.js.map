{"version":3,"sources":["../../../ecma/obj/Animation.js"],"names":["Animation","args","_anime","data","name","$Q","getArg","description","frames","image","GameImage","src","domElement","attack_level","heal_level","type","delay","cix","frameSize","Vector3","frameBounds","VectorBounds","frameOffset","apply2DFrames","parent","flipX","priority","selected_frame","earlyTerm","hang","timer","key","fallback","hasOwnProperty","three_dimen","_a","each","ix","frame","Quazar","log","fcount","y","min","max","x","framePos","push","isNaN","length","resetFrames","update"],"mappings":"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","file":"Animation.js","sourcesContent":["/**\r\n * Created by The Blakes on 04-13-2017\r\n *\r\n */\r\n\r\n\r\nclass Animation {\r\n    constructor(args) {\r\n\r\n        args = args || {};\r\n\r\n\r\n\r\n        var _anime = this;\r\n\r\n\r\n        this.data = {\r\n\r\n          name:$Q.getArg(args, 'name', false),\r\n\r\n            description :  $Q.getArg(args, 'description', '_blank')\r\n        };\r\n\r\n\r\n     this.frames = $Q.getArg(args, 'frames', []);\r\n\r\n\r\n      this.image = new GameImage( $Q.getArg(args, 'src',  $Q.getArg(args, 'image', false)));\r\n\r\n        this.src = this.image.domElement.src;\r\n\r\n        this.domElement = this.image.domElement;\r\n\r\n\r\n\r\n\r\n        this.attack_level = $Q.getArg(args, 'attack_level', 0);\r\n\r\n        this.heal_level = $Q.getArg(args, 'heal_level', 0);\r\n\r\n\r\n        this.type = $Q.getArg(args, 'type', 'basic');\r\n\r\n        this.delay = $Q.getArg(args, 'delay', 0);\r\n\r\n\r\n        this.cix = 0;\r\n\r\n\r\n        this.frameSize = this.getArg(args, 'frameSize', new Vector3(0, 0, 0));\r\n\r\n        this.frameBounds = this.getArg(args, 'frameBounds', new VectorBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n\r\n        this.frameOffset = this.getArg(args, 'frameOffset', new Vector3(0, 0, 0));\r\n\r\n\r\n        this.apply2DFrames(args.parent || {});\r\n\r\n\r\n        this.flipX = $Q.getArg(args, 'flipX', false);\r\n\r\n\r\n        this.priority = $Q.getArg(args, 'priority', 0);\r\n\r\n\r\n        this.cix = 0;\r\n\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n\r\n        this.earlyTerm = this.getArg(args, 'earlyTerm', false);\r\n\r\n        this.hang =this.getArg(args, 'hang', false);\r\n\r\n\r\n        this.timer = 0;\r\n\r\n       // alert('construct complete');\r\n\r\n\r\n    }\r\n\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    apply3DFrames(frames) {\r\n\r\n        this.three_dimen = false;\r\n\r\n        let _a = this;\r\n\r\n\r\n        $Q.each(frames, function (ix, frame) {\r\n\r\n\r\n            if (typeof(frame) == 'Frame3D') {\r\n\r\n                _a.three_dimen = true;\r\n\r\n\r\n                //Assemble a web-gl texture 3D from\r\n\r\n                Quazar.log('TODO: apply webgl / threejs Texture3D set');\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n    }\r\n\r\n    apply2DFrames(parent) {\r\n\r\n        //this.parent = parent;\r\n\r\n\r\n        this.frames = [];\r\n\r\n\r\n        var fcount = 0;\r\n\r\n\r\n        for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n            for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n                //Quazar.log('assembling animation with:' + jstr(this.frameBounds) + ':frames len:' + this.frames.length);\r\n\r\n\r\n\r\n                let framePos = {x: x * this.frameSize.x + this.frameOffset.x, y: y * this.frameSize.y + this.frameOffset.y};\r\n\r\n                this.frames.push({image: this.image, frameSize: this.frameSize, framePos: framePos});\r\n\r\n\r\n                fcount += 1;\r\n\r\n                if(!isNaN(this.earlyTerm))\r\n                {\r\n\r\n                    if(fcount >= this.earlyTerm) {\r\n                        return 0;\r\n                    }\r\n                }\r\n\r\n              //  alert('adding frame');\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.frames[0] = !this.frames[0] ? {\r\n                image: this.image,\r\n                frameSize: this.frameSize,\r\n                framePos: {x: this.frameBounds.min.x, y: this.frameBounds.min.y}\r\n            } : this.frames[0];\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n\r\n    }\r\n\r\n    resetFrames() //special reset function:: frames are re-rendered each reset()\r\n    {\r\n\r\n        //1. reset the GameImage\r\n\r\n\r\n        //2. apply the frames\r\n\r\n        this.apply2DFrames();\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        this.selected_frame = this.frames[this.cix % this.frames.length];\r\n\r\n\r\n    }\r\n\r\n    reset()\r\n{\r\n\r\n    this.resetFrames();\r\n\r\n    this.cix = 0;\r\n\r\n}\r\n\r\n\r\n    animate() {\r\n\r\n        this.timer += 1;\r\n\r\n        Quazar.log('ANIMATING with frame count:' + this.frames.length);\r\n\r\n\r\n\r\n        if(this.timer % this.delay == 0) {\r\n\r\n            if(this.hang)\r\n            {\r\n                this.cix = this.cix + 1;\r\n\r\n                if(this.cix > this.frames.length - 1)\r\n                {\r\n                    this.cix =  this.frames.length - 1;\r\n\r\n                }\r\n\r\n            }\r\n            else\r\n            {\r\n\r\n\r\n                this.cix = this.cix >= this.frames.length - 1 ? this.frameBounds.min.x : this.cix + 1;\r\n            }\r\n\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n"]}