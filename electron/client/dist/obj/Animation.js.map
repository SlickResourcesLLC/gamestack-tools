{"version":3,"sources":["../../../ecma/obj/Animation.js"],"names":["Animation","args","_anime","Quazar","each","ix","item","name","$Q","getArg","description","frames","image","GameImage","src","domElement","attack_level","heal_level","type","delay","cix","frameSize","Vector3","frameBounds","VectorBounds","frameOffset","apply2DFrames","parent","flipX","priority","selected_frame","earlyTerm","hang","timer","key","fallback","hasOwnProperty","three_dimen","_a","frame","log","fcount","y","min","max","x","framePos","push","isNaN","length","update"],"mappings":"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","file":"Animation.js","sourcesContent":["/**\r\n * Created by The Blakes on 04-13-2017\r\n *\r\n */\r\n\r\n\r\nclass Animation {\r\n    constructor(args) {\r\n\r\n        args = args || {};\r\n\r\n\r\n        var _anime = this;\r\n\r\n\r\n        Quazar.each(args, function (ix, item) {\r\n\r\n            if (ix !== 'parent' ) {\r\n                _anime[ix] = item;\r\n            }\r\n\r\n\r\n        });\r\n\r\n        this.name =  $Q.getArg(args, 'name', false);\r\n\r\n        this.description =  $Q.getArg(args, 'description', '_blank');\r\n\r\n\r\n     this.frames = $Q.getArg(args, 'frames', []);\r\n\r\n\r\n      this.image = new GameImage( $Q.getArg(args, 'src',  $Q.getArg(args, 'image', false)));\r\n\r\n        this.src = this.image.domElement.src;\r\n\r\n        this.domElement = this.image.domElement;\r\n\r\n\r\n\r\n\r\n        this.attack_level = $Q.getArg(args, 'attack_level', 0);\r\n\r\n        this.heal_level = $Q.getArg(args, 'heal_level', 0);\r\n\r\n\r\n        this.type = $Q.getArg(args, 'type', 'basic');\r\n\r\n        this.delay = $Q.getArg(args, 'delay', 0);\r\n\r\n\r\n        this.cix = 0;\r\n\r\n\r\n        this.frameSize = $Q.getArg(args, 'frameSize', new Vector3(0, 0, 0));\r\n\r\n        this.frameBounds = $Q.getArg(args, 'frameBounds', new VectorBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n\r\n        this.frameOffset = $Q.getArg(args, 'frameOffset', new Vector3(0, 0, 0));\r\n\r\n\r\n        this.apply2DFrames(args.parent || {});\r\n\r\n\r\n        this.flipX = $Q.getArg(args, 'flipX', false);\r\n\r\n\r\n        this.priority = $Q.getArg(args, 'priority', 0);\r\n\r\n\r\n        this.cix = 0;\r\n\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n\r\n        this.earlyTerm = $Q.getArg(args, 'earlyTerm', false);\r\n\r\n        this.hang =$Q.getArg(args, 'hang', false);\r\n\r\n\r\n        this.timer = 0;\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    apply3DFrames(frames) {\r\n\r\n        this.three_dimen = false;\r\n\r\n        let _a = this;\r\n\r\n\r\n        $Q.each(frames, function (ix, frame) {\r\n\r\n\r\n            if (typeof(frame) == 'Frame3D') {\r\n\r\n                _a.three_dimen = true;\r\n\r\n\r\n                //Assemble a web-gl texture 3D from\r\n\r\n                Quazar.log('TODO: apply webgl / threejs Texture3D set');\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n    }\r\n\r\n    apply2DFrames(parent) {\r\n\r\n        //this.parent = parent;\r\n\r\n\r\n        this.frames = [];\r\n\r\n\r\n        var fcount = 0;\r\n\r\n\r\n        for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n            for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n                //Quazar.log('assembling animation with:' + jstr(this.frameBounds) + ':frames len:' + this.frames.length);\r\n\r\n\r\n\r\n                let framePos = {x: x * this.frameSize.x + this.frameOffset.x, y: y * this.frameSize.y + this.frameOffset.y};\r\n\r\n                this.frames.push({image: this.image, frameSize: this.frameSize, framePos: framePos});\r\n\r\n\r\n                fcount += 1;\r\n\r\n                if(!isNaN(this.earlyTerm))\r\n                {\r\n\r\n                    if(fcount >= this.earlyTerm) {\r\n                        return 0;\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.frames[0] = !this.frames[0] ? {\r\n                image: this.image,\r\n                frameSize: this.frameSize,\r\n                framePos: {x: this.frameBounds.min.x, y: this.frameBounds.min.y}\r\n            } : this.frames[0];\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n\r\n    }\r\n\r\n    reset() //special reset function:: frames are re-rendered each reset()\r\n    {\r\n\r\n        //1. reset the GameImage\r\n\r\n\r\n        //2. apply the frames\r\n\r\n        this.apply2DFrames(this.parent);\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        this.selected_frame = this.frames[this.cix % this.frames.length];\r\n\r\n\r\n    }\r\n\r\n    reset()\r\n{\r\n\r\n    this.cix = 0;\r\n\r\n}\r\n\r\n\r\n    animate() {\r\n\r\n        this.timer += 1;\r\n\r\n        Quazar.log('ANIMATING with frame count:' + this.frames.length);\r\n\r\n\r\n\r\n        if(this.timer % this.delay == 0) {\r\n\r\n            if(this.hang)\r\n            {\r\n                this.cix = this.cix + 1;\r\n\r\n                if(this.cix > this.frames.length - 1)\r\n                {\r\n                    this.cix =  this.frames.length - 1;\r\n\r\n                }\r\n\r\n            }\r\n            else\r\n            {\r\n                this.cix = this.cix >= this.frames.length - 1 ? this.frameBounds.min.x : this.cix + 1;\r\n            }\r\n\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n"]}