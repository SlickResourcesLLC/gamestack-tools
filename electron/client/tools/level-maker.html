
<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>2D Level Mapper</title>
        <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">

        <!-- Insert this line above script imports  -->
        <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>


        <link rel="stylesheet" href="../assets/js/dat.gui.css">


        <script src="../assets/js/dat.gui.js"></script>

        <script src="../assets/js/Tween.js"></script>

        <script src="../dist/obj/Animation.js"></script>

        <script src="../dist/obj/Force.js"></script>
        <script src="../dist/obj/GameMedia.js"></script>

        <script src="../dist/Quazar.js"></script>

        <script src="../dist/obj/Sprite.js"></script>

        <script src="../dist/obj/GamepadAdapter.js"></script>

        <script src="../dist/script/Terrain.js"></script>

        <script src="../assets/js/dat.gui.interface.js"></script>

        <script src="../assets/js/jquery.js"></script>

        <script src="../assets/bootstrap/js/bootstrap.min.js"></script>


        <!-- Insert this line after script imports -->
        <script>if (window.module) module = window.module;</script>

    </head>


    <style>

        body, html
        {
            width:100%;

            min-width:750px;

            height:100%;

            min-height:750px;

            overflow:none;

        }

        label
        {

            font-weight:lighter;

            padding-left:4px;

            float:left;

            margin-top:2px;

            width:100%;

        }

        label.selected
        {


            background: #606c88; /* Old browsers */
            background: -moz-linear-gradient(top, #606c88 0%, #3f4c6b 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #606c88 0%,#3f4c6b 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #606c88 0%,#3f4c6b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#606c88', endColorstr='#3f4c6b',GradientType=0 ); /* IE6-9 */

            color:white;

        }

        .functional-group
        {

            position:relative;

        }

        .functional-group label,.functional-group select,.functional-group input
        {

            float:left;

        }




        .multi-space input[type='radio']
        {
          position:relative;

            left:0px;

        }


        .multi-space *
        {
            float:none;

        }




        .add_object
        {
            position:relative;

            float:left;

        }

        .space-bottom
        {

            padding-bottom:30px;

        }

        .ct-span
        {
            position:absolute;

            bottom:0px;

            height:30px;

            left:0px;

            width:100%;

        }

        div.dg.main
        {
            border:2px inset teal;

            height:200px;

            overflow:scroll;

        }

        div.dg.ac
        {
            position:fixed;

            z-index:9999;

            top:200px;

            bottom:50px;

        }

        canvas
        {

            position:relative;

            z-index:900;

            background:black;

            width:100%;

            height:100%;

            border:2px inset teal;

        }

        .illustration {
            text-align:center;
            padding:15px 0 20px;
            font-size:100px;
            color:#2980ef;
        }

        form input {
            background:none;
            border:none;
            border-bottom:1px solid #434a52;
            border-radius:0;
            box-shadow:none;
            outline:none;
            color:inherit;
        }


        ul#options-dock-main
        {
            position:fixed;

            z-index:997;

            width:40%;

            height:40%;

            overflow-y:scroll;

            left:30%;

            top:70px;

            background:white;

        }

        .list-group-min, .list-group-max
        {

            position:absolute;

            color:black;

            z-index:997;

            height:40px;

            width:40px;


            margin:0px;

            top:0px;

            right:0px;

            font-size:170%;

        }


        li.list-group-heading
        {
            background: url(assets/img/hash-medium.png);

            color:white;

            font-weight:bold;

        }


        textarea
        {

            position:fixed;

            z-index:997;

            top:0px;

            left:300px;



        }

        nav.top-menu{

            width:100%;

            height:45px;

            max-height:45px;

            margin:0; padding:0;

        }



        nav.top-menu  .button-top {

            border-radius: 4px;

            background: #45484d; /* Old browsers */
            background: -moz-linear-gradient(top, #45484d 0%, #000000 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #45484d 0%,#000000 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #45484d 0%,#000000 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#45484d', endColorstr='#000000',GradientType=0 ); /* IE6-9 */

            border: none;
            color: #FFFFFF;
            text-align: center;
            font-size: 16px;
            padding: 10px;

            padding-right:20px;

            transition: all 0.5s;
            cursor: pointer;
            margin: 5px;

            text-decoration:none;

            height:40px;

            vertical-align: middle;

        }



        nav.top-menu  .button-add {

            border-radius: 4px;

            background: #b5bdc8; /* Old browsers */
            background: -moz-linear-gradient(top, #b5bdc8 0%, #828c95 0%, #28343b 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #b5bdc8 0%,#828c95 0%,#28343b 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #b5bdc8 0%,#828c95 0%,#28343b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b5bdc8', endColorstr='#28343b',GradientType=0 ); /* IE6-9 */
            border: none;
            color: #FFFFFF;
            text-align: center;
            font-size: 20px;

            height:40px;
            width:40px;

            vertical-align: middle;

        }


         .button-add:hover {

             border:20px solid silver;

        }


        nav.top-menu a img
        {

            height:36px;

            width:auto;

           position:relative;

            margin-bottom:2px;

        }






        nav.top-menu .button-top span {
            cursor: pointer;
            display: inline-block;
            position: relative;
            transition: 0.5s;
        }

        nav.top-menu .button-top span:after {
            content: '\00bb';
            position: absolute;
            opacity: 0;
            top: 0;
            right: -20px;
            transition: 0.5s;
        }


        nav.top-menu .button-top:hover {
            background: #7ee8d8; /* Old browsers */
            background: -moz-linear-gradient(top, #7ee8d8 0%, #20cab6 49%, #2bd9c5 50%, #3b9f9b 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #7ee8d8 0%,#20cab6 49%,#2bd9c5 50%,#3b9f9b 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #7ee8d8 0%,#20cab6 49%,#2bd9c5 50%,#3b9f9b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#7ee8d8', endColorstr='#3b9f9b',GradientType=0 ); /* IE6-9 */ 
        }


        nav.top-menu .button-top:hover span {
            padding-right: 25px;
        }

        nav.top-menu .button-top:hover span:after {
            opacity: 1;
            right: 0;
        }


        nav.top-menu{

            position:fixed;

            z-index:997;

            top:0px;

            height:100px;

            width:100%;

            margin-left:10px; /*Temp margin left to expose the current select control --03-11-2017*/

        }





        div.free-select
        {

            position:absolute;

            z-index:997;

            padding: 0;

            left:-110%;

            margin-left:10px;

            background-color:#1e2833;

            border:1px inset teal;

        }

        .dropdown {
            position: absolute;

            z-index:9999;

            width:300px;


        }
         .dropdown-submenu {
            position: relative;

             padding:3px;

        }

       .dropdown-submenu .dropdown-menu {
            top: 0;
            left: 100%;
            margin-top: -1px;
        }



        .free-select ul {
            list-style-type: none;

            padding: 0;


        }

        .free-select img
        {

            width:100px;

            height:auto;

        }

        .free-select li {
            font: 200 20px/1.5 Helvetica, Verdana, sans-serif;
            border-top: 1px solid #ccc;

            border-top:none;

        }

        .free-select li:last-child {

            padding-bottom:none;

        }

        .free-select li a {
            text-decoration: none;
            color: #fff;
            display: block;

            -webkit-transition: font-size 0.3s ease, background-color 0.3s ease;
            -moz-transition: font-size 0.3s ease, background-color 0.3s ease;
            -o-transition: font-size 0.3s ease, background-color 0.3s ease;
            -ms-transition: font-size 0.3s ease, background-color 0.3s ease;
            transition: font-size 0.3s ease, background-color 0.3s ease;


            padding:3px;


        }

        .free-select li:hover
        {

            border-top:2px solid goldenrod;

            border-bottom:2px solid goldenrod;


        }



        form{

            display:none;

            position:fixed;

            z-index:990;

            width:50%;

            min-height:60%;

            max-height:80%;

            overflow-y:scroll;

            top:15%;

            left:25%;

            background-color:#1e2833;

            color:white;

        }



        form h2, form h3,form h4
        {

            width:100%;

            display:block;

            text-align:center;

        }

         form input,form label, form select
        {
            width:80%;

            display:block;

            text-align:left;

            margin-left:10%;

            margin-top:2px;

            margin-bottom:2px;

             font-weight:normal;



        }

        form input[type="file"]
        {


            font-weight:normal;

        }




        form input[type="button"]
        {

            width:48%;

            margin-left:26%;

            border-radius:5px;

        }

        form #testCanvas
        {

            position:absolute;

            left:50%;

            height:50px;

            width:48%;

        }


        .form-pair
        {

            position:relative;

            width:100%;

            height:50px;

        }

       button.ok
        {

            position:relative;

            left:10%;
           background-color:#333333;

           color:white;

           border-radius: 4px;

           margin-top:7px;

           background: #45484d; /* Old browsers */
           background: -moz-linear-gradient(top, #45484d 0%, #000000 100%); /* FF3.6-15 */
           background: -webkit-linear-gradient(top, #45484d 0%,#000000 100%); /* Chrome10-25,Safari5.1-6 */
           background: linear-gradient(to bottom, #45484d 0%,#000000 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
           filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#45484d', endColorstr='#000000',GradientType=0 ); /* IE6-9 */

           border: none;
           color: #FFFFFF;
           text-align: center;
           font-size: 15px;

           height:25px;
           width:30%;

           vertical-align: middle;

           margin-bottom:4px;

       }


       li a.delete
       {

           color:white;



           background: #da8452; /* Old browsers */
           background: -moz-linear-gradient(top, #da8452 0%, #c26732 50%, #d67842 100%); /* FF3.6-15 */
           background: -webkit-linear-gradient(top, #da8452 0%,#c26732 50%,#d67842 100%); /* Chrome10-25,Safari5.1-6 */
           background: linear-gradient(to bottom, #da8452 0%,#c26732 50%,#d67842 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
           filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#da8452', endColorstr='#d67842',GradientType=0 ); /* IE6-9 */


       }

        li a.delete:hover {

           border-top:1px solid grey;

            border-bottom:1px solid grey;

        }



        button.cancel
        {

            position:relative;

            color:white;

            border-radius: 4px;

            margin-top:7px;

            background: #da8452; /* Old browsers */
            background: -moz-linear-gradient(top, #da8452 0%, #c26732 50%, #d67842 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #da8452 0%,#c26732 50%,#d67842 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #da8452 0%,#c26732 50%,#d67842 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#da8452', endColorstr='#d67842',GradientType=0 ); /* IE6-9 */

            border: none;
            color: #FFFFFF;
            text-align: center;
            font-size: 15px;

            height:25px;
            width:30%;

            left:30%;

            vertical-align: middle;

            margin-bottom:4px;

        }

        #logo
        {

            width:150px;

            height:auto;

           margin-bottom:0px;

        }

        #map-item-space
        {
            z-index:997;

        }
        #ctrl-space-top
        {
            position:fixed;

            z-index:998;

            width:100%;

            min-width:750px;

            height:50px;

            background-color:white;

            padding:0px;

            margin:0px;

            top:0px;

            left:0px;

            white-space: nowrap;

            background: #e2e2e2; /* Old browsers */
            background: -moz-linear-gradient(top, #e2e2e2 0%, #dbdbdb 50%, #d1d1d1 51%, #fefefe 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #e2e2e2 0%,#dbdbdb 50%,#d1d1d1 51%,#fefefe 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #e2e2e2 0%,#dbdbdb 50%,#d1d1d1 51%,#fefefe 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#e2e2e2', endColorstr='#fefefe',GradientType=0 ); /* IE6-9 */


        }

        #container{

            position:absolute;

            background:#333333;

            top:50px;

            z-index:800;

            overflow:scroll;

        }


    </style>

    <body>

    <div id="ctrl-space-top" >
        <nav class="top-menu" >

            <img id="logo" src="img/logo-main.png"  />

            <button id="my-objects" class="button-top"  ><span>Map-Objects</span></button> <button id="create_map_object" class="button-add"  >+</button>

            <a id="download" class="button-top" target="_blank" href='data:text/json;charset=utf-8,'>Save to File<img src="img/save.png" alt="save data" ></a>


            <a id="map_settings_show" class="button-top"  href='#' onclick="$('#settings-space form').show();">Map-Settings<img src="img/settings.png" alt="settings image"  ></a>

             </nav>

    </div>

        <div id="container" >

            <div  class="free-select center" >

            <ul></ul>

            </div>


            <canvas id="myCanvas" class="level-maker-canvas">
            </canvas>



            <div class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">RightClick: Sprite Action
                    <span class="caret"></span></button>
                <ul class="dropdown-menu">
                    <li><a class="delete"  tabindex="-1" href="#">Delete Last Object(s)</a></li>

                    <li class="dropdown-submenu spacebottom multi-space">
                        <a class="test" tabindex="-1" href="#">Place Multiple-Objects<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><label>Number-1</label><input type="range" id="count" min="1" max="300" value="1" /> </li>

                            <li><label>Spacing-Per-Object-0</label><input type="range" id="dist" min="0" max="300" value="0" /> </li>

                            <li ><label  class="up multi-place switch-label">Up &#8593;</label> </li>
                            <li  ><label class="up-left multi-place switch-label">Diag-Up-Left  &#8598;</label></li>
                            <li ><label  class="left multi-place switch-label"> Left &#8592;</label></li>
                            <li ><label  class="down-left multi-place switch-label">Diag-Down-Left &#8600;</label></li>
                            <li ><label class="down multi-place switch-label">Down &#8595;</label></li>
                            <li ><label  class="down-right multi-place switch-label" >Diag-Down-Right &#8601;</label></li>
                            <li ><label class="right multi-place switch-label" >Right &#8594;</label></li>
                            <li ><label class="up-right multi-place switch-label">Diag-Up-Right &#8599;</label></li>

                            <br/>

                            <li > <button class="ct-span"  id="auto-place" >Confirm</button></li>

                        </ul>
                    </li>
                </ul>
            </div>

        </div>



    <div id="settings-space" >

        <form id="settings"   method="GET">

            <h3>Map Settings</h3>

            <input  type="hidden"  value="image_data" id="image_data" name="image_data" />

            <label>Name</label>

            <input type="text"  placeholder="name" id="map_name" name="map_name"  />

            <label>Description</label>

            <input type="text"  placeholder="description" id="map_description" name="map_description" />

            <label>Type</label>

            <input type="text"  placeholder="type" id="map_type" name="map_type" />

            <label>Map_Id</label>

            <input type="text"  placeholder="map_id" id="map_id" name="map_id" />

            <label>Pixel Snap</label>

            <select id="map_snap_size">

                <option id="1" >1px</option>

                <option selected="true" id="10">10px</option>

                <option id="20">20px</option>

                <option id="50">50px</option>

            </select>

            <label>Width</label>

            <input id="map_level_size_x" type="range"  value="5000" step="10" name="width" min="0" max="10000" />

            <label>Height</label>

            <input id="map_level_size_y" type="range"  value="5000"  step="10" name="height" min="0" max="10000" />

            <label>Intended Game Scale</label>

            <input id="map_game_scale" type="range"  value="1.5" name="gameScale" min="0" max="100" />


            <button id="apply_map_settings" class="ok" onclick="levelMaker.applySettings();" >Apply</button>

            <button id="cancel_map_settings" class="cancel" onclick="$(this).parent().hide();">Cancel</button>

        </form>

    </div>



    <div id="map-item-space"  >

            <form id="object-maker" method="GET">

                <h3>Create Map Object</h3>

                <div class="form-pair" >

                <input type="file"  value="Select Image File" name="file" onchange="levelMaker.getRawImageFile(this);"  />

                    <img style="display:none;" />

                    <canvas id="testCanvas"   ></canvas>

                </div>

                <input type="hidden"  value="image_data" id="image_data" name="image_data" />

                <label>Name</label>

                <input type="text"  placeholder="name" id="name" name="name"  />

                <label>Description</label>

                <input type="text"  placeholder="description" id="description" name="description" />

                <label>Type</label>

                <input type="text"  placeholder="type" id="type" name="type" />

                <label>ID</label>

                <input type="text"  placeholder="id" id="id" name="id" />


                <label>Width</label>

                <input id="width" type="range"  value="0" step="10" name="width" min="0" max="4000" />

                <label>Height</label>

                <input id="height" type="range"  value="0"  step="10" name="height" min="0" max="4000" />


                <label>FrameX Position</label>

                <input id="frameX" type="range"  value="0" name="frameX" min="0" max="4000" />

                <label>FrameY Position</label>

                <input id="frameY" type="range"  value="0" name="frameY"  min="0" max="4000"  />

                <label>FrameWidth</label>

                <input id="framewidth" type="range"  value="64" name="framewidth" min="0" max="4000" />

                <label>FrameHeight</label>

                <input id="frameheight" type="range"  value="64" name="frameheight"  min="0" max="4000"  />

                <label>*Hidden Settings</label>

                <div id="hidden-settings" style="display:none;" >

                    <label>Animations</label> <button class="add_object">+</button>

                    <label>Motions</label> <button class="add_object">+</button>

                <label>Systemic-Positional-Motion Model</label>

                <select id="motion-models" name="motion-models">

                    <option>None</option>

                    <option>Directional</option>

                    <option>Curve</option>

                    <option>Generate These From Javascript Settings</option>

                </select>

                <label>Systemic-Rotation-Motion for-Model</label>

                <select id="motion-models" name="motion-models">

                    <option>None</option>

                    <option>Directional</option>

                    <option>Curve</option>

                    <option>Generate These From Javascript Settings</option>

                </select>

                <label>Systemic-Rotation-Motion for-Object</label>

                <select id="motion-models" name="motion-models">

                    <option>None</option>

                    <option>Directional</option>

                    <option>Curve</option>

                    <option>Generate These From Javascript Settings</option>

                </select>

                <label>Systemic-Motion: Position Movement Speed</label>

                <div class="nested-settings">
                 <input type="checkbox" value="fixed-texture"  /><label for="">Fixed Texture</label>
                    <input class="hidden-form" type="checkbox" value="particle-texture"  /><label for="">Continuous Particle Birth</label>


                <label>Birth Rate Per Second</label>
                <input id="bps" type="range"  value="4" name="bps"  min="0" max="100"  />

                <label>Max Members</label>
                <input id="mm" type="range"  value="64" name="mm"  min="0" max="100"  />


                <label>Decay Rate</label>
                <input id="dr" type="range"  value="4" name="dr"  min="0" max="100"  />

                <label>Max Speed</label>
                <input id="ms" type="range"  value="64" name="ms"  min="0" max="100"  />

                <label>Acceleration Model</label>

                <select id="motion-models" name="motion-models">

                    <option>None</option>

                    <option>Directional</option>

                    <option>Curve</option>

                    <option>Generate These From Javascript Settings</option>

                </select>


                    <label>Formation Model</label>

                    <select id="motion-models" name="motion-models">

                        <option>None</option>

                        <option>Directional</option>

                        <option>Curve</option>

                        <option>Generate These From Javascript Settings</option>

                    </select>


                <label>Birth Animation</label>

                <select id="animations" name="animations">

                    <option>Animation 1</option>

                    <option>Animation 2</option>

                    <option>Animation 3</option>

                </select>


                    <label>Life Animation</label>

                    <select id="animations" name="animations">

                        <option>Animation 1</option>

                        <option>Animation 2</option>

                        <option>Animation 3</option>

                    </select>

                <label>Death Animation</label>

                <select id="animations" name="animations">

                    <option>Animation Type 1</option>

                    <option>Animation Type 2</option>

                    <option>Animation Type 3</option>

                </select>

                </div>

                </div>

                <label>Motion Calls</label>

                <label class="minor">Speed</label>

                <div class="motion-speed-gui" id="motion-speed-gui">

                </div>

                <label class="minor">Acceleration</label>

                <div class="motion-accel-gui" id="motion-accel-gui">

                </div>

                <label class="minor">Rotational Speed</label>

                <div class="rotation-speed-gui" id="rotation-speed-gui">

                </div>

                <label class="minor">Rotational Accel</label>

                <div class="rotation-accel-gui" id="rotation-accel-gui">

                </div>


                <button  id="create_object" class="ok"  >Apply</button>

                <button id="cancel_map_settings" class="cancel" >Cancel</button>

            </form>

        </div>

    <script>



        //App{}: a collection of UI functionality

        var App = {

            DEVMODE:false,

            createDemo : function (lib) {


                /*****************************************************
                 * Main Game Objects:
                 *
                 * -1 Blocks : small_block, medium_block, big_block
                 * -2.Platforms: platform_basic_small, platform_basic_medium, platform_basic_big
                 *
                 * -3.floating platforms : platform_floating_small, platform_floating_big, platform_floating_medium
                 *
                 * -4.fpw : or : floating_platform_waypoint : shows where the floating platform will go to
                 *
                 * -5. mushroom_platforms : mush_plat1, mush_plat2, etc..
                 *
                 * -6. power_boxes : pbxes 1, 2, 3, etc..
                 *
                 * -7. Houses : house_1, house_2, house_3, house_4 (a house could be a store, etc... or there just for fun
                 *
                 * -8. special_enemies : special_enemy_1, special_enemy_2, etc..
                 *
                 *****************************************************/

                var pathPref = levelMaker.url_prefix;

                //add mapItems

                //1. trampoline

                //2. wall turret

                //3. flying enemies

                //4. power boxes


                //5. boss points


                //6. portals :: of level


                //7. portals::end portal



                levelMaker.MapElement('ground', pathPref + 'ground.png', {x: 100, y: 100}, {x:  Math.round(40), y:  Math.round(40)});
                levelMaker.MapElement('platform', pathPref + 'mushplat.png', {x: 490, y: 299}, {x: Math.round(490 / 4), y: Math.round(299 / 4)});
                levelMaker.MapElement('prop', pathPref + 'prop.png', {x: 550, y: 400}, {x: Math.round(550 / 4), y: Math.round(400 / 4)});



                var saveLevel = function ()
                {

                    $.post('/levelmaker', level, function (data) {


                        console.log("response:" + JSON.stringify(data));
                    });
                }

            },

            _UI_OPTION_MAP : {
                my_objects: []

            },

            placeRCMenu:function(x, y, visible)
            {

                if(visible)
                {
                    $('.dropdown').show();

                }
                else
                {
                    $('.dropdown').hide();

                }


                var ct = 0;


                var d = $('.dropdown')[0];

                $(d).css('left', x);

                $(d).css('top', y - 50);




            },

            setInputEvents : function(lib)
            {


                lib.InputEvents.extend('leftclick', function (x, y) {


                    levelMaker.leftClick(x,y);

                    levelMaker.mouse.down = true;

                }, function (x, y) {

                    //button was released

                    levelMaker.deselectAll();

                    levelMaker.mouse.down = false;

                });
                //2DO add this to the main engine: don't need a context menu

                var container = $('#container')[0];

               container.oncontextmenu = function (e) {


                   App.placeRCMenu(levelMaker.mouse.x, levelMaker.mouse.y - 40, true);

                    if(!App.DEVMODE)
                    {

                        e.preventDefault();

                        return false;

                    }


                }


                lib.InputEvents.extend('rightclick', function (x, y) {

                    levelMaker.rightClick(x, y);
                }, function (x, y) {

                    //button was released

                });
                lib.InputEvents.extend('mousemove', function (x, y) {

                    levelMaker.mouse.x = x;
                    levelMaker.mouse.y = y;

                    levelMaker.moveSelected(levelMaker.mouse.x, levelMaker.mouse.y);

                    levelMaker.hoverSelect(levelMaker.mouse.x, levelMaker.mouse.y);


                });

                Quazar.InputEvents.init();

            },

            setMotionVectorGui : function(){

                var sgui = new dat.GUI( { autoPlace: false } );

                sgui.add(levelMaker.assembled_sprite.speed, 'x').min(-50).max(50);
                sgui.add(levelMaker.assembled_sprite.speed, 'y').min(-50).max(50);
                sgui.add(levelMaker.assembled_sprite.speed, 'z').min(-50).max(50);


                $('.motion-speed-gui').append($(sgui.domElement));

                var agui = new dat.GUI( { autoPlace: false } );


                agui.add(levelMaker.assembled_sprite.accel, 'x').min(-50).max(50);
                agui.add(levelMaker.assembled_sprite.accel, 'y').min(-50).max(50);
                agui.add(levelMaker.assembled_sprite.accel, 'z').min(-50).max(50);


                $('.motion-accel-gui').append($(agui.domElement));


                var rsgui = new dat.GUI( { autoPlace: false } );

                rsgui.add(levelMaker.assembled_sprite.rot_speed, 'x').min(-50).max(50);
                rsgui.add(levelMaker.assembled_sprite.rot_speed, 'y').min(-50).max(50);
                rsgui.add(levelMaker.assembled_sprite.rot_speed, 'z').min(-50).max(50);


                $('.rotation-speed-gui').append($(rsgui.domElement));

                var agui = new dat.GUI( { autoPlace: false } );

                agui.add(levelMaker.assembled_sprite.rot_accel, 'x').min(-50).max(50);
                agui.add(levelMaker.assembled_sprite.rot_accel, 'y').min(-50).max(50);
                agui.add(levelMaker.assembled_sprite.rot_accel, 'z').min(-50).max(50);

                $('.rotation-accel-gui').append($(agui.domElement));


            },

            ui_funx_assembler : function ()
            {

                var OptionActionList = function (text, data, callback)
                {

                    return {text: text, data: data, callback: callback}

                };

                var app_out = {
                    _objects: {},
                    OptionActionList: OptionActionList

                };

                return app_out;
            },

            dialog : function (list, targetPX, targetPY, callback)
            {

                $('.free-select ul').html('');

                var show = function ()
                {

                    $('.free-select').show();

                    $('.free-select').animate({top: targetPY, left: targetPX}, "fast");

                };

                var hide = function ()
                {

                    $('.free-select').hide('slow');

                    $('.free-select').animate({top: -800, left: -800}, "fast");

                };


                $.each(list, function (x, item) {

                    var cmText = item.text;

                    var cmCallback = item.callback;

                    var data = item.data;

                    var cm_id = "cmd_" + item.text;

                    $('.free-select ul').append('<li ><a id="' + cm_id + '">' + cmText + '</a><img  src="' + item.data.img.src + '"  /></li>');

                    var link = $('.free-select ul li a')[x];

                    var lparent = $(link).parent();

                    $(link).on('click', function () {
                        cmCallback(false, this);

                        hide();

                    });

                    $(lparent).on('click', function () {
                        cmCallback(false, $(link));

                        hide();

                    });


                });

                show();

            }

        };



        var UI_Funx = App.ui_funx_assembler();
         /************
         * dialog()
         * -show a group of basic options in 'list view'
         ************/


        $(document).ready(function () {

            $('#auto-place').on("click", function(e){

                var blink = false;

               if($('.up').data('on') == 'on')
               {
                   alert('got the up class');



                   levelMaker.leftClickExtra = function() {

                       var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                       levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), true)

                       window.clearInterval(levelMaker.blink);

                   };

                   blink = true;

               }

                if($('.up-left').data('on') == 'on')
                {
                    alert('got the up-left class');



                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), true, false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.left').data('on') == 'on')
                {

                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), false, false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.down-left').data('on') == 'on')
                {


                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), false, true, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.down').data('on') == 'on')
                {

                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.down-right').data('on') == 'on')
                {

                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), false, true, false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.right').data('on') == 'on')
                {

                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;

                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), false, false, false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;

                }

                if($('.up-right').data('on') == 'on')
                {
                
                    levelMaker.leftClickExtra = function(){

                        var x = levelMaker.mouse.x, y = levelMaker.mouse.y;


                    levelMaker.placeGroup(x, y, parseInt($('#dist').val()), parseInt($('#count').val()), true, false, false, true)

                        window.clearInterval(levelMaker.blink);

                    };

                    blink = true;



                }


                if(blink)
                {


                    levelMaker.blink = window.setInterval(function(){

                        levelMaker.hover_selection_sprite.active = levelMaker.hover_selection_sprite.active ? false : true;

                    }, 350);

                }


            });



            $('.delete').on("click", function(e){

                levelMaker.removeLast();

                e.preventDefault();

                return false;


            });


            $('.dropdown-submenu a.test').on("click", function(e){

                $(this).next('ul').toggle();
                e.stopPropagation();
                e.preventDefault();

            });

            $('button.button-top').on('click', function (e) {

                var id = $(this).attr('id').replace('-', '_');

                var x = 0, y = 0 + levelMaker.topScroll;

                App.dialog(App._UI_OPTION_MAP[id],
                        x, y, function () {
                            console.log('dialog shown');
                        });

            });


            var flipSelectedX = function ()
            {

                var s = levelMaker.getSelected();


                if (s)
                {

                    s.flipX = s.flipX ? false : true;

                }

            }



            $(document).on('keydown', function (e) {

                console.log('got key of:' + event.which);

                if (event.which == '70')
                {

                    flipSelectedX();
                }

            });



        });


        var jstr = function(obj){

            return JSON.stringify(obj);

        };


        var Game = {

            WIDTH:0,

            HEIGHT:0,

            GameWindow:{},

            canvas:{},

            ctx:{},

            collective_physics:{},

            sprites:[],

            is_init:false,


            update:function()
            {

                this.WIDTH = levelMaker.settings.levelSizeX;

                this.HEIGHT = levelMaker.settings.levelSizeY;

                if(!this.is_init)
                {
                    return 0;

                }

                console.log('Game Update');

                this.GameWindow.update();

            },


            render:function()
            {

                if(!this.is_init)
                {
                    return 0;

                }

                this.GameWindow.draw();

            },

            init:function()
            {

                levelMaker.applySettings();


                $('#settings-space input').change(function(){

                   levelMaker.applySettings();

                });



                $('#create_map_object').click(function(){

                    levelMaker.showObjectDialog(this);

                });


                $('#settings_button').click(function(){

                   $('#settings-space form').show();

                });



                $('#download').click(function(){

                    levelMaker.save(levelMaker.settings.name.replace('.json', '').replace('.', '') + '.json');

                });

                $('form').submit(function(evt){


                    evt.preventDefault();

                    return false;



                });



                levelMaker.htmlSettings();


              //  document.getElementById('container').innerHTML += "<canvas></canvas>";

                // 1. demonstrate that the threejs canvas can be intercepted at runtime

                this.canvas = document.getElementById('myCanvas');

                this.ctx = this.canvas.getContext('2d');

                this.collective_forces = [];

                //2. create a GameWindow to be sychronizd with threejs

                this.GameWindow = new GameWindow({canvas:this.canvas, ctx: this.ctx, sprites: this.sprites, collective_forces: this.collective_forces}, function(){

                    console.log('Game Update passed');

                });

                this.canvas.width = 5000;

                this.canvas.height = 5000;

                levelMaker.selectedElement = levelMaker.get();

              levelMaker.selectedSprite = levelMaker.createMapSprite(levelMaker.get(), levelMaker.mouse.x, levelMaker.mouse.y);


                jQuery.expr.filters.offscreen = function(el) {
                    var rect = el.getBoundingClientRect();
                    return (
                        (rect.x + rect.width) < 0
                        || (rect.y + rect.height) < 0
                        || (rect.x > window.innerWidth || rect.y > window.innerHeight)
                    );
                };


                this.is_init = true;

            }

        };


        /************
         * o()
         ************/

        /***********************************************
         * levelMaker
         * extends functionality of qui, to allow building of game levels
         * -map out sprites of various types on the canvas
         * -save them to a json file (2do)
         *********************************************/


        var levelMaker = {

            topScroll:0,

            selected_image_src:{},

            assembled_sprite:{},

            lastPlantedCountRecordArray:[],

            pixelSnap:10,

            settings:{

                name:"myLevel",

                description:"the default level for our game",

                pixelSnap:10,

                levelSizeX:5000,

                levelSizeY:5000,

                levelSizeZ:0,

                game_scale:2.0

            },


            objectMemberToArray:function(object, key)
            {

                var list = [];

                for(var x in object)
                {

                    list.push(object[key]);

                }

                return list;

            },

            removeLast:function()
            {

                var number = levelMaker.lastPlantedCountRecordArray[levelMaker.lastPlantedCountRecordArray.length -1];

                for(var x = 0; x < number; x++) {

                    Game.sprites.pop();

                }
            },


            arrayToSelect:function(containerId, selectId, values)
            {

                var myDiv = document.getElementById(containerId);

                //Create array of options to be added
                var array = values;

                //Create and append select list
                var selectList = document.createElement("select");
                selectList.id = selectId;
                myDiv.appendChild(selectList);

                //Create and append the options
                for (var i = 0; i < array.length; i++) {
                    var option = document.createElement("option");
                    option.value = array[i];
                    option.text = array[i];
                    selectList.appendChild(option);
                }


            }

           ,
            htmlSettings:function()
            {
                var obj = levelMaker.settings;

                $('#map_name').val(obj.name);
                $('#map_description').val(obj.description);
                $('#map_type').val(obj.type);



                $('#map_snap_size').val(obj.pixelSnap + 'px');

                $('#map_level_size_x').val(obj.levelSizeX);
                $('#map_level_size_y').val(obj.levelSizeX);

                $('#map_game_scale').val(obj.game_scale);

            },

            applySettings:function()
            {

                var obj = levelMaker.settings;


                obj.name = $('#map_name').val();
                obj.description = $('#map_description').val();
                obj.type = $('#map_type').val();
                obj.pixelSnap = parseFloat($('#map_snap_size').val().replace('px', ''));

                obj.levelSizeX = parseInt($('#map_level_size_x').val());

                obj.levelSizeY = parseInt($('#map_level_size_y').val());

                $('.level-maker-canvas').width(obj.levelSizeX);
                $('.level-maker-canvas').height(obj.levelSizeY);



                Game.canvas.width = obj.levelSizeX;

                Game.canvas.height = obj.levelSizeY;



                $('#map-item-space form').hide('slow');

            },

            showObjectDialog:function(){

               $('#map-item-space form').show();


            },

            objectMakerFormEvents:function()
            {

                levelMaker.assembled_sprite = new Sprite();

                App.setMotionVectorGui();



                $('#create_object').click(function(){

                    var   fx  =  parseFloat($('#frameX').val()),

                        fy  =  parseFloat($('#frameY').val()),

                        w = parseFloat($('#width').val()),

                        h =  parseFloat($('#height').val()),

                        fw  =  parseFloat($('#framewidth').val()),

                        fh  =  parseFloat($('#frameheight').val());


                    var name = $('#name').val(),

                        type = $('#type').val(),

                        description = $('#description').val(),

                    id = $('#id').val(),

                    image_data = $('#image_data').val();

                    //alert('Creating Map Object');

                    levelMaker.selected_image_src = image_data;

                    console.log('Making objects in create event');

                    levelMaker.assembled_sprite = levelMaker.MapElement(name, levelMaker.selected_image_src, new Vector3(fw, fh, 0), new Vector3(w, h, 0),
                        {type:type, description:description });



                    levelMaker.assembled_sprite.img.onload = function()
                    {
                       // alert('new object loaded');
                        levelMaker.addLevelObjectToUI(levelMaker.assembled_sprite);

                    }

                $('#map-item-space form').hide();

                });


                $("#object-maker input").change(function(evt)
                {

                    var   fx  =  parseFloat($('#frameX').val()),

                        fy  =  parseFloat($('#frameY').val()),

                        w = parseFloat($('#width').val()),

                        h =  parseFloat($('#height').val()),

                        fw  =  parseFloat($('#framewidth').val()),

                        fh  =  parseFloat($('#frameheight').val());


                    levelMaker.sizeImage(fx, fy, w, h, fw, fh);


                });

            },

            sizeImage:function(frameX, frameY, mapWidth, mapHeight,  frameWidth, frameHeight)
            {

                var canvas = document.getElementById('testCanvas');

                var ctx = canvas.getContext('2d');

                var image = $(canvas).parent().find('img')[0];

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                var x = 0, y = 0;

                var portion = mapWidth / mapHeight;

                mapHeight = canvas.height;

                mapWidth = mapHeight * portion;

                x = (canvas.width / 2) - mapWidth / 2;

                y = (canvas.height / 2) - mapHeight / 2;



                $('#frameX').val(frameX);

                $('#frameY').val(frameY);

                $('#width').val(mapWidth);

                $('#height').val(mapHeight);

                $('#framewidth').val(frameWidth);

               // $('#framewidth').attr('max', frameWidth);

                $('#frameheight').val(frameHeight);

               // $('#frameheight').attr('max', frameHeight);


                ctx.drawImage(image, frameX, frameY, frameWidth, frameHeight,x, y, mapWidth, mapHeight);


            },

            getRawImageFile:function(input, callback)
            {

                var preview =  $(input).parent().find('img')[0];
                var file  = input.files[0];
                var reader  = new FileReader();



                reader.addEventListener("load", function () {
                    preview.src = reader.result;

                    levelMaker.selected_image_src = preview.src;

                    $('#image_data').val(reader.result);

                    preview.onload = function()
                    {
                        var mapWidth = this.width,

                            mapHeight = this.height;


                     var x = 0, y = 0;


                        levelMaker.sizeImage(x, y, mapWidth, mapHeight,  mapWidth, mapHeight);

                        if(typeof(callback) == 'function')
                        {
                            callback(this);

                        }

                    }



                }, false);

                if (file) {
                    reader.readAsDataURL(file);
                }


            },




            MapData:function(map, meta)
            {

                return {map:map, meta:meta};
            },

            save:function(filename)
            {

                this.map = this.mapElements;

                var str = JSON.stringify({settings:this.settings, map:Game.sprites}, null, 2); // spacing level = 2

                var downloadHRefValue = $('#download').attr('href');

                $('#download').attr('name', filename);

                $('#download').attr('href', downloadHRefValue + str);

                $('#download').attr('download', this.meta.name + ".json");

            },

            selection_sprite: {},
            mouse: {
                x: 0, y: 0,

                down:false

            },
            getDocHeight: function () {
                var D = document;
                return Math.max(
                        D.body.scrollHeight, D.documentElement.scrollHeight,
                        D.body.offsetHeight, D.documentElement.offsetHeight,
                        D.body.clientHeight, D.documentElement.clientHeight
                        )
            },
            scrollAdjust: function () {
                var winheight = window.innerHeight || (document.documentElement || document.body).clientHeight
                var docheight = levelMaker.getDocHeight();
                var scrollTop = window.pageYOffset || (document.documentElement || document.body.parentNode || document.body).scrollTop
                var trackLength = docheight - winheight
                var pctScrolled = Math.floor(scrollTop / trackLength * 100) // gets percentage scrolled (ie: 80 or NaN if tracklength == 0)
                console.log(pctScrolled + '% scrolled');


                levelMaker.topScroll = Game.canvas.height * (pctScrolled / 100);

                return Game.canvas.height * (pctScrolled / 100);

            },
            mapElements: [],
            get: function (tag)
            {
                if(!tag)
                {
                    return this.mapElements[0];

                }

                for (var x = 0; x < this.mapElements.length; x++)
                {

                    if (this.mapElements[x].tag.toLowerCase() === tag.toLowerCase())
                    {

                        return this.mapElements[x];
                    }

                }

            },
            MapElement: function (tag, imgPath, frameSize, mapSize, extras)
            {
                var img = document.createElement('IMG');
                img.src = imgPath;

               // alert("El image:" + JSON.stringify(img.src));

                var element = {
                    tag: tag, img: img, frameSize: frameSize, mapSize: mapSize

                };

                for(var x in extras)
                {
                    element[x] = extras[x];

                };


                this.mapElements.push(element);


                return element;

            },
            selectedSprite: false,
            selectedTag: "",
            selectedElement: {},
            levelObjects: [],
            deselectAll: function ()
            {

                Quazar.each(Game.sprites, function (ix, item) {

                    item.selected = false;

                    item.hover_selected = false;

                });
            },
            getSelected: function ()
            {

                var getSpr = false;

                Quazar.each(Game.sprites, function (ix, item) {

                    if (item.hover_selected || item.selected)
                    {

                        getSpr = item;

                    }

                });


                return getSpr;

            },

            centerPos:function(sprite, x, y)
            {
                sprite.pos.x = Math.floor(x - sprite.size.x / 2);
                sprite.pos.y = Math.floor(y - $(Game.canvas).offset().top - sprite.size.y / 2);

                sprite.pos.x = sprite.pos.x - ( sprite.pos.x % levelMaker.settings.pixelSnap);

                sprite.pos.y = sprite.pos.y - ( sprite.pos.y % levelMaker.settings.pixelSnap);


            },

            moveSelected: function (x, y)
            {

                Quazar.each(Game.sprites, function (ix, item) {

                    if (item.selected)
                    {

                        var x1 = x - (x% levelMaker.settings.pixelSnap) ,
                                y1 = y - (y  % levelMaker.settings.pixelSnap);


                        levelMaker.centerPos(item, x1, y1);

                    }

                });
            },

            leftClickExtra:function()
            {


            },

            leftClick: function (x, y)
            {

              //  alert('left click');

                if(typeof(this.leftClickExtra) == 'function')
                {
                    this.leftClickExtra();

                    this.leftClickExtra = false;

                    return false;

                };

                var notSelection = function(obj)
                {
                    return obj !== levelMaker.hover_selection_sprite &&

                        obj !== levelMaker.selection_sprite;

                };



                var selection = false;
                Quazar.each(Game.sprites, function (ix, item) {


                    if (notSelection(item) && x > item.pos.x && x < item.pos.x + item.size.x &&
                            y > item.pos.y && y < item.pos.y + item.size.y + $('.level-maker-canvas').offset().top)
                        {

                           item.selected = true;
                            selection = true;
                        }

                    });

                if (!selection)
                {

                    levelMaker.plantMapSprite(levelMaker.selectedElement, x - (x % levelMaker.settings.pixelSnap), y - (y % levelMaker.settings.pixelSnap))

                    levelMaker.lastPlantedCountRecordArray.push(1);
                }

            },
            hoverSelect: function (x, y)
            {

                var selection = false, basic_selection = false;

                Quazar.each(Game.sprites, function (ix, item) {

                    if(item.selected )
                    {
                        basic_selection = true;

                    }

                });

                        Quazar.each(Game.sprites, function (ix, item) {

                    if ( x > item.pos.x && x < item.pos.x + item.size.x &&
                            y > item.pos.y && y < item.pos.y + item.size.y + $('.level-maker-canvas').offset().top)
                    {

                        item.hover_selected = !basic_selection && !item.selected ?  true : item.hover_selected;
                        selection = true;
                    }

                });


                if (!selection && !(levelMaker.mouse.down) ) {
                    levelMaker.deselectAll()
                }
                ;


            },
            rightClick: function (x, y)
            {
                Quazar.each(Game.sprites, function (ix, item) {

                    if (x > item.pos.x && x < item.pos.x + item.size.x &&
                            y > item.pos.y && y < item.pos.y + item.size.y)
                    {

                        var ix = Game.sprites.indexOf(item);
                        Game.sprites.splice(ix, 1);
                    }


                });
            },

            simpleMapObject:function(object, x, y)
            {

              var x = Math.floor(x - object.size.x / 2);
                var y = Math.floor(y - $(Game.canvas).offset().top - object.size.y / 2);

               x = x - ( object.pos.x % levelMaker.settings.pixelSnap);

                y = y - ( object.pos.y % levelMaker.settings.pixelSnap);


                return {size:object.size, pos:{x:x, y:y} };

            },

            createMapSprite:function(mapElement, x, y)
            {

                // console.log("Selected Element:" + JSON.stringify(mapElement));
                var img = mapElement.img;
                console.log("Img src:" + img.src);
                var sprite = new Sprite('MapElement', 'A level-builder element');

                sprite.active = true;

                sprite.size = mapElement.mapSize;


                var fs = mapElement.frameSize;

                sprite.setAnimation(new Animation({src:img, frameSize:fs, frameBounds:new VectorBounds(new Vector3(0, 0), new Vector3(0, 0))}));



                // console.log(JSON.stringify(sprite));

                sprite.pos.x = Math.floor(x - sprite.size.x / 2);
                sprite.pos.y = Math.floor(y - $(Game.canvas).offset().top - sprite.size.y / 2);

                sprite.pos.x = sprite.pos.x - ( sprite.pos.x % levelMaker.settings.pixelSnap);

                sprite.pos.y = sprite.pos.y - ( sprite.pos.y % levelMaker.settings.pixelSnap);

                this.selectedSprite = sprite;

                return sprite;

            },

            plantMapSprite: function (mapElement, x, y)
            {

               // console.log("Selected Element:" + JSON.stringify(mapElement));
                var img = mapElement.img;
                console.log("Img src:" + img.src);
                var sprite = new Sprite('MapElement', 'A level-builder element');

                sprite.active = true;

                sprite.size = mapElement.mapSize;


                var fs = mapElement.frameSize;

                sprite.setAnimation(new Animation({src:img, frameSize:fs, frameBounds:new VectorBounds(new Vector3(0, 0), new Vector3(0, 0))}));



               // console.log(JSON.stringify(sprite));

                sprite.pos.x = Math.floor(x - sprite.size.x / 2);
                sprite.pos.y = Math.floor(y - $(Game.canvas).offset().top - sprite.size.y / 2);

                sprite.pos.x = sprite.pos.x - ( sprite.pos.x % levelMaker.settings.pixelSnap);

                sprite.pos.y = sprite.pos.y - ( sprite.pos.y % levelMaker.settings.pixelSnap);

                this.selectedSprite = sprite;


                Game.sprites.push(sprite);


            },
            simulateVerticalMouseMove: function (top) {


                levelMaker.moveSelected(levelMaker.mouse.x, top);
            },

            placeGroup : function(x1, y1, dist, n, north, south, east, west)
            {



                for(var x = 0; x < n; x++)
                {

                    var x2 = 0, y2 = 0;

                    if(east){    x2 = x * levelMaker.selectedElement.mapSize.x  * -1; }

                    if(west){    x2  = x * levelMaker.selectedElement.mapSize.x   }

                    if(north){    y2 =  x * levelMaker.selectedElement.mapSize.y  * -1 }

                    if(south){    y2 =  x * levelMaker.selectedElement.mapSize.y; }

                    levelMaker.plantMapSprite(levelMaker.selectedElement, x1+ x2, y1+y2);

                    levelMaker.lastPlantedCountRecordArray.push(n - 1);

                }

            },


        addLevelObjectToUI:function(item)
            {

                App._UI_OPTION_MAP.my_objects.push(UI_Funx.OptionActionList(item.tag, item, function (err, element) {
                    console.log('1');

                    var value = $(element).text();

                     // alert('click on:' + value);

                    levelMaker.selectedElement = levelMaker.get(value);

                }));

            },

            url_prefix:'../assets/builder/'
        }

        window.setTimeout(function () {


            Game.canvas.width = 5000;
            Game.canvas.height = 5000;
            window.onresize = function ()
            {


                Game.canvas.width = 5000;
                Game.canvas.height = 5000;
            }



            window.addEventListener("scroll", function () {
               var topScroll = levelMaker.scrollAdjust();


                levelMaker.simulateVerticalMouseMove(topScroll);

            }, false);


        }, 500);





        Quazar.ready(function (lib) {

           // alert('quazar on ready');

            App.createDemo(lib);

            //log the completion of the ready function

            $.each(levelMaker.mapElements, function (ix, item) {

                //  alert('map element:' + item.tag);

                App._UI_OPTION_MAP.my_objects.push(UI_Funx.OptionActionList(item.tag, item, function (err, element) {
                    console.log('1');

                    var value = $(element).text();


                    levelMaker.selectedElement = levelMaker.get(value);

                }));

            });


            window.setTimeout(function () {


            }, 100);


            var pathPref = levelMaker.url_prefix;

            var selectionImg = document.createElement('IMG');

            selectionImg.src = pathPref +  "selection.png";


            var hoverSelectionImg = document.createElement('IMG');

            hoverSelectionImg.src =  pathPref +  "hover_selection.png";



            var centerSizeSpriteToSprite = function (cSprite, aSprite)
            {
                cSprite.size.x = aSprite.size.x + 10;

                cSprite.size.y = aSprite.size.y + 10;


                var x = Math.floor(aSprite.pos.x + aSprite.size.x / 2 - cSprite.size.x / 2),
                    y = Math.floor(aSprite.pos.y + aSprite.size.y / 2 - cSprite.size.y / 2);

                cSprite.pos.x = x;
                cSprite.pos.y = y;

            }



        levelMaker.hover_selection_sprite  = new Sprite('Selection Sprite', 'Shows selected area');

        var fs = new Size(191, 192);

        levelMaker.hover_selection_sprite.setAnimation(new Animation({src: hoverSelectionImg.src, frameSize:fs, frameBounds:new  VectorBounds(new Vector3(0, 0), new Vector3(0, 0))}));

            levelMaker.selection_sprite  = new Sprite('Selection Sprite', 'Shows selected area');

            var fs = new Size(191, 192);

            levelMaker.selection_sprite.setAnimation(new Animation({src: selectionImg.src, frameSize:fs, frameBounds:new VectorBounds(new Vector3(0, 0), new Vector3(0,0))}));

            Game.sprites.push(levelMaker.selection_sprite);

            Game.sprites.push(levelMaker.hover_selection_sprite);

            console.log(levelMaker.selection_sprite);

            window.setInterval(function(){

                if(!levelMaker.blink){  levelMaker.hover_selection_sprite.active = false; }
                levelMaker.selection_sprite.active = false;


                var notSelection = function(obj)
                {
                    return obj !== levelMaker.hover_selection_sprite &&

                        obj !== levelMaker.selection_sprite;

                };

                var hoverSelect = false;

                Quazar.each(Game.sprites, function (ix, item) {

                    if (item.hover_selected && notSelection(item))
                    {

                        console.log('Sprite Selected!');

                        centerSizeSpriteToSprite(levelMaker.hover_selection_sprite, item);

                      if(!levelMaker.blink){  levelMaker.hover_selection_sprite.active = true };

                        hoverSelect = true;


                    }



                    if (item.selected && notSelection(item))
                    {

                        console.log('Sprite Selected!');

                        centerSizeSpriteToSprite(levelMaker.selection_sprite, item, item.size.x + 20, item.size.y + 20);

                        levelMaker.selection_sprite.active = true;

                    }


                });


                if(!hoverSelect)
                {


                    var item = {position:{x:levelMaker.mouse.x, y:levelMaker.mouse.y, z:0}, size:levelMaker.selectedSprite.size};

                    item.pos = item.position;

                    item = levelMaker.simpleMapObject(item, levelMaker.mouse.x, levelMaker.mouse.y);

                    centerSizeSpriteToSprite(levelMaker.hover_selection_sprite, item, item.size.x + 20, item.size.y + 20);

                    if(!levelMaker.blink){  levelMaker.hover_selection_sprite.active = true };


                }

            }, 10);

        });
        /********************************
         * Game Init / ready
         *******************************/



        function animate(time) {

            Game.update();

            Game.ctx.clearRect(0, 0, Game.canvas.width, Game.canvas.height);

            Game.render();

            requestAnimationFrame(animate);

            TWEEN.update(time);

        };


        Quazar.ready(function(lib){

            Game.init();

            animate();

            App.setInputEvents(lib);


            levelMaker.objectMakerFormEvents();

          // levelMaker.save();

           // DatGui.get(new Animation());


            $('.add_object').click(function(){




            });



            $.each($('input[type="range"]'), function(ix, item){

                $(item).change(function(evt){

                    var value = $(this).val(),

                        label = $(this).prev('label');

                    var lblVal = $(label).text() + "";

                    if(lblVal.indexOf('-') <= 0)
                    {
                        $(label).text($(label).text() + '-');

                    }

                  $(label).text(lblVal.substring(0, ($(label).text() + "").lastIndexOf('-')) + '-' +  value);

                });

            });


            $('.dropdown input[type="radio"]').click(function(evt) {


                alert('hi');

                $('.dropdown input[type="radio"]').attr('checked', false);

                $(evt.target).attr('checked', true);



                evt.preventDefault();

                return false;

            });



                $('.switch-label').click(function(evt) {


                    $('.switch-label').removeClass('selected');

                    $('.switch-label').data('on', 'off');

                    $(evt.target).data('on', 'on');

                    $(evt.target).addClass('selected');


                evt.preventDefault();

                return false;

            });

                $('div').click(function(evt){

                // $('form').hide();

               var type = $(evt.target).prop('tagName');

                var dissallowed = ['LI', 'UL', 'A', 'SPAN', 'IMG', 'BUTTON', 'INPUT', 'RADIO', 'LABEL'];

                if($(evt.target).attr('id') !== 'container')
                {


                if(!$(evt.target).find('form').length) {

                    if (dissallowed.indexOf(type) == -1  && !$(evt.target).parents('form').length >= 1) {

                        $('form').hide('slow');

                        $('.free-select').hide('slow');

                        App.placeRCMenu(levelMaker.mouse.x, levelMaker.mouse.y - $(Game.canvas).offset().top  + levelMaker.topScroll, false);
                    }


                }


                }

           });

        });





    </script>

</body>

</html>
