{"version":3,"sources":["../../../ecma/Gamestack/concat/Gamestack.js"],"names":["Gamestack","GameStackLibrary","lib","DEBUG","gui_mode","__gameWindow","__sprites","__animations","spriteTypes","systemSpriteTypes","systemAnimationTypes","attack_0","attack_1","attack_2","attack_3","attack_4","defend_0","defend_1","defend_2","defend_3","defend_4","heal_0","heal_1","heal_2","heal_3","heal_4","samples","log_modes","log_mode","recursionCount","__gameWindowList","create_id","d","Date","getTime","performance","now","replace","c","r","Math","random","floor","toString","getObjectById","id","x","all_objects","length","getAllCallables","actionables","$Q","each","sprites","ix","item","concat","sounds","motionstacks","animations","interlog","message","div","isNaN","error","quit","Error","console","info","m","GameStack","log","animate","time","__gameStack","isAtPlay","TWEEN","update","requestAnimationFrame","ctx","clearRect","canvas","width","height","draw","start","Collision","spriteRectanglesCollide","obj1","obj2","paddingX","round","padding","size","paddingY","y","left","position","right","top","bottom","_gameWindow","setGameWindow","gameWindow","ExtendEvents","extendedObject","extendedKey","extendor","extendorKey","evtLink","GSEventLink","push","parent","onRun","onComplete","getGameWindow","assignAll","object","args","keys","list","onResult","i","ready_callstack","ready","callback","reload","callReady","funx","call","InputEvents","init","__running","getArg","key","fallback","hasOwnProperty","add","obj","__inst","isWindow","GameWindow","Force","forces","Camera","camera","Sprite","GSEvent","apply","collect","remove","indexOf","splice","isNormalStringMatch","str1","str2","toLowerCase","instance_type_pairs","objectList","constructor_name","constructor","name","type","getById","select","objects_out","GamestackApi","get","post","contents","jstr","Sound","src","data","sound","document","createElement","onLoad","val","volume","play","SoundList","cix","Array","GameImage","onCreate","Object","image","ext","substring","lastIndexOf","onerror","__error","domElement","onload","Quick2d","__gameInstance","module","exports","JSON","stringify","selector","$GFunx","objects","on","evt_key","selectorObject","controller_ix","criterion","between","cparts","split","__targetType","__targetName","before","trim","parseFloat","alert","evt_profile","contains_any","button_mode","GamepadAdapter","item1","iy","item2","onUpdate","sprite","collidesRectangular","condition","evt_parts","run","mykey","number","e","propkey","spr","object_out","s","mainSelector","msfChar","__targetClassName","output","cleanSelectorString","str","after","getParts","complete","c1","test_str","start_pos","end_pos","contains","contains_all","cList","c2","test_selector_method","Q_TestStrings","test","query","mousemove","leftclick","rightclick","middleclick","wheelup","wheelDown","space","tab","shift","enter","extend","onFinish","cleanKey","down","up","getMousePos","pageX","pageY","clientX","body","scrollLeft","documentElement","clientY","scrollTop","offsetLeft","style","fullMoveInputEvents","event","pos","el","onkeydown","value","String","fromCharCode","keyCode","onkeyup","onmousedown","which","preventDefault","onmouseup","addEventListener","window","_preGameStack_windowLoad","backgrounds","interactives","append","background","getContext","adjustSize","onresize","target","w","h","clientWidth","clientHeight","getElementById","setAttribute","WIDTH","HEIGHT","listout","player","def_update","filepath","$","getJSON","_gw","Canvas","TextDisplay","widthFloat","heightFloat","topFloat","targetTop","get_float_pixels","leftFloat","targetLeft","color","text","fontFamily","font","fadeIn","fade","border","fontSize","fromLeft","fromRight","fromTop","fromBottom","duration","stay_duration","float","dimen","fun","display","textAlign","zIndex","innerText","textContent","opacity","Velocity","easing","setTimeout","ItemDisplay","Vector3","textSize","text_id","img_id","v","innerHTML","Bar","backgroundSize","backgroundPosition","BarFill","BarDisplay","fill_src","fill","fill_width","fill_height","fill_color","bar_src","bar","bar_width","bar_height","bar_color","f","VideoDisplay","undefined","z","Animation","_anime","defaultArgs","description","frames","delay","frameSize","frameBounds","VectorFrameBounds","frameOffset","flipX","reverse_frames","__isValid","Vector","min","max","termPoint","apply2DFrames","selected_frame","timer","seesaw_mode","run_ext","complete_ext","caller","callkey","reverse","__frametype","framePos","fcount","quitLoop","frames_reversed","slice","pop","reverseFrames","engage","call_on_run","tween","Tween","curve","Easing","Linear","None","to","call_on_complete","isComplete","CanvasLib","__levelMaker","active","onScreen","drawPortion","drawFrameWithRotation","img","fx","fy","fw","fh","deg","canvasContextObj","flip","save","rad","PI","translate","rotate","scale","drawImage","restore","drawData","putImageData","frame","selected_animation","p","targetSize","realWidth","realHeight","offset","rotation","HTMLImageElement","GravityForce","subjects","clasticObjects","topClastics","accel","itemx","accelY","__inAir","groundMaxY","itemy","collide_stop","collide_stop_top","ControllerEventKeys","left_stick","right_stick","gamepads","__gamepads","intervals","controller_stack","_gpinst","events","setInterval","gps","navigator","getGamepads","process","clearInterval","game_pad_index","game_pad","gp","stick_left","stick_right","buttons","extendFunc","f1","f2","fc","current_cb","parts","parseInt","gpEvents","process_buttons","process_axes","axes","axis1","axia2","ceil","pressed","clearance_1","gpc","bkey","gpix","GamepadEvents","GamestackModel","__isMaster","master","isMaster","images","motions","terrains","isAllOfAny","types","cleanCheck","projectiles","targets","triggered","statKey","lessThan","greaterThan","isStrOrNum","onKey","rejected","parent_id","child_id","parent_key","child_key","makeExtendableOverrides","Level","threes","Motion","distance","curvesList","curvesToArray","lineCurvesList","lineCurvesToArray","object_id","motion_curve","Quadratic","InOut","line_curve","targetRotation","motionCurveString","getMotionCurveString","lineCurveString","getLineCurveString","setMotionCurve","setLineCurve","getParent","easeType","cps","s1","s2","tweens","targetPosition","targetR","fire","__tweenObject","t","context","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","position_old","line","points","dist","ptrack","easeInOutQuad","t1","t2","stop","sub","sqrt","minPointDist","first_segment","extendLinePoints","segment","next_points","last_point","sr","GeoMath","rotatePointsXY","curve_iterations","Projectile","Line","animation","origin","highlighted","collide","anime","setAnimation","setSize","lp","transpose","equals","Rectangle","VectorBounds","Curves","linearNone","easeInQuadratic","easeOutQuadratic","easeInOutQuadratic","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuartic","easeOutQuartic","easeInOutQuartic","easeInQuintic","easeOutQuintic","easeInOutQuintic","Shapes","circle","radius","freq","center","square","rect","triangle","base","curve_options","curve_string","get_curve_from_string","is_highlighted","pointDist","iterations","growth","n","num","get_curve_string","found","curveCall","existing_canvas","test_graph_size","get_line_segment","current_point","curveMethod","pct","trig_distance_xy","yTrack","mult","t_points","next_segment","t_len","point","point_highlighter","Vector2","angle","theta","cos","sin","gravity","__initializers","_spr","collision_bounds","speed","acceleration","rot_speed","rot_accel","selected_projectile","onInit","options","SpriteInitializers","f_init","framesize","__mapSize","mx","my","wth","htw","keyString1","keyString2","extendedFunc","ef","prep_key","bullet","rot_offset","__playerInst","bx","by","bw","bh","shot","stats","damage","nextPos","next","subsprite","abs","assertSpeed","diff","prop","rate","amt","diff_min_y","diff_min_x","diff_max_y","diff_max_x","dimens","minkey","apart","ct","diffX","distX","overlap_x","diffY","distY","overlap_y","collide_stop_x","file_path","SpriteInitializersOptions","Clastics","top_collideable","force","fourside_collideable","MainGravity","very_light","light","medium","strong","very_strong","ControllerStickMotion","player_move_x","__lib","accelX","decelX","__falling","decelY","player_move_xy","decel","player_rotate_x","v1","v2","Pos","Size","Position","Rotation","Background","orientation","reverseX","reverseY","speedFloat","speedX","speedY","element","cancat","Interactive","Terrain","collision_type","Three","THREE","scene","Scene","geometry","TorusGeometry","AmbientLight","renderer","WebGLRenderer","preserveDrawingBuffer","PerspectiveCamera","loader","TextureLoader","load","texture","material","MeshPhongMaterial","map","__init","mesh","Mesh","render","__ServerSideFile","file_upload","toDataURL","relpath","content","singleFrame","clear","pixels","Uint8Array","gl","readPixels","RGBA","UNSIGNED_BYTE","ImageData","Uint8ClampedArray"],"mappings":"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","file":"Gamestack.js","sourcesContent":["\r\n/**@author\r\nJordan Edward Blake\r\n * */\r\n\r\n/**@copyright\r\n\r\n Copyright 2016\r\n\r\n **/\r\n\r\n/**\r\n * Object, instance of GamestackLibrary() : references Gamestack classes\r\n * attaches to window object || module.exports (when loading via require)\r\n * */\r\n\r\nlet Gamestack = {};\r\n\r\nlet GameStackLibrary = function () {\r\n\r\n    var lib = {\r\n\r\n        DEBUG: false,\r\n\r\n        gui_mode: true,\r\n\r\n        __gameWindow: {}\r\n        ,\r\n\r\n        __sprites: [],\r\n\r\n        __animations: [],\r\n\r\n\r\n        spriteTypes:[],\r\n\r\n        systemSpriteTypes: ['player', 'enemy', 'background', 'interactive'],\r\n\r\n        systemAnimationTypes: {\r\n\r\n            attack_0:\"System.attack_0\",\r\n\r\n            attack_1:\"System.attack_1\",\r\n\r\n            attack_2:\"System.attack_2\",\r\n\r\n            attack_3:\"System.attack_3\",\r\n\r\n            attack_4:\"System.attack_4\",\r\n\r\n            defend_0:\"System.defend_0\",\r\n\r\n            defend_1:\"System.defend_1\",\r\n\r\n            defend_2:\"System.defend_2\",\r\n\r\n            defend_3:\"System.defend_3\",\r\n\r\n            defend_4:\"System.defend_4\",\r\n\r\n            heal_0:\"System.heal_0\",\r\n\r\n            heal_1:\"System.heal_1\",\r\n\r\n            heal_2:\"System.heal_2\",\r\n\r\n            heal_3:\"System.heal_3\",\r\n\r\n            heal_4:\"System.heal_4\",\r\n\r\n        },\r\n\r\n\r\n        samples: {}\r\n        ,\r\n\r\n        log_modes: ['reqs', 'info', 'warning'],\r\n\r\n        log_mode: \"all\",\r\n\r\n        recursionCount: 0,\r\n\r\n        __gameWindowList: [],\r\n\r\n\r\n        create_id: function () {\r\n\r\n            var d = new Date().getTime();\r\n            if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n                d += performance.now(); //use high-precision timer if available\r\n            }\r\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                var r = (d + Math.random() * 16) % 16 | 0;\r\n                d = Math.floor(d / 16);\r\n                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n            });\r\n\r\n        }\r\n\r\n        ,\r\n\r\n\r\n        getObjectById(id){\r\n\r\n            for(var x = 0; x < this.all_objects.length; x++)\r\n            {\r\n                if(this.all_objects[x].id == id)\r\n                {\r\n\r\n                    return this.all_objects[x];\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        },\r\n\r\n        getAllCallables: function () {\r\n            //every unique sound, animation, tweenmotion in the game\r\n\r\n            let actionables = [];\r\n\r\n            $Q.each(this.sprites, function (ix, item) {\r\n\r\n                actionables.concat(item.sounds);\r\n\r\n                actionables.concat(item.motionstacks);\r\n\r\n                actionables.concat(item.animations);\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        interlog: function (message, div) //recursive safe :: won't go crazy with recursive logs\r\n        {\r\n            this.recursionCount++;\r\n\r\n            if (!isNaN(div) && this.recursionCount % div == 0) {\r\n                //   console.log('Interval Log:'+  message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        error: function (quit, message) {\r\n\r\n            if (quit) {\r\n                throw new Error(message);\r\n\r\n            }\r\n            else {\r\n                console.error('E!' + message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        info: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.info('Info:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n\r\n        log: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.log('GameStack:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n\r\n\r\n\r\n        //animate() : main animation call, run the once and it will recurse with requestAnimationFrame(this.animate);\r\n\r\n        animate: function (time) {\r\n\r\n            __gameStack.isAtPlay = true;\r\n\r\n\r\n            TWEEN.update(time);\r\n\r\n            requestAnimationFrame(__gameStack.animate);\r\n\r\n            __gameStack.__gameWindow.update();\r\n\r\n            __gameStack.__gameWindow.ctx.clearRect(0, 0, __gameStack.__gameWindow.canvas.width, __gameStack.__gameWindow.canvas.height);\r\n\r\n            __gameStack.__gameWindow.draw();\r\n\r\n        }\r\n        ,\r\n\r\n        start: function () {\r\n\r\n            this.animate();\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        Collision: {\r\n\r\n            spriteRectanglesCollide(obj1, obj2)\r\n            {\r\n\r\n\r\n               var paddingX = Math.round(obj1.padding.x * obj1.size.x),\r\n\r\n                   paddingY =Math.round(obj1.padding.y * obj1.size.y), left = obj1.position.x + paddingX, right = obj1.position.x + obj1.size.x - paddingX,\r\n\r\n               top = obj1.position.y + paddingY, bottom = obj1.position.y + obj1.size.y - paddingY;\r\n\r\n                if (right > obj2.position.x && left < obj2.position.x + obj2.size.x &&\r\n                   bottom > obj2.position.y && top < obj2.position.y + obj2.size.y) {\r\n\r\n                    return true;\r\n\r\n                }\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n        TWEEN: TWEEN,\r\n\r\n        _gameWindow: {}\r\n        ,\r\n\r\n        setGameWindow: function (gameWindow) {\r\n\r\n            this._gameWindow = gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n       ExtendEvents:function(extendedObject, extendedKey, extendor, extendorKey)\r\n        {\r\n            var evtLink =new GSEventLink(extendedObject, extendedKey, extendor, extendorKey);\r\n\r\n            this.all_objects.push(new GSEventLink(extendedObject, extendedKey, extendor, extendorKey));\r\n\r\n            var parent = extendedObject;\r\n\r\n           // console.log(parent);\r\n\r\n            if(parent)\r\n            {\r\n                console.log('Gamestack:EXTENDING EVENTS:' + extendedKey +\":\" + extendorKey);\r\n\r\n                if(parent.onRun) //Any extendable object has an onRun ... OR\r\n                {\r\n                    parent.onRun(extendor, extendorKey);\r\n\r\n                }\r\n                if(parent.onComplete) //object has an onComplete\r\n                {\r\n                    parent.onComplete(extendor, extendorKey);\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        },\r\n\r\n        getGameWindow: function () {\r\n\r\n\r\n            return this._gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n        assignAll: function (object, args, keys) {\r\n\r\n            __gameStack.each(keys, function (ix, item) {\r\n\r\n                object[ix] = args[ix];\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        each: function (list, onResult, onComplete) {\r\n            for (var i in list) {\r\n                onResult(i, list[i]);\r\n            }\r\n\r\n            if (typeof(onComplete) === 'function') {\r\n                onComplete(false, list)\r\n            }\r\n            ;\r\n\r\n        }\r\n        ,\r\n\r\n        ready_callstack: [],\r\n\r\n        ready: function (callback) {\r\n\r\n            this.ready_callstack.push(callback);\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        reload:function()\r\n        {\r\n          this.callReady();\r\n\r\n        },\r\n\r\n        callReady: function () {\r\n\r\n            var funx = this.ready_callstack;\r\n\r\n            var gameWindow = this._gameWindow, lib = this, sprites = this.__gameWindow.sprites;\r\n\r\n            //call every function in the ready_callstack\r\n\r\n\r\n            this.each(funx, function (ix, call) {\r\n\r\n                call(lib, gameWindow, sprites);\r\n\r\n            });\r\n\r\n            this.InputEvents.init();\r\n\r\n\r\n            this.__running = true;\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        getArg: function (args, key, fallback) {\r\n            if (args && args.hasOwnProperty(key)) {\r\n                return args[key];\r\n            }\r\n            else {\r\n                return fallback;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        add: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            var __inst = this;\r\n\r\n            function isWindow()\r\n            {\r\n                return __inst.hasOwnProperty('__gameWindow') && __inst.__gameWindow instanceof GameWindow;\r\n            };\r\n\r\n            if(isWindow()) {\r\n\r\n                if (obj instanceof GameWindow) {\r\n\r\n                    this.__gameWindow = obj;\r\n\r\n                }\r\n\r\n                if (obj instanceof Force ) {\r\n\r\n                    this.__gameWindow.forces.push(obj);\r\n\r\n                }\r\n\r\n\r\n                if (obj instanceof Camera ) {\r\n\r\n                    this.__gameWindow.camera = obj;\r\n\r\n                }\r\n\r\n\r\n                if (obj instanceof Sprite ) {\r\n\r\n                    this.__gameWindow.sprites.push(obj);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (obj instanceof GSEvent) {\r\n\r\n               if(__gameStack.__running){\r\n\r\n                   return console.error('Events can only be added before Gamstack.animate() is called::aka before the main update / loop begins');\r\n               }\r\n               else\r\n               {\r\n\r\n                   obj.apply();\r\n\r\n\r\n               }\r\n\r\n            }\r\n\r\n            this.collect(obj);\r\n\r\n            return obj;\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        remove: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            if (obj instanceof Sprite) {\r\n\r\n                var ix = this.__gameWindow.sprites.indexOf(obj);\r\n\r\n                this.__gameWindow.sprites.splice(ix, 1);\r\n\r\n            }\r\n\r\n        },\r\n\r\n        all_objects: [],\r\n\r\n        collect: function (obj) {\r\n\r\n            this.all_objects.push(obj);\r\n\r\n        },\r\n\r\n\r\n        isNormalStringMatch: function (str1, str2) {\r\n\r\n            return str1.toLowerCase().replace(' ', '') == str2.toLowerCase().replace(' ', '');\r\n\r\n        },\r\n\r\n        instance_type_pairs: function () {\r\n            //get an array of all instance/type pairs added to the library\r\n\r\n            //example : [ {constructor_name:Sprite, type:enemy_basic}, {constructor_name:Animation, type:enemy_attack}  ];\r\n\r\n            var objectList = [];\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n\r\n                objectList.push({constructor_name: item.constructor.name, type: item.type});\r\n\r\n            });\r\n\r\n            return objectList;\r\n\r\n        },\r\n\r\n        getById:function(id){\r\n\r\n\r\n            for(var x in this.all_objects)\r\n            {\r\n\r\n                if(this.all_objects[x].id == id)\r\n                {\r\n                    return this.all_objects[x];\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n\r\n\r\n        },\r\n\r\n        select: function (constructor_name, name, type /*ignoring spaces and CAPS/CASE on type match*/) {\r\n\r\n\r\n            var objects_out = [];\r\n\r\n\r\n            var __inst = this;\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n                if (constructor_name == '*' || item.constructor.name == constructor_name) {\r\n\r\n                    if (type == '*' || __inst.isNormalStringMatch(type, item.type)) {\r\n\r\n                        if (name == '*' || __inst.isNormalStringMatch(name, item.name)) {\r\n\r\n                            objects_out.push(item);\r\n\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            });\r\n\r\n            return objects_out;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    return lib;\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\nlet GamestackApi =\r\n{\r\n    get:function()\r\n    {\r\n\r\n\r\n    },\r\n\r\n    post:function(object)\r\n    {\r\n        //TODO decycle the object before saving\r\n\r\n        if(!object.id)\r\n        {\r\n            object.id = Gamestack.create_id();\r\n\r\n        }\r\n\r\n        var name = object.name, type = object.constructor.name, contents = jstr(object), id = object.id;\r\n\r\n\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n/**\r\n * Simple Sound object:: implements Jquery: Audio()\r\n * @param   {string} src : source path / name of the targeted sound-file\r\n\r\n * @returns {Sound} object of Sound()\r\n * */\r\n\r\n\r\nclass Sound {\r\n\r\n    constructor(src, data) {\r\n\r\n\r\n        if (typeof(src) == 'object') {\r\n\r\n            this.sound = document.createElement('audio');\r\n\r\n            this.sound.src = src.src;\r\n\r\n            this.src = src.src;\r\n\r\n        }\r\n\r\n    else if (typeof(src) == 'string') {\r\n\r\n            this.sound = document.createElement('audio');\r\n\r\n            this.sound.src = src;\r\n\r\n            this.src = src;\r\n\r\n        }\r\n\r\n       if(typeof(data)=='object') {\r\n           for (var x in data) {\r\n               if (x !== 'sound') {\r\n                   this[x] = data[x];\r\n\r\n               }\r\n\r\n           }\r\n\r\n       }\r\n\r\n        this.onLoad = this.onLoad || function () {\r\n            };\r\n\r\n        if (typeof(this.onLoad) == 'function') {\r\n\r\n            this.onLoad(this.sound);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    volume(val)\r\n    {\r\n\r\n        this.sound.volume = val;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    play() {\r\n        if (typeof(this.sound) == 'object' && typeof(this.sound.play) == 'function') {\r\n\r\n            this.sound.play();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nclass SoundList{\r\n\r\n    constructor(list)\r\n    {\r\n\r\n       this.cix = 1;\r\n\r\n       this.sounds = [];\r\n\r\n        if(list instanceof Array)\r\n        {\r\n            for(var x in list)\r\n            {\r\n                if(list[x].src)\r\n                {\r\n                    this.sounds.push(new Sound(list[x].src, list[x]));\r\n\r\n                }\r\n                else if(typeof(list[x]) == 'string')\r\n                {\r\n                    this.sounds.push(new Sound(list[x]));\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    add(src, name)\r\n    {\r\n        if(typeof(src) == 'object' && src.src)\r\n        {\r\n            this.sounds.push(new Sound(src.src, src));\r\n\r\n        }\r\n        else if(typeof(src) == 'string')\r\n        {\r\n            var data = {};\r\n\r\n            if(name)\r\n            {\r\n                data.name = name;\r\n            }\r\n\r\n            this.sounds.push(new Sound(list[x], data));\r\n\r\n        }\r\n\r\n    }\r\n\r\n    playNext()\r\n    {\r\n        this.sounds[this.cix % this.sounds.length].play();\r\n\r\n        this.cix += 1;\r\n\r\n    }\r\n\r\n    play()\r\n    {\r\n\r\n        this.sounds[this.cix % this.sounds.length].play();\r\n\r\n        this.cix += 1;\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * GameImage\r\n *\r\n * Simple GameImage\r\n * @param   {string} src source name/path of the targeted image-file\r\n\r\n * @returns {GameImage} object of GameImage()\r\n\r\n * */\r\n\r\nclass GameImage {\r\n\r\n    constructor(src, onCreate) {\r\n\r\n        // GameStack.log('initializing image');\r\n\r\n        if (src instanceof Object) {\r\n\r\n            //alert('getting image from image');\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src.src;\r\n\r\n            this.src = src.src;\r\n\r\n        }\r\n\r\n        else if (typeof(src) == 'string') {\r\n\r\n            let ext = src.substring(src.lastIndexOf('.'), src.length);\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src;\r\n\r\n            this.src = this.image.src;\r\n\r\n\r\n        }\r\n\r\n\r\n        if (!this.image) {\r\n            this.image = {error: \"Image not instantiated, set to object by default\"};\r\n\r\n        }\r\n        else {\r\n            this.image.onerror = function () {\r\n                this.__error = true;\r\n            };\r\n\r\n        }\r\n\r\n        this.domElement = this.image;\r\n\r\n        this.image.onload = function () {\r\n\r\n            if (typeof(this.onCreate) == 'function') {\r\n\r\n                this.onCreate(this.image);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    getImage() {\r\n        return this.image;\r\n    }\r\n\r\n}\r\n\r\n\r\n//GameStack: a main / game lib object::\r\n//TODO: fix the following set of mixed references:: only need to refer to (1) lib-object-instance\r\nlet GameStack = new GameStackLibrary();\r\nGamestack = GameStack;\r\nlet __gameStack = GameStack;\r\nlet Quick2d = GameStack; //Exposing 'Quick2d' as synonymous reference to Gamestack\r\nlet __gameInstance = Gamestack;\r\n\r\nGamestack.Sound = Sound;\r\nGamestack.GameImage = GameImage;\r\n\r\nif (typeof module !== 'undefined' && module.exports) {\r\n\r\n    //This library is being instaniated via require() aka node.js require or similar library loader\r\n    module.exports = Gamestack;\r\n\r\n} else {\r\n\r\n\r\n}\r\n\r\n/***************\r\n * TODO : fix the above duplicate references, which exist now for backward compatibility with previouslyh authored code\r\n *\r\n *  -apply find and replace accross the codebase\r\n *\r\n * ****************/\r\n\r\n/********\r\n * jstr() : public function for stringified objects and arrays (uses pretty print style)\r\n * *********/\r\n\r\nfunction jstr(obj) {\r\n\r\n    return JSON.stringify(obj);\r\n\r\n};\r\n\r\nGamestack.jstr = jstr;\r\n\r\n/**********\r\n * $Q : Selector Function\r\n *  -allows string selection of library collections, etc...\r\n * Example Calls\r\n * **********/\r\n\r\n\r\nfunction $Q(selector) {\r\n\r\n    //declare events:\r\n\r\n\r\n    var $GFunx = {};\r\n\r\n    $GFunx.each = function(callback)\r\n    {\r\n\r\n        var objects = [];\r\n\r\n        for(var x = 0; x < this.length; x++)\r\n        {\r\n            if(typeof x == 'number')\r\n            {\r\n\r\n                callback(x, this[x]);\r\n            }\r\n\r\n        }\r\n\r\n\r\n    };\r\n\r\n    $GFunx.on = function (evt_key, selectorObject, controller_ix, callback) //handle each event such as on('collide') OR on('stick_left_0') << first controller stick_left\r\n    {\r\n\r\n        if(__gameStack.isAtPlay)\r\n        {\r\n            return console.error('Cannot call $Q().on while game is at play. Please rig your events before gameplay.');\r\n\r\n        }\r\n\r\n        var criterion = $Q.between('[', ']', evt_key);\r\n\r\n        if(criterion.indexOf('===') >= 0)\r\n        {\r\n            criterion = criterion.replace('===', '=');\r\n        }\r\n\r\n        if(criterion.indexOf('==') >= 0)\r\n        {\r\n            criterion =  criterion.replace('==', '=').replace('==', 0);\r\n        }\r\n\r\n       var cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n        if(evt_key.indexOf('[') >= 0)\r\n        {\r\n            evt_key = $Q.before('[', evt_key).trim();\r\n\r\n        }\r\n\r\n\r\n        var padding = 0;\r\n\r\n        if(cparts[0].toLowerCase() == 'padding')\r\n        {\r\n\r\n            padding = parseFloat(cparts[1]);\r\n\r\n            alert('padding:' + padding);\r\n\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then controller_ix is the callback aka optional argument\r\n\r\n        if(controller_ix && typeof controller_ix == 'function' && !callback)\r\n        {\r\n            callback = controller_ix;\r\n            controller_ix = 0;\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then selectorObject is the callback aka optional argument\r\n\r\n        if(selectorObject && typeof selectorObject == 'function' && !callback)\r\n        {\r\n\r\n            callback = selectorObject;\r\n\r\n            selectorObject = $Q('*');\r\n\r\n            controller_ix = 0;\r\n        };\r\n\r\n        var evt_profile = {};\r\n\r\n        //which controller?\r\n\r\n        evt_profile.cix = controller_ix;\r\n\r\n        //Need the control key: 'left_stick', 'button_0', etc..\r\n\r\n        evt_profile.evt_key = evt_key;\r\n\r\n        if($Q.contains_any(['stick', 'button', 'click', 'key'], evt_profile.evt_key))\r\n        {\r\n\r\n            var button_mode = evt_profile.evt_key.indexOf('button') >= 0;\r\n\r\n            Gamestack.GamepadAdapter.on(evt_profile.evt_key, 0, function (x, y) {\r\n\r\n               callback(x, y);\r\n\r\n            });\r\n\r\n            console.info('detected input event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig events');\r\n\r\n        }\r\n\r\n        //TODO: test collision events:\r\n\r\n      else if($Q.contains_any(['collide', 'collision', 'hit', 'touch'],  evt_profile.evt_key))\r\n        {\r\n\r\n            console.info('Rigging a collision event');\r\n\r\n            console.info('detected collision event key in:' +  evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig collision events');\r\n\r\n            this.each(function(ix, item1){\r\n\r\n                selectorObject.each(function(iy, item2){\r\n\r\n                    if(typeof(item1.onUpdate) == 'function')\r\n                    {\r\n\r\n                        item1.onUpdate(function(sprite){\r\n\r\n                            if(item1.collidesRectangular(item2, padding))\r\n                            {\r\n\r\n                              callback(item1, item2);\r\n\r\n                            };\r\n\r\n                        });\r\n\r\n                    }\r\n\r\n\r\n                });\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n       else {\r\n            console.info('Rigging a property event');\r\n\r\n            //TODO: test property-watch events:\r\n\r\n            console.info('detected property threshhold event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig property events');\r\n\r\n            var condition = \"_\", key = criterion || evt_profile.evt_key;\r\n\r\n            if(key.indexOf('[') >= 0 || key.indexOf(']') >= 0)\r\n            {\r\n                key = $Q.between('[', ']', key);\r\n\r\n            }\r\n\r\n            var evt_parts = [];\r\n\r\n            var run = function()\r\n            {\r\n                console.error('Sprite property check was not set correctly');\r\n\r\n            };\r\n\r\n            if(key.indexOf('>=') >= 0)\r\n            {\r\n                condition = \">=\";\r\n\r\n\r\n            }\r\n           else if(key.indexOf('<=') >= 0)\r\n            {\r\n                condition = \"<=\";\r\n            }\r\n           else if(key.indexOf('>') >= 0)\r\n            {\r\n                condition = \">\";\r\n            }\r\n          else if(key.indexOf('<') >= 0)\r\n            {\r\n                condition = \"<\";\r\n            }\r\n\r\n            else if(key.indexOf('=') >= 0)\r\n            {\r\n                condition = \"=\";\r\n            }\r\n\r\n            evt_parts = key.split(condition);\r\n\r\n            for(var x = 0; x < evt_parts.length; x++)\r\n            {\r\n                evt_parts[x] = evt_parts[x].replace('=', '').replace('=', '').trim(); //remove any trailing equals and trim()\r\n\r\n            }\r\n\r\n            var mykey, number;\r\n\r\n           // alert(evt_parts[0]);\r\n\r\n            try{\r\n\r\n            mykey = evt_parts[0];\r\n\r\n            number = parseFloat(evt_parts[1]);\r\n\r\n            }\r\n            catch(e)\r\n            {\r\n                console.log(e);\r\n            }\r\n\r\n            console.info('Gamestack:Processing condition with:' + condition);\r\n\r\n            switch(condition)\r\n            {\r\n\r\n                case \">=\":\r\n\r\n\r\n                    run = function(obj, key){ if(obj[key] >= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] <= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n\r\n                case \">\":\r\n\r\n                    run = function(obj, key){ if(obj[key] > number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<\":\r\n\r\n                    run = function(obj, key){ if(obj[key] < number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] == number){ callback(); } };\r\n\r\n                    break;\r\n\r\n            }\r\n\r\n\r\n            /************\r\n             * Attach update to each member\r\n             *\r\n             * **************/\r\n\r\n            var keys = mykey.split('.'), propkey = \"\";\r\n\r\n            this.each(function(ix, item){\r\n\r\n                var object = {};\r\n\r\n                if(keys.length == 1)\r\n                {\r\n                    object = item;\r\n\r\n                    propkey = mykey;\r\n\r\n                }\r\n                else if(keys.length == 2)\r\n                {\r\n                    object = item[keys[0]];\r\n\r\n                    propkey = keys[1];\r\n\r\n\r\n                }\r\n\r\n                else if(keys.length == 3)\r\n                {\r\n                    object = item[keys[0]][keys[1]];\r\n\r\n                    propkey = keys[2];\r\n\r\n                }\r\n                else\r\n                {\r\n                    console.error(\":length of '.' notation out of range. We use max length of 3 or prop.prop.key.\");\r\n\r\n                }\r\n\r\n                if(typeof item.onUpdate == 'function')\r\n                {\r\n\r\n\r\n                    var spr = item;\r\n\r\n                    item.onUpdate(function(sprite){\r\n\r\n                        run(object, propkey);\r\n\r\n                    });\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n    };\r\n\r\n\r\n    var object_out = {};\r\n\r\n    //handle selector / selection of objects:\r\n\r\n    if(selector && selector !== '*')\r\n    {\r\n\r\n    var s = selector || '';\r\n\r\n    console.info('selector:' + s);\r\n\r\n    var mainSelector = $Q.before('[', s).trim(), msfChar = mainSelector.substring(0, 1);\r\n\r\n    var __targetClassName = \"*\";\r\n\r\n    var output = [];\r\n\r\n    var cleanSelectorString = function(str)\r\n    {\r\n        return str.replace(\",\", \"\");\r\n    };\r\n\r\n    switch (msfChar.toLowerCase()) {\r\n        case \".\":\r\n\r\n            console.info('Selecting by \".\" or class');\r\n\r\n            __targetClassName = cleanSelectorString($Q.after('.', mainSelector));\r\n\r\n            console.info('Target class is:' + __targetClassName);\r\n\r\n            break;\r\n\r\n        case \"*\":\r\n\r\n            console.info('Selecting by \"*\" or ANY object in the library instance');\r\n\r\n            __targetClassName = \"*\";\r\n\r\n            break;\r\n\r\n    }\r\n\r\n         var criterion = $Q.between('[', ']', s), cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n  var getParts = function() {\r\n\r\n      if(cparts.length >= 2) {\r\n\r\n          switch (cparts[0].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      if(cparts.length >= 4) {\r\n\r\n          cparts[2] = cparts[2].replace(\",\", \"\");\r\n\r\n          switch (cparts[2].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      };\r\n\r\n  getParts(cparts);\r\n\r\n\r\n        object_out = GameStack.select(__targetClassName, __targetName, __targetType);\r\n    }\r\n   else if(selector == '*')\r\n    {\r\n        object_out = GameStack.all_objects;\r\n\r\n    }\r\n\r\n   for(var x in $GFunx)\r\n   {\r\n       object_out[x] = $GFunx[x];\r\n\r\n   };\r\n\r\n   return object_out;\r\n\r\n}\r\n\r\n\r\n$Q.each = function (obj, callback, complete) {\r\n\r\n    for(var x in obj)\r\n    {\r\n        callback(obj);\r\n\r\n    }\r\n\r\n    if(typeof(complete) == 'function')\r\n    {\r\n        complete(obj);\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\n$Q.before = function (c1, test_str) {\r\n    var start_pos = 0;\r\n    var end_pos = test_str.indexOf(c1, start_pos);\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n\r\n$Q.contains = function (c1, test_str) {\r\n    return test_str.indexOf(c1) >= 0;\r\n};\r\n\r\n$Q.contains_all = function (cList, test_str) {\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) < 0) {\r\n            return false;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n};\r\n\r\n$Q.contains_any = function (cList, test_str) {\r\n\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) >= 0) {\r\n            return true;\r\n\r\n        }\r\n    }\r\n\r\n    return false;\r\n\r\n};\r\n\r\n$Q.after = function (c1, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.length;\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n$Q.between = function (c1, c2, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.indexOf(c2, start_pos);\r\n    return test_str.substring(start_pos, end_pos)\r\n};\r\n\r\n\r\n$Q.test_selector_method =  function () { //leftover method of hand-testing\r\n    var Q_TestStrings = ['*', '.Sprite', '*[type=\"enemy_type_0\"]', '.Sprite[type=\"enemy_type_0\"]'];\r\n\r\n    for (var x = 0; x < Q_TestStrings.length; x++) {\r\n        var test = Q_TestStrings[x];\r\n\r\n        console.info('testing:' + test);\r\n\r\n        $Q(test);\r\n    }\r\n\r\n    console.log('Testing stick left');\r\n\r\n    this.on('stick_left_0');\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('button_0');\r\n\r\n\r\n    console.log('Testing collide');\r\n\r\n    this.on('collide');\r\n\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('collide');\r\n\r\n    console.log('Testing prop');\r\n\r\n    this.on('health>=0');\r\n\r\n\r\n};\r\n\r\n\r\nGamestack.$Q = $Q;\r\n\r\nGamestack.query = $Q;\r\n\r\n/********************\r\n * GameStack.InputEvents\r\n * -Various PC Input Events\r\n ********************/\r\n\r\nGamestack.InputEvents = { //PC input events\r\n    mousemove: [],\r\n    leftclick: [],\r\n    rightclick: [],\r\n    middleclick: [],\r\n    wheelup: [],\r\n    wheelDown: [],\r\n    space: [],\r\n    tab: [],\r\n    shift: [],\r\n    1: [], 2: [], 3: [],\r\n    enter: [],\r\n    extend: function (evt_key, callback, onFinish) {\r\n\r\n        if (evt_key.toLowerCase().indexOf('key_') >= 0) {\r\n            //process this as a key event\r\n\r\n            var cleanKey = evt_key.toLowerCase();\r\n            GameStack.InputEvents[cleanKey] = GameStack.InputEvents[cleanKey] || [];\r\n            return GameStack.InputEvents[cleanKey].push({down: callback, up: onFinish});\r\n        } else {\r\n\r\n            GameStack.InputEvents[evt_key] = GameStack.InputEvents[evt_key] || [];\r\n            return GameStack.InputEvents[evt_key].push({down: callback, up: onFinish});\r\n        }\r\n\r\n    },\r\n    init: function () {\r\n\r\n\r\n        function getMousePos(e) {\r\n\r\n            var x;\r\n            var y;\r\n            if (e.pageX || e.pageY) {\r\n                x = e.pageX;\r\n                y = e.pageY;\r\n            } else {\r\n                x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n                y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n            }\r\n            x -= GameStack.canvas.offsetLeft;\r\n            y -= GameStack.canvas.style.top;\r\n            return {x: x, y: y};\r\n        }\r\n\r\n\r\n        function fullMoveInputEvents(event) {\r\n\r\n            var pos = getMousePos(event);\r\n            var InputEvents = GameStack.InputEvents;\r\n            for (var x in InputEvents) {\r\n\r\n\r\n                if (InputEvents[x] instanceof Array && x == 'mousemove') {\r\n\r\n\r\n                    GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                        el.down(pos.x, pos.y);\r\n                    });\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n        ;\r\n        document.onkeydown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            GameStack.log('Got e');\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.log('Got []');\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.down) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.down();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n\r\n        document.onkeyup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.up) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.up();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n\r\n        GameStack.canvas.onmousedown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n\r\n                            return false;\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n            e.preventDefault();\r\n            return 0;\r\n        };\r\n        GameStack.canvas.onmouseup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n\r\n\r\n                            return false;\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n        };\r\n        document.addEventListener(\"mousemove\", fullMoveInputEvents);\r\n    }\r\n\r\n\r\n};\r\n\r\n\r\n//Override the existing window.onload function\r\n\r\nwindow._preGameStack_windowLoad = window.onload;\r\n\r\nwindow.onload = function () {\r\n\r\n    if (typeof(window._preGameStack_windowLoad) == 'function') {\r\n        window._preGameStack_windowLoad();\r\n    }\r\n\r\n    __gameStack.callReady();\r\n\r\n}\r\n\r\n\r\n/*\r\n * Canvas\r\n *    draw animations, textures to the screen\r\n * */\r\n\r\nGamestack.ready(function (lib) {\r\n\r\n    Gamestack.log('GameStack:lib :: ready');\r\n\r\n\r\n});\r\n\r\n\r\n\r\n/**\r\n * Instantiates a GameWindow object\r\n * @param   {Object} args : the object of arguments\r\n * @param   {Object} args.canvas : the canvas object of the window: GameWindow constructor will create one if not supplied in args\r\n *\r\n * @param   {Object} args.ctx : the canvas context\r\n *\r\n * @param   {Array} args.sprites : the list of sprites, to be applied with GameWindow\r\n *\r\n * @param   {Array} args.forces : the list of forces, such as gravity, to be applied with GameWindow\r\n *\r\n\r\n * @returns {GameWindow} object of GameWindow()\r\n * */\r\n\r\n\r\n\r\nclass GameWindow {\r\n\r\n    constructor({canvas=false, ctx, sprites, backgrounds, interactives, forces, update, camera}={}) {\r\n\r\n        this.sprites = sprites instanceof Array ? sprites : [];\r\n\r\n        this.backgrounds = backgrounds instanceof Array ? backgrounds : [];\r\n\r\n        this.interactives = interactives instanceof Array ? interactives : [];\r\n\r\n        this.forces = forces instanceof Array ? forces : [];\r\n\r\n        this.canvas = canvas|| false;\r\n\r\n        document.body.style.position = \"absolute\";\r\n\r\n        document.body.style.width = \"100%\";\r\n\r\n        document.body.style.height = \"100%\";\r\n\r\n        if(!this.canvas)\r\n        {\r\n            console.info('creating new canvas');\r\n            this.canvas = document.createElement('CANVAS');\r\n\r\n            document.body.append(this.canvas);\r\n\r\n\r\n\r\n        }\r\n\r\n        this.canvas.style.position = 'absolute';\r\n\r\n        this.canvas.style.width = '100%';\r\n\r\n        this.canvas.style.height = '100%';\r\n\r\n        this.canvas.style.background = 'black';\r\n\r\n        var c = this.canvas;\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n\r\n        __gameStack.canvas = this.canvas;\r\n\r\n        __gameStack.ctx = this.ctx;\r\n\r\n\r\n        this.adjustSize();\r\n\r\n        window.onresize = function(){\r\n\r\n            __gameStack.__gameWindow.adjustSize();\r\n\r\n        };\r\n\r\n        this.camera = new Camera();\r\n\r\n        this.camera.target = false;\r\n\r\n        __gameStack.camera = this.camera;\r\n\r\n        if (typeof update == 'function') {\r\n            this.onUpdate(update);\r\n\r\n        }\r\n\r\n       __gameStack.__gameWindow = this;\r\n\r\n}\r\n\r\n    adjustSize(w, h)\r\n    {\r\n\r\n\r\n\r\n        w = w || this.canvas.clientWidth;\r\n\r\n        h = h || this.canvas.clientHeight;\r\n\r\n      var c = document.getElementById('#gs-container');\r\n\r\n      if(c){c.setAttribute('width', w) };\r\n\r\n        if(c){c.setAttribute('height', h) };\r\n\r\n        __gameStack.WIDTH = w;\r\n\r\n        __gameStack.HEIGHT = h;\r\n\r\n        this.canvas.width = w;\r\n\r\n        this.canvas.height = h;\r\n\r\n    }\r\n\r\n    uniques(list) {\r\n\r\n        var listout = [];\r\n\r\n        $Q.each(list, function (ix, item) {\r\n\r\n            if (!listout.indexOf(item.id) >= 0) {\r\n\r\n                var str = item.name;\r\n\r\n                listout.push({\"sprite\": item});\r\n\r\n            }\r\n\r\n        });\r\n\r\n        return listout;\r\n\r\n    }\r\n\r\n    setPlayer(player) {\r\n        this.player = player;\r\n\r\n        if (!this.sprites.indexOf(player) >= 0) {\r\n            this.sprites.push(player);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.update) == 'function') {\r\n                item.update(item);\r\n\r\n            }\r\n\r\n\r\n\r\n        });\r\n\r\n\r\n\r\n        GameStack.each(this.forces, function (ix, item) {\r\n\r\n            if (typeof(item.update) == 'function') {\r\n\r\n                item.update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n                //  console.log('def_update');\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n        });\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    loadLevelFile(filepath, callback)\r\n    {\r\n\r\n        $.getJSON(filepath, function(data) {\r\n\r\n            callback(false, data);\r\n\r\n        });\r\n    }\r\n\r\n\r\n    draw() {\r\n\r\n        var _gw = this;\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            Canvas.draw(item, _gw.ctx);\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\n\r\nGamestack.GameWindow = GameWindow;\r\n\r\n\r\n/**\r\n * Instantiates a TextDisplay(), HTML/DOM object\r\n * @param   {Object} args the object of arguments\r\n * @param   {Number} args.widthFloat the pct 0-1.0 of screen-Width\r\n * @param   {Number} args.heightFloat the pct 0-1.0 of screen-Height\r\n *\r\n * @param   {Number} args.topFloat the pct 0-1.0 of screen-top-margin\r\n * @param   {Number} args.leftFloat the pct 0-1.0 of screen-left-margin\r\n * @param   {Number} args.targetLeft the pct 0-1.0 of target-left location (for slide-animation behavior)\r\n * @param   {Number} args.targetTop the pct 0-1.0 of target-top location (for slide-animation behavior)\r\n * @param   {string} args.color the css-text-color\r\n * @param   {string} args.text the text-value\r\n *\r\n * @param   {string} args.fontFamily the css fontFamily\r\n\r\n * @param {boolean} args.fromTop true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromBottom true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromLeft true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromRight true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n *@returns TextDisplay()\r\n *\r\n * */\r\n\r\n\r\nclass TextDisplay {\r\n\r\n    constructor(args)\r\n    {\r\n        if(!args)\r\n        {\r\n            args = {};\r\n\r\n        }\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.5;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.5;\r\n\r\n        this.topFloat = args.top || 0.25;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, document.body.clientHeight);\r\n\r\n        this.leftFloat = args.left || 0.25;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,document.body.clientWidth);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fadeIn = args.fadeIn || args.fade || true;\r\n\r\n        this.border = \"2px inset \" + this.color;\r\n\r\n        this.fontSize = args.fontSize || \"20px\";\r\n\r\n        this.fromLeft = args.fromLeft || false;\r\n\r\n        if(this.fromLeft){ this.leftFloat = 1.5; }\r\n\r\n        this.fromRight = args.fromRight || false;\r\n\r\n        if(this.fromRight){ this.leftFloat = -0.5; }\r\n\r\n        this.fromTop = args.fromTop || false;\r\n\r\n        if(this.fromTop){ this.topFloat = -0.5; }\r\n\r\n        this.fromBottom = args.fromBottom || false;\r\n\r\n        if(this.fromBottom){ this.topFloat = 1.5; }\r\n\r\n        this.duration = args.duration || 5000;\r\n\r\n        this.stay_duration = Math.round(this.duration / 2);\r\n\r\n        this.complete = args.complete || function(){};\r\n\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    onComplete(fun){\r\n\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    show()\r\n    {\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('P');\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = Math.round(document.body.clientHeight * this.topFloat) + 'px';\r\n\r\n        this.domElement.style.left = Math.round(document.body.clientWidth * this.leftFloat) + 'px';\r\n\r\n        this.domElement.style.width = Math.round(document.body.clientWidth * this.widthFloat) + 'px';\r\n\r\n        this.domElement.style.height = Math.round(document.body.clientHeight * this.heightFloat) + 'px';\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.display = \"block\";\r\n\r\n        this.domElement.style.textAlign = \"center\";\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.innerText = this.text;\r\n\r\n        this.domElement.textContent = this.text;\r\n\r\n        this.domElement.style.opacity = this.fadeIn ?  0 : 1.0;\r\n\r\n        this.domElement.id = GameStack.create_id();\r\n\r\n        document.body.append(this.domElement);\r\n\r\n\r\n        var __inst = this;\r\n\r\n        Velocity(this.domElement, { opacity:1.0, top:this.targetTop, left:this.targetLeft}, { duration: this.duration, easing:\"quadratic\"});\r\n\r\n        window.setTimeout(function(){\r\n\r\n            if(__inst.stay_duration >= 1)\r\n            {\r\n                window.setTimeout(function(){\r\n\r\n                    Velocity(__inst.domElement, { opacity:0, display:'none'}, { duration:300, easing:\"linear\"});\r\n\r\n                    if(typeof(__inst.complete) == 'function')\r\n                    {\r\n                        __inst.complete();\r\n\r\n                    }\r\n\r\n\r\n\r\n                }, __inst.stay_duration);\r\n\r\n            }\r\n\r\n\r\n        }, this.duration);\r\n\r\n    }\r\n\r\n}\r\n\r\nGamestack.TextDisplay = TextDisplay;\r\n\r\n\r\n\r\n/**\r\n * Instantiates an ItemDisplay() object : Displays item-image with number, such as the number of theoretical Coins collected\r\n * @param   {Object} args the object of arguments\r\n * @param   {string} args.src the src of the image\r\n * @param   {Vector} args.size the size(x, y) of the image, when displayed\r\n * @param   {Number} args.topFloat the pct 0-1.0 of screen-top-margin\r\n * @param   {Number} args.leftFloat the pct 0-1.0 of screen-left-margin\r\n * @param   {Number} args.targetLeft the pct 0-1.0 of target-left location (for slide-animation behavior)\r\n * @param   {Number} args.targetTop the pct 0-1.0 of target-top location (for slide-animation behavior)\r\n * @param   {string} args.color the css-text-color\r\n * @param   {string} args.text the text-value\r\n *\r\n * @param   {string} args.fontFamily the css fontFamily\r\n * @param   {string} args.fontSize the size of font\r\n *\r\n *@returns ItemDisplay()\r\n *\r\n * */\r\n\r\n\r\nclass ItemDisplay //show an item display (image with text/number to the right\r\n{\r\n    constructor(args) {\r\n\r\n        this.src = args.src || \"__NONE\";\r\n\r\n        this.size = args.size || new Vector3(50, 50);\r\n\r\n        this.topFloat = args.top || 0;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.leftFloat = args.left || 0;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,GameStack.WIDTH);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fontSize = args.fontSize || args.textSize || \"15px\";\r\n\r\n        this.text_id = GameStack.create_id();\r\n\r\n        this.id = GameStack.create_id();\r\n\r\n        this.img_id = GameStack.create_id();\r\n\r\n    }\r\n\r\n    setValue(value)\r\n    {\r\n        document.getElementById(this.text_id)\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n\r\n    get_id()\r\n    {\r\n        return  this.id;\r\n    }\r\n\r\n    update(v)\r\n    {\r\n        var e = document.getElementById(this.text_id);\r\n\r\n        this.text = v + \"\";\r\n\r\n        e.innerText = this.text;\r\n    }\r\n\r\n    show() {\r\n\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('DIV');\r\n\r\n        this.domElement.setAttribute('class', 'gameStack-stats');\r\n\r\n        this.domElement.innerHTML+='<img style=\"float:left;\" width=\"'+this.size.x+'\" height=\"'+this.size.y+'\" id=\"'+this.img_id+'\" src=\"'+this.src+'\"/>';\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.innerHTML+='<span id=\"'+this.text_id+'\" style=\"padding:5px; vertical-align:middle; display:table-cell; font-size:'+this.fontSize+'; color:'+this.color+';\">'+this.text+'</span>';\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        //this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = this.targetTop;\r\n\r\n        this.domElement.style.left = this.targetLeft;\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.id = this.id;\r\n\r\n        document.body.append(this.domElement);\r\n    }\r\n}\r\n\r\nGamestack.ItemDisplay = ItemDisplay;\r\n\r\nclass Bar\r\n{\r\n    constructor(background, border)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.position = 'fixed';\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.zIndex = \"9999\";\r\n\r\n        e.style.backgroundSize = \"100% 100%\";\r\n\r\n        e.style.backgroundPosition = \"center bottom\";\r\n\r\n        if(border)\r\n        {\r\n            e.style.border = border;\r\n\r\n        }\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\nGamestack.Bar = Bar;\r\n\r\nclass BarFill\r\n{\r\n    constructor(background)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.position = 'fixed';\r\n\r\n\r\n        e.style.zIndex = \"9995\";\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\nGamestack.BarFill = BarFill;\r\n\r\nclass BarDisplay //show a display bar such as health bar\r\n{\r\n    constructor(args={}) {\r\n\r\n        this.border = args.border || \"none\";\r\n\r\n        if(args.fill_src)\r\n        {\r\n            this.fill = new BarFill(args.fill_src).width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.fill = args.fill || new BarFill(args.fill_color || 'green').width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n\r\n        if(args.bar_src)\r\n        {\r\n            this.bar = new Bar(args.bar_src, this.border).width(args.bar_width || \"80px\").height(args.bar_height  || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.bar = new Bar(args.bar_color || 'goldenrod', this.border).width(args.bar_width  || \"80px\").height(args.bar_height || \"10px\");\r\n        }\r\n\r\n\r\n        this.topFloat = args.top || args.topFloat || 0.25;\r\n\r\n        this.leftFloat = args.left || args.leftFloat || 0.25;\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.25;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.25;\r\n\r\n        document.body.append(this.fill.domElement);\r\n\r\n        document.body.append(this.bar.domElement);\r\n\r\n\r\n    }\r\n\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    portion_top(v)\r\n    {\r\n\r\n        this.fill.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    portion_left(v)\r\n    {\r\n\r\n        this.fill.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n    }\r\n\r\n    portion_width(w)\r\n    {\r\n\r\n        this.fill.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n\r\n    }\r\n\r\n    portion_height(h)\r\n    {\r\n        this.fill.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    update(f)\r\n    {\r\n        this.fill.domElement.style.width = this.get_float_pixels(f || 0,  parseFloat(this.bar.domElement.style.width));\r\n\r\n    }\r\n\r\n}\r\n\r\nGamestack.BarDisplay = BarDisplay;\r\n\r\nclass VideoDisplay //show a video\r\n{\r\n    constructor({src, size}) {\r\n\r\n        this.domElement = undefined;\r\n\r\n        this.src = src;\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z || 0);\r\n\r\n        GameStack.log('VideoDisplay():: TODO: create dom element');\r\n\r\n    }\r\n\r\n    play() {\r\n\r\n    }\r\n}\r\n\r\nGamestack.VideoDisplay = VideoDisplay;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;/**\r\n * Takes an object of arguments and returns Animation() object.\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {string} args.type optional\r\n * @param   {Vector} args.size of the Animation object, has x and y properties\r\n * @param   {Vector} args.frameSize the size of frames in Animation, having x and y properties\r\n * @param   {VectorFrameBounds} args.frameBounds the bounds of the Animation having min, max, and termPoint properties\r\n * @param   {number} args.delay optional, the seconds to delay before running animation when started by the start() function\r\n\r\n * @param   {number} args.duration how many milliseconds the animation should take to complete\r\n *\r\n * @returns {Animation} an Animation object\r\n */\r\n\r\nclass Animation {\r\n\r\n    constructor(args = {}) {\r\n\r\n        args = args || {};\r\n\r\n        var _anime = this;\r\n\r\n        this.defaultArgs = {\r\n\r\n            name: \"my-animation\",\r\n\r\n            description: \"my-description\",\r\n\r\n            frames: [],\r\n\r\n            type: \"none\",\r\n\r\n            delay: 0,\r\n\r\n            frameSize: new Vector3(44, 44, 0),\r\n\r\n            frameBounds: new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0)),\r\n\r\n            frameOffset: new Vector3(0, 0, 0),\r\n\r\n            flipX: false,\r\n\r\n            duration: 1000,\r\n\r\n            size: new Vector3(20, 20, 20),\r\n\r\n            reverse_frames: false\r\n        };\r\n\r\n        for (var x in this.defaultArgs) {\r\n            if (!args.hasOwnProperty(x)) {\r\n                args[x] = this.defaultArgs[x]\r\n\r\n            }\r\n\r\n        }\r\n        ;\r\n\r\n        for (var x in this.args) {\r\n            this[x] = args[x];\r\n\r\n        }\r\n\r\n        this.name = args.name || \"__animationName\";\r\n\r\n\r\n        this.description = args.description || \"__animationDesc\";\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.src = this.image.domElement.src;\r\n\r\n        this.domElement = this.image.domElement;\r\n\r\n        var __inst = this;\r\n\r\n        this.domElement.onload = function()\r\n        {\r\n\r\n        __inst.__isValid = true;\r\n\r\n        };\r\n\r\n        this.frameSize = new Vector(args.frameSize || new Vector3(44, 44, 0));\r\n\r\n        if (args.frameBounds) {\r\n            this.frameBounds = new VectorFrameBounds(args.frameBounds.min, args.frameBounds.max, args.frameBounds.termPoint);\r\n\r\n        }\r\n        else {\r\n            this.frameBounds = new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0))\r\n\r\n        }\r\n\r\n        this.frameOffset = this.getArg(args, 'frameOffset', new Vector3(0, 0, 0));\r\n\r\n        if (typeof(args) == 'object' && args.frameBounds && args.frameSize) {\r\n            this.apply2DFrames();\r\n        }\r\n        ;\r\n\r\n        this.flipX = this.getArg(args, 'flipX', false);\r\n\r\n        this.cix = 0;\r\n\r\n        this.selected_frame = this.frames[0] || {};\r\n\r\n        this.timer = 0;\r\n\r\n        this.duration = args.duration || 2000;\r\n\r\n        this.seesaw_mode = args.seesaw_mode || false;\r\n\r\n        this.reverse_frames = args.reverse_frames || false;\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n        this.complete_ext = args.complete_ext || [];\r\n\r\n    }\r\n\r\n    /*****\r\n    * Overridable / Extendable functions\r\n    * -allows stacking of external object-function calls\r\n    ******/\r\n\r\n    onRun(caller, callkey) {\r\n        this.run_ext = this.run_ext || [];\r\n\r\n        if (this.run_ext.indexOf(caller[callkey]) == -1) {\r\n            this.run_ext.push({caller: caller, callkey: callkey});\r\n        }\r\n    }\r\n\r\n    onComplete(caller, callkey) {\r\n        this.complete_ext = this.complete_ext || [];\r\n\r\n        if (this.complete_ext.indexOf(caller[callkey]) == -1) {\r\n            this.complete_ext.push({caller: caller, callkey: callkey});\r\n        }\r\n    }\r\n\r\n    call_on_run() {\r\n        //call any function extension that is present\r\n        for (var x = 0; x < this.run_ext.length; x++) {\r\n            this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n        }\r\n    }\r\n\r\n    call_on_complete() {\r\n        //call any function extension that is present\r\n        for (var x = 0; x < this.complete_ext.length; x++) {\r\n            this.complete_ext[x].caller[this.complete_ext[x].callkey]();\r\n        }\r\n    }\r\n\r\n    reverseFrames() {\r\n\r\n        this.frames.reverse();\r\n\r\n    }\r\n\r\n    singleFrame(frameSize, size) {\r\n        this.__frametype = 'single';\r\n\r\n        this.frameSize = frameSize || this.frameSize;\r\n\r\n        this.size = size || this.frameSize;\r\n\r\n        this.selected_frame = {\r\n            image: this.image,\r\n            frameSize: this.frameSize,\r\n            framePos: {x: 0, y: 0}\r\n        };\r\n\r\n        this.frames[0] = this.selected_frame;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n    }\r\n\r\n    apply2DFrames() {\r\n\r\n        this.frames = [];\r\n\r\n        var fcount = 0;\r\n\r\n        var quitLoop = false;\r\n\r\n        for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n            for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n                let framePos = {\r\n                    x: x * this.frameSize.x + this.frameOffset.x,\r\n                    y: y * this.frameSize.y + this.frameOffset.y\r\n                };\r\n\r\n                this.frames.push({image: this.image, frameSize: this.frameSize, framePos: framePos});\r\n\r\n                if (x >= this.frameBounds.termPoint.x && y >= this.frameBounds.termPoint.y) {\r\n\r\n                    quitLoop = true;\r\n\r\n                    break;\r\n                }\r\n\r\n                fcount += 1;\r\n\r\n                if (quitLoop)\r\n                    break;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.frames[0] = !this.frames[0] ? {\r\n            image: this.image,\r\n            frameSize: this.frameSize,\r\n            framePos: {x: this.frameBounds.min.x, y: this.frameBounds.min.y}\r\n        } : this.frames[0];\r\n\r\n\r\n        if (this.seesaw_mode) {\r\n            console.log('ANIMATION: applying seesaw');\r\n\r\n            var frames_reversed = this.frames.slice().reverse();\r\n\r\n            this.frames.pop();\r\n\r\n            this.frames = this.frames.concat(frames_reversed);\r\n\r\n        }\r\n        if (this.reverse_frames) {\r\n            this.reverseFrames();\r\n        }\r\n\r\n        // this.selected_frame = this.frames[this.cix % this.frames.length] || this.frames[0];\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        this.selected_frame = this.frames[Math.round(this.cix) % this.frames.length];\r\n\r\n    }\r\n\r\n    reset() {\r\n\r\n        this.apply2DFrames();\r\n\r\n        this.cix = 0;\r\n\r\n    }\r\n\r\n    continuous(duration) {\r\n\r\n        if (this.__frametype == 'single') {\r\n            return 0;\r\n\r\n        }\r\n\r\n        this.apply2DFrames();\r\n\r\n        //update once:\r\n        this.update();\r\n\r\n        if (this.cix == 0) {\r\n\r\n            this.engage();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    engage(duration, complete) {\r\n        this.call_on_run();\r\n        duration = duration || 2000;\r\n\r\n        if (this.__frametype == 'single') {\r\n            return 0;\r\n\r\n        }\r\n\r\n        let __inst = this;\r\n\r\n        this.complete = complete || this.complete || function () {\r\n            };\r\n\r\n        var duration = duration || typeof(this.duration) == 'number' ? this.duration : this.frames.length * 20;\r\n\r\n\r\n        //we have a target\r\n        this.tween = new TWEEN.Tween(this)\r\n            .easing(__inst.curve || TWEEN.Easing.Linear.None)\r\n\r\n            .to({cix: __inst.frames.length - 1}, duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n                //   __inst.cix = Math.ceil(__inst.cix);\r\n\r\n                __inst.update();\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n               __inst.call_on_complete();\r\n\r\n                __inst.cix = 0;\r\n\r\n                __inst.isComplete = true;\r\n\r\n            });\r\n\r\n        this.tween.start();\r\n\r\n    }\r\n\r\n    animate() {\r\n\r\n        this.apply2DFrames();\r\n\r\n        this.timer += 1;\r\n\r\n        if (this.delay == 0 || this.timer % this.delay == 0) {\r\n\r\n            if (this.cix >= this.frames.length - 1) {\r\n                this.call_on_complete();\r\n\r\n            }\r\n\r\n            this.cix = this.cix >= this.frames.length - 1 ? this.frameBounds.min.x : this.cix + 1;\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\nGamestack.Animation = Animation;;/**\r\n * Camera : has simple x, y, z, position / Vector values\r\n *\r\n * @returns {Vector}\r\n */\r\n\r\n\r\nclass Camera\r\n{\r\n\r\n    constructor(args)\r\n    {\r\n\r\n      this.position = new Vector3(0, 0, 0);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n;\r\n\r\n/**\r\n * instantiates Gamestack.js Canvas (CanvasLib) controller\r\n\r\n @description\r\n This Canvas library handles the low-level drawing of Sprite() objects on HTML5Canvas.\r\n -draws Sprites(), handling their rotation, size, and other parameters.\r\n * @returns {CanvasLib} a CanvasLib object\r\n */\r\n\r\nclass CanvasLib {\r\n\r\n    constructor() {\r\n\r\n        return {\r\n\r\n            __levelMaker: false,\r\n\r\n            draw: function (sprite, ctx) {\r\n\r\n                if (sprite.active && (this.__levelMaker || sprite.onScreen(__gameStack.WIDTH, __gameStack.HEIGHT))) {\r\n\r\n                    this.drawPortion(sprite, ctx);\r\n\r\n                }\r\n\r\n            },\r\n            drawFrameWithRotation: function (img, fx, fy, fw, fh, x, y, width, height, deg, canvasContextObj, flip) {\r\n\r\n                canvasContextObj.save();\r\n                deg = Math.round(deg);\r\n                deg = deg % 360;\r\n                var rad = deg * Math.PI / 180;\r\n                //Set the origin to the center of the image\r\n                canvasContextObj.translate(x, y);\r\n                canvasContextObj.rotate(rad);\r\n                //Rotate the canvas around the origin\r\n\r\n                canvasContextObj.translate(0, canvasContextObj.width);\r\n                if (flip) {\r\n\r\n                    canvasContextObj.scale(-1, 1);\r\n                } else {\r\n\r\n                }\r\n\r\n                //draw the image\r\n                canvasContextObj.drawImage(img, fx, fy, fw, fh, width / 2 * (-1), height / 2 * (-1), width, height);\r\n                //reset the canvas\r\n\r\n                canvasContextObj.restore();\r\n            },\r\n\r\n\r\n\r\n            drawData:function(x, y, w, h, data, ctx){\r\n\r\n                ctx.putImageData(data, x, y, 0, 0, w, h);\r\n\r\n            },\r\n\r\n\r\n            /*\r\n             * drawPortion:\r\n             *\r\n             *   expects: (sprite{selected_animation{selected_frame{frameSize, framePos } offset?, gameSize? }  })\r\n             *\r\n             *\r\n             * */\r\n\r\n            drawPortion: function (sprite, ctx) {\r\n\r\n                var frame;\r\n\r\n                if (sprite.active) {\r\n\r\n                    if (sprite.selected_animation && sprite.selected_animation.selected_frame) {\r\n\r\n                        frame = sprite.selected_animation.selected_frame;\r\n\r\n                    }\r\n                    else {\r\n\r\n                        console.error('Sprite is missing arguments');\r\n\r\n                    }\r\n\r\n                    var p = sprite.position;\r\n\r\n                    var camera = __gameStack.__gameWindow.camera || {x: 0, y: 0, z: 0};\r\n\r\n                    var x = p.x, y = p.y;\r\n\r\n\r\n                    x -= camera.x || 0;\r\n                    y -= camera.y || 0;\r\n                    //optional animation : gameSize\r\n\r\n                    var targetSize = sprite.size || sprite.selected_animation.size;\r\n\r\n                    var realWidth = targetSize.x;\r\n                    var realHeight = targetSize.y;\r\n\r\n                    //optional animation : offset\r\n\r\n                    if (sprite.selected_animation && sprite.selected_animation.hasOwnProperty('offset')) {\r\n                        x += sprite.selected_animation.offset.x;\r\n\r\n                        y += sprite.selected_animation.offset.y;\r\n\r\n                    }\r\n\r\n                    var rotation;\r\n\r\n                    if (typeof(sprite.rotation) == 'object') {\r\n\r\n                        rotation = sprite.rotation.x;\r\n\r\n\r\n                    }\r\n                    else {\r\n                        rotation = sprite.rotation;\r\n\r\n                    }\r\n\r\n                    var frame = sprite.selected_animation.selected_frame;\r\n\r\n                    if (frame && frame.image && frame.image.data) {\r\n\r\n                        ctx.putImageData(frame.image.data, x, y, 0, 0, sprite.size.x, sprite.size.y);\r\n\r\n                    }\r\n                    else {\r\n\r\n                        if(sprite.selected_animation.image.domElement instanceof HTMLImageElement) {\r\n\r\n                            this.drawFrameWithRotation(sprite.selected_animation.image.domElement, frame.framePos.x, frame.framePos.y, frame.frameSize.x, frame.frameSize.y, Math.round(x + (realWidth / 2)), Math.round(y + (realHeight / 2)), realWidth, realHeight, rotation % 360, ctx, sprite.flipX);\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nlet Canvas = new CanvasLib();\r\n\r\nGamestack.Canvas = Canvas;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n /**\r\n * GravityForce, calling new GravityForce() is equivalent to calling new Force()\r\n  *\r\n  * Takes an object of arguments and returns GravityForce() Object.\r\n  *@param   {Object} args the object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {Array} args.subjects the subjects to be pulled by the GravityForce\r\n * @param   {Array} args.clasticObjects any clastic object that should have collision-stop behavior with args.subjects when collision occurs\r\n * @param   {Vector} args.max the speed of gravity AKA terminal velocity\r\n * @param   {number} args.accel the increment to use when accelerating speed of fall\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass GravityForce\r\n{\r\n    constructor(args)\r\n    {\r\n\r\n        this.name = args.name || \"\";\r\n\r\n        this.description = args.description || \"\";\r\n\r\n        this.subjects = args.subjects || [];\r\n\r\n        this.clasticObjects = args.clasticObjects || [];\r\n\r\n        this.topClastics = args.topClastics || [];\r\n\r\n        this.max = args.max || new Vector3(3, 3, 3);\r\n         this.accel = args.accel || new Vector3(1.3, 1.3, 1.3);\r\n\r\n\r\n        for(var x in this.clasticObjects)\r\n        {\r\n            if(!this.clasticObjects[x] instanceof Sprite)\r\n            {\r\n                this.clasticObjects[x] = Gamestack.getById(this.clasticObjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n\r\n        for(var x in this.topClastics)\r\n        {\r\n            if(!this.topClastics[x] instanceof Sprite)\r\n            {\r\n                this.topClastics[x] = Gamestack.getById(this.topClastics[x].id);\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n        for(var x in this.subjects)\r\n        {\r\n            if(!this.subjects[x] instanceof Sprite)\r\n            {\r\n                this.subjects[x] = Gamestack.getById(this.subjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    update()\r\n    {\r\n\r\n      var  subjects = this.subjects;\r\n\r\n       var clasticObjects =  this.clasticObjects;\r\n\r\n        var topClastics =  this.topClastics;\r\n\r\n      var  accel =  this.accel || {};\r\n\r\n        var max =  this.max || {};\r\n\r\n        __gameStack.each(subjects, function(ix, itemx){\r\n\r\n           itemx.accelY(accel, max);\r\n\r\n           itemx.__inAir = true;\r\n\r\n\r\n            if(itemx.position.y >= itemx.groundMaxY)\r\n            {\r\n\r\n\r\n                itemx.position.y = itemx.groundMaxY;\r\n\r\n            }\r\n\r\n            itemx.groundMaxY = 3000000; //some crazy number you'll never reach in-game\r\n\r\n            __gameStack.each(clasticObjects, function(iy, itemy){\r\n\r\n                itemx.collide_stop(itemy);\r\n\r\n            });\r\n\r\n            __gameStack.each(topClastics, function(iy, itemy){\r\n\r\n                itemx.collide_stop_top(itemy);\r\n\r\n            });\r\n\r\n        });\r\n    }\r\n};\r\n\r\nlet Force = GravityForce;\r\n\r\n Gamestack.Force = Force;\r\n\r\n Gamestack.GravityForce = GravityForce;\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n\r\n/**\r\n * ControllerEventKeys()\r\n *\r\n * <ul >\r\n *  <li> an object representation of the controller\r\n *  <li> all keys are set to false\r\n * </ul>\r\n * @returns {ControllerEventKeys} object of ControllerEventKeys()\r\n * */\r\n\r\n\r\nclass ControllerEventKeys\r\n{\r\n    constructor()\r\n    {\r\n        return {\r\n\r\n            left_stick:false,\r\n\r\n            right_stick:false,\r\n\r\n            0:false,\r\n\r\n            1:false,\r\n\r\n            2:false,\r\n\r\n            3:false,\r\n\r\n            4:false,\r\n\r\n            5:false,\r\n\r\n            6:false,\r\n\r\n            7:false,\r\n\r\n            8:false,\r\n\r\n            9:false,\r\n\r\n            10:false,\r\n\r\n            11:false,\r\n\r\n            12:false,\r\n\r\n            13:false,\r\n\r\n            14:false,\r\n\r\n            15:false,\r\n\r\n            16:false,\r\n\r\n            17:false,\r\n\r\n            18:false,\r\n\r\n            19:false\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nGamestack.ControllerEventKeys = ControllerEventKeys;\r\n\r\n\r\n/**\r\n * GamepadAdapter()\r\n *\r\n * <ul >\r\n *  <li> supports game-controller input for web-games\r\n *  <li> accesses live gamepad input from the HTML5 Gamepad Api\r\n * </ul>\r\n *\r\n * [See Live Demos with Suggested Usage-Examples]{@link http://www.google.com}\r\n * @returns {GamepadAdapter} object of GamepadAdapter()\r\n * */\r\n\r\n\r\nGameStack.gamepads = GameStack.gamepads || __gameInstance.gamepads;\r\n\r\nclass GamepadAdapter {\r\n\r\n    constructor() {\r\n\r\n        this.__gamepads = [];\r\n\r\n        this.intervals = [];\r\n\r\n        let controller_stack = this;\r\n\r\n        let _gpinst = this;\r\n\r\n        this.events = [];\r\n\r\n        window.setInterval(function () {\r\n\r\n            var gps = navigator.getGamepads();\r\n\r\n            _gpinst.gps = gps;\r\n\r\n            for(var x = 0; x < gps.length; x++) {\r\n\r\n            var events = _gpinst.__gamepads[x] ? _gpinst.__gamepads[x] : {};\r\n\r\n             _gpinst.process(gps[x], events);\r\n\r\n            }\r\n\r\n\r\n        }, 20);\r\n\r\n    }\r\n\r\n    gamepads()\r\n    {\r\n\r\n        return  navigator.getGamepads();\r\n\r\n    }\r\n\r\n\r\n    disconnect_all() {\r\n\r\n        for (var x = 0; x < this.intervals.length; x++) {\r\n\r\n            window.clearInterval(this.intervals[x]);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    disconnect_by_index(game_pad_index) {\r\n\r\n        window.clearInterval(this.intervals[game_pad_index]);\r\n\r\n    }\r\n\r\n    hasAnyPad() {\r\n        return \"getGamepads\" in navigator;\r\n\r\n    }\r\n\r\n    Event(key, game_pad, callback) {\r\n        return {\r\n\r\n            key: key, game_pad:game_pad, callback: callback\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    GamepadEvents(args)\r\n    {\r\n\r\n        var gp = {};\r\n\r\n        gp.stick_left = args.stick_left || function(x, y)\r\n        {\r\n\r\n          //  console.log('Def call');\r\n\r\n        }\r\n\r\n\r\n        gp.stick_right = args.stick_right ||  function(x, y)\r\n        {\r\n\r\n        }\r\n\r\n        gp.buttons = [];\r\n\r\n        gp.extendFunc = function(f1, f2)\r\n        {\r\n\r\n            var fc = f2;\r\n\r\n           return function(x, y){\r\n\r\n                f2(x, y);\r\n\r\n               f1(x, y);\r\n\r\n            }\r\n\r\n        };\r\n\r\n        gp.on = function(key, callback)\r\n        {\r\n\r\n            if(this[key] && key !== \"on\")\r\n            {\r\n\r\n                var current_cb =  typeof(this[key]) == 'function' ? this[key] : function(x, y){};\r\n\r\n               this[key] = this.extendFunc(callback, current_cb);\r\n\r\n\r\n            }\r\n\r\n            else if(key.indexOf('button') >= 0 && key.indexOf('_') >= 0 )\r\n            {\r\n                var parts = key.split('_');\r\n\r\n                var number;\r\n\r\n                try\r\n                {\r\n\r\n                    number = parseInt(parts[1]);\r\n\r\n\r\n                    var current_cb =  typeof(this['buttons'][number]) == 'function' ? this['buttons'][number] : function(x, y){};\r\n\r\n                    this['buttons'][number] = this.extendFunc(callback, current_cb);\r\n\r\n                }\r\n                catch (e)\r\n                    {\r\n                      console.error('could not parse \"on\" event with ' + key);\r\n\r\n                    }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        gp.constructor = {name:\"GamepadEvents\"};\r\n\r\n        this.__gamepads.push(gp);\r\n\r\n        Gamestack.gamepads = this.__gamepads;\r\n\r\n        return gp;\r\n\r\n    }\r\n\r\n    getGamepads()\r\n    {\r\n        return Gamestack.gamepads;\r\n\r\n    }\r\n\r\n    process(gp, gpEvents)\r\n    {\r\n\r\n        this.process_buttons(gp, gpEvents);\r\n\r\n        this.process_axes(gp, gpEvents);\r\n\r\n    }\r\n\r\n    process_axes(gp, events)\r\n    {\r\n\r\n        if(!gp || !gp['axes'])\r\n        {\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n\r\n            for (var i = 0; i < gp.axes.length; i += 2) {\r\n\r\n            var axis1 = gp.axes[i], axia2 = gp.axes[i + 1];\r\n\r\n            var ix = (Math.ceil(i / 2) + 1), x = gp.axes[i], y = gp.axes[i + 1];\r\n\r\n            if(ix == 1 && events.stick_left)\r\n            {\r\n                events.stick_left(x, y);\r\n\r\n            }\r\n\r\n            if(ix == 2 && events.stick_right)\r\n            {\r\n                events.stick_right(x, y);\r\n\r\n            }\r\n\r\n            if (this.events && this.events['stick_' + i] && typeof(this.events['stick_' + i].callback) == 'function') {\r\n                this.events['stick_' + i].callback();\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    process_buttons(gp, events) {\r\n\r\n        if(!gp || !gp['buttons'])\r\n        {\r\n             return false;\r\n\r\n        }\r\n\r\n        for (var i = 0; i < gp.buttons.length; i++) {\r\n\r\n\r\n            if (typeof(events.buttons[i]) == 'function') {\r\n                events.buttons[i](gp.buttons[i].pressed);\r\n            }\r\n            else if (typeof( events.buttons[i]) == 'object' && typeof(events.buttons[i].update) == 'function') {\r\n                events.buttons[i].update(events.buttons[i].pressed);\r\n\r\n            }\r\n                var clearance_1 = this.events && this.events[i], gpc, bkey = \"button_\" + i;\r\n\r\n                if (clearance_1) {\r\n                    gpc = this.events[bkey] && !isNaN(this.events[bkey].game_pad) ? this.gamepads[this.events[bkey].game_pad] : this.events[bkey].game_pad;\r\n                }\r\n                ;\r\n\r\n                if (clearance_1 && gpc && typeof(this.events[bkey].callback) == 'function') {\r\n                    //call the callback\r\n                    this.events[i].callback();\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    on(key, gpix, callback) {\r\n\r\n        if(gpix >= this.__gamepads.length)\r\n        {\r\n\r\n            this.__gamepads.push(this.GamepadEvents({}));\r\n\r\n        }\r\n\r\n        this.__gamepads[gpix].on(key, callback);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n/**\r\n * ControllerSetting()\r\n * takes arguments of button(string) || stick(string), plus event(function),\r\n *\r\n * @returns {ControllerSetting\r\n * }\r\n */\r\n\r\n\r\n/**********\r\n * NOTE: here we bind the instance, and NOT the instantiator.\r\n *\r\n * *********/\r\n\r\nif(!__gameInstance.GamepadAdapter)\r\n{\r\n    Gamestack.GamepadAdapter = new GamepadAdapter();\r\n\r\n\r\n    GameStack.GamepadAdapter.on('stick_left', 0, function(x, y){\r\n\r\n        console.log('Gamepad stick left');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_0', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 0');\r\n\r\n    });\r\n\r\n\r\n    GameStack.GamepadAdapter.on('button_1', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 1');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_2', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 2');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_3', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 3');\r\n\r\n    });\r\n\r\n   // __gameInstance.gamepads.push(gamepad);\r\n\r\n}\r\n\r\n;\r\nclass GamestackModel {\r\n\r\n    constructor(args={}) {\r\n\r\n        this.__isMaster = args.master || args.isMaster || false;\r\n\r\n        this.images = args.images || [];\r\n\r\n        this.sounds = args.sounds || [];\r\n\r\n        this.motions = args.motions || [];\r\n\r\n        this.sprites = args.sprites || [];\r\n\r\n        this.backgrounds = args.backgrounds || [];\r\n\r\n        this.terrains = args.terrains || [];\r\n\r\n        this.interactives = args.interactives || [];\r\n\r\n    }\r\n\r\n    add(object)\r\n    {\r\n        var isAllOfAny = function(list, types)\r\n        {\r\n            for(var x = 0; x < list.length; x++)\r\n            {\r\n                if(![types].indexOf(list[x].constructor.name) >= 0)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n            }\r\n            return true;\r\n        };\r\n\r\n        if(object instanceof(object))\r\n        {\r\n            object = [object];\r\n        }\r\n\r\n        var cleanCheck = isAllOfAny(object, ['Sprite', 'Background', 'Terrain', 'Motion', 'Projectile', 'GameImage', 'Sound']);\r\n\r\n        if(!cleanCheck)\r\n        {\r\n            return console.error('Must have: valid contents (Sprite OR [] of Sprite())');\r\n        }\r\n\r\n        var __inst = this;\r\n\r\n        Gamestack.each(object, function(ix, item){\r\n\r\n            switch(item.constructor.name)\r\n            {\r\n                case \"Sprite\":\r\n\r\n                    __inst.sprites.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Background\":\r\n\r\n                    __inst.background.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Terrain\":\r\n\r\n                    __inst.terrains.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Interactive\":\r\n\r\n                    __inst.interactives.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Sound\":\r\n\r\n                    __inst.sounds.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Motion\":\r\n\r\n                    __inst.motions.push(item);\r\n\r\n                    break;\r\n\r\n                case \"Projectile\":\r\n\r\n                    __inst.projectiles.push(item);\r\n\r\n                    break;\r\n\r\n                case \"GameImage\":\r\n\r\n                    __inst.images.push(item);\r\n\r\n                    break;\r\n\r\n                default:\r\n\r\n                    console.log('GamestackModel.add():UNKNOWN TYPE');\r\n            }\r\n\r\n            return;\r\n\r\n        });\r\n\r\n        this.contents.concat(object)\r\n\r\n        return this;\r\n    }\r\n\r\n};;\r\nclass GSEvent {\r\n\r\n    constructor(args = {}) {\r\n\r\n        this.name = args.name || \"blankEvent\";\r\n\r\n        this.on = args.on || \"collision\";\r\n\r\n        this.object = args.object || {};\r\n\r\n        this.gpix = args.gpix || 0;\r\n\r\n        this.ix = args.ix || 0; //the button-index OR stick-index\r\n\r\n        this.targets = args.targets || [];\r\n\r\n        this.triggered = args.triggered || function () {\r\n            }\r\n\r\n        this.statKey = args.statKey || false;\r\n\r\n        this.lessThan = args.lessThan || false;\r\n\r\n        this.greaterThan = args.greaterThan || false;\r\n\r\n    }\r\n\r\n    apply() {\r\n\r\n        var __inst = this;\r\n\r\n        switch (this.on) {\r\n            case \"collision\":\r\n            case \"collide\":\r\n\r\n                $Q(this.object).on('collision', this.targets, function (obj1, obj2) {\r\n\r\n                    __inst.triggered(obj1, obj2);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n            case \"button\":\r\n\r\n                //rig the button call\r\n\r\n                $Q(this.object).on('button' + this.ix, function (pressed) {\r\n\r\n\r\n                    __inst.triggered(pressed);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n\r\n            case \"stick_left\":\r\n            case \"stick_right\":\r\n            case \"right_stick\":\r\n            case \"left_stick\":\r\n\r\n                //rig the stick call\r\n\r\n                $Q(this.object).on(this.on, function (x, y) {\r\n\r\n\r\n                    __inst.triggered(x, y);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n            case \"stat\":\r\n\r\n                //rig the stat call\r\n\r\n                console.error('STAT CALLS ARE NOT SET-UP YET. Please add this to the Gamestack library');\r\n\r\n                function isStrOrNum(str){return typeof(str)=='string' || typeof(str)=='number'}\r\n\r\n                var onKey = \"[\" + this.statKey + (isStrOrNum(this.greaterThan)?\">\":\"\") + (isStrOrNum(this.lessThan)?\"<\":\"\") + (this.greaterThan || this.lessThan);\r\n\r\n                $Q(this.object).on(onKey, function (x, y) {\r\n\r\n                    __inst.triggered(x, y);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    triggered() {\r\n    } //called when triggered\r\n\r\n    onTriggered(fun) {\r\n        this.triggered = function () {\r\n            fun();\r\n        };\r\n    } //adds a function argument for triggered\r\n\r\n    rejected() {\r\n    }\r\n\r\n    onRejected(fun) {\r\n        this.rejected = function () {\r\n            fun();\r\n        };\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nfunction GSEventLink(extendedObject, extendedKey, extendor, extendorKey)\r\n{\r\n        this.parent_id=extendedObject.id,\r\n\r\n        this.child_id=extendor.id,\r\n\r\n        this.parent_key=extendedKey,\r\n\r\n        this.child_key=extendorKey;\r\n};\r\n\r\n\r\nfunction makeExtendableOverrides(object)\r\n{\r\n    if(!object.run_ext instanceof  Array)\r\n        object.run_ext || [];\r\n\r\n\r\n\r\n};;\r\nclass Level\r\n{\r\n    constructor(args={})\r\n    {\r\n        this.sprites = args.sprites || [];\r\n\r\n        this.backgrounds = args.backgrounds || [];\r\n\r\n        this.terrains = args.terrains || [];\r\n\r\n        this.interactives = args.interactives || [];\r\n\r\n        this.threes = args.threes || []; //3d objects\r\n\r\n    }\r\n\r\n    add()\r\n    {\r\n\r\n\r\n    }\r\n\r\n    add_all_to_game()\r\n    {\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\n;\r\n/**\r\n * Takes an object of arguments and returns Motion() object. Motion animates movement of position and rotation properties for any Sprite()\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.curve the TWEEN.Easing function to be applied (Example: TWEEN.Easing.Quadratic.InOut)\r\n * @param   {Vector} args.targetRotation the targeted rotation result, when using rotation with movement\r\n * @param   {Vector} args.distance the target distance of position change, when moving position\r\n * @param   {number} args.duration the milliseconds duration of the Motion\r\n * @param   {number} args.delay the milliseconds delay before the Motion occurs (on call of Motion.engage())\r\n *\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass Motion {\r\n    constructor(args={}) {\r\n\r\n        this.getArg = $Q.getArg;\r\n\r\n        this.distance = new Vector(Gamestack.getArg(args, 'distance', new Vector(0, 0)));\r\n\r\n        this.curvesList = this.curvesToArray(); //Tween.Easing\r\n\r\n        this.lineCurvesList = this.lineCurvesToArray();\r\n\r\n        if(args.parent instanceof Sprite)\r\n        {\r\n            this.parent = args.parent;\r\n\r\n            this.parent_id = args.parent.id;\r\n\r\n        }\r\n        else\r\n        {\r\n            this.parent_id = args.parent_id || args.object_id || \"__blank\"; //The parent object\r\n\r\n            this.parent = Gamestack.getObjectById(this.parent_id);\r\n\r\n        }\r\n\r\n        this.motion_curve = Gamestack.getArg(args, 'curve', TWEEN.Easing.Quadratic.InOut);\r\n\r\n        this.line_curve = Gamestack.getArg(args, 'line_curve', TWEEN.Easing.Linear.None);\r\n\r\n        this.rotation = Gamestack.getArg(args, 'rotation', 0);\r\n\r\n        this.size = Gamestack.getArg(args, 'size', new Vector(0, 0, 0));\r\n\r\n        this.targetRotation = Gamestack.getArg(args, 'targetRotation', 0);\r\n\r\n        this.name = Gamestack.getArg(args, 'name', \"__\");\r\n\r\n        this.description = Gamestack.getArg(args, 'description', false);\r\n\r\n        this.motionCurveString = this.getMotionCurveString(); //store a string key for the Tween.Easing || 'curve'\r\n\r\n        this.lineCurveString = this.getLineCurveString(); //store a string key for the Tween.Easing || 'curve'\r\n\r\n        this.setMotionCurve(this.motionCurveString);\r\n\r\n        this.setLineCurve(this.lineCurveString);\r\n\r\n        this.duration = Gamestack.getArg(args, 'duration', 500);\r\n\r\n        this.delay = Gamestack.getArg(args, 'delay', 0);\r\n\r\n        this.object = this.getParent();\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n        this.complete_ext = args.complete_ext || [];\r\n\r\n    }\r\n\r\n    /*****\r\n     * Overridable / Extendable functions\r\n     * -allows stacking of external object-function calls\r\n     ******/\r\n\r\n    onRun(caller, callkey) {\r\n        this.run_ext = this.run_ext || [];\r\n\r\n        if (this.run_ext.indexOf(caller[callkey]) == -1) {\r\n            this.run_ext.push({caller: caller, callkey: callkey});\r\n        }\r\n    }\r\n\r\n    onComplete(caller, callkey) {\r\n        this.complete_ext = this.complete_ext || [];\r\n\r\n        if (this.complete_ext.indexOf(caller[callkey]) == -1) {\r\n            this.complete_ext.push({caller: caller, callkey: callkey});\r\n        }\r\n    }\r\n\r\n    call_on_run() {\r\n        //call any function extension that is present\r\n        for (var x = 0; x < this.run_ext.length; x++) {\r\n            this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n        }\r\n    }\r\n\r\n    call_on_complete() {\r\n        //call any function extension that is present\r\n        for (var x = 0; x < this.complete_ext.length; x++) {\r\n            this.complete_ext[x].caller[this.complete_ext[x].callkey]();\r\n        }\r\n    }\r\n\r\n\r\n    curvesToArray() {\r\n\r\n        var c = [];\r\n\r\n        GameStack.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            GameStack.each(easing, function (iy, easeType) {\r\n\r\n                if (['in', 'out', 'inout','none'].indexOf(iy.toLowerCase()) >= 0) {\r\n\r\n                    c.push(ix + \"_\" + iy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    lineCurvesToArray() {\r\n\r\n        var c = [];\r\n\r\n        GameStack.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            GameStack.each(easing, function (iy, easeType) {\r\n\r\n                if (['linear', 'cubic', 'quadratic', 'quartic', 'quintic'].indexOf(ix.toLowerCase()) >= 0) {\r\n\r\n                    c.push(ix + \"_\" + iy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    getMotionCurveString() {\r\n\r\n        var __inst = this;\r\n\r\n        var c;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (__inst.motion_curve == TWEEN.Easing[ix][iy]) {\r\n\r\n                    c = ix + \"_\" + iy;\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    getLineCurveString() {\r\n\r\n        var __inst = this;\r\n\r\n        var c;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (__inst.line_curve == TWEEN.Easing[ix][iy]) {\r\n\r\n                    c = ix + \"_\" + iy;\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    setLineCurve(c) {\r\n\r\n        var cps = c.split('_');\r\n\r\n        var s1 = cps[0], s2 = cps[1];\r\n\r\n        var curve = TWEEN.Easing.Quadratic.InOut;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (ix == s1 && iy == s2) {\r\n\r\n                    // alert('setting curve');\r\n\r\n                    curve = TWEEN.Easing[ix][iy];\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        this.line_curve = curve;\r\n\r\n\r\n        return curve;\r\n\r\n    }\r\n\r\n    setMotionCurve(c) {\r\n\r\n        var cps = c.split('_');\r\n\r\n        var s1 = cps[0], s2 = cps[1];\r\n\r\n        var curve = TWEEN.Easing.Quadratic.InOut;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (ix == s1 && iy == s2) {\r\n\r\n                    // alert('setting curve');\r\n\r\n                    curve = TWEEN.Easing[ix][iy];\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        this.motion_curve = curve;\r\n\r\n\r\n        return curve;\r\n\r\n    }\r\n\r\n\r\n    onRun(caller, callkey)\r\n    {\r\n\r\n        this.run_ext = this.run_ext  || [];\r\n\r\n        this.run_ext.push({caller:caller, callkey:callkey});\r\n\r\n    }\r\n\r\n    getParent()\r\n    {\r\n\r\n        var object = {}, __inst = this;\r\n\r\n        $.each(Gamestack.all_objects, function (ix, item) {\r\n\r\n            if (item.id == __inst.parent_id) {\r\n\r\n                object = item;\r\n            }\r\n        });\r\n\r\n        if(!this.size)\r\n        {\r\n            this.size = new Vector(object.size);\r\n\r\n        }\r\n\r\n        return object;\r\n\r\n    }\r\n\r\n    engage() {\r\n\r\n        var __inst = this;\r\n\r\n        var tweens = [];\r\n\r\n\r\n        var object = this.getParent();\r\n\r\n        var targetPosition = {\r\n\r\n            x: __inst.distance.x + object.position.x,\r\n            y: __inst.distance.y + object.position.y,\r\n            z: __inst.distance.z + object.position.z\r\n\r\n        };\r\n\r\n        var targetR = __inst.targetRotation + object.rotation.x,\r\n\r\n        targetSize = __inst.size;\r\n\r\n        __inst.call_on_run(); //call any on-run extensions\r\n\r\n        //we always have a targetPosition\r\n        //construct a tween::\r\n        tweens.push(new TWEEN.Tween(object.position)\r\n            .easing(__inst.curve || __inst.motion_curve)\r\n\r\n            .to(targetPosition, __inst.duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n                if (__inst.complete) {\r\n\r\n                    __inst.call_on_complete(); //only call once\r\n\r\n                }\r\n\r\n\r\n            }));\r\n\r\n        //we have a target\r\n        tweens.push(new TWEEN.Tween(object.size)\r\n            .easing(__inst.curve || __inst.motion_curve)\r\n\r\n            .to(targetSize, __inst.duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n                if (__inst.complete) {\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n            }));\r\n\r\n        //we have a target\r\n        tweens.push(new TWEEN.Tween(object.rotation)\r\n            .easing(__inst.curve || __inst.motion_curve)\r\n\r\n            .to({x: targetR}, __inst.duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n                if (__inst.complete) {\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n            }));\r\n\r\n\r\n\r\n        __inst.delay = !isNaN(__inst.delay) && __inst.delay > 0 ? __inst.delay : 0;\r\n\r\n\r\n        return {\r\n\r\n            tweens: tweens,\r\n\r\n            delay: __inst.delay,\r\n\r\n            fire: function () {\r\n\r\n                var __tweenObject = this;\r\n\r\n                window.setTimeout(function () {\r\n\r\n                    for (var x = 0; x < __tweenObject.tweens.length; x++) {\r\n\r\n                        __tweenObject.tweens[x].start();\r\n\r\n                    }\r\n\r\n                }, this.delay);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * start the Motion transition\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     *\r\n     **********/\r\n\r\n    start() {\r\n        this.engage().fire();\r\n\r\n    }\r\n\r\n    /**\r\n     * specify a function to be called when Motion is complete\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     * @param {Function} fun the function to be called when complete\r\n     **********/\r\n\r\n    onComplete(fun) {\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    // obj.getGraphCanvas( $(c.domElement), value.replace('_', '.'), TWEEN.Easing[parts[0]][parts[1]] );\r\n\r\n    getGraphCanvas( t, f, c) {\r\n\r\n        var canvas = c || document.createElement('canvas');\r\n\r\n        canvas.style.position = \"relative\";\r\n\r\n        canvas.id = 'curve-display';\r\n\r\n        canvas.setAttribute('class', 'motion-curve');\r\n\r\n        canvas.width = 180;\r\n        canvas.height = 100;\r\n\r\n        canvas.style.background = \"black\";\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.fillStyle = \"rgb(0,0,0)\";\r\n        context.fillRect(0, 0, 180, 100);\r\n\r\n        context.lineWidth = 0.5;\r\n        context.strokeStyle = \"rgb(230,230,230)\";\r\n\r\n        context.beginPath();\r\n        context.moveTo(0, 20);\r\n        context.lineTo(180, 20);\r\n        context.moveTo(0, 80);\r\n        context.lineTo(180, 80);\r\n        context.closePath();\r\n        context.stroke();\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = \"rgb(255,127,127)\";\r\n\r\n        var position = {x: 5, y: 80};\r\n        var position_old = {x: 5, y: 80};\r\n\r\n        new TWEEN.Tween(position).to({x: 175}, 2000).easing(TWEEN.Easing.Linear.None).start();\r\n        new TWEEN.Tween(position).to({y: 20}, 2000).easing(f).onUpdate(function () {\r\n\r\n            context.beginPath();\r\n            context.moveTo(position_old.x, position_old.y);\r\n            context.lineTo(position.x, position.y);\r\n            context.closePath();\r\n            context.stroke();\r\n\r\n            position_old.x = position.x;\r\n            position_old.y = position.y;\r\n\r\n        }).start();\r\n\r\n        return canvas;\r\n    }\r\n\r\n    getTweenPoints(size, line) {\r\n\r\n        //must have line.minPointDist\r\n\r\n        var curve = line.curve,\r\n        duration = line.duration;\r\n\r\n        var points = [];\r\n\r\n        var position = new Vector(line.position);\r\n\r\n        var target = new Vector(position).add(size);\r\n\r\n        var start = new Vector(position);\r\n\r\n        var dist = new Vector(0, 0, 0);\r\n\r\n        var ptrack;\r\n\r\n\r\n       var  easeInOutQuad =  function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t };\r\n\r\n\r\n        return points;\r\n\r\n       var t1 =  new TWEEN.Tween(position).to({x:target.x}, 2000).easing(TWEEN.Easing.Linear.None).start();\r\n\r\n       if(t2)\r\n       {\r\n           t2.stop();\r\n       }\r\n\r\n      var t2 =  new TWEEN.Tween(position).to({y:target.y}, 2000).easing(curve).onUpdate(function () {\r\n\r\n\r\n          if(ptrack){\r\n\r\n              dist = ptrack.sub(p);\r\n\r\n              var d = Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n              if(d >= line.minPointDist)\r\n              {\r\n\r\n                  points.push(p);\r\n\r\n                  ptrack = new Vector(p);\r\n              }\r\n\r\n          }\r\n\r\n          else{\r\n              ptrack = p;\r\n\r\n              points.push(p);\r\n          };\r\n\r\n        }).onComplete(function() {\r\n\r\n            // alert(line.minPointDist);\r\n\r\n            line.first_segment = points.slice();\r\n\r\n            var extendLinePoints = function (segment, points, ix)\r\n            {\r\n\r\n            var next_points = segment.slice();\r\n\r\n            var last_point = points[points.length - 1];\r\n\r\n            for (var x = 0; x < next_points.length; x++) {\r\n\r\n                var sr = new Vector(Gamestack.GeoMath.rotatePointsXY(line.size.x * ix, line.size.y * ix, line.rotation));\r\n\r\n                var p = next_points[x].add(sr);\r\n\r\n                if(points.indexOf(p) <= -1) {\r\n\r\n                    points.push(p);\r\n\r\n\r\n                }\r\n\r\n            }\r\n        };\r\n\r\n        for(var x = 0; x <= line.curve_iterations; x++)\r\n        {\r\n            if(x > 1) {\r\n\r\n                extendLinePoints(line.first_segment, line.points, x - 1);\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n        }).start();\r\n\r\n        return points;\r\n    }\r\n}\r\n\r\n\r\nGamestack.Motion = Motion;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;/**\r\n * Takes an object of arguments and returns Projectile() object. Projectile fires a shot from the parent sprite, with specified offset, rotation, motion_curve, line_curve\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {string} args.distance the distance before dissappearance\r\n * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.motion_curve the TWEEN.Easing function to be applied for motion/speed (Example: TWEEN.Easing.Quadratic.InOut)\r\n *\r\n *  * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.line_curve the TWEEN.Easing function to be applied for line (Example: TWEEN.Easing.Quadratic.InOut)\r\n *\r\n * @returns {Projectile} a Projectile object\r\n */\r\n\r\nclass Projectile {\r\n\r\n    constructor(args = {}) {\r\n\r\n        this.getArg = $Q.getArg;\r\n\r\n        for (var x in args) {\r\n            this[x] = args[x];\r\n\r\n        }\r\n\r\n        this.name = args.name || \"__\";\r\n\r\n        this.description = args.description || \"__\";\r\n\r\n        this.line = new Line(Gamestack.getArg(args, 'line', new Line()));\r\n\r\n        this.animation = Gamestack.getArg(args, 'animation', new Animation());\r\n\r\n        this.parent_id = args.parent_id || args.object_id || \"__blank\"; //The parent object\r\n\r\n        this.name = Gamestack.getArg(args, 'name', \"__\");\r\n\r\n        this.size = Gamestack.getArg(args, 'size', new Vector());\r\n\r\n        this.origin = args.origin || false;\r\n\r\n        this.description = Gamestack.getArg(args, 'description', false);\r\n\r\n        this.duration = Gamestack.getArg(args, 'duration', 500);\r\n\r\n        this.delay = Gamestack.getArg(args, 'delay', 0);\r\n\r\n        this.position = Gamestack.getArg(args, 'position', new Vector(0, 0, 0));\r\n\r\n        this.motion_curve = Gamestack.getArg(args, 'motion_curve', TWEEN.Easing.Linear.None);\r\n\r\n        this.highlighted = false;\r\n\r\n        this.sprites = [];\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n    }\r\n\r\n    /**\r\n     * specify a function to be called when Motion is complete\r\n     *\r\n     * @function\r\n     * @memberof Projectile\r\n     * @param {Function} fun the function to be called when complete\r\n     *\r\n     **********/\r\n\r\n    onComplete(fun) {\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    onCollide(fun) {\r\n        this.collide = fun;\r\n\r\n    }\r\n\r\n    setAnimation(anime) {\r\n\r\n        this.animation = anime;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    setMotionCurve(c) {\r\n\r\n        this.motion_curve = c;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    kill_one() {\r\n\r\n        var spr = this.sprites[this.sprites.length - 1];\r\n\r\n        Gamestack.remove(spr);\r\n\r\n    }\r\n\r\n    onRun(caller, callkey) {\r\n\r\n        this.run_ext = this.run_ext || [];\r\n\r\n        this.run_ext.push({caller: caller, callkey: callkey});\r\n\r\n    }\r\n\r\n\r\n    fire(origin) {\r\n\r\n        for (var x = 0; x < this.run_ext.length; x++) {\r\n\r\n            this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n\r\n        }\r\n\r\n        if (!origin) {\r\n\r\n            origin = this.origin;\r\n        }\r\n\r\n\r\n        console.log('FIRING FROM:' + jstr(origin));\r\n\r\n        var sprite = new Sprite({image: this.animation.image});\r\n\r\n        sprite.setAnimation(this.animation);\r\n\r\n        sprite.setSize(this.size);\r\n\r\n        sprite.position = new Vector(0, 0, 0);\r\n\r\n        var __inst = this;\r\n\r\n        var lp = __inst.line.transpose(origin);\r\n\r\n        sprite.position = new Vector(lp[0]);\r\n\r\n        sprite.onUpdate(function (sprite) {\r\n\r\n            for (var x = 0; x < lp.length; x++) {\r\n\r\n                if (sprite.position.equals(lp[x]) && x < lp.length - 1) {\r\n\r\n                    sprite.position = new Vector(lp[x + 1]);\r\n\r\n                    break;\r\n                }\r\n\r\n                if (x == lp.length - 1) {\r\n                    Gamestack.remove(sprite);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        });\r\n\r\n        Gamestack.add(sprite);\r\n\r\n        this.sprites.push(sprite);\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nGamestack.Projectile = Projectile;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n/**\r\n * Takes the min and max vectors of rectangular shape and returns Rectangle Object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Vector} args.min the minimum vector point (x,y)\r\n * @param   {Vector} args.max the maximum vector point (x,y)\r\n *\r\n * @returns {Rectangle} a Rectangle object\r\n */\r\n\r\nclass Rectangle {\r\n\r\n    constructor(min, max) {\r\n\r\n        this.min = new Vector(min);\r\n        this.max = new Vector(max);\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\n\r\n\r\nlet VectorBounds = Rectangle;\r\n\r\n\r\n\r\nGamestack.Rectangle = Rectangle;\r\n\r\n\r\n\r\n/**\r\n * Takes the min and max vectors plus termPoint ('termination-point'), returns VectorFrameBounds\r\n *  *use this to define the bounds of an Animation object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Vector} args.min the minimum vector point (x,y)\r\n * @param   {Vector} args.max the maximum vector point (x,y)\r\n * @param   {Vector} args.termPoint the termPoint vector point (x,y)\r\n * -While a min and max Vector(x,y) will describe the grid of Animation frames, the termPoint will indicate the last frame to show on the grid (Animations may stop early on the 'grid')\r\n * @returns {VectorFrameBounds} a VectorFrameBounds object\r\n */\r\n\r\n\r\nclass VectorFrameBounds extends Rectangle {\r\n\r\n    constructor(min, max, termPoint) {\r\n\r\n        super(min, max);\r\n\r\n        this.termPoint = termPoint || new Vector3(this.max.x, this.max.y, this.max.z);\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\n\r\n\r\nGamestack.VectorFrameBounds = VectorFrameBounds;\r\n\r\n\r\n\r\n\r\nvar Curves = { //ALL HAVE INPUT AND OUTPUT OF: 0-1.0\r\n    // no easing, no acceleration\r\n    linearNone: function (t) { return t },\r\n    // accelerating from zero velocity\r\n    easeInQuadratic: function (t) { return t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuadratic: function (t) { return t*(2-t) },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuadratic: function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t },\r\n    // accelerating from zero velocity\r\n    easeInCubic: function (t) { return t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutCubic: function (t) { return (--t)*t*t+1 },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutCubic: function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 },\r\n    // accelerating from zero velocity\r\n    easeInQuartic: function (t) { return t*t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuartic: function (t) { return 1-(--t)*t*t*t },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuartic: function (t) { return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t },\r\n    // accelerating from zero velocity\r\n    easeInQuintic: function (t) { return t*t*t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuintic: function (t) { return 1+(--t)*t*t*t*t },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuintic: function (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t }\r\n}\r\n\r\nGamestack.Curves = Curves;\r\n\r\nvar Shapes = {\r\n\r\n    circle:function(radius, freq) {\r\n\r\n        return {\r\n\r\n            radius:radius,\r\n\r\n            points:[],\r\n\r\n            fill:function(center, freq)\r\n            {\r\n\r\n\r\n\r\n            }\r\n\r\n        }\r\n    },\r\n\r\n    square:function(s, freq)\r\n    {\r\n        console.error('STILL NEED TO BUILD THIS SQUARE IN GS-API');\r\n\r\n        return{\r\n\r\n            size:new Vector(s, s),\r\n\r\n            width:w,\r\n\r\n            height:h,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    rect:function(w, h, freq)\r\n    {\r\n        console.error('STILL NEED TO BUILD THIS TRIANGLE');\r\n\r\n        return{\r\n\r\n            size:new Vector(w, h),\r\n\r\n            width:w,\r\n\r\n            height:h,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    triangle:function(base, h, freq)\r\n    {\r\n\r\n        console.error('STILL NEED TO BUILD THIS TRIANGLE');\r\n\r\n        return{\r\n\r\n            base:base,\r\n\r\n            height:height,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n};\r\n\r\n\r\nGamestack.Shapes = Shapes;\r\n\r\n\r\n/**\r\n * Takes several args and returns Line object. Intended for curved-line / trajectory of Projectile Object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Easing} args.curve the curve applied to line see TWEEN.Easing , limited options for immediate line-drawing\r\n * @param   {number} args.duration the millisecond duration of Line\r\n * @param   {Vector} args.position the position vector\r\n *\r\n * @param   {number} args.pointDist the numeric point-distance\r\n *\r\n * @param   {Vector} args.size the size vector\r\n *\r\n * @param   {number} args.rotation the numeric rotation of -360 - 360\r\n *\r\n * @param   {number} args.growth the numeric growth\r\n *\r\n * -While a min and max Vector(x,y) will describe the grid of Animation frames, the termPoint will indicate the last frame to show on the grid (Animations may stop early on the 'grid')\r\n * @returns {VectorFrameBounds} a VectorFrameBounds object\r\n */\r\n\r\nclass Line\r\n{\r\n    constructor(args = {})\r\n    {\r\n\r\n\r\n        this.curve_options = Curves;//Curves Object (of functions)\r\n        this.curve_string = args.curve_string || \"linearNone\";\r\n\r\n        this.curve = this.get_curve_from_string(this.curve_string);\r\n\r\n        this.motion_curve = args.motion_curve || TWEEN.Easing.Linear.None;\r\n\r\n        if(typeof(args.curve) == 'function')\r\n        {\r\n            this.curve = args.curve;\r\n        }\r\n\r\n        this.points = args.points || [];\r\n\r\n        this.position = args.position ||  new Vector();\r\n\r\n        this.is_highlighted = args.is_highlighted || false;\r\n\r\n        this.offset = args.offset || new Vector();\r\n\r\n        this.pointDist = 5;\r\n\r\n        this.size = args.size || new Vector();\r\n\r\n        this.rotation = args.rotation || 0;\r\n\r\n        this.iterations = 1;\r\n\r\n        this.growth = args.growth || 1.2;\r\n\r\n    }\r\n\r\n    Iterations(n)\r\n    {\r\n\r\n       this.iterations = n;\r\n       return this;\r\n    }\r\n\r\n    Growth(n)\r\n    {\r\n        this.growth = n;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    Pos(p)\r\n    {\r\n\r\n        this.position = p;\r\n        return this;\r\n    }\r\n\r\n    PointDisp(num)\r\n    {\r\n        this.minPointDist = num;\r\n        return this;\r\n    }\r\n\r\n    Curve(c)\r\n    {\r\n        this.curve = c;\r\n        this.curve_string = this.get_curve_string(c);\r\n        return this;\r\n    }\r\n\r\n    Duration(d)\r\n    {\r\n        this.duration = d;\r\n\r\n        return this;\r\n    }\r\n    Rotation(r)\r\n    {\r\n        this.rotation = r;\r\n        return this;\r\n    }\r\n    next(position)\r\n    {\r\n\r\n        var found = false;\r\n\r\n        for(var x = 0; x < this.points.length; x++)\r\n        {\r\n\r\n            if(position.equals(this.points[x]) &&  x < this.points.length - 1)\r\n            {\r\n                found = true;\r\n                return new Vector(this.points[x + 1]);\r\n\r\n            }\r\n\r\n            if(x==this.points.length - 1 && !found)\r\n            {\r\n\r\n                return new Vector(this.points[0]);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    get_curve_from_string(str)\r\n    {\r\n\r\n        console.log('Applying Line():curve:' + str);\r\n\r\n        for(var x in this.curve_options) {\r\n\r\n            if(x.toLowerCase() == str.toLowerCase())\r\n            {\r\n                return this.curve_options[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    get_curve_string(c)\r\n    {\r\n        for(var x in this.curve_options) {\r\n\r\n            if(this.curve_options[x] == c)\r\n            {\r\n                return x;\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    getGraphCanvas(curveCall, existing_canvas) {\r\n\r\n        var canvas = existing_canvas || document.createElement('canvas');\r\n\r\n        canvas.style.position = \"relative\";\r\n\r\n        canvas.id = 'curve-display';\r\n\r\n        canvas.setAttribute('class', 'motion-curve');\r\n\r\n        canvas.width = 180;\r\n        canvas.height = 100;\r\n\r\n        canvas.style.background = \"black\";\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.fillStyle = \"rgb(0,0,0)\";\r\n        context.fillRect(0, 0, 180, 100);\r\n\r\n        context.lineWidth = 0.5;\r\n        context.strokeStyle = \"rgb(230,230,230)\";\r\n\r\n        context.beginPath();\r\n        context.moveTo(0, 20);\r\n        context.lineTo(180, 20);\r\n        context.moveTo(0, 80);\r\n        context.lineTo(180, 80);\r\n        context.closePath();\r\n        context.stroke();\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = \"rgb(255,127,127)\";\r\n\r\n        var position = {x: 0, y: 80};\r\n        var position_old = {x: 0, y: 80};\r\n\r\n        this.test_graph_size = new Vector(185, 80 -20);\r\n\r\n       var points = this.get_line_segment(this.test_graph_size, 5, curveCall);\r\n\r\n        for(var x in points)\r\n        {\r\n            var position = new Vector(points[x].x, this.test_graph_size.y + 20 - points[x].y);\r\n\r\n            context.beginPath();\r\n            context.moveTo(position_old.x, position_old.y);\r\n            context.lineTo(position.x, position.y);\r\n            context.closePath();\r\n            context.stroke();\r\n\r\n            position_old.x = position.x;\r\n            position_old.y = position.y;\r\n        }\r\n\r\n        return canvas;\r\n    }\r\n\r\n    get_line_segment(size, pointDist, curveCall)\r\n    {\r\n        if(!size || !pointDist) //***PREVENT DOUBLE RUN\r\n        {\r\n\r\n            return 0;\r\n        }\r\n\r\n        var points = [];\r\n\r\n        var current_point = new Vector(0, 0, 0);\r\n\r\n        var position = new Vector(current_point),\r\n\r\n            target = new Vector(position.add(size)),\r\n\r\n            start = new Vector(position),\r\n\r\n            curveMethod = curveCall,\r\n\r\n            ptrack = new Vector(start);\r\n\r\n        for (position.x = position.x; position.x < target.x; position.x += 1) {\r\n\r\n            var dist = position.sub(start);\r\n\r\n            var pct = dist.x / size.x;\r\n\r\n            position.y = Math.round(curveMethod(pct) * size.y);\r\n\r\n            if (ptrack.trig_distance_xy(position) >= pointDist) {\r\n\r\n                var p = new Vector(Gamestack.GeoMath.rotatePointsXY(position.x, position.y, 0));\r\n\r\n                points.push(p);\r\n\r\n                current_point = new Vector(position);\r\n\r\n                ptrack = new Vector(current_point);\r\n\r\n            }\r\n        }\r\n\r\n        return points;\r\n\r\n    }\r\n\r\n    fill(size, pointDist)\r\n    {\r\n\r\n        if(!size || !pointDist) //***PREVENT DOUBLE RUN\r\n        {\r\n\r\n            return 0;\r\n        }\r\n\r\n        this.size = size;\r\n\r\n        this.pointDist = pointDist;\r\n\r\n        var __inst = this;\r\n\r\n        this.points = [];\r\n\r\n        var current_point = new Vector(this.position), yTrack = 0;\r\n\r\n        for(var x= 0; x <= this.iterations; x++) {\r\n\r\n            var position = new Vector(current_point),\r\n\r\n                target = new Vector(position.add(size)),\r\n\r\n                start = new Vector(position),\r\n\r\n                curveMethod = this.curve,\r\n\r\n                ptrack = new Vector(start);\r\n\r\n            for (position.x = position.x; position.x < target.x; position.x += 1) {\r\n\r\n                var dist = position.sub(start);\r\n\r\n                var pct = dist.x / size.x;\r\n\r\n                position.y = start.y +  Math.round(curveMethod(pct) * size.y);\r\n\r\n                if (current_point.trig_distance_xy(position) >= this.pointDist) {\r\n\r\n                    var p = new Vector(Gamestack.GeoMath.rotatePointsXY(position.x, position.y, this.rotation));\r\n\r\n                    this.points.push(p);\r\n\r\n                    current_point = new Vector(position);\r\n\r\n                }\r\n            }\r\n\r\n            size = size.mult(this.growth);\r\n\r\n\r\n        }\r\n    }\r\n\r\n    transpose(origin)\r\n    {\r\n\r\n        var t_points = [];\r\n\r\n        for(var x = 0; x < this.points.length; x++) {\r\n\r\n            t_points.push(this.points[x].add(origin));\r\n\r\n        }\r\n\r\n        return t_points;\r\n\r\n    }\r\n\r\n    add_segment(next_segment, offset)\r\n    {\r\n        for(var x = 0; x < next_segment.length; x++) {\r\n\r\n            next_segment[x] = new Vector(next_segment[x]).add(offset);\r\n\r\n            this.points.push(next_segment[x]);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    get_flipped_segment(points)\r\n    {\r\n\r\n        var t_points = points.slice(), t_len = t_points.length;\r\n\r\n        for(var x = 0; x < points.length; x++) {\r\n\r\n            t_points[t_len - x].x = points[x].x\r\n\r\n        }\r\n\r\n        return t_points;\r\n\r\n    }\r\n\r\n    Highlight(origin, ctx)\r\n    {\r\n\r\n        ctx = ctx || Gamestack.ctx;\r\n\r\n        var points = this.transpose(origin);\r\n\r\n        for(var x in points)\r\n        {\r\n\r\n            var point = points[x];\r\n\r\n            var dist = point.sub(Gamestack.point_highlighter.position);\r\n\r\n            var d = Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n\r\n            if(d >= 10)\r\n            {\r\n                Gamestack.point_highlighter.position = new Vector2(points[x]);\r\n            }\r\n\r\n\r\n               Canvas.draw(Gamestack.point_highlighter, ctx);\r\n\r\n        }\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nvar GeoMath = {\r\n\r\n        rotatePointsXY:function(x,y,angle) {\r\n\r\n            var theta = angle*Math.PI/180;\r\n\r\n            var point = {};\r\n            point.x = x * Math.cos(theta) - y * Math.sin(theta);\r\n            point.y = x * Math.sin(theta) + y * Math.cos(theta);\r\n\r\n            point.z = 0;\r\n\r\n            return point\r\n        }\r\n\r\n}\r\n\r\nGamestack.GeoMath = GeoMath;\r\n;/**\r\n * Takes an object of arguments and returns Sprite() object. Sprite() is a container for multiple Animations, Motions, and Sounds. Sprites have several behavioral functions for 2d-Game-Objects.\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n\r\n * @param   {string} args.src the source file for the GameImage:Sprite.image :: use a string / file-path\r\n\r\n * @param   {Vector} args.size the size of the Sprite\r\n * @param   {Vector} args.position the position of the Sprite\r\n * @param   {Vector} args.padding the 'float-type' Vector of x and y padding to use when processing collision on the Sprite. A padding of new Vector(0.2, 0.2) will result in 1/5 of Sprite size for padding\r\n\r\n * @param   {Animation} args.selected_animation the selected_animation of the Sprite:: pass during creation or use Sprite.setAnimation after created\r\n *\r\n * @returns {Sprite} a Sprite object\r\n */\r\n\r\nclass Sprite {\r\n    constructor(args={}) {\r\n\r\n        if(args instanceof Animation)\r\n        {\r\n            args = {selected_animation:args, size:new Vector(args.frameSize)};\r\n        }\r\n\r\n        this.active = true; //active sprites are visible\r\n\r\n        this.name = args.name || \"__blankName\";\r\n\r\n        this.description = args.description || \"__spriteDesc\";\r\n\r\n        this.gravity = \"medium\";\r\n\r\n        this.__initializers = __gameStack.getArg(args, '__initializers', []);\r\n\r\n        var _spr = this;\r\n\r\n        this.type = __gameStack.getArg(args, 'type', 'basic');\r\n\r\n        this.animations = __gameStack.getArg(args, 'animations', []);\r\n\r\n        this.motions = __gameStack.getArg(args, 'motions', []);\r\n\r\n        this.projectiles = __gameStack.getArg(args, 'projectiles', []);\r\n\r\n        let __inst = this;\r\n\r\n        this.id = __gameStack.getArg(args, 'id', this.create_id());\r\n\r\n        this.sounds = __gameStack.getArg(args, 'sounds', []);\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.size = new Vector(__gameStack.getArg(args, 'size', new Vector3(100, 100)));\r\n\r\n        this.position = new Vector( __gameStack.getArg(args, 'position', new Vector3(0, 0, 0)));\r\n\r\n        this.collision_bounds = __gameStack.getArg(args, 'collision_bounds', new VectorBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n        this.rotation =  new Vector(__gameStack.getArg(args, 'rotation', new Vector3(0, 0, 0)));\r\n\r\n        this.selected_animation = {};\r\n\r\n        this.speed = __gameStack.getArg(args, 'speed', new Vector3(0, 0, 0));\r\n\r\n        this.acceleration = __gameStack.getArg(args, 'acceleration', new Vector3(0, 0, 0));\r\n\r\n        this.rot_speed = __gameStack.getArg(args, 'rot_speed', new Vector3(0, 0, 0));\r\n\r\n        this.rot_accel = __gameStack.getArg(args, 'rot_accel', new Vector3(0, 0, 0));\r\n\r\n        this.padding = __gameStack.getArg(args, 'padding', new Vector3(0, 0, 0));\r\n\r\n        //Apply / instantiate Sound(), Motion(), and Animation() args...\r\n\r\n        GameStack.each(this.sounds, function (ix, item) {\r\n\r\n            __inst.sounds[ix] = new Sound(item);\r\n\r\n        });\r\n\r\n        GameStack.each(this.motions, function (ix, item) {\r\n\r\n            __inst.motions[ix] = new Motion(item);\r\n\r\n        });\r\n\r\n        GameStack.each(this.animations, function (ix, item) {\r\n\r\n            __inst.animations[ix] = new Animation(item);\r\n\r\n\r\n        });\r\n\r\n        GameStack.each(this.projectiles, function (ix, item) {\r\n\r\n            __inst.projectiles[ix] = new Projectile(item);\r\n\r\n        });\r\n\r\n        if(__inst.projectiles[0])\r\n        {\r\n            __inst.selected_projectile = __inst.projectiles[0];\r\n\r\n        }\r\n\r\n        //Apply initializers:\r\n\r\n        GameStack.each(this.__initializers, function (ix, item) {\r\n\r\n            __inst.onInit(item);\r\n\r\n        });\r\n\r\n\r\n        this.selected_animation = new Animation(args.selected_animation || {});\r\n\r\n            this.image.domElement.onload = function(){\r\n\r\n                __inst.setAnimation(__inst.animations[0] || new Animation({\r\n\r\n                        image:  __inst.image,\r\n\r\n                        frameSize: new Vector3( __inst.image.domElement.width,  __inst.image.domElement.height),\r\n\r\n                        frameBounds: new VectorFrameBounds(new Vector3(), new Vector3())\r\n\r\n\r\n                    }));\r\n\r\n            };\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function adds objects to the Sprite. Objects of Animation(), Projectile().\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    add(obj) {\r\n\r\n        switch(obj.constructor.name)\r\n        {\r\n\r\n            case \"Animation\":\r\n\r\n                this.animations.push(obj);\r\n\r\n                break;\r\n\r\n            case \"Projectile\":\r\n\r\n                obj.origin = obj.origin || this.position;\r\n\r\n                this.projectiles.push(obj);\r\n\r\n                break;\r\n\r\n            case \"Motion\":\r\n\r\n                this.motions.push(obj);\r\n\r\n                break;\r\n\r\n            case \"Sound\":\r\n\r\n                this.sounds.push(obj);\r\n\r\n                break;\r\n\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * This function initializes sprites. Call to trigger all functions previously passed to onInit().\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    init() {\r\n\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends the init() function. Takes single function() argument OR single string argument\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} fun the function to be passed into the init() event of the Sprite()\r\n     **********/\r\n\r\n    onInit(fun) {\r\n\r\n        if (typeof fun == 'string') {\r\n\r\n            if (this.__initializers.indexOf(fun) < 0) {\r\n\r\n                this.__initializers.push(fun)\r\n            }\r\n            ;\r\n\r\n            var __inst = this;\r\n\r\n            var keys = fun.split('.');\r\n\r\n            console.log('finding init from string:' + fun);\r\n\r\n            if (!keys.length >= 2) {\r\n                return console.error('need min 2 string keys separated by \".\"');\r\n            }\r\n\r\n            var f = GameStack.options.SpriteInitializers[keys[0]][keys[1]];\r\n\r\n            if (typeof(f) == 'function') {\r\n\r\n                var __inst = this;\r\n\r\n                var f_init = this.init;\r\n\r\n                this.init = function () {\r\n\r\n                    f_init(__inst);\r\n\r\n                    f(__inst);\r\n\r\n                };\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'function') {\r\n\r\n            console.log('extending init:');\r\n\r\n\r\n            var f_init = this.init;\r\n            var __inst = this;\r\n\r\n            this.init = function () {\r\n\r\n                f_init(__inst);\r\n\r\n                fun(__inst);\r\n\r\n            };\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'object') {\r\n\r\n            console.log('extending init:');\r\n\r\n            console.info('Quick2D does not yet implement onInit() from arg of object type');\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Getters\r\n     ***************************/\r\n\r\n    /**\r\n     * This function gets the 'id' of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    get_id() {\r\n        return this.id;\r\n    }\r\n\r\n    to_map_object(size, framesize) {\r\n\r\n        this.__mapSize = new Vector3(size || this.size);\r\n\r\n        this.frameSize = new Vector3(framesize || this.size);\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Setters and Creators\r\n     ***************************/\r\n\r\n    /**\r\n     * This function creates the 'id' of the Sprite():Called automatically on constructor()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    create_id() {\r\n\r\n        return Quick2d.create_id();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function sets the size of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setSize(size) {\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sets the position of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setPos(pos) {\r\n        this.position = new Vector3(pos.x, pos.y, pos.z || 0);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sizes the Sprite according to minimum dimensions and existing w/h ratios\r\n     * @param {number} mx the maximum size.x for the resize\r\n     * @param {number} my the maximum size.y for the resize\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n   getSizeByMax(mx, my)\r\n    {\r\n\r\n        var size = new Vector3(this.size);\r\n\r\n        var wth = size.y /  size.x;\r\n\r\n        var htw = size.x /  size.y;\r\n\r\n        if( size.x > mx)\r\n        {\r\n            size.x = mx;\r\n\r\n            size.y = size.x * wth;\r\n\r\n        }\r\n\r\n        if( size.y > my)\r\n        {\r\n            size.y = my;\r\n\r\n            size.x = size.y * htw;\r\n\r\n        }\r\n\r\n        return size;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  assertSpeed()\r\n     *  -assert the existence of a speed{} object\r\n     ***************************/\r\n\r\n    assertSpeed() {\r\n        if (!this.speed) {\r\n\r\n            this.speed = new Vector3(0, 0, 0);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  setAnimation(anime)\r\n     *  -set the select_animation of this sprite\r\n     ***************************/\r\n\r\n    /**\r\n     * This function sets the 'selected_animation' property of the Sprite():: *all Sprites must have a 'selected_animation'\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation}\r\n     **********/\r\n\r\n    setAnimation(anime) {\r\n\r\n        if (anime instanceof Animation && this.animations.indexOf(anime) < 0) {\r\n            this.animations.push(anime);\r\n        }\r\n\r\n        this.selected_animation = anime;\r\n\r\n        Gamestack.log('declared default animation');\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /**\r\n     * This function indicates if this Sprite is onScreen within the Gamestack.WIDTH && Gamestack.HEIGHT dimensions, OR any w & h passed as arguments\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} w optional WIDTH argument, defaults to Gamestack.WIDTH\r\n     * @param {number} h optional HEIGHT argument, defaults to Gamestack.HEIGHT\r\n     **********/\r\n\r\n    onScreen(w, h) {\r\n\r\n        w = w || __gameStack.WIDTH;\r\n\r\n        h = h || __gameStack.HEIGHT;\r\n\r\n\r\n        var camera = __gameStack.camera ||__gameStack.__gameWindow.camera || new Vector3(0, 0, 0);\r\n\r\n        var p = new Vector3(this.position.x - camera.position.x, this.position.y - camera.position.y, this.position.z - camera.position.z);\r\n\r\n        var onScreen = p.x  > 0 - this.size.x && p.x < w + this.size.x\r\n        &&  p.y  > 0 - this.size.x && p.y < h + this.size.y ? true : false;\r\n\r\n        return onScreen;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Updates\r\n     ***************************/\r\n\r\n    /*****************************\r\n     * update()\r\n     * -starts empty:: is used by Quick2d.js as the main sprite update\r\n     ***************************/\r\n\r\n    /**\r\n     * This function is the main update() function for the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n\r\n    update(sprite) {\r\n    }\r\n\r\n    /*****************************\r\n     * def_update()\r\n     * -applies speed and other default factors of movement::\r\n     * -is used by Quick2d.js as the system def_update (default update)\r\n     ***************************/\r\n\r\n    /**\r\n     * This function updates various speed and rotational-speed properties for the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    def_update(sprite) {\r\n\r\n\r\n        for (var x in this.speed) {\r\n\r\n            if (this.speed[x] > 0 || this.speed[x] < 0) {\r\n\r\n                this.position[x] += this.speed[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.acceleration) {\r\n\r\n            if (this.acceleration[x] > 0 || this.acceleration[x] < 0) {\r\n\r\n                this.speed[x] += this.acceleration[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.rot_speed) {\r\n\r\n            if ( this.rot_speed[x] > 0 || this.rot_speed[x] < 0) {\r\n\r\n                this.rotation[x] += this.rot_speed[x];\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        for (var x in this.rot_accel) {\r\n\r\n\r\n            if (this.rot_accel[x] > 0 || this.rot_accel[x] < 0) {\r\n\r\n                this.rot_speed[x] += this.rot_accel[x];\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This function resolves a function nested in an object, from a string-key, and it is applied by Gamestack.js for persistence of data and Sprite() behaviors\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    resolveFunctionFromDoubleKeys(keyString1, keyString2, obj, callback) {\r\n\r\n        callback(typeof obj[keyString1][keyString2] == 'function' ? obj[keyString1][keyString2] : {});\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends an existing function, and is applied by Gamestack in onInit();\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    extendFunc(fun, extendedFunc) {\r\n\r\n        console.log('extending func');\r\n\r\n        var ef = extendedFunc;\r\n\r\n        var __inst = this;\r\n\r\n        return function () {\r\n\r\n\r\n            ef(__inst);\r\n\r\n            //any new function comes after\r\n\r\n            fun(__inst);\r\n\r\n\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  onUpdate(fun)\r\n     * -args: 1 function(sprite){ } //the self-instance/sprite is passed into the function()\r\n     * -overrides and maintains existing code for update(){} function\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * Extends the update() of this sprite with a new function to be called during update()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} the function to apply to the Sprite:update()\r\n     **********/\r\n\r\n\r\n    onUpdate(fun) {\r\n        fun = fun || function () {\r\n            };\r\n\r\n        let update = this.update;\r\n\r\n        let __inst = this;\r\n\r\n        this.update = function (__inst) {\r\n            update(__inst);\r\n            fun(__inst);\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * <ul>\r\n     *     <li>A rectangular style position</li>\r\n     *      <li>Takes another sprite as argument</li>\r\n     *       <li>Returns basic true || false during runtime</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {sprite}\r\n     **********/\r\n\r\n\r\n    /**\r\n     * Get the true || false results of a Collision between two Sprites(), based on their position Vectors and Sizes\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} sprite the alternate Sprite to process collision with\r\n     **********/\r\n\r\n\r\n    collidesRectangular(sprite) {\r\n\r\n        return Gamestack.Collision.spriteRectanglesCollide(this, sprite);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  shoot(sprite)\r\n     *  -fire a shot from the sprite:: as in a firing gun or spaceship\r\n     *  -takes options{} for number of shots anglePerShot etc...\r\n     *  -TODO: complete and test this code\r\n     ***************************/\r\n\r\n    /**\r\n     * Sprite fires a projectile object\r\n     * <ul>\r\n     *     <li>Easy instantiator for bullets and propelled objects in GameStack</li>\r\n     *     <li>*TODO: This function is not-yet implemented in GameStack</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {options} *numerous args\r\n     **********/\r\n\r\n\r\n    /**\r\n     * fire a projectile-subSprite from the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} rot_offset the rotational offset to apply: controls direction of the shot\r\n     **********/\r\n\r\n    shoot(options) {\r\n        //character shoots an animation\r\n\r\n        this.prep_key = 'shoot';\r\n\r\n        let animation = options.bullet || options.animation || new Animation();\r\n\r\n        let speed = options.speed || 1;\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let size = options.size || new Vector3(10, 10, 0);\r\n\r\n        let rot_offset = options.rot_offset || new Vector3(0, 0, 0);\r\n\r\n\r\n        var __playerInst = this;\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var bx = position.x, by = position.y, bw = size.x, bh = size.y;\r\n\r\n            var shot = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            shot.setAnimation(animation);\r\n\r\n            if (typeof(rot_offset) == 'number') {\r\n                rot_offset = new Vector3(rot_offset, 0, 0);\r\n            }\r\n\r\n            shot.position.x = bx, shot.position.y = by;\r\n            shot.rotation.x = 0 + rot_offset.x;\r\n\r\n            shot.stats = {\r\n\r\n                damage: 1\r\n\r\n            };\r\n\r\n            if(!options.line) {\r\n\r\n                shot.speed.x = Math.cos((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n                shot.speed.y = Math.sin((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n            }\r\n            else\r\n            {\r\n                options.line.fill(new Vector(500, 500), 4);\r\n\r\n                var nextPos = new Vector(0, 0, 0);\r\n\r\n              shot.onUpdate(function(spr){\r\n\r\n                  nextPos = options.line.next(nextPos);\r\n\r\n                  spr.position =  __playerInst.position.add(nextPos);\r\n\r\n                  console.log(spr.position);\r\n\r\n\r\n              });\r\n\r\n\r\n            }\r\n\r\n            return shot;\r\n\r\n        }\r\n\r\n        return new Error(\"game was not in motion: Gamestack.isAtPlay must be true to create a shot.\");\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * create a subsprite of Sprite belonging to the current Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} offset the positional offset to apply\r\n     **********/\r\n\r\n    subsprite(options) {\r\n\r\n        let animation = options.animation || new Animation();\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let offset = options.offset || new Vector3(0, 0, 0);\r\n\r\n        let size = options.size || this.size;\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var subsprite = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                offset: offset,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            subsprite.setAnimation(animation);\r\n\r\n            return subsprite;\r\n\r\n        }\r\n        else\r\n        {\r\n            alert('No subsprite when not at play');\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * animate Sprite.selected_animation  by one frame\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation} animation to use, defaults to Sprite.selected_animation\r\n     **********/\r\n\r\n    animate(animation) {\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            if (animation) {\r\n                this.setAnimation(animation)\r\n            }\r\n\r\n            this.selected_animation.animate();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * run a function when the Sprite.selected_animation is complete\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Function} fun the function to call when the animation is complete\r\n     *\r\n     **********/\r\n\r\n    onAnimationComplete(fun) {\r\n        this.selected_animation.onComplete(fun);\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  accelY\r\n     *  -accelerate on Y-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: gravitation of sprite || up / down movement\r\n     ***************************/\r\n\r\n    /**\r\n     * accelerate speed on the Y-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n    accelY(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {y: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.y - this.speed.y;\r\n\r\n        if (diff > 0) {\r\n            this.speed.y += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.y -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accelX\r\n     *  -accelerate on X-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: running of sprite || left / right movement\r\n     ***************************/\r\n\r\n\r\n\r\n\r\n    /**\r\n     * accelerate speed on the X-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n\r\n    accelX(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.x - this.speed.x;\r\n\r\n        if (diff > 0) {\r\n            this.speed.x += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.x -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accel\r\n     *  -accelerate any acceleration -key\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * accelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} accel the increment of acceleration\r\n     *\r\n     * @param {number} max the max value to accelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    accel(prop, key, accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        let speed = prop[key];\r\n\r\n        // this.assertSpeed();\r\n\r\n        let diff = max.x - prop[key];\r\n\r\n        if (diff > 0) {\r\n            prop[key] += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            prop[key] -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  decel\r\n     *  -deceleration -key\r\n     ***************************/\r\n\r\n    /**\r\n     * decelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} decel the increment of deceleration\r\n     *\r\n     * @param {number} max the max value to decelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    decel(prop, key, rate) {\r\n        if (typeof(rate) == 'object') {\r\n\r\n            rate = rate.rate;\r\n\r\n        }\r\n\r\n        rate = Math.abs(rate);\r\n\r\n        if (Math.abs(prop[key]) <= rate) {\r\n            prop[key] = 0;\r\n        }\r\n\r\n        else if (prop[key] > 0) {\r\n            prop[key] -= rate;\r\n\r\n        }\r\n        else if (prop[key] < 0) {\r\n            prop[key] += rate;\r\n\r\n        }\r\n        else {\r\n\r\n            prop[key] = 0;\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    /*****************************\r\n     *  decelY\r\n     *  -decelerate on the Y axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the Y-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelY(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n        if (Math.abs(this.speed.y) <= amt) {\r\n            this.speed.y = 0;\r\n\r\n        }\r\n        else if (this.speed.y > amt) {\r\n\r\n            this.speed.y -= amt;\r\n        }\r\n        else if (this.speed.y < amt * -1) {\r\n\r\n            this.speed.y += amt;\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  decelX\r\n     *  -decelerate on the X axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the X-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelX(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n\r\n        if (this.speed.x > amt) {\r\n\r\n            this.speed.x -= amt;\r\n        }\r\n        else if (this.speed.x < amt * -1) {\r\n\r\n            this.speed.x += amt;\r\n        }\r\n\r\n        if (Math.abs(this.speed.x) <= amt) {\r\n\r\n            this.speed.x = 0;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    shortest_stop(item, callback) {\r\n        var diff_min_y = item.min ? item.min.y : Math.abs(item.position.y - this.position.y + this.size.y);\r\n\r\n        var diff_min_x = item.min ? item.min.x : Math.abs(item.position.x - this.position.x + this.size.x);\r\n\r\n        var diff_max_y = item.max ? item.max.y : Math.abs(item.position.y + item.size.y - this.position.y);\r\n\r\n        var diff_max_x = item.max ? item.max.x : Math.abs(item.position.x + item.size.x - this.position.y);\r\n\r\n        var dimens = {top: diff_min_y, left: diff_min_x, bottom: diff_max_y, right: diff_max_x};\r\n\r\n        var minkey = \"\", min = 10000000;\r\n\r\n        for (var x in dimens) {\r\n            if (dimens[x] < min) {\r\n                min = dimens[x];\r\n                minkey = x; // a key of top left bottom or right\r\n\r\n            }\r\n        }\r\n\r\n        callback(minkey);\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * get the center of a Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Vector)\r\n     *\r\n     **********/\r\n\r\n    center() {\r\n\r\n\r\n        return new Vector(this.position.x + this.size.x / 2, this.position.y + this.size.y / 2, 0);\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on X axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns {var} a true || false var\r\n     *\r\n     **********/\r\n\r\n    overlap_x(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return right > item.position.x && left < item.position.x + item.size.x;\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on Y axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns (true || false}\r\n     *\r\n     **********/\r\n\r\n    overlap_y(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return bottom > item.position.y && top < item.position.y + item.size.y;\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n\r\n    collide_stop_x(item)\r\n    {\r\n\r\n        var apart = false;\r\n\r\n            var ct = 10000;\r\n\r\n            while (!apart && ct > 0) {\r\n\r\n                ct--;\r\n\r\n                var diffX = this.center().sub(item.center()).x;\r\n\r\n                var distX = Math.abs(this.size.x / 2 + item.size.x / 2 - Math.round(this.size.x * this.padding.x));\r\n\r\n                if (Math.abs(diffX) < distX) {\r\n\r\n                    this.position.x -= diffX > 0 ? -1 : 1;\r\n\r\n\r\n\r\n                }\r\n                else\r\n                {\r\n\r\n                    apart = true;\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * cause a fourway collision-stop between this and another Sprite :: objects will behave clastically and resist passing through one another\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     *\r\n     **********/\r\n\r\n    collide_stop(item) {\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n       // this.position = this.position.sub(this.speed);\r\n\r\n        if(this.collidesRectangular(item)) {\r\n\r\n            var diff = this.center().sub(item.center());\r\n\r\n            if(this.overlap_x(item, this.padding.x + 0.1) && Math.abs(diff.x) < Math.abs(diff.y))\r\n           {\r\n\r\n               var apart = false;\r\n\r\n                   var ct = 10000;\r\n\r\n                   while (!apart && ct > 0) {\r\n\r\n                       ct--;\r\n\r\n                       var diffY = this.center().sub(item.center()).y;\r\n\r\n                       var distY = Math.abs(this.size.y / 2 + item.size.y / 2- Math.round(this.size.y * this.padding.y));\r\n\r\n                       if (Math.abs(diffY) < distY) {\r\n\r\n                           this.position.y -= diffY > 0 ? -1 : diffY < 0 ? 1 : 0;\r\n\r\n                           this.position.y = Math.round(this.position.y);\r\n\r\n                       }\r\n\r\n                     else {\r\n\r\n                           if (diffY <= 0){\r\n                               this.__inAir = false;\r\n                           };\r\n\r\n\r\n                          return apart = true;\r\n\r\n\r\n                       }\r\n\r\n\r\n               }\r\n\r\n\r\n\r\n           }\r\n\r\n\r\n            if(this.overlap_y(item, this.padding.y ) && Math.abs(diff.y) < Math.abs(diff.x)) {\r\n\r\n                this.collide_stop_x(item);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    collide_stop_top(item)\r\n    {\r\n\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n            if(this.overlap_x(item, this.padding.x + 0.1))\r\n            {\r\n\r\n                console.log('OVERLAP_X');\r\n\r\n                var paddingY = this.padding.y * this.size.y;\r\n\r\n                if(this.position.y + this.size.y - paddingY <= item.position.y)\r\n                {\r\n\r\n                    this.groundMaxY = item.position.y - this.size.y + paddingY;\r\n\r\n                }\r\n\r\n            }\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Restore a sprite from saved .json data\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Sprite)\r\n     **********/\r\n\r\n    restoreFrom(data) {\r\n        data.image = new GameImage(data.src || data.image.src);\r\n\r\n        return new Sprite(data);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  fromFile(file_path)\r\n     *  -TODO : complete this function based on code to load Sprite() from file, located in the spritemaker.html file\r\n     *  -TODO: test this function\r\n     ***************************/\r\n\r\n    fromFile(file_path) {\r\n\r\n        if (typeof file_path == 'string') {\r\n\r\n            var __inst = this;\r\n\r\n            $.getJSON(file_path, function (data) {\r\n\r\n                __inst = new Sprite(data);\r\n\r\n            });\r\n        }\r\n    }\r\n\r\n    toJSONString()\r\n    {\r\n        for(var x = 0; x < this.motions.length; x++)\r\n        {\r\n            this.motions[x].parent = false;\r\n        }\r\n\r\n        return jstr(this);\r\n    }\r\n\r\n}\r\n;\r\n\r\n/****************\r\n * TODO : Complete SpritePresetsOptions::\r\n *  Use these as options for Sprite Control, etc...\r\n ****************/\r\n\r\nGamestack.Sprite = Sprite;\r\n\r\nlet SpriteInitializersOptions = {\r\n\r\n    Clastics:{\r\n\r\n        top_collideable:function(sprite)\r\n        {\r\n\r\n            for(var x in Gamestack.__gameWindow.forces)\r\n            {\r\n                var force = Gamestack.__gameWindow.forces[x];\r\n\r\n                force.topClastics.push(sprite);\r\n\r\n            }\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        fourside_collideable:function(sprite)\r\n        {\r\n\r\n            for(var x in Gamestack.__gameWindow.forces)\r\n            {\r\n                var force = Gamestack.__gameWindow.forces[x];\r\n\r\n                force.clasticObjects.push(sprite);\r\n\r\n            }\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n    },\r\n\r\n    MainGravity:{\r\n\r\n        very_light:function(sprite)\r\n        {\r\n            //Add a gravity to the game\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"very_light_grav\",\r\n                accel:0.05,\r\n                max:new Vector3(0, 3.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        light:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"light_grav\",\r\n                accel:0.1,\r\n                max:new Vector3(0, 4.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        medium:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"medium_grav\",\r\n                accel:0.2,\r\n                max:new Vector3(0, 7.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n\r\n        strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.4,\r\n                max:new Vector3(0, 10.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        very_strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.5,\r\n                max:new Vector3(0, 12.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n    },\r\n\r\n\r\n    ControllerStickMotion: {\r\n\r\n        player_move_x: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                spr.decelX(0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_move_xy: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    x = 0;\r\n                }\r\n\r\n                if (Math.abs(y) < 0.2) {\r\n                    y = 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                sprite.accelY(accel, y * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.speed, 'x', 0.1);\r\n\r\n                sprite.decel(sprite.speed, 'y', 0.1);\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_rotate_x: function (sprite) {\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.25; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accel(sprite.rot_speed, 'x', accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.rot_speed, 'x', 0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\nGamestack.options = Gamestack.options || {};\r\n\r\nGamestack.options.SpriteInitializers = SpriteInitializersOptions;;\r\n/**\r\n * Takes arguments of x, y, and (optionally) z, instantiates Vector object\r\n\r\n <ul>\r\n <li>Optional: use a Vector as the 'x' argument, and instantiate new distinct Vector from the argument</li>\r\n </ul>\r\n\r\n * @param   {number} x the x coordinate\r\n * @param   {number} y the y coordinate\r\n * @param   {number} z the z coordinate\r\n * @returns {Vector} a Vector object\r\n */\r\n\r\n\r\nclass Vector {\r\n    constructor(x, y, z, r) {\r\n\r\n        if(typeof(x) == 'object' && x.hasOwnProperty('x') && x.hasOwnProperty('y')) //optionally pass vector3\r\n        {\r\n            this.x = x.x;\r\n            this.y = x.y;\r\n            this.z = x.z || 0;\r\n\r\n            if(this.z == null)\r\n            {\r\n                this.z = 0;\r\n            }\r\n\r\n            return this;\r\n        }\r\n\r\n        if(z == null){z = 0;}\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.r = r;\r\n\r\n    }\r\n\r\n\r\n    sub(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x - v.x, this.y - v.y, this.z - v.z);\r\n\r\n    }\r\n\r\n    add(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x + v.x, this.y + v.y, this.z + v.z);\r\n\r\n    }\r\n\r\n    mult(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x * v.x, this.y * v.y, this.z * v.z);\r\n\r\n    }\r\n    div(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x / v.x, this.y / v.y, this.z / v.z);\r\n    }\r\n\r\n    round()\r\n    {\r\n        return new Vector(Math.round(this.x), Math.round(this.y), Math.round(this.z));\r\n\r\n    }\r\n    floor()\r\n    {\r\n        return new Vector(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z));\r\n\r\n    }\r\n    ceil()\r\n    {\r\n        return new Vector(Math.ceil(this.x), Math.ceil(this.y), Math.ceil(this.z));\r\n\r\n    }\r\n\r\n    equals(v)\r\n    {\r\n\r\n        return this.x == v.x && this.y == v.y && this.z == v.z;\r\n    }\r\n\r\n    trig_distance_xy(v)\r\n    {\r\n\r\n        var dist = this.sub(v);\r\n\r\n        return  Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n    }\r\n\r\n    diff()\r\n    {\r\n        //TODO:this function\r\n\r\n\r\n    }\r\n\r\n    abs_diff()\r\n    {\r\n        //TODO:this function\r\n\r\n    }\r\n\r\n    is_between(v1, v2)\r\n    {\r\n       //TODO : overlap vectors return boolean\r\n\r\n        return this.x >= v1.x && this.x <= v2.x &&\r\n            this.y >= v1.y && this.y <= v2.y &&\r\n            this.z >= v1.z && this.z <= v2.z;\r\n\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\nlet Vector3 = Vector, Pos = Vector, Size = Vector, Position = Vector, Vector2 = Vector, Rotation = Vector;\r\n\r\n\r\nGamestack.Vector = Vector;\r\n\r\n\r\n//The above are a list of synonymous expressions for Vector. All of these do the same thing in this library (store x,y,z values)\r\n;class Background extends Sprite {\r\n\r\n    constructor(args={}) {\r\n\r\n        super(args);\r\n\r\n        this.type = args.type || \"parallax\" || \"basic\" || false;\r\n\r\n        this.orientation = args.orientation || \"x\" || \"y\" || \"xy\";\r\n\r\n        this.contents = args.contents || [];\r\n\r\n        if(this.contents instanceof Object)\r\n        {\r\n            this.contents = [this.contents] //encapsulate in array (always) for simple processing\r\n        };\r\n\r\n        this.reverseX = args.reverseX || false;\r\n\r\n        this.reverseY = args.reverseY || false;\r\n\r\n        this.speedFloat = args.speedFloat || 1.0;\r\n\r\n    }\r\n\r\n    scroll(speedX, speedY)\r\n    {\r\n\r\n        Gamestack.each(this.contents, function(ix, element){\r\n\r\n          element.position.x += speedX * this.speedFloat;\r\n            element.position.y += speedY * this.speedFloat;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    scrollX(speed)\r\n    {\r\n        Gamestack.each(this.contents, function(ix, element){\r\n\r\n            element.position.x += speed * this.speedFloat;\r\n\r\n        });\r\n\r\n    }\r\n\r\n    scrollY(speed)\r\n    {\r\n        Gamestack.each(this.contents, function(ix, element){\r\n\r\n            element.position.y += speed * this.speedFloat;\r\n\r\n        });\r\n    }\r\n    add(object)\r\n    {\r\n        var cleanCheck = object instanceof Sprite || object instanceof Array && object[0] instanceof Sprite;\r\n\r\n        if(!cleanCheck)\r\n        {\r\n            return console.error('Must have: valid contents (Sprite OR [] of Sprite())');\r\n        }\r\n\r\n        if(object instanceof Array)\r\n        {\r\n            this.contents.cancat(object)\r\n        }\r\n        else\r\n        {\r\n            this.contents.push(object);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n};\r\nclass Interactive extends Sprite\r\n{\r\n    constructor(args={})\r\n    {\r\n        super(args); //init as Sprite()\r\n    }\r\n    onCollide()\r\n    {\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n};\r\nclass Terrain extends Sprite\r\n{\r\n    constructor(args={})\r\n    {\r\n        super(args); //init as Sprite()\r\n\r\n        this.collision_type = args.collision_type || \"FULL_COLLIDE\" || \"TOP_COLLIDE\" || \"NO_COLLIDE\";\r\n\r\n    }\r\n\r\n    onCollide()\r\n    {\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n};\r\nclass Three extends Sprite //dependency: THREE.js\r\n{\r\n    constructor(args={})\r\n    {\r\n        super(args); //init as Sprite()\r\n\r\n       if(!THREE) //THREE.js library must be loaded\r\n       {\r\n           return console.error('ThreeJSObject():Library: Three.js is required for this object.');\r\n\r\n       }\r\n\r\n\r\n        this.scene =  new THREE.Scene();\r\n\r\n        this.geometry = args.geometry || new THREE.TorusGeometry( 50, 10, 16, 100 );\r\n\r\n        this.scene.add( new THREE.AmbientLight( 0x404040, 0.8  ) );\r\n\r\n\r\n        this.renderer = Gamestack.renderer || new THREE.WebGLRenderer({\r\n                preserveDrawingBuffer: true\r\n            });\r\n\r\n        this.renderer.setSize(1000, 1000);\r\n\r\n        this.camera = new THREE.PerspectiveCamera(70, 1, 1, 1000);\r\n\r\n        this.camera.position.z = 1000 / 8;\r\n\r\n\r\n        var __inst = this;\r\n\r\n        this.loader = new THREE.TextureLoader();\r\n        this.loader.load( \"../assets/game/image/tiles/perlin_3.png\", function ( texture ) {\r\n\r\n                __inst.material = args.material || new THREE.MeshPhongMaterial({\r\n                        map: texture\r\n                    });\r\n\r\n            if(!__inst.__init) {\r\n\r\n                __inst.mesh = new THREE.Mesh(__inst.geometry, __inst.material);\r\n\r\n                        __inst.scene.add(__inst.mesh);\r\n\r\n                        __inst.__init = true;\r\n\r\n                    }\r\n\r\n                __inst.renderer.render(__inst.scene, __inst.camera);\r\n\r\n\r\n                __ServerSideFile.file_upload('test.png', __inst.renderer.domElement.toDataURL('image/png'), function(relpath, content){\r\n\r\n                    relpath = relpath.replace('client/', '../');\r\n\r\n                    __inst.selected_animation = new Animation({src:relpath, frameSize:new Vector(1000, 1000), frameBounds:new VectorFrameBounds(new Vector(0, 0, 0), new Vector(0, 0, 0),new Vector(0, 0, 0))}).singleFrame();\r\n\r\n                    __inst.selected_animation.image.domElement.onload = function()\r\n                    {\r\n\r\n                        __inst.setSize(new Vector(__inst.selected_animation.image.domElement.width, __inst.selected_animation.image.domElement.height));\r\n\r\n                        __inst.selected_animation.animate();\r\n\r\n\r\n                        console.log(jstr(__inst.selected_animation.frames));\r\n\r\n                    };\r\n\r\n                });\r\n\r\n\r\n\r\n        } );\r\n\r\n    }\r\n\r\n    three_update()\r\n    {\r\n        console.log('THREE --GS-Object UPDATE');\r\n\r\n        this.mesh.rotation.y += 0.05;\r\n\r\n        this.renderer.clear();\r\n\r\n        this.renderer.setSize(this.size.x, this.size.y);\r\n\r\n        var pixels = new Uint8Array(this.size.x * this.size.y * 4);\r\n\r\n        this.renderer.render(this.scene, this.camera);\r\n\r\n        var gl = this.renderer.getContext();\r\n\r\n        gl.readPixels( 0, 0, this.size.x, this.size.y, gl.RGBA, gl.UNSIGNED_BYTE, pixels );\r\n\r\n        this.selected_animation.selected_frame = {image:{}};\r\n\r\n        this.selected_animation.selected_frame.image.data = new ImageData(new Uint8ClampedArray(pixels), this.size.x, this.size.y);\r\n\r\n    }\r\n    applyAnimativeState()\r\n    {\r\n\r\n\r\n    }\r\n}"]}