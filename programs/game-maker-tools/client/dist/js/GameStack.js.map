{"version":3,"sources":["../../../ecma/GameStack/concat/GameStack.js"],"names":["Gamestack","GameStackLibrary","lib","DEBUG","gui_mode","__gameWindow","__sprites","__animations","spriteTypes","systemSpriteTypes","systemAnimationTypes","attack_0","attack_1","attack_2","attack_3","attack_4","defend_0","defend_1","defend_2","defend_3","defend_4","heal_0","heal_1","heal_2","heal_3","heal_4","samples","log_modes","log_mode","recursionCount","__gameWindowList","create_id","d","Date","getTime","performance","now","replace","c","r","Math","random","floor","toString","getObjectById","id","x","all_objects","length","getAllCallables","actionables","$Q","each","sprites","ix","item","concat","sounds","motionstacks","animations","interlog","message","div","isNaN","error","quit","Error","console","info","m","GameStack","log","animate","time","__gameStack","isAtPlay","TWEEN","update","requestAnimationFrame","ctx","clearRect","canvas","width","height","draw","start","Collision","spriteRectanglesCollide","obj1","obj2","paddingX","round","padding","size","paddingY","y","left","position","right","top","bottom","_gameWindow","setGameWindow","gameWindow","ExtendEvents","extendedObject","extendedKey","extendor","extendorKey","extendorFunc","EventLink","parent_id","child_id","parent_key","child_key","evtLink","push","parent","onRun","getGameWindow","assignAll","object","args","keys","list","onResult","onComplete","i","ready_callstack","ready","callback","reload","callReady","funx","call","InputEvents","init","__running","getArg","key","fallback","hasOwnProperty","add","obj","GameWindow","Force","forces","Camera","camera","Sprite","GSEvent","apply","collect","remove","indexOf","splice","isNormalStringMatch","str1","str2","toLowerCase","instance_type_pairs","objectList","constructor_name","constructor","name","type","getById","select","objects_out","__inst","Sound","src","data","sound","document","createElement","onLoad","val","volume","play","SoundList","cix","Array","GameImage","onCreate","Object","image","ext","substring","lastIndexOf","onerror","__error","domElement","onload","Quick2d","__gameInstance","module","exports","jstr","JSON","stringify","selector","$GFunx","objects","on","evt_key","selectorObject","controller_ix","criterion","between","cparts","split","__targetType","__targetName","before","trim","parseFloat","alert","evt_profile","contains_any","button_mode","GamepadAdapter","item1","iy","item2","onUpdate","sprite","collidesRectangular","condition","evt_parts","run","mykey","number","e","propkey","spr","object_out","s","mainSelector","msfChar","__targetClassName","output","cleanSelectorString","str","after","getParts","complete","c1","test_str","start_pos","end_pos","contains","contains_all","cList","c2","test_selector_method","Q_TestStrings","test","query","mousemove","leftclick","rightclick","middleclick","wheelup","wheelDown","space","tab","shift","enter","extend","onFinish","cleanKey","down","up","getMousePos","pageX","pageY","clientX","body","scrollLeft","documentElement","clientY","scrollTop","offsetLeft","style","fullMoveInputEvents","event","pos","el","onkeydown","value","String","fromCharCode","keyCode","onkeyup","onmousedown","which","preventDefault","onmouseup","addEventListener","window","_preGameStack_windowLoad","backgrounds","interactives","append","background","getContext","adjustSize","onresize","target","w","h","clientWidth","clientHeight","getElementById","setAttribute","WIDTH","HEIGHT","listout","player","def_update","filepath","$","getJSON","_gw","Canvas","TextDisplay","widthFloat","heightFloat","topFloat","targetTop","get_float_pixels","leftFloat","targetLeft","color","text","fontFamily","font","fadeIn","fade","border","fontSize","fromLeft","fromRight","fromTop","fromBottom","duration","stay_duration","float","dimen","fun","display","textAlign","zIndex","innerText","textContent","opacity","Velocity","easing","setTimeout","ItemDisplay","Vector3","textSize","text_id","img_id","v","innerHTML","Bar","backgroundSize","backgroundPosition","BarFill","BarDisplay","fill_src","fill","fill_width","fill_height","fill_color","bar_src","bar","bar_width","bar_height","bar_color","f","VideoDisplay","undefined","z","FilterUtils","HSVtoRGB","g","b","p","q","t","RGBtoHSV","max","min","getPixel","pixels","pix","clampPixel","haveNextGaussian","nextGaussian","gaussianRandom","v1","v2","mult","sqrt","a","triangle","mod","n","parseInt","mixColors","rgb1","rgb2","linearInterpolate","bilinearInterpolate","nw","ne","sw","se","m0","m1","r0","g0","b0","a0","r1","g1","b1","a1","r2","g2","b2","a2","r3","g3","b3","a3","cx","cy","tableFilter","inputData","table","pixel","convolveFilter","matrix","outputData","rows","cols","rows2","cols2","trace","row","ioffset","moffset","col","iPixel","k","transformFilter","transformInverse","out","j","srcX","srcY","xWeight","yWeight","rgba","BlurFilter","isDirAnimatable","defaultValues","amount","valueRanges","filter","input","values","width4","qq","qqq","bigB","index","indexLast","ppixel","pppixel","ppppixel","BrightnessFilter","filterUtils","hsv","rgb","BumpFilter","CircleSmearFilter","density","mix","radius","radius2","numShapes","sx","pow","sy","mixedRGB","l","ContrastFilter","CrossSmearFilter","distance","x1","y1","DiffusionFilter","scale","sinTable","cosTable","angle","PI","sin","cos","transInverse","DitherFilter","levels","sum","map","reverse","direction","er","eg","eb","jx","factor","EdgeFilter","matrixH","matrixV","rh","gh","bh","rv","gv","bv","EmbossFilter","elevation","bumpHeight","width45","pixelScale","bumpPixels","bumpMapWidth","bumpMapHeight","Nx","Ny","Nz","Lx","Ly","Lz","Nz2","NzLz","NdotL","shade","bumpIndex","s1","s2","s3","ExposureFilter","exposure","exp","GainFilter","gain","bias","GammaFilter","GrayscaleFilter","luma","HueFilter","InvertFilter","KaleidoscopeFilter","rotation","sides","centerX","centerY","iCenterX","iCenterY","dx","dy","theta","atan2","LensDistortionFilter","refraction","x2","y2","rRefraction","z2","xAngle","acos","angle1","angle2","asin","tan","yAngle","LineSmearFilter","sinAngle","cosAngle","x0","y0","incrE","incrNE","ddx","ddy","abs","MaximumFilter","maxR","maxG","maxB","MedianFilter","rList","gList","bList","sortFunc","sort","MinimumFilter","minR","minG","minB","NoiseFilter","monochrome","OilFilter","range","rHistogram","gHistogram","bHistogram","rTotal","gTotal","bTotal","ro","go","bo","ri","gi","bi","OpacityFilter","PinchFilter","PixelationFilter","by","bx","bPixel","PosterizeFilter","RGBAdjustFilter","red","green","blue","SaturationFilter","RW","RG","RB","pR","pG","pB","SawtoothRippleFilter","xAmplitude","yAmplitude","xWavelength","yWavelength","nx","ny","fx","fy","SepiaFilter","SharpenFilter","SineRippleFilter","SolarizeFilter","SparkleFilter","rays","randomness","rayLengths","SquareSmearFilter","ThresholdFilter","threshold","brightness","colorVal","TriangleRippleFilter","TwirlFilter","VignetteFilter","context","gradient","putImageData","globalCompositeOperation","createRadialGradient","addColorStop","fillStyle","fillRect","getImageData","WaterRippleFilter","phase","wavelength","amplitude","distance2","JSManipulate","blur","bump","circlesmear","contrast","crosssmear","diffusion","dither","edge","emboss","gamma","grayscale","hue","invert","kaleidoscope","lensdistortion","linesmear","maximum","median","minimum","noise","oil","pinch","pixelate","posterize","rgbadjust","saturation","sawtoothripple","sepia","sharpen","sineripple","solarize","sparkle","squaresmear","triangleripple","twirl","vignette","waterripple","MyJSManipulate","CanvasLib","__levelMaker","active","onScreen","drawPortion","drawFrameWithRotation","img","fw","fh","deg","canvasContextObj","flip","save","rad","translate","rotate","drawImage","restore","drawData","frame","selected_animation","selected_frame","targetSize","realWidth","realHeight","offset","framePos","frameSize","flipX","Animation","_anime","defaultArgs","description","frames","delay","frameBounds","VectorFrameBounds","frameOffset","Vector","termPoint","extras","apply2DFrames","timer","seesaw_mode","run_ext","__frametype","fcount","quitLoop","frames_reversed","slice","pop","resetFrames","engage","caller","callkey","tween","Tween","curve","Easing","Linear","None","to","isComplete","EffectSequence","animation","effects","selected_effect","effects_list","effect_guis","numberSteps","counter","loopBack","testCtx","initValues","minFloat","portion","startValues","maxFloat","endValues","parse","foldLeft","foldTop","effect","dat","GUI","prototype","removeFolder","folder","__folders","close","__ul","removeChild","parentNode","onResize","gui","setValues","my_gui","startValuesGUI","addFolder","endValuesGUI","effect_select","setValue","onFinishChange","guiCallback","lp","onChange","DatGui","addTweenCurveSelect","updateableAnimationObjectToGui","sourceImageData","dataListCallback","image_data_list","canvasCallback","canvasList","image_ix","copyImageData","dst","createImageData","set","ct","stop","timer_diff","frameIndex","source_image","tween2","Extras","items","allowedTypes","fire","process","GravityForce","subjects","clasticObjects","topClastics","accel","itemx","accelY","__inAir","groundMaxY","itemy","collide_stop","collide_stop_top","gamepads","__gamepads","intervals","controller_stack","_gpinst","events","setInterval","gps","navigator","getGamepads","clearInterval","game_pad_index","game_pad","gp","stick_left","stick_right","buttons","extendFunc","f1","f2","fc","current_cb","parts","gpEvents","process_buttons","process_axes","axes","axis1","axia2","ceil","pressed","clearance_1","gpc","bkey","gpix","GamepadEvents","targets","triggered","statKey","lessThan","greaterThan","isStrOrNum","onKey","rejected","Motion","curvesList","curvesToArray","lineCurvesList","lineCurvesToArray","object_id","motion_curve","Quadratic","InOut","line_curve","targetRotation","motionCurveString","getMotionCurveString","lineCurveString","getLineCurveString","setMotionCurve","setLineCurve","easeType","cps","tweens","Game","targetR","__tweenObject","lineWidth","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","position_old","line","points","dist","ptrack","easeInOutQuad","t1","t2","sub","minPointDist","first_segment","extendLinePoints","segment","next_points","last_point","sr","GeoMath","rotatePointsXY","curve_iterations","Projectile","Line","origin","highlighted","collide","anime","setAnimation","setSize","transpose","center","equals","Rectangle","VectorBounds","Curves","linearNone","easeInQuadratic","easeOutQuadratic","easeInOutQuadratic","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuartic","easeOutQuartic","easeInOutQuartic","easeInQuintic","easeOutQuintic","easeInOutQuintic","Shapes","circle","freq","square","rect","base","curve_string","get_curve_from_string","is_highlighted","pointDist","iterations","growth","curve_options","num","get_curve_string","found","curveCall","existing_canvas","test_graph_size","get_line_segment","current_point","curveMethod","pct","trig_distance_xy","yTrack","t_points","next_segment","t_len","point","point_highlighter","Vector2","gravity","__initializers","_spr","motions","projectiles","collision_bounds","speed","acceleration","rot_speed","rot_accel","onInit","options","SpriteInitializers","f_init","framesize","__mapSize","mx","my","currentSize","wth","htw","keyString1","keyString2","extendedFunc","ef","prep_key","bullet","rot_offset","__playerInst","bw","shot","stats","damage","nextPos","next","subsprite","assertSpeed","diff","prop","rate","amt","diff_min_y","diff_min_x","diff_max_y","diff_max_x","dimens","minkey","apart","diffX","distX","overlap_x","diffY","distY","overlap_y","collide_stop_x","file_path","SpriteInitializersOptions","Clastics","top_collideable","force","fourside_collideable","MainGravity","very_light","light","medium","strong","very_strong","ControllerStickMotion","player_move_x","__lib","accelX","decelX","__falling","decelY","player_move_xy","decel","player_rotate_x","Pos","Size","Position","Rotation"],"mappings":"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","file":"GameStack.js","sourcesContent":["\r\n/**@author\r\nJordan Edward Blake\r\n * */\r\n\r\n/**@copyright\r\n\r\n Copyright 2016\r\n\r\n **/\r\n\r\n/**\r\n * Object, instance of GamestackLibrary() : references Gamestack classes\r\n * attaches to window object || module.exports (when loading via require)\r\n * */\r\n\r\nlet Gamestack = {};\r\n\r\nlet GameStackLibrary = function () {\r\n\r\n    var lib = {\r\n\r\n        DEBUG: false,\r\n\r\n        gui_mode: true,\r\n\r\n        __gameWindow: {}\r\n        ,\r\n\r\n        __sprites: [],\r\n\r\n        __animations: [],\r\n\r\n\r\n        spriteTypes:[],\r\n\r\n        systemSpriteTypes: ['player', 'enemy', 'background', 'interactive'],\r\n\r\n        systemAnimationTypes: {\r\n\r\n            attack_0:\"System.attack_0\",\r\n\r\n            attack_1:\"System.attack_1\",\r\n\r\n            attack_2:\"System.attack_2\",\r\n\r\n            attack_3:\"System.attack_3\",\r\n\r\n            attack_4:\"System.attack_4\",\r\n\r\n            defend_0:\"System.defend_0\",\r\n\r\n            defend_1:\"System.defend_1\",\r\n\r\n            defend_2:\"System.defend_2\",\r\n\r\n            defend_3:\"System.defend_3\",\r\n\r\n            defend_4:\"System.defend_4\",\r\n\r\n            heal_0:\"System.heal_0\",\r\n\r\n            heal_1:\"System.heal_1\",\r\n\r\n            heal_2:\"System.heal_2\",\r\n\r\n            heal_3:\"System.heal_3\",\r\n\r\n            heal_4:\"System.heal_4\",\r\n\r\n        },\r\n\r\n\r\n        samples: {}\r\n        ,\r\n\r\n        log_modes: ['reqs', 'info', 'warning'],\r\n\r\n        log_mode: \"all\",\r\n\r\n        recursionCount: 0,\r\n\r\n        __gameWindowList: [],\r\n\r\n\r\n        create_id: function () {\r\n\r\n            var d = new Date().getTime();\r\n            if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n                d += performance.now(); //use high-precision timer if available\r\n            }\r\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                var r = (d + Math.random() * 16) % 16 | 0;\r\n                d = Math.floor(d / 16);\r\n                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n            });\r\n\r\n        }\r\n\r\n        ,\r\n\r\n\r\n        getObjectById(id){\r\n\r\n            for(var x = 0; x < this.all_objects.length; x++)\r\n            {\r\n                if(this.all_objects[x].id == id)\r\n                {\r\n\r\n                    return this.all_objects[x];\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        },\r\n\r\n        getAllCallables: function () {\r\n            //every unique sound, animation, tweenmotion in the game\r\n\r\n            let actionables = [];\r\n\r\n            $Q.each(this.sprites, function (ix, item) {\r\n\r\n                actionables.concat(item.sounds);\r\n\r\n                actionables.concat(item.motionstacks);\r\n\r\n                actionables.concat(item.animations);\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        interlog: function (message, div) //recursive safe :: won't go crazy with recursive logs\r\n        {\r\n            this.recursionCount++;\r\n\r\n            if (!isNaN(div) && this.recursionCount % div == 0) {\r\n                //   console.log('Interval Log:'+  message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        error: function (quit, message) {\r\n\r\n            if (quit) {\r\n                throw new Error(message);\r\n\r\n            }\r\n            else {\r\n                console.error('E!' + message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        info: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.info('Info:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n\r\n        log: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.log('GameStack:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n\r\n\r\n\r\n        //animate() : main animation call, run the once and it will recurse with requestAnimationFrame(this.animate);\r\n\r\n        animate: function (time) {\r\n\r\n            __gameStack.isAtPlay = true;\r\n\r\n\r\n            TWEEN.update(time);\r\n\r\n            requestAnimationFrame(__gameStack.animate);\r\n\r\n            __gameStack.__gameWindow.update();\r\n\r\n            __gameStack.__gameWindow.ctx.clearRect(0, 0, __gameStack.__gameWindow.canvas.width, __gameStack.__gameWindow.canvas.height);\r\n\r\n            __gameStack.__gameWindow.draw();\r\n\r\n        }\r\n        ,\r\n\r\n        start: function () {\r\n\r\n            this.animate();\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        Collision: {\r\n\r\n            spriteRectanglesCollide(obj1, obj2)\r\n            {\r\n\r\n\r\n               var paddingX = Math.round(obj1.padding.x * obj1.size.x),\r\n\r\n                   paddingY =Math.round(obj1.padding.y * obj1.size.y), left = obj1.position.x + paddingX, right = obj1.position.x + obj1.size.x - paddingX,\r\n\r\n               top = obj1.position.y + paddingY, bottom = obj1.position.y + obj1.size.y - paddingY;\r\n\r\n                if (right > obj2.position.x && left < obj2.position.x + obj2.size.x &&\r\n                   bottom > obj2.position.y && top < obj2.position.y + obj2.size.y) {\r\n\r\n                    return true;\r\n\r\n                }\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n        TWEEN: TWEEN,\r\n\r\n        _gameWindow: {}\r\n        ,\r\n\r\n        setGameWindow: function (gameWindow) {\r\n\r\n            this._gameWindow = gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n       ExtendEvents:function(extendedObject, extendedKey, extendor, extendorKey, extendorFunc)\r\n        {\r\n            function EventLink(extendedObject, extendedKey, extendor, extendorKey)\r\n            {\r\n\r\n                this.parent_id=extendedObject.id,\r\n\r\n                this.child_id=extendor.id,\r\n\r\n                this.parent_key=extendedKey,\r\n\r\n                this.child_key=extendorKey;\r\n\r\n            };\r\n\r\n            var evtLink =new EventLink(extendedObject, extendedKey, extendor, extendorKey);\r\n\r\n            this.all_objects.push(new EventLink(extendedObject, extendedKey, extendor, extendorKey));\r\n\r\n            var parent = extendedObject;\r\n\r\n            console.log(parent);\r\n\r\n            if(parent)\r\n            {\r\n                console.log('EXTENDING EVENTS:' + extendedKey +\":\" + extendorKey);\r\n\r\n                if(parent.onRun)\r\n                {\r\n                    parent.onRun(extendor, extendorKey);\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        },\r\n\r\n        getGameWindow: function () {\r\n\r\n\r\n            return this._gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n        assignAll: function (object, args, keys) {\r\n\r\n            __gameStack.each(keys, function (ix, item) {\r\n\r\n                object[ix] = args[ix];\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        each: function (list, onResult, onComplete) {\r\n            for (var i in list) {\r\n                onResult(i, list[i]);\r\n            }\r\n\r\n            if (typeof(onComplete) === 'function') {\r\n                onComplete(false, list)\r\n            }\r\n            ;\r\n\r\n        }\r\n        ,\r\n\r\n        ready_callstack: [],\r\n\r\n        ready: function (callback) {\r\n\r\n            this.ready_callstack.push(callback);\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        reload:function()\r\n        {\r\n          this.callReady();\r\n\r\n        },\r\n\r\n        callReady: function () {\r\n\r\n            var funx = this.ready_callstack;\r\n\r\n            var gameWindow = this._gameWindow, lib = this, sprites = this.__gameWindow.sprites;\r\n\r\n            //call every function in the ready_callstack\r\n\r\n\r\n            this.each(funx, function (ix, call) {\r\n\r\n                call(lib, gameWindow, sprites);\r\n\r\n            });\r\n\r\n            this.InputEvents.init();\r\n\r\n\r\n            this.__running = true;\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        getArg: function (args, key, fallback) {\r\n            if (args && args.hasOwnProperty(key)) {\r\n                return args[key];\r\n            }\r\n            else {\r\n                return fallback;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        add: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            if (obj instanceof GameWindow) {\r\n\r\n                this.__gameWindow = obj;\r\n\r\n            }\r\n\r\n            if (obj instanceof Force) {\r\n\r\n                this.__gameWindow.forces.push(obj);\r\n\r\n            }\r\n\r\n\r\n            if (obj instanceof Camera) {\r\n\r\n                this.__gameWindow.camera = obj;\r\n\r\n            }\r\n\r\n\r\n            if (obj instanceof Sprite) {\r\n\r\n                this.__gameWindow.sprites.push(obj);\r\n\r\n            }\r\n\r\n            if (obj instanceof GSEvent) {\r\n\r\n               if(__gameStack.__running){\r\n\r\n                   return console.error('Events can only be added before Gamstack.animate() is called::aka before the main update / loop begins');\r\n               }\r\n               else\r\n               {\r\n\r\n                   obj.apply();\r\n\r\n\r\n               }\r\n\r\n            }\r\n\r\n            this.collect(obj);\r\n\r\n            return obj;\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        remove: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            if (obj instanceof Sprite) {\r\n\r\n                var ix = this.__gameWindow.sprites.indexOf(obj);\r\n\r\n                this.__gameWindow.sprites.splice(ix, 1);\r\n\r\n            }\r\n\r\n        },\r\n\r\n        all_objects: [],\r\n\r\n        collect: function (obj) {\r\n\r\n            this.all_objects.push(obj);\r\n\r\n        },\r\n\r\n\r\n        isNormalStringMatch: function (str1, str2) {\r\n\r\n            return str1.toLowerCase().replace(' ', '') == str2.toLowerCase().replace(' ', '');\r\n\r\n        },\r\n\r\n        instance_type_pairs: function () {\r\n            //get an array of all instance/type pairs added to the library\r\n\r\n            //example : [ {constructor_name:Sprite, type:enemy_basic}, {constructor_name:Animation, type:enemy_attack}  ];\r\n\r\n            var objectList = [];\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n\r\n                objectList.push({constructor_name: item.constructor.name, type: item.type});\r\n\r\n            });\r\n\r\n            return objectList;\r\n\r\n        },\r\n\r\n        getById:function(id){\r\n\r\n\r\n            for(var x in this.all_objects)\r\n            {\r\n\r\n                if(this.all_objects[x].id == id)\r\n                {\r\n                    return this.all_objects[x];\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n\r\n\r\n        },\r\n\r\n        select: function (constructor_name, name, type /*ignoring spaces and CAPS/CASE on type match*/) {\r\n\r\n\r\n            var objects_out = [];\r\n\r\n\r\n            var __inst = this;\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n                if (constructor_name == '*' || item.constructor.name == constructor_name) {\r\n\r\n                    if (type == '*' || __inst.isNormalStringMatch(type, item.type)) {\r\n\r\n                        if (name == '*' || __inst.isNormalStringMatch(name, item.name)) {\r\n\r\n                            objects_out.push(item);\r\n\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            });\r\n\r\n            return objects_out;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    return lib;\r\n\r\n};\r\n\r\n\r\n/**\r\n * Simple Sound object:: implements Jquery: Audio()\r\n * @param   {string} src : source path / name of the targeted sound-file\r\n\r\n * @returns {Sound} object of Sound()\r\n * */\r\n\r\n\r\nclass Sound {\r\n\r\n    constructor(src, data) {\r\n\r\n\r\n        if (typeof(src) == 'object') {\r\n\r\n            this.sound = document.createElement('audio');\r\n\r\n            this.sound.src = src.src;\r\n\r\n            this.src = src.src;\r\n\r\n        }\r\n\r\n    else if (typeof(src) == 'string') {\r\n\r\n            this.sound = document.createElement('audio');\r\n\r\n            this.sound.src = src;\r\n\r\n            this.src = src;\r\n\r\n        }\r\n       if(typeof(data)=='object') {\r\n           for (var x in data) {\r\n               if (x !== 'sound') {\r\n                   this[x] = data[x];\r\n\r\n               }\r\n\r\n           }\r\n\r\n       }\r\n\r\n        this.onLoad = this.onLoad || function () {\r\n            };\r\n\r\n        if (typeof(this.onLoad) == 'function') {\r\n\r\n            this.onLoad(this.sound);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    volume(val)\r\n    {\r\n\r\n        this.sound.volume = val;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    play() {\r\n        if (typeof(this.sound) == 'object' && typeof(this.sound.play) == 'function') {\r\n\r\n            this.sound.play();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nclass SoundList{\r\n\r\n    constructor(list)\r\n    {\r\n\r\n       this.cix = 1;\r\n\r\n       this.sounds = [];\r\n\r\n        if(list instanceof Array)\r\n        {\r\n            for(var x in list)\r\n            {\r\n                if(list[x].src)\r\n                {\r\n                    this.sounds.push(new Sound(list[x].src, list[x]));\r\n\r\n                }\r\n                else if(typeof(list[x]) == 'string')\r\n                {\r\n                    this.sounds.push(new Sound(list[x]));\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    add(src, name)\r\n    {\r\n        if(typeof(src) == 'object' && src.src)\r\n        {\r\n            this.sounds.push(new Sound(src.src, src));\r\n\r\n        }\r\n        else if(typeof(src) == 'string')\r\n        {\r\n            var data = {};\r\n\r\n            if(name)\r\n            {\r\n                data.name = name;\r\n            }\r\n\r\n            this.sounds.push(new Sound(list[x], data));\r\n\r\n        }\r\n\r\n    }\r\n\r\n    playNext()\r\n    {\r\n        this.sounds[this.cix % this.sounds.length].play();\r\n\r\n        this.cix += 1;\r\n\r\n    }\r\n\r\n    play()\r\n    {\r\n\r\n        this.sounds[this.cix % this.sounds.length].play();\r\n\r\n        this.cix += 1;\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * GameImage\r\n *\r\n * Simple GameImage\r\n * @param   {string} src source name/path of the targeted image-file\r\n\r\n * @returns {GameImage} object of GameImage()\r\n\r\n * */\r\n\r\nclass GameImage {\r\n\r\n    constructor(src, onCreate) {\r\n\r\n        // GameStack.log('initializing image');\r\n\r\n        if (src instanceof Object) {\r\n\r\n            //alert('getting image from image');\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src.src;\r\n\r\n            this.src = src.src;\r\n\r\n        }\r\n\r\n        else if (typeof(src) == 'string') {\r\n\r\n            let ext = src.substring(src.lastIndexOf('.'), src.length);\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src;\r\n\r\n            this.src = this.image.src;\r\n\r\n\r\n        }\r\n\r\n\r\n        if (!this.image) {\r\n            this.image = {error: \"Image not instantiated, set to object by default\"};\r\n\r\n        }\r\n        else {\r\n            this.image.onerror = function () {\r\n                this.__error = true;\r\n            };\r\n\r\n        }\r\n\r\n        this.domElement = this.image;\r\n\r\n        this.image.onload = function () {\r\n\r\n            if (typeof(this.onCreate) == 'function') {\r\n\r\n                this.onCreate(this.image);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    getImage() {\r\n        return this.image;\r\n    }\r\n\r\n}\r\n\r\n\r\n//GameStack: a main / game lib object::\r\n//TODO: fix the following set of mixed references:: only need to refer to (1) lib-object-instance\r\nlet GameStack = new GameStackLibrary();\r\nGamestack = GameStack;\r\nlet __gameStack = GameStack;\r\nlet Quick2d = GameStack; //Exposing 'Quick2d' as synonymous reference to Gamestack\r\nlet __gameInstance = Gamestack;\r\n\r\nGamestack.Sound = Sound;\r\nGamestack.GameImage = GameImage;\r\n\r\nif (typeof module !== 'undefined' && module.exports) {\r\n\r\n    //This library is being instaniated via require() aka node.js require or similar library loader\r\n    module.exports = Gamestack;\r\n\r\n} else {\r\n\r\n\r\n}\r\n\r\n/***************\r\n * TODO : fix the above duplicate references, which exist now for backward compatibility with previouslyh authored code\r\n *\r\n *  -apply find and replace accross the codebase\r\n *\r\n * ****************/\r\n\r\n/********\r\n * jstr() : public function for stringified objects and arrays (uses pretty print style)\r\n * *********/\r\n\r\nfunction jstr(obj) {\r\n\r\n    return JSON.stringify(obj);\r\n\r\n};\r\n\r\nGamestack.jstr = jstr;\r\n\r\n/**********\r\n * $Q : Selector Function\r\n *  -allows string selection of library collections, etc...\r\n * Example Calls\r\n * **********/\r\n\r\n\r\nfunction $Q(selector) {\r\n\r\n    //declare events:\r\n\r\n\r\n    var $GFunx = {};\r\n\r\n    $GFunx.each = function(callback)\r\n    {\r\n\r\n        var objects = [];\r\n\r\n        for(var x = 0; x < this.length; x++)\r\n        {\r\n            if(typeof x == 'number')\r\n            {\r\n\r\n                callback(x, this[x]);\r\n            }\r\n\r\n        }\r\n\r\n\r\n    };\r\n\r\n    $GFunx.on = function (evt_key, selectorObject, controller_ix, callback) //handle each event such as on('collide') OR on('stick_left_0') << first controller stick_left\r\n    {\r\n\r\n        if(__gameStack.isAtPlay)\r\n        {\r\n            return console.error('Cannot call $Q().on while game is at play. Please rig your events before gameplay.');\r\n\r\n        }\r\n\r\n        var criterion = $Q.between('[', ']', evt_key);\r\n\r\n        if(criterion.indexOf('===') >= 0)\r\n        {\r\n            criterion = criterion.replace('===', '=');\r\n        }\r\n\r\n        if(criterion.indexOf('==') >= 0)\r\n        {\r\n            criterion =  criterion.replace('==', '=').replace('==', 0);\r\n        }\r\n\r\n       var cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n        if(evt_key.indexOf('[') >= 0)\r\n        {\r\n            evt_key = $Q.before('[', evt_key).trim();\r\n\r\n        }\r\n\r\n\r\n        var padding = 0;\r\n\r\n        if(cparts[0].toLowerCase() == 'padding')\r\n        {\r\n\r\n            padding = parseFloat(cparts[1]);\r\n\r\n            alert('padding:' + padding);\r\n\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then controller_ix is the callback aka optional argument\r\n\r\n        if(controller_ix && typeof controller_ix == 'function' && !callback)\r\n        {\r\n            callback = controller_ix;\r\n            controller_ix = 0;\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then selectorObject is the callback aka optional argument\r\n\r\n        if(selectorObject && typeof selectorObject == 'function' && !callback)\r\n        {\r\n\r\n            callback = selectorObject;\r\n\r\n            selectorObject = $Q('*');\r\n\r\n            controller_ix = 0;\r\n        };\r\n\r\n        var evt_profile = {};\r\n\r\n        //which controller?\r\n\r\n        evt_profile.cix = controller_ix;\r\n\r\n        //Need the control key: 'left_stick', 'button_0', etc..\r\n\r\n        evt_profile.evt_key = evt_key;\r\n\r\n        if($Q.contains_any(['stick', 'button', 'click', 'key'], evt_profile.evt_key))\r\n        {\r\n\r\n            var button_mode = evt_profile.evt_key.indexOf('button') >= 0;\r\n\r\n            Gamestack.GamepadAdapter.on(evt_profile.evt_key, 0, function (x, y) {\r\n\r\n               callback(x, y);\r\n\r\n            });\r\n\r\n            console.info('detected input event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig events');\r\n\r\n        }\r\n\r\n        //TODO: test collision events:\r\n\r\n      else if($Q.contains_any(['collide', 'collision', 'hit', 'touch'],  evt_profile.evt_key))\r\n        {\r\n\r\n            console.info('Rigging a collision event');\r\n\r\n            console.info('detected collision event key in:' +  evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig collision events');\r\n\r\n            this.each(function(ix, item1){\r\n\r\n                selectorObject.each(function(iy, item2){\r\n\r\n                    if(typeof(item1.onUpdate) == 'function')\r\n                    {\r\n\r\n                        item1.onUpdate(function(sprite){\r\n\r\n                            if(item1.collidesRectangular(item2, padding))\r\n                            {\r\n\r\n                              callback(item1, item2);\r\n\r\n                            };\r\n\r\n                        });\r\n\r\n                    }\r\n\r\n\r\n                });\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n       else {\r\n            console.info('Rigging a property event');\r\n\r\n            //TODO: test property-watch events:\r\n\r\n            console.info('detected property threshhold event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig property events');\r\n\r\n            var condition = \"_\", key = criterion || evt_profile.evt_key;\r\n\r\n            if(key.indexOf('[') >= 0 || key.indexOf(']') >= 0)\r\n            {\r\n                key = $Q.between('[', ']', key);\r\n\r\n            }\r\n\r\n            var evt_parts = [];\r\n\r\n            var run = function()\r\n            {\r\n                console.error('Sprite property check was not set correctly');\r\n\r\n            };\r\n\r\n            if(key.indexOf('>=') >= 0)\r\n            {\r\n                condition = \">=\";\r\n\r\n\r\n            }\r\n           else if(key.indexOf('<=') >= 0)\r\n            {\r\n                condition = \"<=\";\r\n            }\r\n           else if(key.indexOf('>') >= 0)\r\n            {\r\n                condition = \">\";\r\n            }\r\n          else if(key.indexOf('<') >= 0)\r\n            {\r\n                condition = \"<\";\r\n            }\r\n\r\n            else if(key.indexOf('=') >= 0)\r\n            {\r\n                condition = \"=\";\r\n            }\r\n\r\n            evt_parts = key.split(condition);\r\n\r\n            for(var x = 0; x < evt_parts.length; x++)\r\n            {\r\n                evt_parts[x] = evt_parts[x].replace('=', '').replace('=', '').trim(); //remove any trailing equals and trim()\r\n\r\n            }\r\n\r\n            var mykey, number;\r\n\r\n           // alert(evt_parts[0]);\r\n\r\n            try{\r\n\r\n            mykey = evt_parts[0];\r\n\r\n            number = parseFloat(evt_parts[1]);\r\n\r\n            }\r\n            catch(e)\r\n            {\r\n                console.log(e);\r\n            }\r\n\r\n            console.info('Processing condition with:' + condition);\r\n\r\n            switch(condition)\r\n            {\r\n\r\n                case \">=\":\r\n\r\n\r\n                    run = function(obj, key){ if(obj[key] >= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] <= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n\r\n                case \">\":\r\n\r\n                    run = function(obj, key){ if(obj[key] > number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<\":\r\n\r\n                    run = function(obj, key){ if(obj[key] < number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] == number){ callback(); } };\r\n\r\n                    break;\r\n\r\n            }\r\n\r\n\r\n            /************\r\n             * Attach update to each member\r\n             *\r\n             * **************/\r\n\r\n            var keys = mykey.split('.'), propkey = \"\";\r\n\r\n            this.each(function(ix, item){\r\n\r\n                var object = {};\r\n\r\n                if(keys.length == 1)\r\n                {\r\n                    object = item;\r\n\r\n                    propkey = mykey;\r\n\r\n                }\r\n                else if(keys.length == 2)\r\n                {\r\n                    object = item[keys[0]];\r\n\r\n                    propkey = keys[1];\r\n\r\n\r\n                }\r\n\r\n                else if(keys.length == 3)\r\n                {\r\n                    object = item[keys[0]][keys[1]];\r\n\r\n                    propkey = keys[2];\r\n\r\n                }\r\n                else\r\n                {\r\n                    console.error(\":length of '.' notation out of range. We use max length of 3 or prop.prop.key.\");\r\n\r\n                }\r\n\r\n                if(typeof item.onUpdate == 'function')\r\n                {\r\n\r\n\r\n                    var spr = item;\r\n\r\n                    item.onUpdate(function(sprite){\r\n\r\n                        run(object, propkey);\r\n\r\n                    });\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n    };\r\n\r\n\r\n    var object_out = {};\r\n\r\n    //handle selector / selection of objects:\r\n\r\n    if(selector && selector !== '*')\r\n    {\r\n\r\n    var s = selector || '';\r\n\r\n    console.info('selector:' + s);\r\n\r\n    var mainSelector = $Q.before('[', s).trim(), msfChar = mainSelector.substring(0, 1);\r\n\r\n    var __targetClassName = \"*\";\r\n\r\n    var output = [];\r\n\r\n    var cleanSelectorString = function(str)\r\n    {\r\n        return str.replace(\",\", \"\");\r\n    };\r\n\r\n    switch (msfChar.toLowerCase()) {\r\n        case \".\":\r\n\r\n            console.info('Selecting by \".\" or class');\r\n\r\n            __targetClassName = cleanSelectorString($Q.after('.', mainSelector));\r\n\r\n            console.info('Target class is:' + __targetClassName);\r\n\r\n            break;\r\n\r\n        case \"*\":\r\n\r\n            console.info('Selecting by \"*\" or ANY object in the library instance');\r\n\r\n            __targetClassName = \"*\";\r\n\r\n            break;\r\n\r\n    }\r\n\r\n         var criterion = $Q.between('[', ']', s), cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n  var getParts = function() {\r\n\r\n      if(cparts.length >= 2) {\r\n\r\n          switch (cparts[0].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      if(cparts.length >= 4) {\r\n\r\n          cparts[2] = cparts[2].replace(\",\", \"\");\r\n\r\n          switch (cparts[2].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      };\r\n\r\n  getParts(cparts);\r\n\r\n\r\n        object_out = GameStack.select(__targetClassName, __targetName, __targetType);\r\n    }\r\n   else if(selector == '*')\r\n    {\r\n        object_out = GameStack.all_objects;\r\n\r\n    }\r\n\r\n   for(var x in $GFunx)\r\n   {\r\n       object_out[x] = $GFunx[x];\r\n\r\n   };\r\n\r\n   return object_out;\r\n\r\n}\r\n\r\n\r\n$Q.each = function (obj, callback, complete) {\r\n\r\n    for(var x in obj)\r\n    {\r\n        callback(obj);\r\n\r\n    }\r\n\r\n    if(typeof(complete) == 'function')\r\n    {\r\n        complete(obj);\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\n$Q.before = function (c1, test_str) {\r\n    var start_pos = 0;\r\n    var end_pos = test_str.indexOf(c1, start_pos);\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n\r\n$Q.contains = function (c1, test_str) {\r\n    return test_str.indexOf(c1) >= 0;\r\n};\r\n\r\n$Q.contains_all = function (cList, test_str) {\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) < 0) {\r\n            return false;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n};\r\n\r\n$Q.contains_any = function (cList, test_str) {\r\n\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) >= 0) {\r\n            return true;\r\n\r\n        }\r\n    }\r\n\r\n    return false;\r\n\r\n};\r\n\r\n$Q.after = function (c1, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.length;\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n$Q.between = function (c1, c2, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.indexOf(c2, start_pos);\r\n    return test_str.substring(start_pos, end_pos)\r\n};\r\n\r\n\r\n$Q.test_selector_method =  function () {\r\n    var Q_TestStrings = ['*', '.Sprite', '*[type=\"enemy_type_0\"]', '.Sprite[type=\"enemy_type_0\"]'];\r\n\r\n    for (var x = 0; x < Q_TestStrings.length; x++) {\r\n        var test = Q_TestStrings[x];\r\n\r\n        console.info('testing:' + test);\r\n\r\n        $Q(test);\r\n    }\r\n\r\n    console.log('Testing stick left');\r\n\r\n    this.on('stick_left_0');\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('button_0');\r\n\r\n\r\n    console.log('Testing collide');\r\n\r\n    this.on('collide');\r\n\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('collide');\r\n\r\n    console.log('Testing prop');\r\n\r\n    this.on('health>=0');\r\n\r\n\r\n};\r\n\r\n\r\nGamestack.$Q = $Q;\r\n\r\nGamestack.query = $Q;\r\n\r\n/********************\r\n * GameStack.InputEvents\r\n * -Various PC Input Events\r\n ********************/\r\n\r\nGamestack.InputEvents = { //PC input events\r\n    mousemove: [],\r\n    leftclick: [],\r\n    rightclick: [],\r\n    middleclick: [],\r\n    wheelup: [],\r\n    wheelDown: [],\r\n    space: [],\r\n    tab: [],\r\n    shift: [],\r\n    1: [], 2: [], 3: [],\r\n    enter: [],\r\n    extend: function (evt_key, callback, onFinish) {\r\n\r\n        if (evt_key.toLowerCase().indexOf('key_') >= 0) {\r\n            //process this as a key event\r\n\r\n            var cleanKey = evt_key.toLowerCase();\r\n            GameStack.InputEvents[cleanKey] = GameStack.InputEvents[cleanKey] || [];\r\n            return GameStack.InputEvents[cleanKey].push({down: callback, up: onFinish});\r\n        } else {\r\n\r\n            GameStack.InputEvents[evt_key] = GameStack.InputEvents[evt_key] || [];\r\n            return GameStack.InputEvents[evt_key].push({down: callback, up: onFinish});\r\n        }\r\n\r\n    },\r\n    init: function () {\r\n\r\n\r\n        function getMousePos(e) {\r\n\r\n            var x;\r\n            var y;\r\n            if (e.pageX || e.pageY) {\r\n                x = e.pageX;\r\n                y = e.pageY;\r\n            } else {\r\n                x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n                y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n            }\r\n            x -= GameStack.canvas.offsetLeft;\r\n            y -= GameStack.canvas.style.top;\r\n            return {x: x, y: y};\r\n        }\r\n\r\n\r\n        function fullMoveInputEvents(event) {\r\n\r\n            var pos = getMousePos(event);\r\n            var InputEvents = GameStack.InputEvents;\r\n            for (var x in InputEvents) {\r\n\r\n\r\n                if (InputEvents[x] instanceof Array && x == 'mousemove') {\r\n\r\n\r\n                    GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                        el.down(pos.x, pos.y);\r\n                    });\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n        ;\r\n        document.onkeydown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            GameStack.log('Got e');\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.log('Got []');\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.down) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.down();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n\r\n        document.onkeyup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.up) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.up();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n\r\n        GameStack.canvas.onmousedown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n\r\n                            return false;\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n            e.preventDefault();\r\n            return 0;\r\n        };\r\n        GameStack.canvas.onmouseup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n\r\n\r\n                            return false;\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n        };\r\n        document.addEventListener(\"mousemove\", fullMoveInputEvents);\r\n    }\r\n\r\n\r\n};\r\n\r\n\r\n//Override the existing window.onload function\r\n\r\nwindow._preGameStack_windowLoad = window.onload;\r\n\r\nwindow.onload = function () {\r\n\r\n    if (typeof(window._preGameStack_windowLoad) == 'function') {\r\n        window._preGameStack_windowLoad();\r\n    }\r\n\r\n    __gameStack.callReady();\r\n\r\n}\r\n\r\n\r\n/*\r\n * Canvas\r\n *    draw animations, textures to the screen\r\n * */\r\n\r\nGamestack.ready(function (lib) {\r\n\r\n    Gamestack.log('GameStack:lib :: ready');\r\n\r\n\r\n});\r\n\r\n\r\n\r\n/**\r\n * Instantiates a GameWindow object\r\n * @param   {Object} args : the object of arguments\r\n * @param   {Object} args.canvas : the canvas object of the window: GameWindow constructor will create one if not supplied in args\r\n *\r\n * @param   {Object} args.ctx : the canvas context\r\n *\r\n * @param   {Array} args.sprites : the list of sprites, to be applied with GameWindow\r\n *\r\n * @param   {Array} args.forces : the list of forces, such as gravity, to be applied with GameWindow\r\n *\r\n\r\n * @returns {GameWindow} object of GameWindow()\r\n * */\r\n\r\n\r\n\r\nclass GameWindow {\r\n\r\n    constructor({canvas=false, ctx, sprites, backgrounds, interactives, forces, update, camera}={}) {\r\n\r\n        this.sprites = sprites instanceof Array ? sprites : [];\r\n\r\n        this.backgrounds = backgrounds instanceof Array ? backgrounds : [];\r\n\r\n        this.interactives = interactives instanceof Array ? interactives : [];\r\n\r\n        this.forces = forces instanceof Array ? forces : [];\r\n\r\n        this.canvas = canvas|| false;\r\n\r\n        document.body.style.position = \"absolute\";\r\n\r\n        document.body.style.width = \"100%\";\r\n\r\n        document.body.style.height = \"100%\";\r\n\r\n        if(!this.canvas)\r\n        {\r\n            console.info('creating new canvas');\r\n            this.canvas = document.createElement('CANVAS');\r\n\r\n            document.body.append(this.canvas);\r\n\r\n\r\n\r\n        }\r\n\r\n        this.canvas.style.position = 'absolute';\r\n\r\n        this.canvas.style.width = '100%';\r\n\r\n        this.canvas.style.height = '100%';\r\n\r\n        this.canvas.style.background = 'black';\r\n\r\n        var c = this.canvas;\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n\r\n        __gameStack.canvas = this.canvas;\r\n\r\n        __gameStack.ctx = this.ctx;\r\n\r\n\r\n        this.adjustSize();\r\n\r\n        window.onresize = function(){\r\n\r\n            __gameStack.__gameWindow.adjustSize();\r\n\r\n        };\r\n\r\n        this.camera = new Camera();\r\n\r\n        this.camera.target = false;\r\n\r\n        __gameStack.camera = this.camera;\r\n\r\n        if (typeof update == 'function') {\r\n            this.onUpdate(update);\r\n\r\n        }\r\n\r\n       __gameStack.__gameWindow = this;\r\n\r\n}\r\n\r\n    adjustSize(w, h)\r\n    {\r\n\r\n\r\n\r\n        w = w || this.canvas.clientWidth;\r\n\r\n        h = h || this.canvas.clientHeight;\r\n\r\n      var c = document.getElementById('#gs-container');\r\n\r\n      if(c){c.setAttribute('width', w) };\r\n\r\n        if(c){c.setAttribute('height', h) };\r\n\r\n        __gameStack.WIDTH = w;\r\n\r\n        __gameStack.HEIGHT = h;\r\n\r\n        this.canvas.width = w;\r\n\r\n        this.canvas.height = h;\r\n\r\n    }\r\n\r\n    uniques(list) {\r\n\r\n        var listout = [];\r\n\r\n        $Q.each(list, function (ix, item) {\r\n\r\n            if (!listout.indexOf(item.id) >= 0) {\r\n\r\n                var str = item.name;\r\n\r\n                listout.push({\"sprite\": item});\r\n\r\n            }\r\n\r\n        });\r\n\r\n        return listout;\r\n\r\n    }\r\n\r\n    setPlayer(player) {\r\n        this.player = player;\r\n\r\n        if (!this.sprites.indexOf(player) >= 0) {\r\n            this.sprites.push(player);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.update) == 'function') {\r\n                item.update(item);\r\n\r\n            }\r\n\r\n\r\n\r\n        });\r\n\r\n\r\n\r\n        GameStack.each(this.forces, function (ix, item) {\r\n\r\n            if (typeof(item.update) == 'function') {\r\n\r\n                item.update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n                //  console.log('def_update');\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n        });\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    loadLevelFile(filepath, callback)\r\n    {\r\n\r\n        $.getJSON(filepath, function(data) {\r\n\r\n            callback(false, data);\r\n\r\n        });\r\n    }\r\n\r\n\r\n    draw() {\r\n\r\n        var _gw = this;\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            Canvas.draw(item, _gw.ctx);\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\n\r\nGamestack.GameWindow = GameWindow;\r\n\r\n\r\n/**\r\n * Instantiates a TextDisplay(), HTML/DOM object\r\n * @param   {Object} args the object of arguments\r\n * @param   {Number} args.widthFloat the pct 0-1.0 of screen-Width\r\n * @param   {Number} args.heightFloat the pct 0-1.0 of screen-Height\r\n *\r\n * @param   {Number} args.topFloat the pct 0-1.0 of screen-top-margin\r\n * @param   {Number} args.leftFloat the pct 0-1.0 of screen-left-margin\r\n * @param   {Number} args.targetLeft the pct 0-1.0 of target-left location (for slide-animation behavior)\r\n * @param   {Number} args.targetTop the pct 0-1.0 of target-top location (for slide-animation behavior)\r\n * @param   {string} args.color the css-text-color\r\n * @param   {string} args.text the text-value\r\n *\r\n * @param   {string} args.fontFamily the css fontFamily\r\n\r\n * @param {boolean} args.fromTop true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromBottom true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromLeft true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n * @param {boolean} args.fromRight true || false, triggers a sliding-text animation from direction\r\n *\r\n *\r\n *@returns TextDisplay()\r\n *\r\n * */\r\n\r\n\r\nclass TextDisplay {\r\n\r\n    constructor(args)\r\n    {\r\n        if(!args)\r\n        {\r\n            args = {};\r\n\r\n        }\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.5;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.5;\r\n\r\n        this.topFloat = args.top || 0.25;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, document.body.clientHeight);\r\n\r\n        this.leftFloat = args.left || 0.25;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,document.body.clientWidth);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fadeIn = args.fadeIn || args.fade || true;\r\n\r\n        this.border = \"2px inset \" + this.color;\r\n\r\n        this.fontSize = args.fontSize || \"20px\";\r\n\r\n        this.fromLeft = args.fromLeft || false;\r\n\r\n        if(this.fromLeft){ this.leftFloat = 1.5; }\r\n\r\n        this.fromRight = args.fromRight || false;\r\n\r\n        if(this.fromRight){ this.leftFloat = -0.5; }\r\n\r\n        this.fromTop = args.fromTop || false;\r\n\r\n        if(this.fromTop){ this.topFloat = -0.5; }\r\n\r\n        this.fromBottom = args.fromBottom || false;\r\n\r\n        if(this.fromBottom){ this.topFloat = 1.5; }\r\n\r\n        this.duration = args.duration || 5000;\r\n\r\n        this.stay_duration = Math.round(this.duration / 2);\r\n\r\n        this.complete = args.complete || function(){};\r\n\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    onComplete(fun){\r\n\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    show()\r\n    {\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('P');\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = Math.round(document.body.clientHeight * this.topFloat) + 'px';\r\n\r\n        this.domElement.style.left = Math.round(document.body.clientWidth * this.leftFloat) + 'px';\r\n\r\n        this.domElement.style.width = Math.round(document.body.clientWidth * this.widthFloat) + 'px';\r\n\r\n        this.domElement.style.height = Math.round(document.body.clientHeight * this.heightFloat) + 'px';\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.display = \"block\";\r\n\r\n        this.domElement.style.textAlign = \"center\";\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.innerText = this.text;\r\n\r\n        this.domElement.textContent = this.text;\r\n\r\n        this.domElement.style.opacity = this.fadeIn ?  0 : 1.0;\r\n\r\n        this.domElement.id = GameStack.create_id();\r\n\r\n        document.body.append(this.domElement);\r\n\r\n\r\n        var __inst = this;\r\n\r\n        Velocity(this.domElement, { opacity:1.0, top:this.targetTop, left:this.targetLeft}, { duration: this.duration, easing:\"quadratic\"});\r\n\r\n        window.setTimeout(function(){\r\n\r\n            if(__inst.stay_duration >= 1)\r\n            {\r\n                window.setTimeout(function(){\r\n\r\n                    Velocity(__inst.domElement, { opacity:0, display:'none'}, { duration:300, easing:\"linear\"});\r\n\r\n                    if(typeof(__inst.complete) == 'function')\r\n                    {\r\n                        __inst.complete();\r\n\r\n                    }\r\n\r\n\r\n\r\n                }, __inst.stay_duration);\r\n\r\n            }\r\n\r\n\r\n        }, this.duration);\r\n\r\n    }\r\n\r\n}\r\n\r\nGamestack.TextDisplay = TextDisplay;\r\n\r\n\r\n\r\n/**\r\n * Instantiates an ItemDisplay() object : Displays item-image with number, such as the number of theoretical Coins collected\r\n * @param   {Object} args the object of arguments\r\n * @param   {string} args.src the src of the image\r\n * @param   {Vector} args.size the size(x, y) of the image, when displayed\r\n * @param   {Number} args.topFloat the pct 0-1.0 of screen-top-margin\r\n * @param   {Number} args.leftFloat the pct 0-1.0 of screen-left-margin\r\n * @param   {Number} args.targetLeft the pct 0-1.0 of target-left location (for slide-animation behavior)\r\n * @param   {Number} args.targetTop the pct 0-1.0 of target-top location (for slide-animation behavior)\r\n * @param   {string} args.color the css-text-color\r\n * @param   {string} args.text the text-value\r\n *\r\n * @param   {string} args.fontFamily the css fontFamily\r\n * @param   {string} args.fontSize the size of font\r\n *\r\n *@returns ItemDisplay()\r\n *\r\n * */\r\n\r\n\r\nclass ItemDisplay //show an item display (image with text/number to the right\r\n{\r\n    constructor(args) {\r\n\r\n        this.src = args.src || \"__NONE\";\r\n\r\n        this.size = args.size || new Vector3(50, 50);\r\n\r\n        this.topFloat = args.top || 0;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.leftFloat = args.left || 0;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,GameStack.WIDTH);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fontSize = args.fontSize || args.textSize || \"15px\";\r\n\r\n        this.text_id = GameStack.create_id();\r\n\r\n        this.id = GameStack.create_id();\r\n\r\n        this.img_id = GameStack.create_id();\r\n\r\n    }\r\n\r\n    setValue(value)\r\n    {\r\n        document.getElementById(this.text_id)\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n\r\n    get_id()\r\n    {\r\n        return  this.id;\r\n    }\r\n\r\n    update(v)\r\n    {\r\n        var e = document.getElementById(this.text_id);\r\n\r\n        this.text = v + \"\";\r\n\r\n        e.innerText = this.text;\r\n    }\r\n\r\n    show() {\r\n\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('DIV');\r\n\r\n        this.domElement.setAttribute('class', 'gameStack-stats');\r\n\r\n        this.domElement.innerHTML+='<img style=\"float:left;\" width=\"'+this.size.x+'\" height=\"'+this.size.y+'\" id=\"'+this.img_id+'\" src=\"'+this.src+'\"/>';\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.innerHTML+='<span id=\"'+this.text_id+'\" style=\"padding:5px; vertical-align:middle; display:table-cell; font-size:'+this.fontSize+'; color:'+this.color+';\">'+this.text+'</span>';\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        //this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = this.targetTop;\r\n\r\n        this.domElement.style.left = this.targetLeft;\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.id = this.id;\r\n\r\n        document.body.append(this.domElement);\r\n    }\r\n}\r\n\r\nGamestack.ItemDisplay = ItemDisplay;\r\n\r\nclass Bar\r\n{\r\n    constructor(background, border)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.position = 'fixed';\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.zIndex = \"9999\";\r\n\r\n        e.style.backgroundSize = \"100% 100%\";\r\n\r\n        e.style.backgroundPosition = \"center bottom\";\r\n\r\n        if(border)\r\n        {\r\n            e.style.border = border;\r\n\r\n        }\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\nGamestack.Bar = Bar;\r\n\r\nclass BarFill\r\n{\r\n    constructor(background)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.position = 'fixed';\r\n\r\n\r\n        e.style.zIndex = \"9995\";\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\nGamestack.BarFill = BarFill;\r\n\r\nclass BarDisplay //show a display bar such as health bar\r\n{\r\n    constructor(args={}) {\r\n\r\n        this.border = args.border || \"none\";\r\n\r\n        if(args.fill_src)\r\n        {\r\n            this.fill = new BarFill(args.fill_src).width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.fill = args.fill || new BarFill(args.fill_color || 'green').width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n\r\n        if(args.bar_src)\r\n        {\r\n            this.bar = new Bar(args.bar_src, this.border).width(args.bar_width || \"80px\").height(args.bar_height  || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.bar = new Bar(args.bar_color || 'goldenrod', this.border).width(args.bar_width  || \"80px\").height(args.bar_height || \"10px\");\r\n        }\r\n\r\n\r\n        this.topFloat = args.top || args.topFloat || 0.25;\r\n\r\n        this.leftFloat = args.left || args.leftFloat || 0.25;\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.25;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.25;\r\n\r\n        document.body.append(this.fill.domElement);\r\n\r\n        document.body.append(this.bar.domElement);\r\n\r\n\r\n    }\r\n\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    portion_top(v)\r\n    {\r\n\r\n        this.fill.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    portion_left(v)\r\n    {\r\n\r\n        this.fill.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n    }\r\n\r\n    portion_width(w)\r\n    {\r\n\r\n        this.fill.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n\r\n    }\r\n\r\n    portion_height(h)\r\n    {\r\n        this.fill.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    update(f)\r\n    {\r\n        this.fill.domElement.style.width = this.get_float_pixels(f || 0,  parseFloat(this.bar.domElement.style.width));\r\n\r\n    }\r\n\r\n}\r\n\r\nGamestack.BarDisplay = BarDisplay;\r\n\r\nclass VideoDisplay //show a video\r\n{\r\n    constructor({src, size}) {\r\n\r\n        this.domElement = undefined;\r\n\r\n        this.src = src;\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z || 0);\r\n\r\n        GameStack.log('VideoDisplay():: TODO: create dom element');\r\n\r\n    }\r\n\r\n    play() {\r\n\r\n    }\r\n}\r\n\r\nGamestack.VideoDisplay = VideoDisplay;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;/* \n=========================================================================\n   JSManipulate v1.0 (2011-08-01)\n\nJavascript image filter & effect library\n\nDeveloped by Joel Besada (http://www.joelb.me)\nDemo page: http://www.joelb.me/jsmanipulate\n\nMIT LICENSED (http://www.opensource.org/licenses/mit-license.php)\nCopyright (c) 2011, Joel Besada\n=========================================================================\n*/\n\n\n/**\n * Contains common filter functions.\n */\nfunction FilterUtils(){\n\tthis.HSVtoRGB = function (h, s, v){\n\t\tvar r, g, b;\n\t\tvar i = Math.floor(h * 6);\n\t\tvar f = h * 6 - i;\n\t\tvar p = v * (1 - s);\n\t\tvar q = v * (1 - f * s);\n\t\tvar t = v * (1 - (1 - f) * s);\n\t\tswitch(i % 6){\n\t\t\tcase 0: r = v; g = t; b = p; break;\n\t\t\tcase 1: r = q; g = v; b = p; break;\n\t\t\tcase 2: r = p; g = v; b = t; break;\n\t\t\tcase 3: r = p; g = q; b = v; break;\n\t\t\tcase 4: r = t; g = p; b = v; break;\n\t\t\tcase 5: r = v; g = p; b = q; break;\n\t\t\tdefault: break;\n\t\t}\n\t\treturn [r * 255, g * 255, b * 255];\n\t};\n\tthis.RGBtoHSV = function (r, g, b){\n\t\tr = r/255; g = g/255; b = b/255;\n\t\tvar max = Math.max(r, g, b);\n\t\tvar min = Math.min(r, g, b);\n\t\tvar h, s, v = max;\n\t\tvar d = max - min;\n\t\ts = max === 0 ? 0 : d / max;\n\t\tif(max === min){\n\t\t\th = 0;\n\t\t}else{\n\t\t\tswitch(max){\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\t\t\tcase g: h = (b - r) / d + 2; break;\n\t\t\t\tcase b: h = (r - g) / d + 4; break;\n\t\t\t\tdefault: break;\n\t\t\t}\n\t\t\th /= 6;\n\t\t}\n\t\treturn [h, s, v];\n\t};\n\tthis.getPixel = function (pixels,x,y,width,height){\n\t\tvar pix = (y*width + x)*4;\n\t\tif (x < 0 || x >= width || y < 0 || y >= height) {\n\t\t\treturn [pixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 1],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 2],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 3]];\n\t\t}\n\t\treturn [pixels[pix],pixels[pix+1],pixels[pix+2],pixels[pix+3]];\n\t};\n\tvar haveNextGaussian = false;\n\tvar nextGaussian;\n\tthis.gaussianRandom = function(){\n\t\tif(haveNextGaussian){\n\t\t\thaveNextGaussian = false;\n\t\t\treturn nextGaussian;\n\t\t} else {\n\t\t\tvar v1, v2, s;\n\t\t\tdo {\n\t\t\t\tv1 = 2 * Math.random() - 1;\n\t\t\t\tv2 = 2 * Math.random() - 1;\n\t\t\t\ts = v1 * v1 + v2 * v2;\n\t\t\t} while (s >= 1 || s === 0);\n\t\t\tvar mult = Math.sqrt(-2 * Math.log(s)/s);\n\t\t\tnextGaussian = v2 * mult;\n\t\t\thaveNextGaussian = true;\n\t\t\treturn v1 * mult;\n\t\t}\n\t};\n\tthis.clampPixel = function (x,a,b){\n\t\treturn (x < a) ? a : (x > b) ? b : x;\n\t};\n\tthis.triangle = function(x){\n\t\tvar r = this.mod(x, 1);\n\t\treturn 2*(r < 0.5 ? r : 1-r);\n\t};\n\tthis.mod = function(a,b){\n\t\tvar n = parseInt(a/b,10);\n\t\ta -= n*b;\n\t\tif(a < 0){\n\t\t\treturn a + b;\n\t\t}\n\t\treturn a;\n\t};\n\tthis.mixColors = function(t, rgb1, rgb2){\n\t\tvar r = this.linearInterpolate(t,rgb1[0],rgb2[0]);\n\t\tvar g = this.linearInterpolate(t,rgb1[1],rgb2[1]);\n\t\tvar b = this.linearInterpolate(t,rgb1[2],rgb2[2]);\n\t\tvar a = this.linearInterpolate(t,rgb1[3],rgb2[3]);\n\t\treturn [r,g,b,a];\n\t};\n\n\tthis.linearInterpolate = function(t,a,b){\n\t\treturn a + t * (b-a);\n\t};\n\tthis.bilinearInterpolate = function (x,y,nw,ne,sw,se){\n\t\tvar m0, m1;\n\t\tvar r0 = nw[0]; var g0 = nw[1]; var b0 = nw[2]; var a0 = nw[3];\n\t\tvar r1 = ne[0]; var g1 = ne[1]; var b1 = ne[2]; var a1 = ne[3];\n\t\tvar r2 = sw[0]; var g2 = sw[1]; var b2 = sw[2]; var a2 = sw[3];\n\t\tvar r3 = se[0]; var g3 = se[1]; var b3 = se[2]; var a3 = se[3];\n\t\tvar cx = 1.0 - x; var cy = 1.0 - y;\n\n\t\tm0 = cx * a0 + x * a1;\n\t\tm1 = cx * a2 + x * a3;\n\t\tvar a = cy * m0 + y * m1;\n\n\t\tm0 = cx * r0 + x * r1;\n\t\tm1 = cx * r2 + x * r3;\n\t\tvar r = cy * m0 + y * m1;\n\n\t\tm0 = cx * g0 + x * g1;\n\t\tm1 = cx * g2 + x * g3;\n\t\tvar g = cy * m0 + y * m1;\n\n\t\tm0 = cx * b0 + x * b1;\n\t\tm1 = cx * b2 + x * b3;\n\t\tvar b =cy * m0 + y * m1;\n\t\treturn [r,g,b,a];\n\t};\n\tthis.tableFilter = function (inputData, table, width, height){\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = table[inputData[pixel+i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tthis.convolveFilter = function(inputData, matrix, width, height){\n\t\tvar outputData = [];\n\t\tvar rows, cols;\n\t\trows = cols = Math.sqrt(matrix.length);\n\t\tvar rows2 = parseInt(rows/2,10);\n\t\tvar cols2 = parseInt(cols/2,10);\n\t\tvar trace = true;\n\t\tfor(var y = 0; y < height; y++){\n\t\t\tfor (var x = 0; x < width; x++){\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor(var row = -rows2; row <= rows2; row++){\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tioffset = iy*width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tioffset = y*width;\n\t\t\t\t\t}\n\t\t\t\t\tvar moffset = cols*(row+rows2)+cols2;\n\t\t\t\t\tfor (var col = -cols2; col <= cols2; col++) {\n\t\t\t\t\t\tvar f = matrix[moffset+col];\n\t\t\t\t\t\tif (f !== 0) {\n\t\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\t\tif (!(0 <= ix && ix < width)) {\n\t\t\t\t\t\t\t\tix = x;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar iPixel = (ioffset+ix)*4;\n\t\t\t\t\t\t\tr += f * inputData[iPixel];\n\t\t\t\t\t\t\tg += f * inputData[iPixel+1];\n\t\t\t\t\t\t\tb += f * inputData[iPixel+2];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = parseInt(r+0.5,10);\n\t\t\t\toutputData[pixel+1] = parseInt(g+0.5,10);\n\t\t\t\toutputData[pixel+2] = parseInt(b+0.5,10);\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n\tthis.transformFilter = function(inputData, transformInverse, width, height){\n\t\tvar out = [];\n\t\tvar outputData = [];\n\t\tfor(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tfor(var y = 0; y < height; y++){\n\t\t\tfor (var x = 0; x < width; x++){\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\ttransformInverse.apply(this,[x,y,out]);\n\t\t\t\tvar srcX = Math.floor(out[0]);\n\t\t\t\tvar srcY = Math.floor(out[1]);\n\t\t\t\tvar xWeight = out[0]-srcX;\n\t\t\t\tvar yWeight = out[1]-srcY;\n\t\t\t\tvar nw,ne,sw,se;\n\t\t\t\tif(srcX >= 0 && srcX < width-1 && srcY >= 0 && srcY < height-1){\n\t\t\t\t\tvar i = (width*srcY + srcX)*4;\n\t\t\t\t\tnw = [inputData[i],inputData[i+1],inputData[i+2],inputData[i+3]];\n\t\t\t\t\tne = [inputData[i+4],inputData[i+5],inputData[i+6],inputData[i+7]];\n\t\t\t\t\tsw = [inputData[i+width*4],inputData[i+width*4+1],inputData[i+width*4+2],inputData[i+width*4+3]];\n\t\t\t\t\tse = [inputData[i+(width + 1)*4],inputData[i+(width + 1)*4+1],inputData[i+(width + 1)*4+2],inputData[i+(width + 1)*4+3]];\n\t\t\t\t} else {\n\t\t\t\t\tnw = this.getPixel( inputData, srcX, srcY, width, height );\n\t\t\t\t\tne = this.getPixel( inputData, srcX+1, srcY, width, height );\n\t\t\t\t\tsw = this.getPixel( inputData, srcX, srcY+1, width, height );\n\t\t\t\t\tse = this.getPixel( inputData, srcX+1, srcY+1, width, height );\n\t\t\t\t}\n\t\t\t\tvar rgba = this.bilinearInterpolate(xWeight,yWeight,nw,ne,sw,se);\n\t\t\t\toutputData[pixel] = rgba[0];\n\t\t\t\toutputData[pixel + 1] = rgba[1];\n\t\t\t\toutputData[pixel + 2] = rgba[2];\n\t\t\t\toutputData[pixel + 3] = rgba[3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Blurs the image with Gaussian blur.\n */\nfunction BlurFilter(){\n\tthis.name = \"Blur\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 3\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:10}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width;\n\t\tvar width4 = width << 2;\n\t\tvar height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar q;\n\t\tvar amount = values.amount;\n\t\tif (amount < 0.0) {\n\t\t\tamount = 0.0;\n\t\t}\n\t\tif (amount >= 2.5) {\n\t\t\tq = 0.98711 * amount - 0.96330; \n\t\t} else if (amount >= 0.5) {\n\t\t\tq = 3.97156 - 4.14554 * Math.sqrt(1.0 - 0.26891 * amount);\n\t\t} else {\n\t\t\tq = 2 * amount * (3.97156 - 4.14554 * Math.sqrt(1.0 - 0.26891 * 0.5));\n\t\t}\n\t\tvar qq = q * q;\n\t\tvar qqq = qq * q;\n\t\tvar b0 = 1.57825 + (2.44413 * q) + (1.4281 * qq ) + (0.422205 * qqq);\n\t\tvar b1 = ((2.44413 * q) + (2.85619 * qq) + (1.26661 * qqq)) / b0;\n\t\tvar b2 = (-((1.4281 * qq) + (1.26661 * qqq))) / b0;\n\t\tvar b3 = (0.422205 * qqq) / b0; \n\t\tvar bigB = 1.0 - (b1 + b2 + b3); \n\t\tvar c = 0;\n\t\tvar index;\n\t\tvar indexLast;\n\t\tvar pixel;\n\t\tvar ppixel;\n\t\tvar pppixel;\n\t\tvar ppppixel;\n\t\tfor (c = 0; c < 3; c++) {\n\t\t\tfor (var y = 0; y < height; y++) {\n\t\t\t\tindex = y * width4 + c;\n\t\t\t\tindexLast = y * width4 + ((width - 1) << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index <= indexLast; index += 4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel; \n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t\tindex = y * width4 + ((width - 1) << 2) + c;\n\t\t\t\tindexLast = y * width4 + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index >= indexLast; index -= 4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (c = 0; c < 3; c++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tindex = (x << 2) + c;\n\t\t\t\tindexLast = (height - 1) * width4 + (x << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index <= indexLast; index += width4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t} \n\t\t\t\tindex = (height - 1) * width4 + (x << 2) + c;\n\t\t\t\tindexLast = (x << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index >= indexLast; index -= width4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t}\n\t\t} \n\t};\n}\n/**\n * Adjusts the brightness of the image by going over to HSV values.\n * Negative values decrease brightness while positive values increase brightness.\n */\nfunction BrightnessFilter(){\n\tthis.name = \"Brightness\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 0.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:-1.0, max:1.0}\n\t};\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar hsv = filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);\n\t\t\t\thsv[2] += amount;\n\t\t\t\tif(hsv[2] < 0){\n\t\t\t\t\thsv[2] = 0;\n\t\t\t\t} else if (hsv[2] > 1){ \n\t\t\t\t\thsv[2] = 1;\n\t\t\t\t}\n\t\t\t\tvar rgb = filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]);\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = rgb[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Embosses the edges of the image.\n * This filter takes no parameters but can be applied several times for\n * further effect.\n */\nfunction BumpFilter(){\n\tthis.name = \"Bump\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar matrix = [-1,-1, 0,\n\t\t\t\t\t  -1, 1, 1,\n\t\t\t\t\t   0, 1, 1];\n\t\tfilterUtils.convolveFilter(inputData,matrix,width,height);\n\t};\n}\n/**\n * Smears out the image with circular shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n * NOTE: This filter can be very slow, especially at higher densities/sizes. Use with caution.\n */\nfunction CircleSmearFilter(){\n\tthis.name = \"Circle Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 4,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:10},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\t for(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tif(size < 1){ size = 1;}\n\t\tsize = parseInt(size,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar radius = size+1;\n\t\tvar radius2 = radius*radius;\n\t\tvar numShapes = parseInt(2*density/30*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tfor(var x = sx - radius; x < sx + radius + 1; x++){\n\t\t\t\tfor(var y = sy - radius; y < sy + radius + 1; y++){\n\t\t\t\t\tvar f = (x - sx) * (x - sx) + (y - sy) * (y - sy);\n\t\t\t\t\tif (x >= 0 && x < width && y >= 0 && y < height && f <= radius2) {\n\t\t\t\t\t\tvar rgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tvar mixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(var k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(var l = 0; l < outputData.length; l++){\n\t\t\tinputData[l] = outputData[l];\n\t\t}\n\t};\n}\n/**\n * Adjusts the contrast of the image.\n */\nfunction ContrastFilter(){\n\tthis.name = \"Contrast\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tif(!FilterUtils){\n\t\t\tif(console){\n\t\t\t\tconsole.error(\"Unable to find filterutils.js, please include this file! (Required by \" + this.name + \" filter)\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tif(amount < 0){\n\t\t\tamount = 0.0;\n\t\t}\n\t\tvar table = [];\n\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 * (((i/255)-0.5)*amount+0.5),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Smears out the image with cross shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n */\nfunction CrossSmearFilter(){\n\tthis.name = \"Cross Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tdistance : 8,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tdistance : {min:0, max:30},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\t for(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar distance = (values.distance === undefined) ? this.defaultValues.distance : values.distance;\n\t\tif(distance < 0){ distance = 0;}\n\t\tdistance = parseInt(distance,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar numShapes = parseInt(2*density*width * height / (distance + 1),10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar x = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar y = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar length = (Math.random()*Math.pow(2,32)) % distance + 1;\n\t\t\tvar rgb2 = [inputData[(y*width+x)*4],inputData[(y*width+x)*4+1],inputData[(y*width+x)*4+2],inputData[(y*width+x)*4+3]];\n\t\t\tvar rgb1;\n\t\t\tvar mixedRGB;\n\t\t\tvar k;\n\t\t\tfor (var x1 = x-length; x1 < x+length+1; x1++) {\n\t\t\t\tif(x1 >= 0 && x1 < width){\n\t\t\t\t\trgb1 = [outputData[(y*width+x1)*4],outputData[(y*width+x1)*4+1],outputData[(y*width+x1)*4+2],outputData[(y*width+x1)*4+3]];\n\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\toutputData[(y*width+x1)*4+k] = mixedRGB[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} \n\t\t\tfor (var y1 = y-length; y1 < y+length+1; y1++) {\n\t\t\t\tif(y1 >= 0 && y1 < height){\n\t\t\t\t\trgb1 = [outputData[(y1*width+x)*4],outputData[(y1*width+x)*4+1],outputData[(y1*width+x)*4+2],outputData[(y1*width+x)*4+3]];\n\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\toutputData[(y1*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} \n\t\t}\n\t\tfor(var l = 0; l < outputData.length; l++){\n\t\t\tinputData[l] = outputData[l];\n\t\t}\n\t};\n}\n/**\n * Diffuses the image creating a frosted glass effect.\n */\nfunction DiffusionFilter(){\n\tthis.name = \"Diffusion\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tscale: 4\n\t}; \n\tthis.valueRanges = {\n\t\tscale: {min: 1, max: 100}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar scale = (values.scale === undefined) ? this.defaultValues.scale : values.scale; \n\t\tvar out = [];\n\t\tvar outputData = [];\n\t\tvar sinTable = [];\n\t\tvar cosTable = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar angle = Math.PI*2*i/256;\n\t\t\tsinTable[i] = scale*Math.sin(angle);\n\t\t\tcosTable[i] = scale*Math.cos(angle);\n\t\t}\n\t\ttransInverse = function (x,y,out){\n\t\t\tvar angle = parseInt(Math.random() * 255,10);\n\t\t\tvar distance = Math.random();\n\t\t\tout[0] = x + distance * sinTable[angle];\n\t\t\tout[1] = y + distance * cosTable[angle];\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n  };\n}\n/**\n * Dithers the image to the specified number of colors. Setting color to false\n * grayscales the image.\n */\nfunction DitherFilter(){\n\tthis.name = \"Dither\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tlevels : 3,\n\t\tcolor : true\n\t};\n\tthis.valueRanges = {\n\t\tlevels : {min:2, max:30},\n\t\tcolor : {min:false, max:true}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar i, j;\n\t\tfor (j=0; j < inputData.length; j++) {\n\t\t\toutputData[j] = 0;\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar levels = (values.levels === undefined) ? this.defaultValues.levels : values.levels;\n\t\tvar color = (values.color === undefined) ? this.defaultValues.color : values.color;\n\t\tif(levels <= 1){\n\t\t\tlevels = 1;\n\t\t}\n\t\tvar matrix = [0,0,0,\n\t\t\t\t\t  0,0,7,\n\t\t\t\t\t  3,5,1];\n\t\tvar sum = 7+3+5+1;\n\t\tvar index = 0;\n\t\tvar map = [];\n\t\t\n\t\tfor (i=0; i < levels; i++) {\n\t\t\tmap[i] = parseInt(255* i / (levels-1),10);\n\t\t}\n\t\tvar div = [];\n\t\tfor (i=0; i < 256; i++) {\n\t\t\tdiv[i] = parseInt(levels*i / 256,10);\n\t\t}\n\t  \tfor (var y = 0; y < height; y++) {\n\t\t\tvar reverse = ((y & 1) == 1);\n\t\t\tvar direction;\n\t\t\tif(reverse){\n\t\t\t\tindex = (y*width+width-1)*4;\n\t\t\t\tdirection = -1;\n\t\t\t} else {\n\t\t\t\tindex = y*width*4;\n\t\t\t\tdirection = 1;\n\t\t\t}\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar r1 = inputData[index]; var g1 = inputData[index+1]; var b1 = inputData[index+2];\n\t\t\t\tif(!color){\n\t\t\t\t\tr1 = g1 = b1 = parseInt((r1+g1+b1) / 3,10);\n\t\t\t\t}\n\t\t\t\tvar r2 = map[div[r1]];var g2 = map[div[g1]];var b2 = map[div[b1]];\n\n\t\t\t\toutputData[index] = r2; outputData[index + 1] = g2; outputData[index+2] = b2; outputData[index+3] = inputData[index+3];\n\n\t\t\t\tvar er = r1-r2; var eg = g1-g2; var eb = b1-b2;\n\n\t\t\t\tfor (i = -1; i <= 1; i++) {\n\t\t\t\t\tvar iy = i+y;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tfor (j = -1; j <= 1; j++) {\n\t\t\t\t\t\t\tvar jx = j+x;\n\t\t\t\t\t\t\tif (0 <= jx && jx < width) {\n\t\t\t\t\t\t\t\tvar w;\n\t\t\t\t\t\t\t\tif (reverse){\n\t\t\t\t\t\t\t\t\tw = matrix[(i+1)*3-j+1];\n\t\t\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\t\t\tw = matrix[(i+1)*3+j+1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (w !== 0) {\n\t\t\t\t\t\t\t\t\tvar k = (reverse) ? index - j*4 : index + j*4;\n\t\t\t\t\t\t\t\t\tr1 = inputData[k]; g1 = inputData[k+1]; b1 = inputData[k+2];\n\t\t\t\t\t\t\t\t\tvar factor = w/sum;\n\t\t\t\t\t\t\t\t\tr1 += er * factor; g1 += eg * factor; b1 += eb * factor;\n\t\t\t\t\t\t\t\t\tinputData[k] = r1; inputData[k+1] = g1 ;inputData[k+2] = b1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tindex += direction*4;\n\t\t\t}\n\t\t}\n\t\tfor(j = 0; j < outputData.length; j++){\n\t\t\tinputData[j] = outputData[j];\n\t\t}\n\t};\n}\n/** \n * Highlights the edges of the image.\n */\nfunction EdgeFilter(){\n\tthis.name = \"Edge Detection\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tvar matrixH = [-1,-2,-1,\n\t\t\t\t\t0, 0, 0,\n\t\t\t\t\t1, 2, 1];\n\tvar matrixV = [-1, 0, 1,\n\t\t\t\t   -2, 0, 2,\n\t\t\t\t   -1, 0, 1];\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar rh = 0; gh = 0; bh = 0;\n\t\t\t\tvar rv = 0; gv = 0; bv = 0;\n\t\t\t\tfor(var row = -1; row <= 1; row++){\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tioffset = iy*width*4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tioffset = y*width*4;\n\t\t\t\t\t}\n\t\t\t\t\tvar moffset = 3*(row+1)+1;\n\t\t\t\t\tfor(var col = -1; col <= 1; col++){\n\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\tif(!(ix >= 0 && ix < width)){\n\t\t\t\t\t\t\tix = x;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tix *= 4;\n\t\t\t\t\t\tvar r = inputData[ioffset+ix];\n\t\t\t\t\t\tvar g = inputData[ioffset+ix+1];\n\t\t\t\t\t\tvar b = inputData[ioffset+ix+2];\n\t\t\t\t\t\tvar h = matrixH[moffset+col];\n\t\t\t\t\t\tvar v = matrixV[moffset+col];\n\t\t\t\t\t\trh += parseInt(h*r,10);\n\t\t\t\t\t\tbh += parseInt(h*g,10);\n\t\t\t\t\t\tgh += parseInt(h*b,10);\n\t\t\t\t\t\trv += parseInt(v*r,10);\n\t\t\t\t\t\tgv += parseInt(v*g,10);\n\t\t\t\t\t\tbv += parseInt(v*b,10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = parseInt(Math.sqrt(rh*rh + rv*rv) / 1.8,10);\n\t\t\t\tg = parseInt(Math.sqrt(gh*gh + gv*gv) / 1.8,10);\n\t\t\t\tb = parseInt(Math.sqrt(bh*bh + bv*bv) / 1.8,10);\n\n\t\t\t\toutputData[pixel] = r;\n\t\t\t\toutputData[pixel+1] = g;\n\t\t\t\toutputData[pixel+2] = b;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}   \n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Embosses the image with a simulated light source. \n * Angle and elevation sets the position of the light.\n */\nfunction EmbossFilter(){\n\tthis.name = \"Emboss\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\theight : 1,\n\t\tangle : 135,\n\t\televation : 30\n\t};\n\tthis.valueRanges = {\n\t\theight : {min:1, max:10},\n\t\tangle : {min:0, max:360},\n\t\televation : {min:0, max:180}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar bumpHeight = (values.height === undefined) ? this.defaultValues.height : values.height;\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar elevation = (values.elevation === undefined) ? this.defaultValues.elevation : values.elevation; \n\t\tangle = angle / 180 * Math.PI;\n\t\televation = elevation / 180 * Math.PI;\n\t\tvar width45 = 3 * bumpHeight;\n\t\tvar pixelScale = 255.9;\n\n\t\tvar bumpPixels = [];\n\t\tvar bumpMapWidth = width;\n\t\tvar bumpMapHeight = height;\n\t\tfor(var i = 0; i < inputData.length; i+=4){\n\t\t\tbumpPixels[i/4] = (inputData[i] + inputData[i+1] + inputData[i+2])/3;\n\t\t}\n\t\tvar Nx, Ny, Nz, Lx, Ly, Lz, Nz2, NzLz, NdotL;\n\t\tvar shade, background;\n\n\t\tLx = parseInt(Math.cos(angle) * Math.cos(elevation) * pixelScale,10);\n\t\tLy = parseInt(Math.sin(angle) * Math.cos(elevation) * pixelScale,10);\n\t\tLz = parseInt(Math.sin(elevation) * pixelScale,10);\n\n\t\tNz = parseInt(6 * 255 / width45,10);\n\t\tNz2 = Nz * Nz;\n\t\tNzLz = Nz * Lz;\n\t\tbackground = Lz;\n\n\t\tvar bumpIndex = 0;\n\t\t\n\t\tfor (var y = 0; y < height; y++, bumpIndex += bumpMapWidth) {\n\t\t\tvar s1 = bumpIndex;\n\t\t\tvar s2 = s1 + bumpMapWidth;\n\t\t\tvar s3 = s2 + bumpMapWidth;\n\t\t\tfor (var x = 0; x < width; x++, s1++, s2++, s3++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tif (y !== 0 && y < height-2 && x !== 0 && x < width-2) {\n\t\t\t\t\tNx = bumpPixels[s1-1] + bumpPixels[s2-1] + bumpPixels[s3-1] - bumpPixels[s1+1] - bumpPixels[s2+1] - bumpPixels[s3+1];\n\t\t\t\t\tNy = bumpPixels[s3-1] + bumpPixels[s3] + bumpPixels[s3+1] - bumpPixels[s1-1] - bumpPixels[s1] - bumpPixels[s1+1];\n\t\t\t\t\tif (Nx === 0 && Ny === 0){\n\t\t\t\t\t\tshade = background;\n\t\t\t\t\t} else if ((NdotL = Nx*Lx + Ny*Ly + NzLz) < 0){\n\t\t\t\t\t\tshade = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshade = parseInt(NdotL / Math.sqrt(Nx*Nx + Ny*Ny + Nz2),10);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshade = background;\n\t\t\t\t}\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = shade;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Adjust simulated exposure values on the image.\n */\nfunction ExposureFilter(){\n\tthis.name = \"Exposure\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\texposure : 1.0\n\t};\n\tthis.valueRanges = {\n\t\texposure : {min:0, max:5}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar exposure = (values.exposure === undefined) ? this.defaultValues.exposure : values.exposure;\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 *(1-Math.exp(-(i/255) * exposure)),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData, table, width, height);\n\t};\n}\n/**\n * Adjusts the gain and bias of the image. Gain alters the contrast while bias biases\n * colors towards lighter or darker.\n */\nfunction GainFilter(){\n\tthis.name = \"Gain/Bias\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tgain: 0.5,\n\t\tbias: 0.5\n\t};\n\tthis.valueRanges = {\n\t\tgain: {min:0.0, max:1.0},\n\t\tbias: {min:0.0, max:1.0}\n\t};\n\tvar table = [];\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar gain = (values.gain === undefined) ? this.defaultValues.gain : values.gain;\n\t\tvar bias = (values.bias === undefined) ? this.defaultValues.bias : values.bias;\n\t\t\n\t\tvar table = [];\n\t\t\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar val = i/255;\n\t\t\tvar k = (1/gain-2) * (1-2*val);\n\t\t\tval = (val < 0.5) ? val/(k+1) : (k-val)/(k-1);\n\t\t\tval /= (1/bias-2)*(1-val)+1; \n\t\t\ttable[i] = parseInt(255 * val,10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Adjusts the gamma values of the image. Values over 1 increase the gamma while values over 0 decrease gamma.\n */\nfunction GammaFilter(){\n\tthis.name = \"Gamma\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tif(amount < 0){\n\t\t\tamount = 0.0;\n\t\t}\n\t\tif(!FilterUtils){\n\t\t\tif(console){\n\t\t\t\tconsole.error(\"Unable to find filterutils.js, please include this file! (Required by \" + this.name + \" filter)\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tvar filterUtils = new FilterUtils();\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = 255 * Math.pow(i/255, 1/amount) + 0.5;\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Sets the image to grayscale.\n */\nfunction GrayscaleFilter(){\n\tthis.name = \"Grayscale\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar luma = inputData[pixel]*0.3 + inputData[pixel+1]*0.59 + inputData[pixel+2]*0.11;\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = luma;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Adjusts the hue of the image by going over to HSV values.\n */\nfunction HueFilter(){\n\tthis.name = \"Hue\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 0.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:-1.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar hsv = filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);\n\t\t\t\thsv[0] += amount;\n\t\t\t\twhile(hsv[0] < 0){\n\t\t\t\t\thsv[0] += 360;\n\t\t\t\t}\n\t\t\t\tvar rgb = filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]);\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = rgb[i];\n\t\t\t\t}\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Inverts the colors of the image.\n */\nfunction InvertFilter(){\n\tthis.name = \"Invert\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = 255 - inputData[pixel+i];\n\t\t\t\t}\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Creates a kaleidoscope effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction KaleidoscopeFilter(){\n\tthis.name = \"Kaleidoscope\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tangle : 0,\n\t\trotation : 0,\n\t\tsides : 3,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tangle : {min: 0, max: 360},\n\t\trotation : {min: 0, max: 360},\n\t\tsides : {min: 1, max: 30},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle; \n\t\tvar rotation = (values.rotation === undefined) ? this.defaultValues.rotation : values.rotation; \n\t\tvar sides = (values.sides === undefined) ? this.defaultValues.sides : values.sides; \n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX; \n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY; \n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tangle = angle/180 * Math.PI;\n\t\trotation = rotation/180 * Math.PI;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x - iCenterX;\n\t\t\tvar dy = y - iCenterY;\n\t\t\tvar r = Math.sqrt(dx*dx + dy*dy);\n\t\t\tvar theta = Math.atan2(dy,dx) - angle - rotation;\n\t\t\ttheta = filterUtils.triangle(theta/Math.PI*sides*0.5);\n\t\t\ttheta += angle;\n\t\t\tout[0] = iCenterX + r*Math.cos(theta);\n\t\t\tout[1] = iCenterY + r*Math.sin(theta);\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Applies a fisheye lens distortion effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction LensDistortionFilter(){\n\tthis.name = \"Lens Distortion\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trefraction : 1.5,\n\t\tradius : 50,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\trefraction : {min: 1, max: 10},\n\t\tradius : {min: 1, max: 200},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar refraction = (values.refraction === undefined) ? this.defaultValues.refraction : values.refraction; \n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX; \n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY; \n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;  \n\t\tvar radius2 = radius*radius;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar x2 = dx*dx;\n\t\t\tvar y2 = dy*dy;\n\t\t\tif (y2 >= (radius2 - (radius2*x2)/radius2)) {\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar rRefraction = 1.0 / refraction;\n\n\t\t\t\tvar z = Math.sqrt((1.0 - x2/radius2 - y2/radius2) * radius2);\n\t\t\t\tvar z2 = z*z;\n\n\t\t\t\tvar xAngle = Math.acos(dx / Math.sqrt(x2+z2));\n\t\t\t\tvar angle1 = Math.PI/2 - xAngle;\n\t\t\t\tvar angle2 = Math.asin(Math.sin(angle1)*rRefraction);\n\t\t\t\tangle2 = Math.PI/2 - xAngle - angle2;\n\t\t\t\tout[0] = x - Math.tan(angle2)*z;\n\n\t\t\t\tvar yAngle = Math.acos(dy / Math.sqrt(y2+z2));\n\t\t\t\tangle1 = Math.PI/2 - yAngle;\n\t\t\t\tangle2 = Math.asin(Math.sin(angle1)*rRefraction);\n\t\t\t\tangle2 = Math.PI/2 - yAngle - angle2;\n\t\t\t\tout[1] = y - Math.tan(angle2)*z;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Smears out the image with line shapes to create a painting style effect. Mix specifies\n * the intensity of the effect.\n */\nfunction LineSmearFilter(){\n\tthis.name = \"Line Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tdistance : 8,\n\t\tdensity : 0.5,\n\t\tangle : 0,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tdistance : {min:1, max:30},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tangle : {min:0, max:360},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar k;\n\t\tfor(k = 0; k < inputData.length; k++){\n\t\t\toutputData[k] = inputData[k];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar distance = (values.distance === undefined) ? this.defaultValues.distance : values.distance;\n\t\tif(distance < 1){ distance = 1;}\n\t\tdistance = parseInt(distance,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tangle = angle/180*Math.PI;\n\t\tvar sinAngle = Math.sin(angle);\n\t\tvar cosAngle = Math.cos(angle);\n\t\tvar numShapes = parseInt(2*density*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar length = (Math.random()*Math.pow(2,32) & 0x7fffffff) % distance + 1;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tvar dx = parseInt(length*cosAngle,10);\n\t\t\tvar dy = parseInt(length*sinAngle,10);\n\n\t\t\tvar x0 = sx-dx;\n\t\t\tvar y0 = sy-dy;\n\t\t\tvar x1 = sx+dx;\n\t\t\tvar y1 = sy+dy;\n\t\t\tvar x, y, d, incrE, incrNE, ddx, ddy;\n\t\t\t\n\t\t\tif (x1 < x0){ \n\t\t\t\tddx = -1;\n\t\t\t} else {\n\t\t\t\tddx = 1;\n\t\t\t}\n\t\t\tif (y1 < y0){\n\t\t\t\tddy = -1;\n\t\t\t} else {\n\t\t\t\tddy = 1;\n\t\t\t}\n\t\t\tdx = x1-x0;\n\t\t\tdy = y1-y0;\n\t\t\tdx = Math.abs(dx);\n\t\t\tdy = Math.abs(dy);\n\t\t\tx = x0;\n\t\t\ty = y0;\n\t\t\tvar rgb1;\n\t\t\tvar mixedRGB;\n\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Math.abs(dx) > Math.abs(dy)) {\n\t\t\t\td = 2*dy-dx;\n\t\t\t\tincrE = 2*dy;\n\t\t\t\tincrNE = 2*(dy-dx);\n\n\t\t\t\twhile (x != x1) {\n\t\t\t\t\tif (d <= 0){\n\t\t\t\t\t\td += incrE;\n\t\t\t\t\t} else {\n\t\t\t\t\t\td += incrNE;\n\t\t\t\t\t\ty += ddy;\n\t\t\t\t\t}\n\t\t\t\t\tx += ddx;\n\t\t\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\td = 2*dx-dy;\n\t\t\t\tincrE = 2*dx;\n\t\t\t\tincrNE = 2*(dx-dy);\n\n\t\t\t\twhile (y != y1) {\n\t\t\t\t\tif (d <= 0) {\n\t\t\t\t\t\td += incrE;\n\t\t\t\t\t}else {\n\t\t\t\t\t\td += incrNE;\n\t\t\t\t\t\tx += ddx;\n\t\t\t\t\t}\n\t\t\t\t\ty += ddy;\n\t\t\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the maximum RGB value of the neighboring pixels. Each color is \n * considered separately.\n */\nfunction MaximumFilter(){\n\tthis.name = \"Maximum\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar maxR = 0;\n\t\t\t\tvar maxG = 0;\n\t\t\t\tvar maxB = 0;\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\tmaxR = Math.max(maxR,inputData[iPixel]);\n\t\t\t\t\t\t\t\tmaxG = Math.max(maxG,inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tmaxB = Math.max(maxB,inputData[iPixel+2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = maxR;\n\t\t\t\toutputData[pixel+1] = maxG;\n\t\t\t\toutputData[pixel+2] = maxB;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}   \n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the median RGB value of the neighboring pixels. Each color is \n * considered separately.\n */\nfunction MedianFilter(){\n\tthis.name = \"Median\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar rList = [];\n\t\t\t\tvar gList = [];\n\t\t\t\tvar bList = [];\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\trList.push(inputData[iPixel]);\n\t\t\t\t\t\t\t\tgList.push(inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tbList.push(inputData[iPixel+2]);\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar sortFunc = function(a,b){\n\t\t\t\t\treturn a-b;\n\t\t\t\t};\n\t\t\t\trList.sort(sortFunc);\n\t\t\t\tgList.sort(sortFunc);\n\t\t\t\tbList.sort(sortFunc);\n\t\t\t\toutputData[pixel] = rList[4];\n\t\t\t\toutputData[pixel+1] = gList[4];\n\t\t\t\toutputData[pixel+2] = bList[4];\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}   \n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the minimum RGB value of the neighboring pixels. Each color is \n * considered separately.\n */\nfunction MinimumFilter(){\n\tthis.name = \"Minimum\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar minR = 255;\n\t\t\t\tvar minG = 255;\n\t\t\t\tvar minB = 255;\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\tminR = Math.min(minR,inputData[iPixel]);\n\t\t\t\t\t\t\t\tminG = Math.min(minG,inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tminB = Math.min(minB,inputData[iPixel+2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = minR;\n\t\t\t\toutputData[pixel+1] = minG;\n\t\t\t\toutputData[pixel+2] = minB;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}   \n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Creates random noise on the image, with or without color.\n */\nfunction NoiseFilter(){\n\tthis.name = \"Noise\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 25,\n\t\tdensity : 1,\n\t\tmonochrome : true\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:100},\n\t\tdensity : {min:0, max:1.0},\n\t\tmonochrome : {min:false, max:true}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar monochrome = (values.monochrome === undefined) ? this.defaultValues.monochrome : values.monochrome;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tif(Math.random() <= density){\n\t\t\t\t\tvar n;\n\t\t\t\t\tif(monochrome){\n\t\t\t\t\t\tn = parseInt((2*Math.random()-1) * amount,10);\n\t\t\t\t\t\tinputData[pixel] += n;\n\t\t\t\t\t\tinputData[pixel+1] += n;\n\t\t\t\t\t\tinputData[pixel+2] += n;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\t\t\tn = parseInt((2*Math.random()-1) * amount,10);\n\t\t\t\t\t\t\tinputData[pixel+i] += n; \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Produces an oil painting effect on the image.\n * NOTE: This filter can be very slow, especially at higher ranges. Use with caution.\n */\nfunction OilFilter(){\n\tthis.name = \"Oil Painting\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trange : 3\n\t};\n\tthis.valueRanges = {\n\t\trange : {min:0, max:5}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar range = (values.range === undefined) ? this.defaultValues.range : values.range;\n\t\trange = parseInt(range,10);\n\t\tvar index = 0;\n\t\tvar rHistogram = [];\n\t\tvar gHistogram = [];\n\t\tvar bHistogram = [];\n\t\tvar rTotal = [];\n\t\tvar gTotal = [];\n\t\tvar bTotal = [];\n\t\tvar levels = 256;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor (var j = 0; j < levels; j++){\n\t\t\t\t\trHistogram[j] = gHistogram[j] = bHistogram[j] = rTotal[j] = gTotal[j] = bTotal[j] = 0;\n\t\t\t\t}\n\t\t\t\tfor (var row = -range; row <= range; row++) {\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tioffset = iy*width;\n\t\t\t\t\t\tfor (var col = -range; col <= range; col++) {\n\t\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\t\tif (0 <= ix && ix < width) {\n\t\t\t\t\t\t\t\tvar ro = inputData[(ioffset+ix)*4];\n\t\t\t\t\t\t\t\tvar go = inputData[(ioffset+ix)*4+1];\n\t\t\t\t\t\t\t\tvar bo = inputData[(ioffset+ix)*4+2];\n\t\t\t\t\t\t\t\tvar ri = ro*levels/256;\n\t\t\t\t\t\t\t\tvar gi = go*levels/256;\n\t\t\t\t\t\t\t\tvar bi = bo*levels/256;\n\t\t\t\t\t\t\t\trTotal[ri] += ro;\n\t\t\t\t\t\t\t\tgTotal[gi] += go;\n\t\t\t\t\t\t\t\tbTotal[bi] += bo;\n\t\t\t\t\t\t\t\trHistogram[ri]++;\n\t\t\t\t\t\t\t\tgHistogram[gi]++;\n\t\t\t\t\t\t\t\tbHistogram[bi]++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor (var i = 1; i < levels; i++) {\n\t\t\t\t\tif (rHistogram[i] > rHistogram[r]){\n\t\t\t\t\t\tr = i;\n\t\t\t\t\t}\n\t\t\t\t\tif (gHistogram[i] > gHistogram[g]){\n\t\t\t\t\t\tg = i;\n\t\t\t\t\t}\n\t\t\t\t\tif (bHistogram[i] > bHistogram[b]){\n\t\t\t\t\t\tb = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = rTotal[r] / rHistogram[r];\n\t\t\t\tg = gTotal[g] / gHistogram[g];\n\t\t\t\tb = bTotal[b] / bHistogram[b];\n\t\t\t\toutputData[pixel] = r;\n\t\t\t\toutputData[pixel+1] = g;\n\t\t\t\toutputData[pixel+2] = b;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}   \n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Changes the opacity of the image.\n */\nfunction OpacityFilter(){\n\tthis.name = \"Opacity\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:1.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tinputData[pixel+3] = 255*amount;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Pinches and whirls the image toward the center point. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction PinchFilter(){\n\tthis.name = \"Pinch/Whirl\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 0.5,\n\t\tradius : 100,\n\t\tangle : 0,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min: -1.0, max: 1.0},\n\t\tradius : {min: 1, max: 200},\n\t\tangle : {min: 0, max: 360},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount; \n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle; \n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX; \n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY; \n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;  \n\t\tvar radius2 = radius*radius;\n\t\tangle = angle/180 * Math.PI;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\tif(distance > radius2 || distance === 0){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar d = Math.sqrt( distance / radius2 );\n\t\t\t\tvar t = Math.pow( Math.sin( Math.PI*0.5 * d ), -amount);\n\t\t\t\tdx *= t;\n\t\t\t\tdy *= t;\n\t\t\t\tvar e = 1 - d;\n\t\t\t\tvar a = angle * e * e;\n\t\t\t\tvar s = Math.sin(a);\n\t\t\t\tvar c = Math.cos(a);\n\t\t\t\tout[0] = iCenterX + c*dx - s*dy;\n\t\t\t\tout[1] = iCenterY + s*dx + c*dy;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Pixelates the image i.e. divides the image into blocks of color.\n */\nfunction PixelationFilter(){\n\tthis.name = \"Pixelation\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:50}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tsize = parseInt(size,10);\n\t\tvar pixels = [];\n\t\tvar by, bx, bPixel;\n\t\tfor (var y = 0; y < height; y+=size) {\n\t\t\tfor (var x = 0; x < width; x+=size) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar w = Math.min(size, width-x);\n\t\t\t\tvar h = Math.min(size, height-y);\n\t\t\t\tvar t = w*h;\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor(by = y; by < y+h; by++){\n\t\t\t\t\tfor(bx = x; bx < x+w; bx++){\n\t\t\t\t\t\tbPixel = (by*width + bx)*4;\n\t\t\t\t\t\tr += inputData[bPixel];\n\t\t\t\t\t\tg +=  inputData[bPixel+1];\n\t\t\t\t\t\tb += inputData[bPixel+2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(by = y; by < y+h; by++){\n\t\t\t\t\tfor(bx = x; bx < x+w; bx++){\n\t\t\t\t\t\tbPixel = (by*width + bx)*4;\n\t\t\t\t\t\tinputData[bPixel] = r/t;\n\t\t\t\t\t\tinputData[bPixel+1] = g/t;\n\t\t\t\t\t\tinputData[bPixel+2] = b/t;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Posterizes the image, i.e. restricts the color values to a set amount of levels.\n */\nfunction PosterizeFilter(){\n\tthis.name = \"Posterize\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tlevels : 6\n\t};\n\tthis.valueRanges = {\n\t\tlevels : {min:2, max:30 }\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar levels = (values.levels === undefined) ? this.defaultValues.levels : parseInt(values.levels,10);\n\t\tif(levels <= 1){\n\t\t\treturn;\n\t\t}\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 * parseInt(i*levels/256,10) / (levels-1),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Adjust the factor of each RGB color value in the image.\n */\nfunction RGBAdjustFilter(){\n\tthis.name = \"RGBAdjust\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tred: 1.0,\n\t\tgreen: 1.0,\n\t\tblue: 1.0\n\t};\n\tthis.valueRanges = {\n\t\tred: {min: 0.0, max: 2.0},\n\t\tgreen: {min: 0.0, max: 2.0},\n\t\tblue: {min: 0.0, max: 2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar red = (values.red === undefined) ? this.defaultValues.red : values.red;\n\t\tvar green = (values.green === undefined) ? this.defaultValues.green : values.green;\n\t\tvar blue = (values.blue === undefined) ? this.defaultValues.blue : values.blue;\n\t\tif(red < 0){ red = 0; }\n\t\tif(green < 0){ green = 0; }\n\t\tif(blue < 0){ blue = 0; }\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tinputData[pixel] *= red;\n\t\t\t\tinputData[pixel+1] *= green;\n\t\t\t\tinputData[pixel+2] *= blue;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Adjusts the saturation value of the image. Values over 1 increase saturation while values below decrease saturation.\n * For a true grayscale effect, use the grayscale filter instead.\n */\nfunction SaturationFilter(){\n\tthis.name = \"Saturation\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar RW = 0.3;\n\t\tvar RG = 0.59;\n\t\tvar RB = 0.11;\n\t\tvar a = (1 - amount) * RW + amount;\n\t\tvar b = (1 - amount) * RW;\n\t\tvar c = (1 - amount) * RW;\n\t\tvar d = (1 - amount) * RG;\n\t\tvar e = (1 - amount) * RG + amount;\n\t\tvar f = (1 - amount) * RG;\n\t\tvar g = (1 - amount) * RB;\n\t\tvar h = (1 - amount) * RB;\n\t\tvar i = (1 - amount) * RB + amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar pR = inputData[pixel];\n\t\t\t\tvar pG = inputData[pixel+1];\n\t\t\t\tvar pB = inputData[pixel+2];\n\t\t\t\tinputData[pixel]   = a*pR + d*pG + g*pB;\n\t\t\t\tinputData[pixel+1] = b*pR + e*pG + h*pB;\n\t\t\t\tinputData[pixel+2]  = c*pR + f*pG + i*pB;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sawtooth pattern.\n */\nfunction SawtoothRippleFilter(){\n\tthis.name = \"Sawtooth Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16 \n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50} \n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude; \n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude; \n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength; \n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength; \n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = filterUtils.mod(nx,1);\n\t\t\tvar fy = filterUtils.mod(ny,1);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Creates a sepia effect on the image i.e. gives the image a yellow-brownish tone.\n */\nfunction SepiaFilter(){\n\tthis.name = \"Sepia\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 10\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:30}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tamount *= 255/100;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar luma = inputData[pixel]*0.3 + inputData[pixel+1]*0.59 + inputData[pixel+2]*0.11;\n\t\t\t\tvar r,g,b;\n\t\t\t\tr = g = b = luma;\n\t\t\t\tr += 40;\n\t\t\t\tg += 20;\n\t\t\t\tb -= amount;\n\t\t\t\t\n\t\t\t\tinputData[pixel] = r;\n\t\t\t\tinputData[pixel+1] = g;\n\t\t\t\tinputData[pixel+2] = b;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Sharpens the image slightly. For increased effect, apply the filter multiple times.\n */\nfunction SharpenFilter(){\n\tthis.name = \"Sharpen\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar matrix = [ 0.0,-0.2, 0.0,\n\t\t\t\t\t  -0.2, 1.8,-0.2,\n\t\t\t\t\t   0.0, -0.2, 0.0];\n\t\tfilterUtils.convolveFilter(inputData,matrix,width,height);\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sine pattern.\n */\nfunction SineRippleFilter(){\n\tthis.name = \"Sine Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16 \n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50} \n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude; \n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude; \n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength; \n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength; \n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = Math.sin(nx);\n\t\t\tvar fy = Math.sin(ny);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Produces a solarization effect on the image.  \n */\nfunction SolarizeFilter(){\n\tthis.name = \"Solarize\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar val = (i/255 > 0.5) ? 2*(i/255-0.5) : 2*(0.5-i/255);\n\t\t\ttable[i] = parseInt(255 * val,10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData, table, width, height);\n\t};\n}\n/**\n * Generates a sparkle/sunburst effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction SparkleFilter(){\n\tthis.name = \"Sparkle\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trays : 50,\n\t\tsize : 25,\n\t\tamount : 50,\n\t\trandomness : 25,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\trays : {min:1, max:100},\n\t\tsize : {min:1, max:200},\n\t\tamount : {min:0, max:100},\n\t\trandomness : {min:0, max:50},\n\t\tcenterX : {min:0, max:1.0},\n\t\tcenterY : {min:0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar rays = (values.rays === undefined) ? this.defaultValues.rays : values.rays;\n\t\trays = parseInt(rays, 10);\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar randomness = (values.randomness === undefined) ? this.defaultValues.randomness : values.randomness;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar iCenterX = centerX * width;\n\t\tvar iCenterY = centerY * height;\n\t\tvar rayLengths = [];\n\t\tfor(var j = 0; j < rays; j++){\n\t\t\trayLengths[j]= size + randomness / 100 * size * filterUtils.gaussianRandom();\n\t\t}\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar dx = x-iCenterX;\n\t\t\t\tvar dy = y-iCenterY;\n\t\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\t\tvar angle = Math.atan2(dy,dx);\n\t\t\t\tvar d = (angle+Math.PI) / (Math.PI*2) * rays;\n\t\t\t\tvar i = parseInt(d,10);\n\t\t\t\tvar f = d - i;\n\t\t\t\tif(size !== 0){\n\t\t\t\t\tvar length = filterUtils.linearInterpolate(f, rayLengths[i % rays], rayLengths[(i+1) % rays]);\n\t\t\t\t\tvar g = length*length / (distance+0.0001);\n\t\t\t\t\tg = Math.pow(g, (100-amount) / 50);\n\t\t\t\t\tf -= 0.5;\n\t\t\t\t\tf = 1 - f*f;\n\t\t\t\t\tf *= g;\n\t\t\t\t}\n\t\t\t\tf = filterUtils.clampPixel(f,0,1);\n\t\t\t\tvar mixedRGB = filterUtils.mixColors(f,[inputData[pixel],inputData[pixel+1],inputData[pixel+2],inputData[pixel+3]],[255,255,255,255]);\n\t\t\t\tfor(var k = 0; k < 3; k++){\n\t\t\t\t\tinputData[pixel+k] = mixedRGB[k]; \n\t\t\t\t}\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Smears out the image with square shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n * NOTE: This filter can be very slow, especially at higher densities/sizes. Use with caution.\n */\nfunction SquareSmearFilter(){\n\tthis.name = \"Square Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 4,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:10},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar k;\n\t\tfor(k = 0; k < inputData.length; k++){\n\t\t\toutputData[k] = inputData[k];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tif(size < 1){ size = 1;}\n\t\tsize = parseInt(size,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar radius = size+1;\n\t\tvar radius2 = radius*radius;\n\t\tvar numShapes = parseInt(2*density/30*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tfor(var x = sx - radius; x < sx + radius + 1; x++){\n\t\t\t\t\n\t\t\t\tfor(var y = sy - radius; y < sy + radius + 1; y++){\n\t\t\t\t\tif (x >= 0 && x < width && y >= 0 && y < height) {\n\t\t\t\t\t\tvar rgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tvar mixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Divides the colors into black and white following the treshold value. Brightnesses above the threshold\n * sets the color to white while values below the threshold sets the color to black.\n */\nfunction ThresholdFilter(){\n\tthis.name = \"Black & White\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tthreshold : 127\n\t};\n\tthis.valueRanges = {\n\t\tthreshold : {min:0, max:255}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar threshold = (values.threshold === undefined) ? this.defaultValues.threshold : values.threshold;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar brightness = (inputData[pixel] + inputData[pixel+1] + inputData[pixel+2])/3;\n\t\t\t\tvar colorVal = 0;\n\t\t\t\tif(brightness > threshold){\n\t\t\t\t\tcolorVal = 255;\n\t\t\t\t}\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = colorVal;\n\t\t\t}   \n\t\t}\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sine pattern.\n */\nfunction TriangleRippleFilter(){\n\tthis.name = \"Triangle Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16 \n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50} \n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude; \n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude; \n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength; \n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength; \n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = filterUtils.triangle(nx,1);\n\t\t\tvar fy = filterUtils.triangle(ny,1);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Twists the image around a given center point. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction TwirlFilter(){\n\tthis.name = \"Twirl\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tradius : 100,\n\t\tangle : 180,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tradius : {min: 1, max: 200},\n\t\tangle : {min: 0, max: 360},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle; \n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX; \n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY; \n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;  \n\t\tvar radius2 = radius*radius;\n\t\tangle = angle/180 * Math.PI;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\tif(distance > radius2){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tdistance = Math.sqrt(distance);\n\t\t\t\tvar a = Math.atan2(dy, dx) + angle * (radius-distance) / radius;\n\t\t\t\tout[0] = iCenterX + distance*Math.cos(a);\n\t\t\t\tout[1] = iCenterY + distance*Math.sin(a);\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Creates a classical vignette effect on the image i.e. darkens the corners.\n */\nfunction VignetteFilter(){\n\tthis.name = \"Vignette\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 0.3\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:1.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar canvas = document.createElement(\"canvas\");\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tvar context = canvas.getContext(\"2d\");\n\t\tvar gradient;\n\t\tvar radius = Math.sqrt( Math.pow(width/2, 2) + Math.pow(height/2, 2) );\n\t\tcontext.putImageData(input,0,0);\n\t\tcontext.globalCompositeOperation = 'source-over';\n\t\t\n\t\tgradient = context.createRadialGradient(width/2, height/2, 0, width/2, height/2, radius);\n\t\tgradient.addColorStop(0, 'rgba(0,0,0,0)');\n\t\tgradient.addColorStop(0.5, 'rgba(0,0,0,0)');\n\t\tgradient.addColorStop(1, 'rgba(0,0,0,' + amount + ')');\n\t\tcontext.fillStyle = gradient;\n\t\tcontext.fillRect(0, 0, width, height);\n\t\toutputData = context.getImageData(0,0,width,height).data;\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Produces a water ripple/waves on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction WaterRippleFilter(){\n\tthis.name = \"Water Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tphase : 0,\n\t\tradius : 50,\n\t\twavelength : 16,\n\t\tamplitude : 10,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tphase : {min: 0, max: 100},\n\t\tradius : {min: 1, max: 200},\n\t\twavelength : {min: 1, max: 100},\n\t\tamplitude : {min: 1, max: 100},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar wavelength = (values.wavelength === undefined) ? this.defaultValues.wavelength : values.wavelength; \n\t\tvar amplitude = (values.amplitude === undefined) ? this.defaultValues.amplitude : values.amplitude; \n\t\tvar phase = (values.phase === undefined) ? this.defaultValues.phase : values.phase; \n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX; \n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY; \n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;  \n\t\tvar radius2 = radius*radius;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance2 = dx*dx + dy*dy;\n\t\t\tif(distance2 > radius2){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar distance = Math.sqrt(distance2);\n\t\t\t\tvar amount = amplitude * Math.sin(distance/wavelength * Math.PI * 2 - phase);\n\t\t\t\tamount *= (radius-distance)/radius;\n\t\t\t\tif(distance !== 0){\n\t\t\t\t\tamount *= wavelength/distance;\n\t\t\t\t}\n\t\t\t\tout[0] = x + dx*amount;\n\t\t\t\tout[1] = y + dy*amount;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * A collection of all the filters.\n */\nvar JSManipulate = {\n\tblur : new BlurFilter(),\n\tbrightness : new BrightnessFilter(),\n\tbump : new BumpFilter(),\n\tcirclesmear : new CircleSmearFilter(),\n\tcontrast : new ContrastFilter(),\n\tcrosssmear : new CrossSmearFilter(),\n\tdiffusion : new DiffusionFilter(),\n\tdither : new DitherFilter(),\n\tedge : new EdgeFilter(),\n\temboss : new EmbossFilter(),\n\texposure : new ExposureFilter(),\n\tgain : new GainFilter(),\n\tgamma : new GammaFilter(),\n\tgrayscale : new GrayscaleFilter(),\n\thue : new HueFilter(),\n\tinvert : new InvertFilter(),\n\tkaleidoscope : new KaleidoscopeFilter(),\n\tlensdistortion : new LensDistortionFilter(),\n\tlinesmear : new LineSmearFilter(),\n\tmaximum : new MaximumFilter(),\n\tmedian : new MedianFilter(),\n\tminimum : new MinimumFilter(),\n\tnoise : new NoiseFilter(),\n\toil : new OilFilter(),\n\topacity : new OpacityFilter(),\n\tpinch : new PinchFilter(),\n\tpixelate : new PixelationFilter(),\n\tposterize : new PosterizeFilter(),\n\trgbadjust : new RGBAdjustFilter(),\n\tsaturation : new SaturationFilter(),\n\tsawtoothripple : new SawtoothRippleFilter(),\n\tsepia : new SepiaFilter(),\n\tsharpen : new SharpenFilter(),\n\tsineripple : new SineRippleFilter(),\n\tsolarize : new SolarizeFilter(),\n\tsparkle : new SparkleFilter(),\n\tsquaresmear : new SquareSmearFilter(),\n\tthreshold : new ThresholdFilter(),\n\ttriangleripple : new TriangleRippleFilter(),\n\ttwirl : new TwirlFilter(),\n\tvignette : new VignetteFilter(),\n\twaterripple : new WaterRippleFilter() \n};\n\n\nvar MyJSManipulate = {};\n\nfor(var x in JSManipulate)\n{\n\tif(JSManipulate[x].hasOwnProperty('defaultValues'))\n\t{\n        MyJSManipulate[x] = JSManipulate[x];\n\n\t}\n\n}\n\n\nGamestack.JSManipulate = MyJSManipulate;;\r\n\r\n/**\r\n * instantiates Gamestack.js Canvas (CanvasLib) controller\r\n\r\n @description\r\n This Canvas library handles the low-level drawing of Sprite() objects on HTML5Canvas.\r\n -draws Sprites(), handling their rotation, size, and other parameters.\r\n * @returns {CanvasLib} a CanvasLib object\r\n */\r\n\r\nclass CanvasLib {\r\n\r\n    constructor() {\r\n\r\n        return {\r\n\r\n            __levelMaker: false,\r\n\r\n            draw: function (sprite, ctx) {\r\n\r\n                if (sprite.active && (this.__levelMaker || sprite.onScreen(__gameStack.WIDTH, __gameStack.HEIGHT))) {\r\n\r\n                    this.drawPortion(sprite, ctx);\r\n\r\n                }\r\n\r\n            },\r\n            drawFrameWithRotation: function (img, fx, fy, fw, fh, x, y, width, height, deg, canvasContextObj, flip) {\r\n\r\n                canvasContextObj.save();\r\n                deg = Math.round(deg);\r\n                deg = deg % 360;\r\n                var rad = deg * Math.PI / 180;\r\n                //Set the origin to the center of the image\r\n                canvasContextObj.translate(x, y);\r\n                canvasContextObj.rotate(rad);\r\n                //Rotate the canvas around the origin\r\n\r\n                canvasContextObj.translate(0, canvasContextObj.width);\r\n                if (flip) {\r\n\r\n                    canvasContextObj.scale(-1, 1);\r\n                } else {\r\n\r\n                }\r\n\r\n                //draw the image\r\n                canvasContextObj.drawImage(img, fx, fy, fw, fh, width / 2 * (-1), height / 2 * (-1), width, height);\r\n                //reset the canvas\r\n\r\n                canvasContextObj.restore();\r\n            },\r\n\r\n\r\n\r\n            drawData:function(x, y, w, h, data, ctx){\r\n\r\n                ctx.putImageData(data, x, y, 0, 0, w, h);\r\n\r\n            },\r\n\r\n\r\n            /*\r\n             * drawPortion:\r\n             *\r\n             *   expects: (sprite{selected_animation{selected_frame{frameSize, framePos } offset?, gameSize? }  })\r\n             *\r\n             *\r\n             * */\r\n\r\n            drawPortion: function (sprite, ctx) {\r\n\r\n                var frame;\r\n\r\n                if (sprite.active) {\r\n\r\n                    if (sprite.selected_animation && sprite.selected_animation.selected_frame) {\r\n\r\n                        frame = sprite.selected_animation.selected_frame;\r\n\r\n                    }\r\n                    else {\r\n\r\n                        console.error('Sprite is missing arguments');\r\n\r\n                    }\r\n\r\n                    var p = sprite.position;\r\n\r\n                    var camera = __gameStack.__gameWindow.camera || {x: 0, y: 0, z: 0};\r\n\r\n                    var x = p.x, y = p.y;\r\n\r\n\r\n                    x -= camera.x || 0;\r\n                    y -= camera.y || 0;\r\n                    //optional animation : gameSize\r\n\r\n                    var targetSize = sprite.size || sprite.selected_animation.size;\r\n\r\n                    var realWidth = targetSize.x;\r\n                    var realHeight = targetSize.y;\r\n\r\n                    //optional animation : offset\r\n\r\n                    if (sprite.selected_animation && sprite.selected_animation.hasOwnProperty('offset')) {\r\n                        x += sprite.selected_animation.offset.x;\r\n\r\n                        y += sprite.selected_animation.offset.y;\r\n\r\n                    }\r\n\r\n                    var rotation;\r\n\r\n                    if (typeof(sprite.rotation) == 'object') {\r\n\r\n                        rotation = sprite.rotation.x;\r\n\r\n\r\n                    }\r\n                    else {\r\n                        rotation = sprite.rotation;\r\n\r\n                    }\r\n\r\n                    var frame = sprite.selected_animation.selected_frame;\r\n\r\n                    if (frame && frame.image && frame.image.data) {\r\n\r\n                        ctx.putImageData(frame.image.data, x, y);\r\n\r\n                    }\r\n                    else {\r\n\r\n                        this.drawFrameWithRotation(sprite.selected_animation.image.domElement, frame.framePos.x, frame.framePos.y, frame.frameSize.x, frame.frameSize.y, Math.round(x + (realWidth / 2)), Math.round(y + (realHeight / 2)), realWidth, realHeight, rotation % 360, ctx, sprite.flipX);\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nlet Canvas = new CanvasLib();\r\n\r\nGamestack.Canvas = Canvas;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;/**\r\n * Takes an object of arguments and returns Animation() object.\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {string} args.type optional\r\n * @param   {Vector} args.size of the Animation object, has x and y properties\r\n * @param   {Vector} args.frameSize the size of frames in Animation, having x and y properties\r\n * @param   {VectorFrameBounds} args.frameBounds the bounds of the Animation having min, max, and termPoint properties\r\n * @param   {number} args.delay optional, the seconds to delay before running animation when started by the start() function\r\n\r\n * @param   {number} args.duration how many milliseconds the animation should take to complete\r\n *\r\n * @returns {Animation} an Animation object\r\n */\r\n\r\nclass Animation {\r\n    constructor(args = {}) {\r\n\r\n        args = args || {};\r\n\r\n        var _anime = this;\r\n\r\n        this.defaultArgs = {\r\n\r\n            name:\"my-animation\",\r\n\r\n            description:\"my-description\",\r\n\r\n            frames:[],\r\n\r\n            type:\"none\",\r\n\r\n            delay:0,\r\n\r\n            frameSize:new Vector3(44, 44, 0),\r\n\r\n            frameBounds:new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0)),\r\n\r\n            frameOffset:new Vector3(0, 0, 0),\r\n\r\n            flipX:false,\r\n\r\n            duration:1000,\r\n\r\n            size:new Vector3(20, 20, 20)\r\n        };\r\n\r\n        for(var x in this.defaultArgs)\r\n        {\r\n            if(!args.hasOwnProperty(x))\r\n            {\r\n                args[x] = this.defaultArgs[x]\r\n\r\n            }\r\n\r\n        };\r\n\r\n        for(var x in this.args)\r\n        {\r\n           this[x] = args[x];\r\n\r\n        }\r\n\r\n\r\n        this.name = args.name || \"__\";\r\n\r\n        this.description = args.description || \"__\";\r\n\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.src = this.image.domElement.src;\r\n\r\n        this.domElement = this.image.domElement;\r\n\r\n        this.frameSize = new Vector(args.frameSize || new Vector3(44, 44, 0));\r\n\r\n        if(args.frameBounds)\r\n        {\r\n            this.frameBounds = new VectorFrameBounds(args.frameBounds.min, args.frameBounds.max, args.frameBounds.termPoint);\r\n\r\n        }\r\n        else\r\n        {\r\n            this.frameBounds =   new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0))\r\n\r\n        }\r\n\r\n        this.frameOffset = this.getArg(args, 'frameOffset', new Vector3(0, 0, 0));\r\n\r\n        this.extras = this.getArg(args, 'extras', false);\r\n\r\n      if(typeof(args) == 'object' && args.frameBounds && args.frameSize){  this.apply2DFrames(args.parent || {}) };\r\n\r\n        this.flipX = this.getArg(args, 'flipX', false);\r\n\r\n        this.cix = 0;\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n        this.timer = 0;\r\n\r\n        this.duration = args.duration || 2000;\r\n\r\n        this.seesaw_mode = args.seesaw_mode || false;\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n\r\n    }\r\n\r\n    singleFrame(frameSize, size)\r\n    {\r\n\r\n        this.__frametype = 'single';\r\n\r\n        this.frameSize = frameSize;\r\n\r\n        this.size = size || this.frameSize;\r\n\r\n        this.selected_frame = {\r\n            image: this.image,\r\n            frameSize: this.frameSize,\r\n            framePos: {x: 0, y: 0}\r\n        };\r\n\r\n        this.frames[0] = this.selected_frame;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    apply2DFrames() {\r\n\r\n\r\n\r\n        this.frames = [];\r\n\r\n        var fcount = 0;\r\n\r\n        var quitLoop = false;\r\n\r\n        for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n            for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n                let framePos = {x: x * this.frameSize.x + this.frameOffset.x, y: y * this.frameSize.y + this.frameOffset.y};\r\n\r\n                this.frames.push({image: this.image, frameSize: this.frameSize, framePos: framePos});\r\n\r\n                if( x >= this.frameBounds.termPoint.x && y >= this.frameBounds.termPoint.y)\r\n                {\r\n\r\n                    quitLoop = true;\r\n\r\n                    break;\r\n                }\r\n\r\n                fcount += 1;\r\n\r\n                if(quitLoop)\r\n                    break;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.frames[0] = !this.frames[0] ? {\r\n                image: this.image,\r\n                frameSize: this.frameSize,\r\n                framePos: {x: this.frameBounds.min.x, y: this.frameBounds.min.y}\r\n            } : this.frames[0];\r\n\r\n\r\n        if(this.seesaw_mode)\r\n        {\r\n            console.log('ANIMATION: applying seesaw');\r\n\r\n            var frames_reversed = this.frames.slice().reverse();\r\n\r\n            this.frames.pop();\r\n\r\n            this.frames = this.frames.concat(frames_reversed);\r\n\r\n        }\r\n\r\n       // this.selected_frame = this.frames[this.cix % this.frames.length] || this.frames[0];\r\n\r\n    }\r\n\r\n    resetFrames() //special reset function:: frames are re-rendered each reset()\r\n    {\r\n\r\n        this.apply2DFrames();\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        this.selected_frame = this.frames[Math.round(this.cix) % this.frames.length];\r\n\r\n\r\n    }\r\n\r\n\r\n    reset()\r\n{\r\n\r\n    this.resetFrames();\r\n\r\n    this.cix = 0;\r\n\r\n}\r\n\r\ncontinuous(duration)\r\n{\r\n\r\n    if(this.__frametype == 'single')\r\n    {\r\n        return 0;\r\n\r\n    }\r\n\r\n  this.apply2DFrames();\r\n\r\n    //update once:\r\n    this.update();\r\n\r\n\r\n    if(this.cix == 0)\r\n  {\r\n\r\n      this.engage();\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\n    onRun(caller, callkey)\r\n    {\r\n\r\n        this.run_ext = this.run_ext  || [];\r\n\r\n        this.run_ext.push({caller:caller, callkey:callkey});\r\n\r\n    }\r\n\r\nengage(duration, complete)\r\n{\r\n    //call any function extension that is present\r\n    for(var x= 0 ; x<this.run_ext.length; x++)\r\n    {\r\n\r\n        this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n\r\n    }\r\n\r\n    duration = duration || 2000;\r\n\r\n    if(this.__frametype == 'single')\r\n    {\r\n        return 0;\r\n\r\n    }\r\n\r\n    let __inst = this;\r\n\r\n    this.complete = complete || this.complete || function(){  };\r\n\r\n    var duration = duration || typeof(this.duration) == 'number' ? this.duration : this.frames.length * 20;\r\n\r\n    if(this.cix == 0 && this.extras)\r\n    {\r\n        this.extras.call(); //fire any extras attached\r\n\r\n    }\r\n\r\n    //we have a target\r\n  this.tween = new TWEEN.Tween(this)\r\n        .easing(__inst.curve || TWEEN.Easing.Linear.None)\r\n\r\n        .to({cix:__inst.frames.length - 1}, duration)\r\n        .onUpdate(function() {\r\n            //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n         //   __inst.cix = Math.ceil(__inst.cix);\r\n\r\n        __inst.update();\r\n\r\n        })\r\n        .onComplete(function() {\r\n            //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n            if(__inst.complete)\r\n            {\r\n\r\n                __inst.complete();\r\n\r\n            }\r\n\r\n            __inst.cix = 0;\r\n\r\n            __inst.isComplete = true;\r\n\r\n        });\r\n\r\n\r\n  this.tween.start();\r\n\r\n\r\n}\r\n\r\nonComplete(fun)\r\n{\r\n    this.complete = fun;\r\n\r\n}\r\n\r\n    animate() {\r\n\r\n        this.apply2DFrames();\r\n\r\n        this.timer += 1;\r\n\r\n        if(this.delay == 0 || this.timer % this.delay == 0) {\r\n\r\n                if(this.cix == 0 && this.extras)\r\n                {\r\n                    this.extras.call(); //fire any extras attached\r\n\r\n                }\r\n\r\n                if(this.cix >= this.frames.length - 1 && typeof(this.complete) == 'function')\r\n                {\r\n                    this.complete(this);\r\n\r\n                }\r\n\r\n                this.cix = this.cix >= this.frames.length - 1 ? this.frameBounds.min.x : this.cix + 1;\r\n\r\n                this.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n\r\nGamestack.Animation = Animation;;/**\r\n * Camera : has simple x, y, z, position / Vector values\r\n *\r\n * @returns {Vector}\r\n */\r\n\r\n\r\nclass Camera\r\n{\r\n\r\n    constructor(args)\r\n    {\r\n\r\n      this.position = new Vector3(0, 0, 0);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n;/*\r\n * Canvas\r\n *    draw animations, textures to the screen\r\n * */\r\n\r\nclass EffectSequence\r\n{\r\n    constructor(args = {})\r\n    {\r\n\r\n        console.log('Effect Sequence');\r\n\r\n        this.animation = args.animation || false;\r\n\r\n        this.effects = Gamestack.JSManipulate;\r\n\r\n        this.selected_effect = this.effects.triangleripple;\r\n\r\n        this.effects_list = [];\r\n\r\n        this.effects_list[0] = this.selected_effect;\r\n\r\n        this.effect_guis = [];\r\n\r\n        this.numberSteps = 10;\r\n\r\n        this.curve = args.curve || TWEEN.Easing.Linear.None;\r\n\r\n        this.counter = 0;\r\n\r\n         this.duration = 3000;\r\n\r\n        this.loopBack = true; //Use this to loop effects back to original state\r\n\r\n        this.canvas = document.createElement('canvas');\r\n\r\n        this.testCtx = this.canvas.getContext('2d');\r\n\r\n        this.values = {};\r\n\r\n        this.initValues();\r\n\r\n        this.minFloat = function(portion)\r\n        {\r\n            for(var x in this.startValues)\r\n            {\r\n\r\n                this.startValues[x] = this.valueRanges[x].max * portion;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.maxFloat = function(portion)\r\n        {\r\n            for(var x in this.endValues)\r\n            {\r\n\r\n                this.endValues[x] = this.valueRanges[x].max * portion;\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    initValues()\r\n    {\r\n        this.startValues = {};\r\n\r\n        this.endValues = {};\r\n\r\n        for(var x in this.selected_effect.valueRanges)\r\n        {\r\n\r\n            this.startValues[x] = this.selected_effect.valueRanges[x].min;\r\n\r\n            this.endValues[x] = this.selected_effect.valueRanges[x].max;\r\n\r\n        }\r\n\r\n        this.values =  JSON.parse(jstr(this.startValues));\r\n\r\n        this.valueRanges = this.selected_effect.valueRanges;\r\n\r\n    }\r\n\r\n    Effect(key)\r\n    {\r\n\r\n        if(typeof(key) == 'object')\r\n        {\r\n            this.selected_effect = key;\r\n\r\n        }\r\n        else if (typeof(key) == 'string')\r\n        {\r\n\r\n            for(var x in this.effects)\r\n            {\r\n\r\n                if(x.toLowerCase() == key.toLowerCase())\r\n                {\r\n                    this.selected_effect = this.effects[key];\r\n\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.initValues();\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n\r\n    foldLeft()\r\n    {\r\n        this.foldLeft = true;\r\n        return this;\r\n    }\r\n\r\n\r\n    foldTop()\r\n    {\r\n        this.foldTop = true;\r\n        return this;\r\n\r\n    }\r\n\r\n    guiCallback(effect, callback)\r\n    {\r\n\r\n        this.selected_effect = effect || this.effects.triangleripple;\r\n\r\n        dat.GUI.prototype.removeFolder = function(name) {\r\n            var folder = this.__folders[name];\r\n            if (!folder) {\r\n                return;\r\n            }\r\n            folder.close();\r\n            this.__ul.removeChild(folder.domElement.parentNode);\r\n            delete this.__folders[name];\r\n            this.onResize();\r\n        }\r\n\r\n        var __inst = this;\r\n\r\n        __inst.gui = __inst.gui ||  false;\r\n\r\n\r\n        var setValues = function(my_gui)\r\n        {\r\n\r\n            my_gui.removeFolder('start-values');\r\n            my_gui.removeFolder('end-values');\r\n            var startValuesGUI =  my_gui.addFolder('start-values'),\r\n                endValuesGUI =  my_gui.addFolder('end-values');\r\n\r\n            for(var x in __inst.startValues)\r\n            {\r\n                if(__inst.valueRanges.hasOwnProperty(x))\r\n                {\r\n                    startValuesGUI.add(__inst.startValues, x).min(__inst.valueRanges[x].min).max(__inst.valueRanges[x].max);\r\n\r\n                    endValuesGUI.add(__inst.endValues, x).min(__inst.valueRanges[x].min).max(__inst.valueRanges[x].max);\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n\r\n        };\r\n\r\n\r\n        if(__inst.gui)\r\n        {\r\n\r\n\r\n        }\r\n        else\r\n        {\r\n\r\n            __inst.gui = new dat.GUI();\r\n\r\n            var effect_select = __inst.gui.add(__inst, 'selected_effect', Object.keys(__inst.effects));\r\n\r\n\r\n\r\n            if(!effect)\r\n            {\r\n                effect_select.setValue('triangleripple');\r\n\r\n                __inst.selected_effect = __inst.effects.triangleripple;\r\n\r\n            }\r\n\r\n            effect_select.onFinishChange(function(value){\r\n\r\n                __inst.selected_effect = __inst.effects[value];\r\n\r\n                __inst.guiCallback(__inst.selected_effect, callback);\r\n\r\n\r\n\r\n            });\r\n\r\n\r\n          var lp =  __inst.gui.add(__inst, 'loopBack');\r\n\r\n          lp.onChange(function(value){\r\n\r\n             __inst.loopBack = value;\r\n\r\n          });\r\n\r\n            DatGui.addTweenCurveSelect(__inst, __inst.gui);\r\n\r\n        }\r\n\r\n        setValues(this.gui);\r\n\r\n        DatGui.updateableAnimationObjectToGui( __inst.gui, __inst);\r\n\r\n        window.setTimeout(function(){\r\n\r\n            callback(__inst.gui);\r\n\r\n        }, 200);\r\n\r\n        return this.gui;\r\n\r\n    }\r\n\r\n    get_image_data_array(sourceImageData, dataListCallback)\r\n    {\r\n\r\n        __inst.image_data_list = [];\r\n\r\n            if (sourceImageData && this.selected_effect.hasOwnProperty('filter')) {\r\n\r\n                this.values = JSON.parse(jstr(this.startValues));\r\n\r\n                var __inst = this;\r\n\r\n                var tween =  new TWEEN.Tween(this.values).to(this.endValues, this.duration).easing(this.curve).onUpdate(function () {\r\n\r\n                    __inst.counter += 1;\r\n\r\n                    var img = {data:__inst.image_data_list.data.slice(0)} ;\r\n\r\n                    __inst.selected_effect.filter(img, __inst.values);\r\n\r\n\r\n\r\n                    __inst.image_data_list.push(img);\r\n\r\n\r\n                    console.log('tween update');\r\n\r\n\r\n\r\n                }).onComplete(function(){  __inst.counter = 0;\r\n\r\n\r\n                    __inst.image_data_list = __inst.loopBack ? __inst.image_data_list.concat(__inst.image_data_list.slice().reverse()): __inst.image_data_list;\r\n\r\n\r\n                if(dataListCallback){\r\n\r\n                    dataListCallback(image_data_list); }\r\n\r\n\r\n\r\n                }).start();\r\n\r\n            }\r\n\r\n        }\r\n\r\n     get_canvas_array(sourceImageData, canvasCallback) {\r\n\r\n    this.canvasList = [];\r\n\r\n    if (sourceImageData && this.selected_effect.hasOwnProperty('filter')) {\r\n\r\n        var timer = 0;\r\n\r\n        var __inst = this;\r\n\r\n        this.image_ix = 0;\r\n\r\n\r\n        var copyImageData = function copyImageData(ctx, src) {\r\n            var dst = ctx.createImageData(src.width, src.height);\r\n            dst.data.set(src.data);\r\n            return dst;\r\n        };\r\n\r\n        if(!this.complete) {\r\n\r\n            this.values = JSON.parse(jstr(this.startValues));\r\n\r\n           __inst.tween = new TWEEN.Tween(this.values).to(this.endValues, this.duration).easing(this.curve).onUpdate(function () {\r\n\r\n                var c = document.createElement('CANVAS'), ct = c.getContext('2d');\r\n\r\n                c.width = sourceImageData.width;\r\n\r\n                c.height = sourceImageData.height;\r\n\r\n                c.style.background = \"blue\";\r\n\r\n                ct.restore();\r\n\r\n                ct.save();\r\n\r\n                var img = copyImageData(ct, sourceImageData);\r\n\r\n                __inst.selected_effect.filter(img, __inst.values);\r\n\r\n                ct.putImageData(img, 0, 0);\r\n\r\n                if(__inst.foldLeft)\r\n                {\r\n                    var left = ct.getImageData(0, 0, c.width / 2, c.height);\r\n\r\n                    ct.translate(c.width / 2, 0);\r\n\r\n                    ct.scale(-1, 1);\r\n\r\n                    ct.putImageData(left, 0, 0);\r\n\r\n                }\r\n\r\n               if(__inst.foldTop)\r\n               {\r\n                   var top = ct.getImageData(0, 0, c.width, c.height / 2);\r\n\r\n                   ct.translate(0, c.height / 2);\r\n\r\n                   ct.scale(1, -1);\r\n\r\n                   ct.putImageData(top, 0, 0);\r\n\r\n               }\r\n\r\n\r\n\r\n               __inst.canvasList.push(c);\r\n\r\n                console.log('tween update');\r\n\r\n\r\n\r\n\r\n            }).onComplete(function () {\r\n\r\n                console.log('complete');\r\n\r\n               if(!__inst.complete)\r\n                {\r\n\r\n                __inst.complete = true;\r\n\r\n\r\n                    __inst.canvasList = __inst.loopBack ? __inst.canvasList.concat(__inst.canvasList.slice().reverse()): __inst.canvasList;\r\n\r\n                    if(canvasCallback){\r\n\r\n\r\n\r\n                        canvasCallback(__inst.canvasList) };\r\n\r\n\r\n                    __inst.tween.stop();\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n            }).start();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    var animate = function()\r\n    {\r\n        if(!__inst.complete) {\r\n\r\n            TWEEN.update();\r\n\r\n            requestAnimationFrame(animate);\r\n\r\n        }\r\n\r\n    }\r\n\r\n        animate();\r\n\r\n}\r\n\r\n    apply(sprite, canvas)\r\n    {\r\n\r\n        this.sprite = sprite;\r\n\r\n        this.canvas = canvas;\r\n\r\n        if(this.counter == 0) {\r\n\r\n            if (canvas && this.selected_effect && this.selected_effect.hasOwnProperty('filter')) {\r\n\r\n                this.timer_diff = 0;\r\n\r\n                var frameIndex = 0;\r\n\r\n                var ctx = canvas.getContext('2d');\r\n\r\n                this.source_image = this.source_image || false;\r\n\r\n\r\n                function copyImageData(ctx, src) {\r\n                    var dst = ctx.createImageData(src.width, src.height);\r\n                    dst.data.set(src.data);\r\n                    return dst;\r\n                }\r\n\r\n                this.values = JSON.parse(jstr(this.startValues));\r\n\r\n                var __inst = this;\r\n\r\n\r\n                __inst.image_data_list = [];\r\n\r\n              var tween =  new TWEEN.Tween(this.values).to(this.endValues, this.duration).easing(this.curve).onUpdate(function () {\r\n\r\n                    if (!__inst.source_image) {\r\n\r\n                        __inst.source_image = ctx.getImageData(sprite.position.x, sprite.position.y, sprite.size.x, sprite.size.y);\r\n\r\n                        console.log('image is set');\r\n\r\n                    }\r\n\r\n                    sprite.selected_animation.selected_frame.image.data = false;\r\n\r\n                    var img = copyImageData(ctx, __inst.source_image);\r\n\r\n                  //  console.log(jstr(__inst.values));\r\n\r\n\r\n\r\n                    __inst.selected_effect.filter(img, __inst.values);\r\n\r\n\r\n                  __inst.image_data_list.push(img);\r\n\r\n                  sprite.selected_animation.selected_frame.image.data = img;\r\n\r\n\r\n                  __inst.counter += 1;\r\n\r\n\r\n\r\n                }).onComplete(function(){\r\n\r\nif(__inst.loopBack)\r\n{\r\n\r\n\r\n    var tween2 =  new TWEEN.Tween(__inst.values).to(__inst.startValues, __inst.duration).easing(__inst.curve).onUpdate(function () {\r\n\r\n        if (!__inst.source_image) {\r\n\r\n            __inst.source_image = ctx.getImageData(sprite.position.x, sprite.position.y, sprite.size.x, sprite.size.y);\r\n\r\n        }\r\n\r\n        sprite.selected_animation.selected_frame.image.data = false;\r\n\r\n        var img = copyImageData(ctx, __inst.source_image);\r\n\r\n        //  console.log(jstr(__inst.values));\r\n\r\n\r\n\r\n        __inst.selected_effect.filter(img, __inst.values);\r\n\r\n\r\n        __inst.image_data_list.push(img);\r\n\r\n        sprite.selected_animation.selected_frame.image.data = img;\r\n\r\n\r\n    }).onComplete(function(){  __inst.counter = 0;\r\n\r\n\r\n    }).start();\r\n\r\n}\r\n                  else\r\n                  {\r\n                      __inst.counter = 0;\r\n                  }\r\n\r\n\r\n              }).start();\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n\r\nclass Extras\r\n{\r\n\r\n    constructor(args)\r\n    {\r\n        this.items = args || [];\r\n\r\n        if(typeof(this.items)== 'object')\r\n        {\r\n            this.items = [this.items]; //assert array from single object\r\n        }\r\n\r\n        var allowedTypes = ['Sound', 'GameText', 'StatDisplay', 'Menu'];\r\n\r\n        if(!(this.items instanceof Array))\r\n        {\r\n\r\n            return console.error('Quick2d.Extras.call(), needs array argument');\r\n\r\n        }\r\n\r\n    }\r\n\r\n    call()\r\n    {\r\n        var items = this.items;\r\n        //a callable item can be one-time executed: it will have any of the following functions attached\r\n\r\n        for(var x = 0; x < items.length; x++)\r\n        {\r\n            var item = items[x];\r\n\r\n            if(typeof(item.play) == 'function')\r\n            {\r\n                item.play();\r\n\r\n            }\r\n\r\n\r\n            if(typeof(item.engage) == 'function')\r\n            {\r\n                item.engage();\r\n\r\n            }\r\n\r\n            if(typeof(item.fire) == 'function')\r\n            {\r\n                item.fire();\r\n\r\n            }\r\n\r\n            if(typeof(item.start) == 'function')\r\n            {\r\n                item.start();\r\n\r\n            }\r\n\r\n            if(typeof(item.run) == 'function')\r\n            {\r\n                item.run();\r\n\r\n            }\r\n\r\n            if(typeof(item.process) == 'function')\r\n            {\r\n                item.process();\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n /**\r\n * GravityForce, calling new GravityForce() is equivalent to calling new Force()\r\n  *\r\n  * Takes an object of arguments and returns GravityForce() Object.\r\n  *@param   {Object} args the object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {Array} args.subjects the subjects to be pulled by the GravityForce\r\n * @param   {Array} args.clasticObjects any clastic object that should have collision-stop behavior with args.subjects when collision occurs\r\n * @param   {Vector} args.max the speed of gravity AKA terminal velocity\r\n * @param   {number} args.accel the increment to use when accelerating speed of fall\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass GravityForce\r\n{\r\n    constructor(args)\r\n    {\r\n\r\n        this.name = args.name || \"\";\r\n\r\n        this.description = args.description || \"\";\r\n\r\n        this.subjects = args.subjects || [];\r\n\r\n        this.clasticObjects = args.clasticObjects || [];\r\n\r\n        this.topClastics = args.topClastics || [];\r\n\r\n        this.max = args.max || new Vector3(3, 3, 3);\r\n         this.accel = args.accel || new Vector3(1.3, 1.3, 1.3);\r\n\r\n\r\n        for(var x in this.clasticObjects)\r\n        {\r\n            if(!this.clasticObjects[x] instanceof Sprite)\r\n            {\r\n                this.clasticObjects[x] = Gamestack.getById(this.clasticObjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n\r\n        for(var x in this.topClastics)\r\n        {\r\n            if(!this.topClastics[x] instanceof Sprite)\r\n            {\r\n                this.topClastics[x] = Gamestack.getById(this.topClastics[x].id);\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n        for(var x in this.subjects)\r\n        {\r\n            if(!this.subjects[x] instanceof Sprite)\r\n            {\r\n                this.subjects[x] = Gamestack.getById(this.subjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    update()\r\n    {\r\n\r\n      var  subjects = this.subjects;\r\n\r\n       var clasticObjects =  this.clasticObjects;\r\n\r\n        var topClastics =  this.topClastics;\r\n\r\n      var  accel =  this.accel || {};\r\n\r\n        var max =  this.max || {};\r\n\r\n        __gameStack.each(subjects, function(ix, itemx){\r\n\r\n           itemx.accelY(accel, max);\r\n\r\n           itemx.__inAir = true;\r\n\r\n\r\n            if(itemx.position.y >= itemx.groundMaxY)\r\n            {\r\n\r\n\r\n                itemx.position.y = itemx.groundMaxY;\r\n\r\n            }\r\n\r\n            itemx.groundMaxY = 3000000; //some crazy number you'll never reach in-game\r\n\r\n            __gameStack.each(clasticObjects, function(iy, itemy){\r\n\r\n                itemx.collide_stop(itemy);\r\n\r\n            });\r\n\r\n            __gameStack.each(topClastics, function(iy, itemy){\r\n\r\n                itemx.collide_stop_top(itemy);\r\n\r\n            });\r\n\r\n        });\r\n    }\r\n};\r\n\r\nlet Force = GravityForce;\r\n\r\n Gamestack.Force = Force;\r\n\r\n Gamestack.GravityForce = GravityForce;\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n/**\r\n * GamepadAdapter()\r\n *\r\n * <ul >\r\n *  <li> supports game-controller input for web-games\r\n *  <li> accesses live gamepad input from the HTML5 Gamepad Api\r\n * </ul>\r\n *\r\n * [See Live Demos with Suggested Usage-Examples]{@link http://www.google.com}\r\n * @returns {GamepadAdapter} object of GamepadAdapter()\r\n * */\r\n\r\n\r\nGameStack.gamepads = GameStack.gamepads || __gameInstance.gamepads;\r\n\r\nclass GamepadAdapter {\r\n\r\n    constructor() {\r\n\r\n        this.__gamepads = [];\r\n\r\n        this.intervals = [];\r\n\r\n        let controller_stack = this;\r\n\r\n        let _gpinst = this;\r\n\r\n        this.events = [];\r\n\r\n        window.setInterval(function () {\r\n\r\n            var gps = navigator.getGamepads();\r\n\r\n            _gpinst.gps = gps;\r\n\r\n            for(var x = 0; x < gps.length; x++) {\r\n\r\n            var events = _gpinst.__gamepads[x] ? _gpinst.__gamepads[x] : {};\r\n\r\n             _gpinst.process(gps[x], events);\r\n\r\n            }\r\n\r\n\r\n        }, 20);\r\n\r\n    }\r\n\r\n    gamepads()\r\n    {\r\n\r\n        return  navigator.getGamepads();\r\n\r\n    }\r\n\r\n\r\n    disconnect_all() {\r\n\r\n        for (var x = 0; x < this.intervals.length; x++) {\r\n\r\n            window.clearInterval(this.intervals[x]);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    disconnect_by_index(game_pad_index) {\r\n\r\n        window.clearInterval(this.intervals[game_pad_index]);\r\n\r\n    }\r\n\r\n    hasAnyPad() {\r\n        return \"getGamepads\" in navigator;\r\n\r\n    }\r\n\r\n    Event(key, game_pad, callback) {\r\n        return {\r\n\r\n            key: key, game_pad:game_pad, callback: callback\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    GamepadEvents(args)\r\n    {\r\n\r\n        var gp = {};\r\n\r\n        gp.stick_left = args.stick_left || function(x, y)\r\n        {\r\n\r\n          //  console.log('Def call');\r\n\r\n        }\r\n\r\n\r\n        gp.stick_right = args.stick_right ||  function(x, y)\r\n        {\r\n\r\n        }\r\n\r\n        gp.buttons = [];\r\n\r\n        gp.extendFunc = function(f1, f2)\r\n        {\r\n\r\n            var fc = f2;\r\n\r\n           return function(x, y){\r\n\r\n                f2(x, y);\r\n\r\n               f1(x, y);\r\n\r\n            }\r\n\r\n        };\r\n\r\n        gp.on = function(key, callback)\r\n        {\r\n\r\n            if(this[key] && key !== \"on\")\r\n            {\r\n\r\n                var current_cb =  typeof(this[key]) == 'function' ? this[key] : function(x, y){};\r\n\r\n               this[key] = this.extendFunc(callback, current_cb);\r\n\r\n\r\n            }\r\n\r\n            else if(key.indexOf('button') >= 0 && key.indexOf('_') >= 0 )\r\n            {\r\n                var parts = key.split('_');\r\n\r\n                var number;\r\n\r\n                try\r\n                {\r\n\r\n                    number = parseInt(parts[1]);\r\n\r\n\r\n                    var current_cb =  typeof(this['buttons'][number]) == 'function' ? this['buttons'][number] : function(x, y){};\r\n\r\n                    this['buttons'][number] = this.extendFunc(callback, current_cb);\r\n\r\n                }\r\n                catch (e)\r\n                    {\r\n                      console.error('could not parse \"on\" event with ' + key);\r\n\r\n                    }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        this.__gamepads.push(gp);\r\n\r\n        Gamestack.gamepads = this.__gamepads;\r\n\r\n        return gp;\r\n\r\n    }\r\n\r\n    getGamepads()\r\n    {\r\n        return Gamestack.gamepads;\r\n\r\n    }\r\n\r\n    process(gp, gpEvents)\r\n    {\r\n\r\n        this.process_buttons(gp, gpEvents);\r\n\r\n        this.process_axes(gp, gpEvents);\r\n\r\n    }\r\n\r\n    process_axes(gp, events)\r\n    {\r\n\r\n        if(!gp || !gp['axes'])\r\n        {\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n\r\n            for (var i = 0; i < gp.axes.length; i += 2) {\r\n\r\n            var axis1 = gp.axes[i], axia2 = gp.axes[i + 1];\r\n\r\n            var ix = (Math.ceil(i / 2) + 1), x = gp.axes[i], y = gp.axes[i + 1];\r\n\r\n            if(ix == 1 && events.stick_left)\r\n            {\r\n                events.stick_left(x, y);\r\n\r\n            }\r\n\r\n            if(ix == 2 && events.stick_right)\r\n            {\r\n                events.stick_right(x, y);\r\n\r\n            }\r\n\r\n            if (this.events && this.events['stick_' + i] && typeof(this.events['stick_' + i].callback) == 'function') {\r\n                this.events['stick_' + i].callback();\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    process_buttons(gp, events) {\r\n\r\n        if(!gp || !gp['buttons'])\r\n        {\r\n             return false;\r\n\r\n        }\r\n\r\n        for (var i = 0; i < gp.buttons.length; i++) {\r\n\r\n\r\n            if (typeof(events.buttons[i]) == 'function') {\r\n                events.buttons[i](gp.buttons[i].pressed);\r\n            }\r\n            else if (typeof( events.buttons[i]) == 'object' && typeof(events.buttons[i].update) == 'function') {\r\n                events.buttons[i].update(events.buttons[i].pressed);\r\n\r\n            }\r\n                var clearance_1 = this.events && this.events[i], gpc, bkey = \"button_\" + i;\r\n\r\n                if (clearance_1) {\r\n                    gpc = this.events[bkey] && !isNaN(this.events[bkey].game_pad) ? this.gamepads[this.events[bkey].game_pad] : this.events[bkey].game_pad;\r\n                }\r\n                ;\r\n\r\n                if (clearance_1 && gpc && typeof(this.events[bkey].callback) == 'function') {\r\n                    //call the callback\r\n                    this.events[i].callback();\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    on(key, gpix, callback) {\r\n\r\n        if(gpix >= this.__gamepads.length)\r\n        {\r\n\r\n            this.__gamepads.push(this.GamepadEvents({}));\r\n\r\n        }\r\n\r\n        this.__gamepads[gpix].on(key, callback);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n/**\r\n * ControllerSetting()\r\n * takes arguments of button(string) || stick(string), plus event(function),\r\n *\r\n * @returns {ControllerSetting\r\n * }\r\n */\r\n\r\n\r\n/**********\r\n * NOTE: here we bind the instance, and NOT the instantiator.\r\n *\r\n * *********/\r\n\r\nif(!__gameInstance.GamepadAdapter)\r\n{\r\n    Gamestack.GamepadAdapter = new GamepadAdapter();\r\n\r\n    GameStack.GamepadAdapter.on('stick_left', 0, function(x, y){\r\n\r\n        console.log('Gamepad stick left');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_0', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 0');\r\n\r\n    });\r\n\r\n\r\n    GameStack.GamepadAdapter.on('button_1', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 1');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_2', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 2');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_3', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 3');\r\n\r\n    });\r\n\r\n   // __gameInstance.gamepads.push(gamepad);\r\n\r\n}\r\n\r\n;\r\nclass GSEvent {\r\n\r\n    constructor(args = {}) {\r\n\r\n        this.name = args.name || \"blankEvent\";\r\n\r\n        this.on = args.on || \"collision\";\r\n\r\n        this.object = args.object || {};\r\n\r\n        this.gpix = args.gpix || 0;\r\n\r\n        this.ix = args.ix || 0; //the button-index OR stick-index\r\n\r\n        this.targets = args.targets || [];\r\n\r\n        this.triggered = args.triggered || function () {\r\n            }\r\n\r\n        this.statKey = args.statKey || false;\r\n\r\n        this.lessThan = args.lessThan || false;\r\n\r\n        this.greaterThan = args.greaterThan || false;\r\n\r\n    }\r\n\r\n    apply() {\r\n\r\n        var __inst = this;\r\n\r\n        switch (this.on) {\r\n            case \"collision\":\r\n            case \"collide\":\r\n\r\n                $Q(this.object).on('collision', this.targets, function (obj1, obj2) {\r\n\r\n                    __inst.triggered(obj1, obj2);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n            case \"button\":\r\n\r\n                //rig the button call\r\n\r\n                $Q(this.object).on('button' + this.ix, function (pressed) {\r\n\r\n\r\n                    __inst.triggered(pressed);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n\r\n            case \"stick_left\":\r\n            case \"stick_right\":\r\n            case \"right_stick\":\r\n            case \"left_stick\":\r\n\r\n                //rig the stick call\r\n\r\n                $Q(this.object).on(this.on, function (x, y) {\r\n\r\n\r\n                    __inst.triggered(x, y);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n            case \"stat\":\r\n\r\n                //rig the stat call\r\n\r\n                console.error('STAT CALLS ARE NOT SET-UP YET. Please add this to the Gamestack library');\r\n\r\n                function isStrOrNum(str){return typeof(str)=='string' || typeof(str)=='number'}\r\n\r\n                var onKey = \"[\" + this.statKey + (isStrOrNum(this.greaterThan)?\">\":\"\") + (isStrOrNum(this.lessThan)?\"<\":\"\") + (this.greaterThan || this.lessThan);\r\n\r\n                $Q(this.object).on(onKey, function (x, y) {\r\n\r\n                    __inst.triggered(x, y);\r\n\r\n                });\r\n\r\n                break;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    triggered() {\r\n    } //called when triggered\r\n\r\n    onTriggered(fun) {\r\n        this.triggered = function () {\r\n            fun();\r\n        };\r\n    } //adds a function argument for triggered\r\n\r\n    rejected() {\r\n    }\r\n\r\n    onRejected(fun) {\r\n        this.rejected = function () {\r\n            fun();\r\n        };\r\n    }\r\n\r\n};\r\n/**\r\n * Takes an object of arguments and returns Motion() object. Motion animates movement of position and rotation properties for any Sprite()\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.curve the TWEEN.Easing function to be applied (Example: TWEEN.Easing.Quadratic.InOut)\r\n * @param   {Vector} args.targetRotation the targeted rotation result, when using rotation with movement\r\n * @param   {Vector} args.distance the target distance of position change, when moving position\r\n * @param   {number} args.duration the milliseconds duration of the Motion\r\n * @param   {number} args.delay the milliseconds delay before the Motion occurs (on call of Motion.engage())\r\n *\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass Motion {\r\n    constructor(args={}) {\r\n\r\n        this.getArg = $Q.getArg;\r\n\r\n        this.distance = new Vector(Gamestack.getArg(args, 'distance', new Vector(0, 0)));\r\n\r\n        this.curvesList = this.curvesToArray(); //Tween.Easing\r\n\r\n        this.lineCurvesList = this.lineCurvesToArray();\r\n\r\n        if(args.parent instanceof Sprite)\r\n        {\r\n            this.parent = args.parent;\r\n\r\n            this.parent_id = args.parent.id;\r\n\r\n        }\r\n        else\r\n        {\r\n            this.parent_id = args.parent_id || args.object_id || \"__blank\"; //The parent object\r\n\r\n            this.parent = Gamestack.getObjectById(this.parent_id);\r\n\r\n        }\r\n\r\n        this.motion_curve = Gamestack.getArg(args, 'curve', TWEEN.Easing.Quadratic.InOut);\r\n\r\n        this.line_curve = Gamestack.getArg(args, 'line_curve', TWEEN.Easing.Linear.None);\r\n\r\n        this.rotation = Gamestack.getArg(args, 'rotation', 0);\r\n\r\n        this.targetRotation = Gamestack.getArg(args, 'targetRotation', 0);\r\n\r\n        this.name = Gamestack.getArg(args, 'name', \"__\");\r\n\r\n        this.description = Gamestack.getArg(args, 'description', false);\r\n\r\n        this.motionCurveString = this.getMotionCurveString(); //store a string key for the Tween.Easing || 'curve'\r\n\r\n        this.lineCurveString = this.getLineCurveString(); //store a string key for the Tween.Easing || 'curve'\r\n\r\n        this.setMotionCurve(this.motionCurveString);\r\n\r\n        this.setLineCurve(this.lineCurveString);\r\n\r\n        this.duration = Gamestack.getArg(args, 'duration', 500);\r\n\r\n        this.delay = Gamestack.getArg(args, 'delay', 0);\r\n\r\n        this.animation = args.animation || false;\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n    }\r\n\r\n    curvesToArray() {\r\n\r\n        var c = [];\r\n\r\n        GameStack.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            GameStack.each(easing, function (iy, easeType) {\r\n\r\n                if (['in', 'out', 'inout','none'].indexOf(iy.toLowerCase()) >= 0) {\r\n\r\n                    c.push(ix + \"_\" + iy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    lineCurvesToArray() {\r\n\r\n        var c = [];\r\n\r\n        GameStack.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            GameStack.each(easing, function (iy, easeType) {\r\n\r\n                if (['linear', 'cubic', 'quadratic', 'quartic', 'quintic'].indexOf(ix.toLowerCase()) >= 0) {\r\n\r\n                    c.push(ix + \"_\" + iy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    getMotionCurveString() {\r\n\r\n        var __inst = this;\r\n\r\n        var c;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (__inst.motion_curve == TWEEN.Easing[ix][iy]) {\r\n\r\n                    c = ix + \"_\" + iy;\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    getLineCurveString() {\r\n\r\n        var __inst = this;\r\n\r\n        var c;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (__inst.line_curve == TWEEN.Easing[ix][iy]) {\r\n\r\n                    c = ix + \"_\" + iy;\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n    setLineCurve(c) {\r\n\r\n        var cps = c.split('_');\r\n\r\n        var s1 = cps[0], s2 = cps[1];\r\n\r\n        var curve = TWEEN.Easing.Quadratic.InOut;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (ix == s1 && iy == s2) {\r\n\r\n                    // alert('setting curve');\r\n\r\n                    curve = TWEEN.Easing[ix][iy];\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        this.line_curve = curve;\r\n\r\n\r\n        return curve;\r\n\r\n    }\r\n\r\n    setMotionCurve(c) {\r\n\r\n        var cps = c.split('_');\r\n\r\n        var s1 = cps[0], s2 = cps[1];\r\n\r\n        var curve = TWEEN.Easing.Quadratic.InOut;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (ix == s1 && iy == s2) {\r\n\r\n                    // alert('setting curve');\r\n\r\n                    curve = TWEEN.Easing[ix][iy];\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        this.motion_curve = curve;\r\n\r\n\r\n        return curve;\r\n\r\n    }\r\n\r\n\r\n    onRun(caller, callkey)\r\n    {\r\n\r\n        this.run_ext = this.run_ext  || [];\r\n\r\n        this.run_ext.push({caller:caller, callkey:callkey});\r\n\r\n    }\r\n\r\n    engage() {\r\n\r\n        //call any function extension that is present\r\n        for(var x= 0 ; x<this.run_ext.length; x++)\r\n        {\r\n\r\n            this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n\r\n        }\r\n\r\n\r\n        var __inst = this;\r\n\r\n        var tweens = [];\r\n\r\n        //construct a tween::\r\n\r\n\r\n        var objects = {};\r\n\r\n        $.each(Game.sprites, function (ix, item) {\r\n\r\n            if (item.id == __inst.parent_id) {\r\n\r\n                objects[ix] = item;\r\n\r\n                if(__inst.animation)\r\n                {\r\n                    objects[ix].selected_animation = __inst.animation;\r\n\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n        var target = {\r\n\r\n            x: __inst.distance.x + objects[0].position.x,\r\n            y: __inst.distance.y + objects[0].position.y,\r\n            z: __inst.distance.z + objects[0].position.z\r\n\r\n        };\r\n\r\n        if (__inst.targetRotation > 0 || __inst.targetRotation < 0) {\r\n\r\n\r\n            var targetR = __inst.targetRotation + objects[0].rotation.x;\r\n\r\n            //we have a target\r\n            tweens[0] = new TWEEN.Tween(objects[0].rotation)\r\n                .easing(__inst.curve || __inst.motion_curve)\r\n\r\n                .to({x: targetR}, __inst.duration)\r\n                .onUpdate(function () {\r\n                    //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n                })\r\n                .onComplete(function () {\r\n                    //console.log(objects[0].position.x, objects[0].position.y);\r\n                    if (__inst.complete) {\r\n\r\n                        __inst.complete();\r\n\r\n                    }\r\n\r\n\r\n                });\r\n\r\n\r\n        }\r\n\r\n        //we have a target\r\n        tweens.push(new TWEEN.Tween(objects[0].position)\r\n            .easing(__inst.motion_curve)\r\n\r\n            .to(target, __inst.duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n                if (__inst.complete) {\r\n\r\n                    __inst.complete();\r\n\r\n                }\r\n\r\n\r\n            }));\r\n\r\n\r\n        __inst.delay = !isNaN(__inst.delay) && __inst.delay > 0 ? __inst.delay : 0;\r\n\r\n\r\n        return {\r\n\r\n            tweens: tweens,\r\n\r\n            delay: __inst.delay,\r\n\r\n            fire: function () {\r\n\r\n                var __tweenObject = this;\r\n\r\n                window.setTimeout(function () {\r\n\r\n                    for (var x = 0; x < __tweenObject.tweens.length; x++) {\r\n\r\n                        __tweenObject.tweens[x].start();\r\n\r\n                    }\r\n\r\n                }, this.delay);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * start the Motion transition\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     *\r\n     **********/\r\n\r\n    start() {\r\n        this.engage().fire();\r\n\r\n    }\r\n\r\n    /**\r\n     * specify a function to be called when Motion is complete\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     * @param {Function} fun the function to be called when complete\r\n     **********/\r\n\r\n    onComplete(fun) {\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    // obj.getGraphCanvas( $(c.domElement), value.replace('_', '.'), TWEEN.Easing[parts[0]][parts[1]] );\r\n\r\n    getGraphCanvas( t, f, c) {\r\n\r\n        var canvas = c || document.createElement('canvas');\r\n\r\n        canvas.style.position = \"relative\";\r\n\r\n        canvas.id = 'curve-display';\r\n\r\n        canvas.setAttribute('class', 'motion-curve');\r\n\r\n        canvas.width = 180;\r\n        canvas.height = 100;\r\n\r\n        canvas.style.background = \"black\";\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.fillStyle = \"rgb(0,0,0)\";\r\n        context.fillRect(0, 0, 180, 100);\r\n\r\n        context.lineWidth = 0.5;\r\n        context.strokeStyle = \"rgb(230,230,230)\";\r\n\r\n        context.beginPath();\r\n        context.moveTo(0, 20);\r\n        context.lineTo(180, 20);\r\n        context.moveTo(0, 80);\r\n        context.lineTo(180, 80);\r\n        context.closePath();\r\n        context.stroke();\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = \"rgb(255,127,127)\";\r\n\r\n        var position = {x: 5, y: 80};\r\n        var position_old = {x: 5, y: 80};\r\n\r\n        new TWEEN.Tween(position).to({x: 175}, 2000).easing(TWEEN.Easing.Linear.None).start();\r\n        new TWEEN.Tween(position).to({y: 20}, 2000).easing(f).onUpdate(function () {\r\n\r\n            context.beginPath();\r\n            context.moveTo(position_old.x, position_old.y);\r\n            context.lineTo(position.x, position.y);\r\n            context.closePath();\r\n            context.stroke();\r\n\r\n            position_old.x = position.x;\r\n            position_old.y = position.y;\r\n\r\n        }).start();\r\n\r\n        return canvas;\r\n    }\r\n\r\n    getTweenPoints(size, line) {\r\n\r\n        //must have line.minPointDist\r\n\r\n        var curve = line.curve,\r\n        duration = line.duration;\r\n\r\n        var points = [];\r\n\r\n        var position = new Vector(line.position);\r\n\r\n        var target = new Vector(position).add(size);\r\n\r\n        var start = new Vector(position);\r\n\r\n        var dist = new Vector(0, 0, 0);\r\n\r\n        var ptrack;\r\n\r\n\r\n       var  easeInOutQuad =  function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t };\r\n\r\n\r\n        return points;\r\n\r\n       var t1 =  new TWEEN.Tween(position).to({x:target.x}, 2000).easing(TWEEN.Easing.Linear.None).start();\r\n\r\n       if(t2)\r\n       {\r\n           t2.stop();\r\n       }\r\n\r\n      var t2 =  new TWEEN.Tween(position).to({y:target.y}, 2000).easing(curve).onUpdate(function () {\r\n\r\n\r\n          if(ptrack){\r\n\r\n              dist = ptrack.sub(p);\r\n\r\n              var d = Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n              if(d >= line.minPointDist)\r\n              {\r\n\r\n                  points.push(p);\r\n\r\n                  ptrack = new Vector(p);\r\n              }\r\n\r\n          }\r\n\r\n          else{\r\n              ptrack = p;\r\n\r\n              points.push(p);\r\n          };\r\n\r\n        }).onComplete(function() {\r\n\r\n            // alert(line.minPointDist);\r\n\r\n            line.first_segment = points.slice();\r\n\r\n            var extendLinePoints = function (segment, points, ix)\r\n            {\r\n\r\n            var next_points = segment.slice();\r\n\r\n            var last_point = points[points.length - 1];\r\n\r\n            for (var x = 0; x < next_points.length; x++) {\r\n\r\n                var sr = new Vector(Gamestack.GeoMath.rotatePointsXY(line.size.x * ix, line.size.y * ix, line.rotation));\r\n\r\n                var p = next_points[x].add(sr);\r\n\r\n                if(points.indexOf(p) <= -1) {\r\n\r\n                    points.push(p);\r\n\r\n\r\n                }\r\n\r\n            }\r\n        };\r\n\r\n        for(var x = 0; x <= line.curve_iterations; x++)\r\n        {\r\n            if(x > 1) {\r\n\r\n                extendLinePoints(line.first_segment, line.points, x - 1);\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n        }).start();\r\n\r\n        return points;\r\n    }\r\n\r\n}\r\n\r\n\r\nGamestack.Motion = Motion;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n/**\r\n * Takes an object of arguments and returns Projectile() object. Projectile fires a shot from the parent sprite, with specified offset, rotation, motion_curve, line_curve\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {string} args.distance the distance before dissappearance\r\n * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.motion_curve the TWEEN.Easing function to be applied for motion/speed (Example: TWEEN.Easing.Quadratic.InOut)\r\n *\r\n *  * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.line_curve the TWEEN.Easing function to be applied for line (Example: TWEEN.Easing.Quadratic.InOut)\r\n *\r\n * @returns {Projectile} a Projectile object\r\n */\r\n\r\nclass Projectile {\r\n\r\n    constructor(args={}) {\r\n\r\n        this.getArg = $Q.getArg;\r\n\r\n        for(var x in args)\r\n        {\r\n            this[x] = args[x];\r\n\r\n        }\r\n\r\n        this.name = args.name || \"__\";\r\n\r\n        this.description = args.description || \"__\";\r\n\r\n        this.line = new Line(Gamestack.getArg(args, 'line', new Line()));\r\n\r\n        this.animation = Gamestack.getArg(args, 'animation', new Animation());\r\n\r\n        this.parent_id = args.parent_id || args.object_id || \"__blank\"; //The parent object\r\n\r\n        this.name = Gamestack.getArg(args, 'name', \"__\");\r\n\r\n        this.size = Gamestack.getArg(args, 'size', new Vector());\r\n\r\n        this.origin = args.origin ||  new Vector(0, 0);\r\n\r\n        this.description = Gamestack.getArg(args, 'description', false);\r\n\r\n        this.duration = Gamestack.getArg(args, 'duration', 500);\r\n\r\n        this.delay = Gamestack.getArg(args, 'delay', 0);\r\n\r\n        this.position = Gamestack.getArg(args, 'position', new Vector(0, 0, 0));\r\n\r\n        this.motion_curve = Gamestack.getArg(args, 'motion_curve', TWEEN.Easing.Linear.None);\r\n\r\n        this.highlighted = false;\r\n\r\n        this.sprites = [];\r\n\r\n        this.run_ext = args.run_ext || [];\r\n\r\n    }\r\n\r\n    /**\r\n     * specify a function to be called when Motion is complete\r\n     *\r\n     * @function\r\n     * @memberof Projectile\r\n     * @param {Function} fun the function to be called when complete\r\n     *\r\n     **********/\r\n\r\n    onComplete(fun) {\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    onCollide(fun) {\r\n        this.collide = fun;\r\n\r\n    }\r\n\r\n    setAnimation(anime) {\r\n\r\n        this.animation = anime;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    setMotionCurve(c) {\r\n\r\n        this.motion_curve = c;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    kill_one()\r\n    {\r\n\r\n        var spr = this.sprites[this.sprites.length - 1];\r\n\r\n        Gamestack.remove(spr);\r\n\r\n    }\r\n\r\n    onRun(caller, callkey)\r\n    {\r\n\r\n        this.run_ext = this.run_ext  || [];\r\n\r\n        this.run_ext.push({caller:caller, callkey:callkey});\r\n\r\n    }\r\n\r\n\r\n    fire(origin)\r\n    {\r\n\r\n        for(var x= 0 ; x<this.run_ext.length; x++)\r\n        {\r\n\r\n            this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n\r\n        }\r\n\r\n        if(!origin)\r\n        {\r\n\r\n            origin = this.origin;\r\n        }\r\n\r\n\r\n        console.log('FIRING FROM:' + jstr(origin));\r\n\r\n        var sprite = new Sprite({image:this.animation.image});\r\n\r\n        sprite.setAnimation(this.animation);\r\n\r\n        sprite.setSize(this.size);\r\n\r\n        sprite.position = new Vector(0, 0, 0);\r\n\r\n        var __inst = this;\r\n\r\n        var lp = __inst.line.transpose(origin);\r\n\r\n        sprite.position = new Vector(lp[0].sub(sprite.size.div(2)));\r\n\r\n        sprite.onUpdate(function(sprite)\r\n        {\r\n\r\n            for(var x = 0; x <  lp.length; x++)\r\n            {\r\n\r\n                if(sprite.center().equals(lp[x]) && x < lp.length - 1)\r\n                {\r\n\r\n                    sprite.position = new Vector(lp[x+1].sub(sprite.size.div(2)));\r\n\r\n                    break;\r\n                }\r\n\r\n                if(x==lp.length - 1)\r\n                {\r\n                    Gamestack.remove(sprite);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        });\r\n\r\n        Gamestack.add(sprite);\r\n\r\n        this.sprites.push(sprite);\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nGamestack.Projectile = Projectile;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n/**\r\n * Takes the min and max vectors of rectangular shape and returns Rectangle Object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Vector} args.min the minimum vector point (x,y)\r\n * @param   {Vector} args.max the maximum vector point (x,y)\r\n *\r\n * @returns {Rectangle} a Rectangle object\r\n */\r\n\r\nclass Rectangle {\r\n\r\n    constructor(min, max) {\r\n\r\n        this.min = new Vector(min);\r\n        this.max = new Vector(max);\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\n\r\n\r\nlet VectorBounds = Rectangle;\r\n\r\n\r\n\r\nGamestack.Rectangle = Rectangle;\r\n\r\n\r\n\r\n/**\r\n * Takes the min and max vectors plus termPoint ('termination-point'), returns VectorFrameBounds\r\n *  *use this to define the bounds of an Animation object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Vector} args.min the minimum vector point (x,y)\r\n * @param   {Vector} args.max the maximum vector point (x,y)\r\n * @param   {Vector} args.termPoint the termPoint vector point (x,y)\r\n * -While a min and max Vector(x,y) will describe the grid of Animation frames, the termPoint will indicate the last frame to show on the grid (Animations may stop early on the 'grid')\r\n * @returns {VectorFrameBounds} a VectorFrameBounds object\r\n */\r\n\r\n\r\nclass VectorFrameBounds extends Rectangle {\r\n\r\n    constructor(min, max, termPoint) {\r\n\r\n        super(min, max);\r\n\r\n        this.termPoint = termPoint || new Vector3(this.max.x, this.max.y, this.max.z);\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\n\r\n\r\nGamestack.VectorFrameBounds = VectorFrameBounds;\r\n\r\n\r\n\r\n\r\nvar Curves = { //ALL HAVE INPUT AND OUTPUT OF: 0-1.0\r\n    // no easing, no acceleration\r\n    linearNone: function (t) { return t },\r\n    // accelerating from zero velocity\r\n    easeInQuadratic: function (t) { return t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuadratic: function (t) { return t*(2-t) },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuadratic: function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t },\r\n    // accelerating from zero velocity\r\n    easeInCubic: function (t) { return t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutCubic: function (t) { return (--t)*t*t+1 },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutCubic: function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 },\r\n    // accelerating from zero velocity\r\n    easeInQuartic: function (t) { return t*t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuartic: function (t) { return 1-(--t)*t*t*t },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuartic: function (t) { return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t },\r\n    // accelerating from zero velocity\r\n    easeInQuintic: function (t) { return t*t*t*t*t },\r\n    // decelerating to zero velocity\r\n    easeOutQuintic: function (t) { return 1+(--t)*t*t*t*t },\r\n    // acceleration until halfway, then deceleration\r\n    easeInOutQuintic: function (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t }\r\n}\r\n\r\nGamestack.Curves = Curves;\r\n\r\nvar Shapes = {\r\n\r\n    circle:function(radius, freq) {\r\n\r\n        return {\r\n\r\n            radius:radius,\r\n\r\n            points:[],\r\n\r\n            fill:function(center, freq)\r\n            {\r\n\r\n\r\n\r\n            }\r\n\r\n        }\r\n    },\r\n\r\n    square:function(s, freq)\r\n    {\r\n        console.error('STILL NEED TO BUILD THIS SQUARE IN GS-API');\r\n\r\n        return{\r\n\r\n            size:new Vector(s, s),\r\n\r\n            width:w,\r\n\r\n            height:h,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    rect:function(w, h, freq)\r\n    {\r\n        console.error('STILL NEED TO BUILD THIS TRIANGLE');\r\n\r\n        return{\r\n\r\n            size:new Vector(w, h),\r\n\r\n            width:w,\r\n\r\n            height:h,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    triangle:function(base, h, freq)\r\n    {\r\n\r\n        console.error('STILL NEED TO BUILD THIS TRIANGLE');\r\n\r\n        return{\r\n\r\n            base:base,\r\n\r\n            height:height,\r\n\r\n            freq:freq,\r\n\r\n            points:[],\r\n\r\n            fill:function(start, freq)\r\n            {\r\n\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n};\r\n\r\n\r\nGamestack.Shapes = Shapes;\r\n\r\n\r\n/**\r\n * Takes several args and returns Line object. Intended for curved-line / trajectory of Projectile Object.\r\n * @param   {Object} args object of arguments\r\n * @param   {Easing} args.curve the curve applied to line see TWEEN.Easing , limited options for immediate line-drawing\r\n * @param   {number} args.duration the millisecond duration of Line\r\n * @param   {Vector} args.position the position vector\r\n *\r\n * @param   {number} args.pointDist the numeric point-distance\r\n *\r\n * @param   {Vector} args.size the size vector\r\n *\r\n * @param   {number} args.rotation the numeric rotation of -360 - 360\r\n *\r\n * @param   {number} args.growth the numeric growth\r\n *\r\n * -While a min and max Vector(x,y) will describe the grid of Animation frames, the termPoint will indicate the last frame to show on the grid (Animations may stop early on the 'grid')\r\n * @returns {VectorFrameBounds} a VectorFrameBounds object\r\n */\r\n\r\nclass Line\r\n{\r\n    constructor(args = {})\r\n    {\r\n\r\n        this.curve_string = args.curve_string || \"Linear_None\";\r\n\r\n        this.curve = this.get_curve_from_string(this.curve_string);\r\n\r\n        this.motion_curve = args.motion_curve || TWEEN.Easing.Linear.None;\r\n\r\n        if(typeof(args.curve) == 'function')\r\n        {\r\n            this.curve = args.curve;\r\n        }\r\n\r\n        this.points = [];\r\n\r\n        this.position = args.position ||  new Vector();\r\n\r\n        this.is_highlighted = args.is_highlighted || false;\r\n\r\n        this.offset = args.offset || new Vector();\r\n\r\n        this.pointDist = 5;\r\n\r\n        this.size = args.size || new Vector();\r\n\r\n        this.rotation = args.rotation || 0;\r\n\r\n        this.iterations = 1;\r\n\r\n        this.growth = args.growth || 1.2;\r\n\r\n        this.curve_options = Curves;\r\n\r\n    }\r\n\r\n    Iterations(n)\r\n    {\r\n\r\n       this.iterations = n;\r\n       return this;\r\n    }\r\n\r\n    Growth(n)\r\n    {\r\n        this.growth = n;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    Pos(p)\r\n    {\r\n\r\n        this.position = p;\r\n        return this;\r\n    }\r\n\r\n    PointDisp(num)\r\n    {\r\n        this.minPointDist = num;\r\n        return this;\r\n    }\r\n\r\n    Curve(c)\r\n    {\r\n        this.curve = c;\r\n        this.curve_string = this.get_curve_string(c);\r\n        return this;\r\n    }\r\n\r\n    Duration(d)\r\n    {\r\n        this.duration = d;\r\n\r\n        return this;\r\n    }\r\n    Rotation(r)\r\n    {\r\n        this.rotation = r;\r\n        return this;\r\n    }\r\n    next(position)\r\n    {\r\n\r\n        var found = false;\r\n\r\n        for(var x = 0; x < this.points.length; x++)\r\n        {\r\n\r\n            if(position.equals(this.points[x]) &&  x < this.points.length - 1)\r\n            {\r\n                found = true;\r\n                return new Vector(this.points[x + 1]);\r\n\r\n            }\r\n\r\n            if(x==this.points.length - 1 && !found)\r\n            {\r\n\r\n                return new Vector(this.points[0]);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    get_curve_from_string(str)\r\n    {\r\n\r\n        for(var x in this.curve_options) {\r\n\r\n            if(x.toLowerCase() == str.toLowerCase().replace('_', ''))\r\n            {\r\n                return this.curve_options[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    get_curve_string(c)\r\n    {\r\n        for(var x in this.curve_options) {\r\n\r\n            if(this.curve_options[x] == c)\r\n            {\r\n                return x;\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    getGraphCanvas(curveCall, existing_canvas) {\r\n\r\n        var canvas = existing_canvas || document.createElement('canvas');\r\n\r\n        canvas.style.position = \"relative\";\r\n\r\n        canvas.id = 'curve-display';\r\n\r\n        canvas.setAttribute('class', 'motion-curve');\r\n\r\n        canvas.width = 180;\r\n        canvas.height = 100;\r\n\r\n        canvas.style.background = \"black\";\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.fillStyle = \"rgb(0,0,0)\";\r\n        context.fillRect(0, 0, 180, 100);\r\n\r\n        context.lineWidth = 0.5;\r\n        context.strokeStyle = \"rgb(230,230,230)\";\r\n\r\n        context.beginPath();\r\n        context.moveTo(0, 20);\r\n        context.lineTo(180, 20);\r\n        context.moveTo(0, 80);\r\n        context.lineTo(180, 80);\r\n        context.closePath();\r\n        context.stroke();\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = \"rgb(255,127,127)\";\r\n\r\n        var position = {x: 0, y: 80};\r\n        var position_old = {x: 0, y: 80};\r\n\r\n        this.test_graph_size = new Vector(185, 80 -20);\r\n\r\n       var points = this.get_line_segment(this.test_graph_size, 5, curveCall);\r\n\r\n        for(var x in points)\r\n        {\r\n            var position = new Vector(points[x].x, this.test_graph_size.y + 20 - points[x].y);\r\n\r\n            context.beginPath();\r\n            context.moveTo(position_old.x, position_old.y);\r\n            context.lineTo(position.x, position.y);\r\n            context.closePath();\r\n            context.stroke();\r\n\r\n            position_old.x = position.x;\r\n            position_old.y = position.y;\r\n        }\r\n\r\n        return canvas;\r\n    }\r\n\r\n    get_line_segment(size, pointDist, curveCall)\r\n    {\r\n        if(!size || !pointDist) //***PREVENT DOUBLE RUN\r\n        {\r\n\r\n            return 0;\r\n        }\r\n\r\n        var points = [];\r\n\r\n        var current_point = new Vector(0, 0, 0);\r\n\r\n        var position = new Vector(current_point),\r\n\r\n            target = new Vector(position.add(size)),\r\n\r\n            start = new Vector(position),\r\n\r\n            curveMethod = curveCall,\r\n\r\n            ptrack = new Vector(start);\r\n\r\n        for (position.x = position.x; position.x < target.x; position.x += 1) {\r\n\r\n            var dist = position.sub(start);\r\n\r\n            var pct = dist.x / size.x;\r\n\r\n            console.log(pct);\r\n\r\n            position.y = Math.round(curveMethod(pct) * size.y);\r\n\r\n            if (ptrack.trig_distance_xy(position) >= pointDist) {\r\n\r\n                var p = new Vector(Gamestack.GeoMath.rotatePointsXY(position.x, position.y, 0));\r\n\r\n                points.push(p);\r\n\r\n                current_point = new Vector(position);\r\n\r\n                ptrack = new Vector(current_point);\r\n\r\n            }\r\n        }\r\n\r\n        return points;\r\n\r\n    }\r\n\r\n    fill(size, pointDist)\r\n    {\r\n\r\n        if(!size || !pointDist) //***PREVENT DOUBLE RUN\r\n        {\r\n\r\n            return 0;\r\n        }\r\n\r\n        this.size = size;\r\n\r\n        this.pointDist = pointDist;\r\n\r\n        var __inst = this;\r\n\r\n        this.points = [];\r\n\r\n        var current_point = new Vector(this.position), yTrack = 0;\r\n\r\n        for(var x= 0; x <= this.iterations; x++) {\r\n\r\n            var position = new Vector(current_point),\r\n\r\n                target = new Vector(position.add(size)),\r\n\r\n                start = new Vector(position),\r\n\r\n                curveMethod = this.curve,\r\n\r\n                ptrack = new Vector(start);\r\n\r\n            for (position.x = position.x; position.x < target.x; position.x += 1) {\r\n\r\n                var dist = position.sub(start);\r\n\r\n                var pct = dist.x / size.x;\r\n\r\n                position.y = start.y +  Math.round(curveMethod(pct) * size.y);\r\n\r\n                if (current_point.trig_distance_xy(position) >= this.pointDist) {\r\n\r\n                    var p = new Vector(Gamestack.GeoMath.rotatePointsXY(position.x, position.y, this.rotation));\r\n\r\n                    this.points.push(p);\r\n\r\n                    current_point = new Vector(position);\r\n\r\n                }\r\n            }\r\n\r\n            size = size.mult(this.growth);\r\n\r\n\r\n        }\r\n    }\r\n\r\n    transpose(origin)\r\n    {\r\n\r\n        var t_points = [];\r\n\r\n        for(var x = 0; x < this.points.length; x++) {\r\n\r\n            t_points.push(this.points[x].add(origin));\r\n\r\n        }\r\n\r\n        return t_points;\r\n\r\n    }\r\n\r\n    add_segment(next_segment, offset)\r\n    {\r\n        for(var x = 0; x < next_segment.length; x++) {\r\n\r\n            next_segment[x] = new Vector(next_segment[x]).add(offset);\r\n\r\n            this.points.push(next_segment[x]);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    get_flipped_segment(points)\r\n    {\r\n\r\n        var t_points = points.slice(), t_len = t_points.length;\r\n\r\n        for(var x = 0; x < points.length; x++) {\r\n\r\n            t_points[t_len - x].x = points[x].x\r\n\r\n        }\r\n\r\n        return t_points;\r\n\r\n    }\r\n\r\n    Highlight(origin, ctx)\r\n    {\r\n\r\n        ctx = ctx || Gamestack.ctx;\r\n\r\n        for(var x in this.points)\r\n        {\r\n\r\n            var point = origin.add(this.points[x]).sub(Gamestack.point_highlighter.size.mult(0.5));\r\n\r\n            var dist = point.sub(Gamestack.point_highlighter.position);\r\n\r\n            var d = Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n\r\n            if(d >= 10)\r\n            {\r\n                Gamestack.point_highlighter.position = new Vector2(origin.add(this.points[x]).sub(Gamestack.point_highlighter.size.mult(0.5)));\r\n            }\r\n\r\n\r\n               Canvas.draw(Gamestack.point_highlighter, ctx);\r\n\r\n        }\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nvar GeoMath = {\r\n\r\n        rotatePointsXY:function(x,y,angle) {\r\n\r\n            var theta = angle*Math.PI/180;\r\n\r\n            var point = {};\r\n            point.x = x * Math.cos(theta) - y * Math.sin(theta);\r\n            point.y = x * Math.sin(theta) + y * Math.cos(theta);\r\n\r\n            point.z = 0;\r\n\r\n            return point\r\n        }\r\n\r\n}\r\n\r\nGamestack.GeoMath = GeoMath;\r\n;/**\r\n * Takes an object of arguments and returns Sprite() object. Sprite() is a container for multiple Animations, Motions, and Sounds. Sprites have several behavioral functions for 2d-Game-Objects.\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n\r\n * @param   {string} args.src the source file for the GameImage:Sprite.image :: use a string / file-path\r\n\r\n * @param   {Vector} args.size the size of the Sprite\r\n * @param   {Vector} args.position the position of the Sprite\r\n * @param   {Vector} args.padding the 'float-type' Vector of x and y padding to use when processing collision on the Sprite. A padding of new Vector(0.2, 0.2) will result in 1/5 of Sprite size for padding\r\n\r\n\r\n\r\n * @param   {Animation} args.selected_animation the selected_animation of the Sprite:: pass during creation or use Sprite.setAnimation after created\r\n *\r\n * @returns {Sprite} a Sprite object\r\n */\r\n\r\nclass Sprite {\r\n    constructor(args) {\r\n\r\n        if (!args) {\r\n            args = {};\r\n        }\r\n\r\n        if(args instanceof Animation)\r\n        {\r\n\r\n            args = {selected_animation:args, size:new Vector(args.frameSize)};\r\n        }\r\n\r\n        this.active = true; //active sprites are visible\r\n\r\n        this.name = args.name || \"__\";\r\n\r\n        this.description = args.description || \"__\";\r\n\r\n        this.gravity = \"medium\";\r\n\r\n        this.__initializers = __gameStack.getArg(args, '__initializers', []);\r\n\r\n        var _spr = this;\r\n\r\n        Gamestack.each(args, function (ix, item) { //apply all args\r\n\r\n            if (ix !== 'parent') {\r\n                _spr[ix] = item;\r\n            }\r\n\r\n        });\r\n\r\n        this.type = __gameStack.getArg(args, 'type', 'basic');\r\n\r\n        this.animations = __gameStack.getArg(args, 'animations', []);\r\n\r\n        this.motions = __gameStack.getArg(args, 'motions', []);\r\n\r\n        this.projectiles = __gameStack.getArg(args, 'projectiles', []);\r\n\r\n        let __inst = this;\r\n\r\n        this.id = __gameStack.getArg(args, 'id', this.create_id());\r\n\r\n        this.sounds = __gameStack.getArg(args, 'sounds', []);\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.size = new Vector(__gameStack.getArg(args, 'size', new Vector3(100, 100)));\r\n\r\n        this.position = new Vector( __gameStack.getArg(args, 'position', new Vector3(0, 0, 0)));\r\n\r\n        this.collision_bounds = __gameStack.getArg(args, 'collision_bounds', new VectorBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n        this.rotation =  new Vector(__gameStack.getArg(args, 'rotation', new Vector3(0, 0, 0)));\r\n\r\n        this.selected_animation = {};\r\n\r\n        this.speed = __gameStack.getArg(args, 'speed', new Vector3(0, 0, 0));\r\n\r\n        this.acceleration = __gameStack.getArg(args, 'acceleration', new Vector3(0, 0, 0));\r\n\r\n        this.rot_speed = __gameStack.getArg(args, 'rot_speed', new Vector3(0, 0, 0));\r\n\r\n        this.rot_accel = __gameStack.getArg(args, 'rot_accel', new Vector3(0, 0, 0));\r\n\r\n\r\n        this.padding = __gameStack.getArg(args, 'padding', new Vector3(0, 0, 0));\r\n\r\n        //Apply / instantiate Sound(), Motion(), and Animation() args...\r\n\r\n        GameStack.each(this.sounds, function (ix, item) {\r\n\r\n            __inst.sounds[ix] = new Sound(item);\r\n\r\n        });\r\n\r\n        GameStack.each(this.motions, function (ix, item) {\r\n\r\n            __inst.motions[ix] = new Motion(item);\r\n\r\n        });\r\n\r\n        GameStack.each(this.animations, function (ix, item) {\r\n\r\n            __inst.animations[ix] = new Animation(item);\r\n\r\n\r\n        });\r\n\r\n        GameStack.each(this.projectiles, function (ix, item) {\r\n\r\n            __inst.projectiles[ix] = new Projectile(item);\r\n\r\n        });\r\n\r\n        //Apply initializers:\r\n\r\n        GameStack.each(this.__initializers, function (ix, item) {\r\n\r\n            __inst.onInit(item);\r\n\r\n        });\r\n\r\n\r\n        if (args.selected_animation) {\r\n            this.selected_animation = new Animation(args.selected_animation);\r\n\r\n        }\r\n        else {\r\n\r\n            this.image.domElement.onload = function(){\r\n\r\n                __inst.setAnimation(__inst.animations[0] || new Animation({\r\n\r\n                        image:  __inst.image,\r\n\r\n                        frameSize: new Vector3( __inst.image.domElement.width,  __inst.image.domElement.height),\r\n\r\n                        frameBounds: new VectorFrameBounds(new Vector3(), new Vector3())\r\n\r\n\r\n                    }));\r\n\r\n            };\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function initializes sprites. Call to trigger all functions previously passed to onInit().\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    init() {\r\n\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends the init() function. Takes single function() argument OR single string argument\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} fun the function to be passed into the init() event of the Sprite()\r\n     **********/\r\n\r\n    onInit(fun) {\r\n\r\n        if (typeof fun == 'string') {\r\n\r\n            if (this.__initializers.indexOf(fun) < 0) {\r\n\r\n                this.__initializers.push(fun)\r\n            }\r\n            ;\r\n\r\n            var __inst = this;\r\n\r\n            var keys = fun.split('.');\r\n\r\n            console.log('finding init from string:' + fun);\r\n\r\n            if (!keys.length >= 2) {\r\n                return console.error('need min 2 string keys separated by \".\"');\r\n            }\r\n\r\n            var f = GameStack.options.SpriteInitializers[keys[0]][keys[1]];\r\n\r\n            if (typeof(f) == 'function') {\r\n\r\n                var __inst = this;\r\n\r\n                var f_init = this.init;\r\n\r\n                this.init = function () {\r\n\r\n                    f_init(__inst);\r\n\r\n                    f(__inst);\r\n\r\n                };\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'function') {\r\n\r\n            console.log('extending init:');\r\n\r\n\r\n            var f_init = this.init;\r\n            var __inst = this;\r\n\r\n            this.init = function () {\r\n\r\n                f_init(__inst);\r\n\r\n                fun(__inst);\r\n\r\n            };\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'object') {\r\n\r\n            console.log('extending init:');\r\n\r\n            console.info('Quick2D does not yet implement onInit() from arg of object type');\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Getters\r\n     ***************************/\r\n\r\n    /**\r\n     * This function gets the 'id' of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    get_id() {\r\n        return this.id;\r\n    }\r\n\r\n    to_map_object(size, framesize) {\r\n\r\n        this.__mapSize = new Vector3(size || this.size);\r\n\r\n        this.frameSize = new Vector3(framesize || this.size);\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Setters and Creators\r\n     ***************************/\r\n\r\n    /**\r\n     * This function creates the 'id' of the Sprite():Called automatically on constructor()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    create_id() {\r\n\r\n        return Quick2d.create_id();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function sets the size of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setSize(size) {\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sets the position of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setPos(pos) {\r\n        this.position = new Vector3(pos.x, pos.y, pos.z || 0);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sizes the Sprite according to minimum dimensions and existing w/h ratios\r\n     * @param {number} mx the maximum size.x for the resize\r\n     * @param {number} my the maximum size.y for the resize\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n   getCappedSizeXY(mx, my, currentSize)\r\n    {\r\n\r\n        var size = new Vector3(currentSize || this.size);\r\n\r\n        var wth = size.y /  size.x;\r\n\r\n        var htw = size.x /  size.y;\r\n\r\n        if( size.x > mx)\r\n        {\r\n            size.x = mx;\r\n\r\n            size.y = size.x * wth;\r\n\r\n        }\r\n\r\n        if( size.y > my)\r\n        {\r\n            size.y = my;\r\n\r\n            size.x = size.y * htw;\r\n\r\n        }\r\n\r\n        return size;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  assertSpeed()\r\n     *  -assert the existence of a speed{} object\r\n     ***************************/\r\n\r\n    assertSpeed() {\r\n        if (!this.speed) {\r\n\r\n            this.speed = new Vector3(0, 0, 0);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  setAnimation(anime)\r\n     *  -set the select_animation of this sprite\r\n     ***************************/\r\n\r\n    /**\r\n     * This function sets the 'selected_animation' property of the Sprite():: *all Sprites must have a 'selected_animation'\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation}\r\n     **********/\r\n\r\n    setAnimation(anime) {\r\n\r\n        if (anime instanceof Animation && this.animations.indexOf(anime) < 0) {\r\n            this.animations.push(anime);\r\n        }\r\n\r\n        this.selected_animation = anime;\r\n\r\n        Gamestack.log('declared default animation');\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /**\r\n     * This function indicates if this Sprite is onScreen within the Gamestack.WIDTH && Gamestack.HEIGHT dimensions, OR any w & h passed as arguments\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} w optional WIDTH argument, defaults to Gamestack.WIDTH\r\n     * @param {number} h optional HEIGHT argument, defaults to Gamestack.HEIGHT\r\n     **********/\r\n\r\n    onScreen(w, h) {\r\n\r\n        w = w || __gameStack.WIDTH;\r\n\r\n        h = h || __gameStack.HEIGHT;\r\n\r\n\r\n        var camera = __gameStack.camera ||__gameStack.__gameWindow.camera || new Vector3(0, 0, 0);\r\n\r\n        var p = new Vector3(this.position.x - camera.position.x, this.position.y - camera.position.y, this.position.z - camera.position.z);\r\n\r\n        var onScreen = p.x  > 0 - this.size.x && p.x < w + this.size.x\r\n        &&  p.y  > 0 - this.size.x && p.y < h + this.size.y ? true : false;\r\n\r\n        return onScreen;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Updates\r\n     ***************************/\r\n\r\n    /*****************************\r\n     * update()\r\n     * -starts empty:: is used by Quick2d.js as the main sprite update\r\n     ***************************/\r\n\r\n    /**\r\n     * This function is the main update() function for the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n\r\n    update(sprite) {\r\n    }\r\n\r\n    /*****************************\r\n     * def_update()\r\n     * -applies speed and other default factors of movement::\r\n     * -is used by Quick2d.js as the system def_update (default update)\r\n     ***************************/\r\n\r\n    /**\r\n     * This function updates various speed and rotational-speed properties for the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    def_update(sprite) {\r\n\r\n\r\n        for (var x in this.speed) {\r\n\r\n            if (this.speed[x] > 0 || this.speed[x] < 0) {\r\n\r\n                this.position[x] += this.speed[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.acceleration) {\r\n\r\n            if (this.acceleration[x] > 0 || this.acceleration[x] < 0) {\r\n\r\n                this.speed[x] += this.acceleration[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.rot_speed) {\r\n\r\n            if ( this.rot_speed[x] > 0 || this.rot_speed[x] < 0) {\r\n\r\n                this.rotation[x] += this.rot_speed[x];\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        for (var x in this.rot_accel) {\r\n\r\n\r\n            if (this.rot_accel[x] > 0 || this.rot_accel[x] < 0) {\r\n\r\n                this.rot_speed[x] += this.rot_accel[x];\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This function resolves a function nested in an object, from a string-key, and it is applied by Gamestack.js for persistence of data and Sprite() behaviors\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    resolveFunctionFromDoubleKeys(keyString1, keyString2, obj, callback) {\r\n\r\n        callback(typeof obj[keyString1][keyString2] == 'function' ? obj[keyString1][keyString2] : {});\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends an existing function, and is applied by Gamestack in onInit();\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    extendFunc(fun, extendedFunc) {\r\n\r\n        console.log('extending func');\r\n\r\n        var ef = extendedFunc;\r\n\r\n        var __inst = this;\r\n\r\n        return function () {\r\n\r\n\r\n            ef(__inst);\r\n\r\n            //any new function comes after\r\n\r\n            fun(__inst);\r\n\r\n\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  onUpdate(fun)\r\n     * -args: 1 function(sprite){ } //the self-instance/sprite is passed into the function()\r\n     * -overrides and maintains existing code for update(){} function\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * Extends the update() of this sprite with a new function to be called during update()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} the function to apply to the Sprite:update()\r\n     **********/\r\n\r\n\r\n    onUpdate(fun) {\r\n        fun = fun || function () {\r\n            };\r\n\r\n        let update = this.update;\r\n\r\n        let __inst = this;\r\n\r\n        this.update = function (__inst) {\r\n            update(__inst);\r\n            fun(__inst);\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * <ul>\r\n     *     <li>A rectangular style position</li>\r\n     *      <li>Takes another sprite as argument</li>\r\n     *       <li>Returns basic true || false during runtime</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {sprite}\r\n     **********/\r\n\r\n\r\n    /**\r\n     * Get the true || false results of a Collision between two Sprites(), based on their position Vectors and Sizes\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} sprite the alternate Sprite to process collision with\r\n     **********/\r\n\r\n\r\n    collidesRectangular(sprite) {\r\n\r\n        return Gamestack.Collision.spriteRectanglesCollide(this, sprite);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  shoot(sprite)\r\n     *  -fire a shot from the sprite:: as in a firing gun or spaceship\r\n     *  -takes options{} for number of shots anglePerShot etc...\r\n     *  -TODO: complete and test this code\r\n     ***************************/\r\n\r\n    /**\r\n     * Sprite fires a projectile object\r\n     * <ul>\r\n     *     <li>Easy instantiator for bullets and propelled objects in GameStack</li>\r\n     *     <li>*TODO: This function is not-yet implemented in GameStack</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {options} *numerous args\r\n     **********/\r\n\r\n\r\n    /**\r\n     * fire a projectile-subSprite from the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} rot_offset the rotational offset to apply: controls direction of the shot\r\n     **********/\r\n\r\n    shoot(options) {\r\n        //character shoots an animation\r\n\r\n        this.prep_key = 'shoot';\r\n\r\n        let animation = options.bullet || options.animation || new Animation();\r\n\r\n        let speed = options.speed || 1;\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let size = options.size || new Vector3(10, 10, 0);\r\n\r\n        let rot_offset = options.rot_offset || new Vector3(0, 0, 0);\r\n\r\n\r\n        var __playerInst = this;\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var bx = position.x, by = position.y, bw = size.x, bh = size.y;\r\n\r\n            var shot = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            shot.setAnimation(animation);\r\n\r\n            if (typeof(rot_offset) == 'number') {\r\n                rot_offset = new Vector3(rot_offset, 0, 0);\r\n            }\r\n\r\n            shot.position.x = bx, shot.position.y = by;\r\n            shot.rotation.x = 0 + rot_offset.x;\r\n\r\n            shot.stats = {\r\n\r\n                damage: 1\r\n\r\n            };\r\n\r\n            if(!options.line) {\r\n\r\n                shot.speed.x = Math.cos((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n                shot.speed.y = Math.sin((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n            }\r\n            else\r\n            {\r\n                options.line.fill(new Vector(500, 500), 4);\r\n\r\n                var nextPos = new Vector(0, 0, 0);\r\n\r\n              shot.onUpdate(function(spr){\r\n\r\n                  nextPos = options.line.next(nextPos);\r\n\r\n                  spr.position =  __playerInst.position.add(nextPos);\r\n\r\n                  console.log(spr.position);\r\n\r\n\r\n              });\r\n\r\n\r\n            }\r\n\r\n            return shot;\r\n\r\n        }\r\n\r\n        return new Error(\"game was not in motion: Gamestack.isAtPlay must be true to create a shot.\");\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * create a subsprite of Sprite belonging to the current Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} offset the positional offset to apply\r\n     **********/\r\n\r\n    subsprite(options) {\r\n\r\n        let animation = options.animation || new Animation();\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let offset = options.offset || new Vector3(0, 0, 0);\r\n\r\n        let size = options.size || this.size;\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var subsprite = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                offset: offset,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            subsprite.setAnimation(animation);\r\n\r\n            return subsprite;\r\n\r\n        }\r\n        else\r\n        {\r\n            alert('No subsprite when not at play');\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * animate Sprite.selected_animation  by one frame\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation} animation to use, defaults to Sprite.selected_animation\r\n     **********/\r\n\r\n    animate(animation) {\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            if (animation) {\r\n                this.setAnimation(animation)\r\n            }\r\n\r\n            this.selected_animation.animate();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * run a function when the Sprite.selected_animation is complete\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Function} fun the function to call when the animation is complete\r\n     *\r\n     **********/\r\n\r\n    onAnimationComplete(fun) {\r\n        this.selected_animation.onComplete(fun);\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  accelY\r\n     *  -accelerate on Y-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: gravitation of sprite || up / down movement\r\n     ***************************/\r\n\r\n    /**\r\n     * accelerate speed on the Y-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n    accelY(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {y: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.y - this.speed.y;\r\n\r\n        if (diff > 0) {\r\n            this.speed.y += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.y -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accelX\r\n     *  -accelerate on X-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: running of sprite || left / right movement\r\n     ***************************/\r\n\r\n\r\n\r\n\r\n    /**\r\n     * accelerate speed on the X-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n\r\n    accelX(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.x - this.speed.x;\r\n\r\n        if (diff > 0) {\r\n            this.speed.x += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.x -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accel\r\n     *  -accelerate any acceleration -key\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * accelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} accel the increment of acceleration\r\n     *\r\n     * @param {number} max the max value to accelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    accel(prop, key, accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        let speed = prop[key];\r\n\r\n        // this.assertSpeed();\r\n\r\n        let diff = max.x - prop[key];\r\n\r\n        if (diff > 0) {\r\n            prop[key] += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            prop[key] -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  decel\r\n     *  -deceleration -key\r\n     ***************************/\r\n\r\n    /**\r\n     * decelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} decel the increment of deceleration\r\n     *\r\n     * @param {number} max the max value to decelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    decel(prop, key, rate) {\r\n        if (typeof(rate) == 'object') {\r\n\r\n            rate = rate.rate;\r\n\r\n        }\r\n\r\n        rate = Math.abs(rate);\r\n\r\n        if (Math.abs(prop[key]) <= rate) {\r\n            prop[key] = 0;\r\n        }\r\n\r\n        else if (prop[key] > 0) {\r\n            prop[key] -= rate;\r\n\r\n        }\r\n        else if (prop[key] < 0) {\r\n            prop[key] += rate;\r\n\r\n        }\r\n        else {\r\n\r\n            prop[key] = 0;\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    /*****************************\r\n     *  decelY\r\n     *  -decelerate on the Y axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the Y-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelY(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n        if (Math.abs(this.speed.y) <= amt) {\r\n            this.speed.y = 0;\r\n\r\n        }\r\n        else if (this.speed.y > amt) {\r\n\r\n            this.speed.y -= amt;\r\n        }\r\n        else if (this.speed.y < amt * -1) {\r\n\r\n            this.speed.y += amt;\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  decelX\r\n     *  -decelerate on the X axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the X-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelX(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n\r\n        if (this.speed.x > amt) {\r\n\r\n            this.speed.x -= amt;\r\n        }\r\n        else if (this.speed.x < amt * -1) {\r\n\r\n            this.speed.x += amt;\r\n        }\r\n\r\n        if (Math.abs(this.speed.x) <= amt) {\r\n\r\n            this.speed.x = 0;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    shortest_stop(item, callback) {\r\n        var diff_min_y = item.min ? item.min.y : Math.abs(item.position.y - this.position.y + this.size.y);\r\n\r\n        var diff_min_x = item.min ? item.min.x : Math.abs(item.position.x - this.position.x + this.size.x);\r\n\r\n        var diff_max_y = item.max ? item.max.y : Math.abs(item.position.y + item.size.y - this.position.y);\r\n\r\n        var diff_max_x = item.max ? item.max.x : Math.abs(item.position.x + item.size.x - this.position.y);\r\n\r\n        var dimens = {top: diff_min_y, left: diff_min_x, bottom: diff_max_y, right: diff_max_x};\r\n\r\n        var minkey = \"\", min = 10000000;\r\n\r\n        for (var x in dimens) {\r\n            if (dimens[x] < min) {\r\n                min = dimens[x];\r\n                minkey = x; // a key of top left bottom or right\r\n\r\n            }\r\n        }\r\n\r\n        callback(minkey);\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * get the center of a Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Vector)\r\n     *\r\n     **********/\r\n\r\n    center() {\r\n\r\n\r\n        return new Vector(this.position.x + this.size.x / 2, this.position.y + this.size.y / 2, 0);\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on X axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns {var} a true || false var\r\n     *\r\n     **********/\r\n\r\n    overlap_x(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return right > item.position.x && left < item.position.x + item.size.x;\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on Y axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns (true || false}\r\n     *\r\n     **********/\r\n\r\n    overlap_y(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return bottom > item.position.y && top < item.position.y + item.size.y;\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n\r\n    collide_stop_x(item)\r\n    {\r\n\r\n        var apart = false;\r\n\r\n            var ct = 10000;\r\n\r\n            while (!apart && ct > 0) {\r\n\r\n                ct--;\r\n\r\n                var diffX = this.center().sub(item.center()).x;\r\n\r\n                var distX = Math.abs(this.size.x / 2 + item.size.x / 2 - Math.round(this.size.x * this.padding.x));\r\n\r\n                if (Math.abs(diffX) < distX) {\r\n\r\n                    this.position.x -= diffX > 0 ? -1 : 1;\r\n\r\n\r\n\r\n                }\r\n                else\r\n                {\r\n\r\n                    apart = true;\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * cause a fourway collision-stop between this and another Sprite :: objects will behave clastically and resist passing through one another\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     *\r\n     **********/\r\n\r\n    collide_stop(item) {\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n       // this.position = this.position.sub(this.speed);\r\n\r\n        if(this.collidesRectangular(item)) {\r\n\r\n            var diff = this.center().sub(item.center());\r\n\r\n            if(this.overlap_x(item, this.padding.x + 0.1) && Math.abs(diff.x) < Math.abs(diff.y))\r\n           {\r\n\r\n               var apart = false;\r\n\r\n                   var ct = 10000;\r\n\r\n                   while (!apart && ct > 0) {\r\n\r\n                       ct--;\r\n\r\n                       var diffY = this.center().sub(item.center()).y;\r\n\r\n                       var distY = Math.abs(this.size.y / 2 + item.size.y / 2- Math.round(this.size.y * this.padding.y));\r\n\r\n                       if (Math.abs(diffY) < distY) {\r\n\r\n                           this.position.y -= diffY > 0 ? -1 : diffY < 0 ? 1 : 0;\r\n\r\n                           this.position.y = Math.round(this.position.y);\r\n\r\n                       }\r\n\r\n                     else {\r\n\r\n                           if (diffY <= 0){\r\n                               this.__inAir = false;\r\n                           };\r\n\r\n\r\n                          return apart = true;\r\n\r\n\r\n                       }\r\n\r\n\r\n               }\r\n\r\n\r\n\r\n           }\r\n\r\n\r\n            if(this.overlap_y(item, this.padding.y ) && Math.abs(diff.y) < Math.abs(diff.x)) {\r\n\r\n                this.collide_stop_x(item);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    collide_stop_top(item)\r\n    {\r\n\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n            if(this.overlap_x(item, this.padding.x + 0.1))\r\n            {\r\n\r\n                console.log('OVERLAP_X');\r\n\r\n                var paddingY = this.padding.y * this.size.y;\r\n\r\n                if(this.position.y + this.size.y - paddingY <= item.position.y)\r\n                {\r\n\r\n                    this.groundMaxY = item.position.y - this.size.y + paddingY;\r\n\r\n                }\r\n\r\n            }\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Restore a sprite from saved .json data\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Sprite)\r\n     **********/\r\n\r\n    restoreFrom(data) {\r\n        data.image = new GameImage(data.src || data.image.src);\r\n\r\n        return new Sprite(data);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  fromFile(file_path)\r\n     *  -TODO : complete this function based on code to load Sprite() from file, located in the spritemaker.html file\r\n     *  -TODO: test this function\r\n     ***************************/\r\n\r\n    fromFile(file_path) {\r\n\r\n        if (typeof file_path == 'string') {\r\n\r\n            var __inst = this;\r\n\r\n            $.getJSON(file_path, function (data) {\r\n\r\n                __inst = new Sprite(data);\r\n\r\n            });\r\n        }\r\n    }\r\n\r\n    toJSONString()\r\n    {\r\n        for(var x = 0; x < this.motions.length; x++)\r\n        {\r\n            this.motions[x].parent = false;\r\n        }\r\n\r\n        return jstr(this);\r\n    }\r\n\r\n}\r\n;\r\n\r\n/****************\r\n * TODO : Complete SpritePresetsOptions::\r\n *  Use these as options for Sprite Control, etc...\r\n ****************/\r\n\r\nGamestack.Sprite = Sprite;\r\n\r\nlet SpriteInitializersOptions = {\r\n\r\n    Clastics:{\r\n\r\n        top_collideable:function(sprite)\r\n        {\r\n\r\n            for(var x in Gamestack.__gameWindow.forces)\r\n            {\r\n                var force = Gamestack.__gameWindow.forces[x];\r\n\r\n                force.topClastics.push(sprite);\r\n\r\n            }\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        fourside_collideable:function(sprite)\r\n        {\r\n\r\n            for(var x in Gamestack.__gameWindow.forces)\r\n            {\r\n                var force = Gamestack.__gameWindow.forces[x];\r\n\r\n                force.clasticObjects.push(sprite);\r\n\r\n            }\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n    },\r\n\r\n    MainGravity:{\r\n\r\n        very_light:function(sprite)\r\n        {\r\n            //Add a gravity to the game\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"very_light_grav\",\r\n                accel:0.05,\r\n                max:new Vector3(0, 3.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        light:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"light_grav\",\r\n                accel:0.1,\r\n                max:new Vector3(0, 4.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        medium:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"medium_grav\",\r\n                accel:0.2,\r\n                max:new Vector3(0, 7.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n\r\n        strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.4,\r\n                max:new Vector3(0, 10.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        very_strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.5,\r\n                max:new Vector3(0, 12.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n    },\r\n\r\n\r\n    ControllerStickMotion: {\r\n\r\n        player_move_x: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                spr.decelX(0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_move_xy: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    x = 0;\r\n                }\r\n\r\n                if (Math.abs(y) < 0.2) {\r\n                    y = 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                sprite.accelY(accel, y * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.speed, 'x', 0.1);\r\n\r\n                sprite.decel(sprite.speed, 'y', 0.1);\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_rotate_x: function (sprite) {\r\n\r\n            let __lib = Gamestack || Quick2d;\r\n\r\n            Gamestack.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.25; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accel(sprite.rot_speed, 'x', accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.rot_speed, 'x', 0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\nGamestack.options = Gamestack.options || {};\r\n\r\nGamestack.options.SpriteInitializers = SpriteInitializersOptions;;\r\n/**\r\n * Takes arguments of x, y, and (optionally) z, instantiates Vector object\r\n\r\n <ul>\r\n <li>Optional: use a Vector as the 'x' argument, and instantiate new distinct Vector from the argument</li>\r\n </ul>\r\n\r\n * @param   {number} x the x coordinate\r\n * @param   {number} y the y coordinate\r\n * @param   {number} z the z coordinate\r\n * @returns {Vector} a Vector object\r\n */\r\n\r\n\r\nclass Vector {\r\n    constructor(x, y, z, r) {\r\n\r\n        if(typeof(x) == 'object' && x.hasOwnProperty('x') && x.hasOwnProperty('y')) //optionally pass vector3\r\n        {\r\n            this.x = x.x;\r\n            this.y = x.y;\r\n            this.z = x.z || 0;\r\n\r\n            if(this.z == null)\r\n            {\r\n                this.z = 0;\r\n            }\r\n\r\n            return this;\r\n        }\r\n\r\n        if(z == null){z = 0;}\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.r = r;\r\n\r\n    }\r\n\r\n\r\n    sub(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x - v.x, this.y - v.y, this.z - v.z);\r\n\r\n    }\r\n\r\n    add(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x + v.x, this.y + v.y, this.z + v.z);\r\n\r\n    }\r\n\r\n    mult(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x * v.x, this.y * v.y, this.z * v.z);\r\n\r\n    }\r\n    div(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector(this.x / v.x, this.y / v.y, this.z / v.z);\r\n    }\r\n\r\n    round()\r\n    {\r\n        return new Vector(Math.round(this.x), Math.round(this.y), Math.round(this.z));\r\n\r\n    }\r\n    floor()\r\n    {\r\n        return new Vector(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z));\r\n\r\n    }\r\n    ceil()\r\n    {\r\n        return new Vector(Math.ceil(this.x), Math.ceil(this.y), Math.ceil(this.z));\r\n\r\n    }\r\n\r\n    equals(v)\r\n    {\r\n\r\n        return this.x == v.x && this.y == v.y && this.z == v.z;\r\n    }\r\n\r\n    trig_distance_xy(v)\r\n    {\r\n\r\n        var dist = this.sub(v);\r\n\r\n        return  Math.sqrt( dist.x * dist.x + dist.y * dist.y );\r\n\r\n    }\r\n\r\n    diff()\r\n    {\r\n        //TODO:this function\r\n\r\n\r\n    }\r\n\r\n    abs_diff()\r\n    {\r\n        //TODO:this function\r\n\r\n    }\r\n\r\n    is_between(v1, v2)\r\n    {\r\n       //TODO : overlap vectors return boolean\r\n\r\n        return this.x >= v1.x && this.x <= v2.x &&\r\n            this.y >= v1.y && this.y <= v2.y &&\r\n            this.z >= v1.z && this.z <= v2.z;\r\n\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\nlet Vector3 = Vector, Pos = Vector, Size = Vector, Position = Vector, Vector2 = Vector, Rotation = Vector;\r\n\r\n\r\nGamestack.Vector = Vector;\r\n\r\n\r\n//The above are a list of synonymous expressions for Vector. All of these do the same thing in this library (store x,y,z values)\r\n"]}