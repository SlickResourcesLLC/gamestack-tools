{"version":3,"sources":["../../../ecma/GameStack/concat/GameStack.js"],"names":["CanvasLib","__levelMaker","draw","sprite","ctx","active","onScreen","__gameStack","WIDTH","HEIGHT","drawPortion","drawFrameWithRotation","img","fx","fy","fw","fh","x","y","width","height","deg","canvasContextObj","flip","save","Math","round","rad","PI","translate","rotate","scale","drawImage","restore","frame","selected_animation","selected_frame","console","error","p","position","camera","__gameWindow","pos","z","targetSize","size","realWidth","realHeight","hasOwnProperty","offset","rotation","image","domElement","framePos","frameSize","flipX","Canvas","Sound","src","sound","Audio","onLoad","val","volume","play","GameImage","onCreate","Object","document","createElement","ext","substring","lastIndexOf","length","onerror","__error","onload","SystemType","constructor","name","index","GameStackLibrary","lib","DEBUG","gui_mode","__sprites","__animations","spriteTypes","systemSpriteTypes","systemAnimationTypes","attack_0","attack_1","attack_2","attack_3","attack_4","defend_0","defend_1","defend_2","defend_3","defend_4","heal_0","heal_1","heal_2","heal_3","heal_4","samples","log_modes","log_mode","recursionCount","__gameWindowList","create_id","d","Date","getTime","performance","now","replace","c","r","random","floor","toString","getActionablesCheckList","__inst","actionables","$Q","each","sprites","ix","item","concat","sounds","motionstacks","animations","interlog","message","div","isNaN","quit","Error","info","m","GameStack","log","animate","time","isAtPlay","TWEEN","update","requestAnimationFrame","clearRect","canvas","start","Collision","spriteRectanglesCollide","obj1","obj2","paddingX","padding","paddingY","left","right","top","bottom","_gameWindow","setGameWindow","gameWindow","getGameWindow","assignAll","object","args","keys","list","onResult","onComplete","i","ready_callstack","ready","callback","push","callReady","funx","call","InputEvents","init","getArg","key","fallback","add","obj","GameWindow","Force","forces","Camera","Sprite","collect","remove","indexOf","splice","all_objects","isNormalStringMatch","str1","str2","toLowerCase","instance_type_pairs","objectList","constructor_name","type","getById","id","select","objects_out","Gamestack","Quick2d","Quazar","QUAZAR","__gameInstance","jstr","JSON","stringify","selector","$GFunx","objects","on","evt_key","selectorObject","controller_ix","criterion","between","cparts","split","__targetType","__targetName","before","trim","parseFloat","alert","evt_profile","cix","contains_any","button_mode","GamepadAdapter","item1","iy","item2","onUpdate","collidesRectangular","condition","evt_parts","run","mykey","number","e","propkey","spr","object_out","s","mainSelector","msfChar","__targetClassName","output","cleanSelectorString","str","after","getParts","complete","c1","test_str","start_pos","end_pos","contains","contains_all","cList","c2","test_selector_method","Q_TestStrings","test","mousemove","leftclick","rightclick","middleclick","wheelup","wheelDown","space","tab","shift","enter","extend","onFinish","cleanKey","down","up","getMousePos","pageX","pageY","clientX","body","scrollLeft","documentElement","clientY","scrollTop","offsetLeft","style","fullMoveInputEvents","event","Array","el","onkeydown","value","String","fromCharCode","keyCode","onkeyup","onmousedown","which","preventDefault","onmouseup","addEventListener","window","_preGameStack_windowLoad","backgrounds","interactives","append","background","getContext","adjustSize","onresize","target","w","h","clientWidth","clientHeight","listout","player","def_update","filepath","$","getJSON","data","_gw","TextDisplay","widthFloat","heightFloat","topFloat","targetTop","get_float_pixels","leftFloat","targetLeft","color","text","fontFamily","font","fadeIn","fade","border","fontSize","fromLeft","fromRight","fromTop","fromBottom","duration","stay_duration","float","dimen","fun","display","textAlign","zIndex","innerText","textContent","opacity","Velocity","easing","setTimeout","ItemDisplay","Vector3","textSize","text_id","img_id","getElementById","v","setAttribute","innerHTML","Bar","backgroundSize","backgroundPosition","BarFill","BarDisplay","fill_src","fill","fill_width","fill_height","fill_color","bar_src","bar","bar_width","bar_height","bar_color","f","VideoDisplay","undefined","Animation","_anime","defaultArgs","description","frames","delay","frameBounds","VectorFrameBounds","frameOffset","earlyTerm","hang","extras","apply2DFrames","parent","effects","timer","__gameLogic","setType","__frametype","fcount","quitLoop","min","max","termPoint","resetFrames","engage","tween","Tween","curve","Easing","Linear","None","to","isComplete","Extras","items","allowedTypes","fire","process","GravityForce","subjects","clasticObjects","accel","itemx","accelY","__inAir","itemy","collide_stop","__gamepads","intervals","controller_stack","_gpinst","events","setInterval","gps","navigator","getGamepads","clearInterval","game_pad_index","game_pad","gp","stick_left","stick_right","buttons","extendFunc","f1","f2","fc","current_cb","parts","parseInt","gpEvents","process_buttons","process_axes","axes","axis1","axia2","ceil","pressed","clearance_1","gpc","bkey","gamepads","gpix","GamepadEvents","GravityAction","Graviton","GravitationalRay","Motion","distance","curvesList","curvesObject","parent_id","object_id","Quadratic","InOut","targetRotation","curveString","getCurveString","setCurve","line","easeType","cps","s1","s2","tweens","Game","targetR","Elastic","__tweenObject","t","context","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","position_old","Rectangle","VectorBounds","Circle","radius","getArgs","__initializers","_spr","motions","collision_bounds","speed","acceleration","rot_speed","rot_accel","onInit","setAnimation","options","SpriteInitializers","f_init","framesize","__mapSize","mx","my","currentSize","wth","htw","anime","keyString1","keyString2","extendedFunc","ef","prep_key","animation","bullet","rot_offset","bx","by","bw","bh","shot","stats","damage","cos","sin","subsprite","abs","assertSpeed","diff","prop","rate","amt","diff_min_y","diff_min_x","diff_max_y","diff_max_x","dimens","minkey","apart","ct","diffX","center","sub","distX","overlap_x","diffY","distY","overlap_y","collide_stop_x","file_path","SpriteInitializersOptions","Collideables","top_collideable","fourside_collideable","force","MainGravity","very_light","gravity","light","medium","strong","very_strong","ControllerStickMotion","__args","player_move_x","__lib","accelX","decelX","__falling","decelY","player_move_xy","decel","player_rotate_x","Vector","v1","v2","Pos","Size","Position","Vector2","Rotation","InterfaceCallback","SpeechInterfaceStructure","options_structure","scroll","create_object_resource","constructors","IF","__allConstructors","selectedType","selectByName","apply_speech_value","applySpeechValue","save_object_resource","selected_object","confirm","confirmation","retrieve_object_resource","browse_object_resources","search_object_resources","delete_object_resources","apply_value"],"mappings":"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","file":"GameStack.js","sourcesContent":["\r\n/*\r\n * Canvas\r\n *    draw animations, textures to the screen\r\n * */\r\n\r\n\r\nvar CanvasLib = function() {\r\n\r\n    return {\r\n\r\n        __levelMaker: false,\r\n\r\n        draw: function (sprite, ctx) {\r\n\r\n            if (sprite.active && (this.__levelMaker || sprite.onScreen(__gameStack.WIDTH, __gameStack.HEIGHT))) {\r\n\r\n                this.drawPortion(sprite, ctx);\r\n\r\n            }\r\n\r\n        },\r\n        drawFrameWithRotation: function (img, fx, fy, fw, fh, x, y, width, height, deg, canvasContextObj, flip) {\r\n\r\n            canvasContextObj.save();\r\n            deg = Math.round(deg);\r\n            deg = deg % 360;\r\n            var rad = deg * Math.PI / 180;\r\n            //Set the origin to the center of the image\r\n            canvasContextObj.translate(x, y);\r\n            canvasContextObj.rotate(rad);\r\n            //Rotate the canvas around the origin\r\n\r\n            canvasContextObj.translate(0, canvasContextObj.width);\r\n            if (flip) {\r\n\r\n                canvasContextObj.scale(-1, 1);\r\n            } else {\r\n\r\n            }\r\n\r\n            //draw the image\r\n            canvasContextObj.drawImage(img, fx, fy, fw, fh, width / 2 * (-1), height / 2 * (-1), width, height);\r\n            //reset the canvas\r\n\r\n            canvasContextObj.restore();\r\n        },\r\n\r\n\r\n        /*\r\n         * drawPortion:\r\n         *\r\n         *   expects: (sprite{selected_animation{selected_frame{frameSize, framePos } offset?, gameSize? }  })\r\n         *\r\n         *\r\n         * */\r\n\r\n\r\n        drawPortion: function (sprite, ctx) {\r\n\r\n            var frame;\r\n\r\n            if (sprite.active) {\r\n\r\n                if (sprite.selected_animation && sprite.selected_animation.selected_frame) {\r\n\r\n                    frame = sprite.selected_animation.selected_frame;\r\n\r\n                }\r\n                else {\r\n\r\n                    console.error('Sprite is missing arguments');\r\n\r\n                }\r\n\r\n                var p = sprite.position;\r\n\r\n                var camera = __gameStack.__gameWindow.camera || {pos: {x: 0, y: 0, z: 0}};\r\n\r\n                var x = p.x, y = p.y;\r\n\r\n\r\n                x -= camera.position.x || 0;\r\n                y -= camera.position.y || 0;\r\n                //optional animation : gameSize\r\n\r\n                var targetSize = sprite.size || sprite.selected_animation.size;\r\n\r\n                var realWidth = targetSize.x;\r\n                var realHeight = targetSize.y;\r\n\r\n                //optional animation : offset\r\n\r\n                if (sprite.selected_animation && sprite.selected_animation.hasOwnProperty('offset')) {\r\n                    x += sprite.selected_animation.offset.x;\r\n\r\n                    y += sprite.selected_animation.offset.y;\r\n\r\n                }\r\n\r\n                var rotation;\r\n\r\n                if (typeof(sprite.rotation) == 'object') {\r\n\r\n                    rotation = sprite.rotation.x;\r\n\r\n\r\n                }\r\n                else {\r\n                    rotation = sprite.rotation;\r\n\r\n                }\r\n\r\n\r\n                this.drawFrameWithRotation(sprite.selected_animation.image.domElement, frame.framePos.x, frame.framePos.y, frame.frameSize.x, frame.frameSize.y, Math.round(x + (realWidth / 2)), Math.round(y + (realHeight / 2)), realWidth, realHeight, rotation % 360, ctx, sprite.flipX);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nlet Canvas = CanvasLib();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n/**\r\n * Sound\r\n * :Simple Sound object:: uses Jquery: audio\r\n * @param   {string} src : source path / name of the targeted sound-file\r\n\r\n * @returns {Sound} object of Sound()\r\n * */\r\n\r\nclass Sound {\r\n\r\n    constructor(src) {\r\n\r\n        if (typeof(src) == 'object') {\r\n\r\n            for (var x in src) {\r\n                this[x] = src[x];\r\n\r\n            }\r\n\r\n            this.sound = new Audio(src.src);\r\n\r\n            this.onLoad = src.onLoad || function () {\r\n                };\r\n\r\n        }\r\n\r\n        else if (typeof(src) == 'string') {\r\n\r\n            this.src = src;\r\n\r\n            this.sound = new Audio(this.src);\r\n\r\n        }\r\n\r\n        this.onLoad = this.onLoad || function () {\r\n            };\r\n\r\n        if (typeof(this.onLoad) == 'function') {\r\n\r\n            this.onLoad(this.sound);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    volume(val)\r\n    {\r\n\r\n        this.sound.volume = val;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    play() {\r\n        if (typeof(this.sound) == 'object' && typeof(this.sound.play) == 'function') {\r\n\r\n            this.sound.play();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * GameImage\r\n *\r\n * Simple GameImage\r\n * @param   {string} src : source path / name of the targeted image-file\r\n\r\n * @returns {GameImage} object of GameImage()\r\n\r\n * */\r\n\r\nclass GameImage {\r\n\r\n    constructor(src, onCreate) {\r\n\r\n        // GameStack.log('initializing image');\r\n\r\n        if (src instanceof Object) {\r\n\r\n            //alert('getting image from image');\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src.src;\r\n\r\n            this.src = src.src;\r\n\r\n        }\r\n\r\n        else if (typeof(src) == 'string') {\r\n\r\n            let ext = src.substring(src.lastIndexOf('.'), src.length);\r\n\r\n            this.image = document.createElement('IMG');\r\n\r\n            this.image.src = src;\r\n\r\n            this.src = this.image.src;\r\n\r\n\r\n        }\r\n\r\n\r\n        if (!this.image) {\r\n            this.image = {error: \"Image not instantiated, set to object by default\"};\r\n\r\n        }\r\n        else {\r\n            this.image.onerror = function () {\r\n                this.__error = true;\r\n            };\r\n\r\n        }\r\n\r\n        this.domElement = this.image;\r\n\r\n        this.image.onload = function () {\r\n\r\n            if (typeof(this.onCreate) == 'function') {\r\n\r\n                this.onCreate(this.image);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    getImage() {\r\n        return this.image;\r\n    }\r\n\r\n}\r\n\r\n\r\nlet SystemType = function(constructor, name, index)\r\n{\r\n\r\n    return{\r\n\r\n        constructor:constructor,\r\n\r\n        name:name,\r\n\r\n        index:index\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\nlet GameStackLibrary = function () {\r\n\r\n\r\n    var lib = {\r\n\r\n        DEBUG: false,\r\n\r\n        gui_mode: true,\r\n\r\n        __gameWindow: {}\r\n        ,\r\n\r\n        __sprites: [],\r\n\r\n        __animations: [],\r\n\r\n\r\n        spriteTypes:[],\r\n\r\n        systemSpriteTypes: ['player', 'enemy', 'background', 'interactive'],\r\n\r\n        systemAnimationTypes: {\r\n\r\n            attack_0:\"System.attack_0\",\r\n\r\n            attack_1:\"System.attack_1\",\r\n\r\n            attack_2:\"System.attack_2\",\r\n\r\n            attack_3:\"System.attack_3\",\r\n\r\n            attack_4:\"System.attack_4\",\r\n\r\n            defend_0:\"System.defend_0\",\r\n\r\n            defend_1:\"System.defend_1\",\r\n\r\n            defend_2:\"System.defend_2\",\r\n\r\n            defend_3:\"System.defend_3\",\r\n\r\n            defend_4:\"System.defend_4\",\r\n\r\n            heal_0:\"System.heal_0\",\r\n\r\n            heal_1:\"System.heal_1\",\r\n\r\n            heal_2:\"System.heal_2\",\r\n\r\n            heal_3:\"System.heal_3\",\r\n\r\n            heal_4:\"System.heal_4\",\r\n\r\n        },\r\n\r\n\r\n        samples: {}\r\n        ,\r\n\r\n        log_modes: ['reqs', 'info', 'warning'],\r\n\r\n        log_mode: \"all\",\r\n\r\n        recursionCount: 0,\r\n\r\n        __gameWindowList: [],\r\n\r\n\r\n        create_id: function () {\r\n\r\n            var d = new Date().getTime();\r\n            if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n                d += performance.now(); //use high-precision timer if available\r\n            }\r\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                var r = (d + Math.random() * 16) % 16 | 0;\r\n                d = Math.floor(d / 16);\r\n                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n            });\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        getActionablesCheckList: function () {\r\n            //every unique sound, animation, tweenmotion in the game\r\n\r\n            let __inst = {};\r\n\r\n            let actionables = [];\r\n\r\n            $Q.each(this.sprites, function (ix, item) {\r\n\r\n                actionables.concat(item.sounds);\r\n\r\n                actionables.concat(item.motionstacks);\r\n\r\n                actionables.concat(item.animations);\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        interlog: function (message, div) //recursive safe :: won't go crazy with recursive logs\r\n        {\r\n            this.recursionCount++;\r\n\r\n            if (!isNaN(div) && this.recursionCount % div == 0) {\r\n                //   console.log('Interval Log:'+  message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        error: function (quit, message) {\r\n\r\n            if (quit) {\r\n                throw new Error(message);\r\n\r\n            }\r\n            else {\r\n                console.error('E!' + message);\r\n\r\n            }\r\n\r\n        }\r\n        ,\r\n\r\n        info: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.info('Info:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n\r\n        log: function (m) {\r\n\r\n            if (GameStack.DEBUG) {\r\n\r\n                console.log('GameStack:' + m);\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n        //animate() : main animation call, run the once and it will recurse with requestAnimationFrame(this.animate);\r\n\r\n        animate: function (time) {\r\n\r\n            __gameStack.isAtPlay = true;\r\n\r\n\r\n            TWEEN.update(time);\r\n\r\n            requestAnimationFrame(__gameStack.animate);\r\n\r\n            __gameStack.__gameWindow.update();\r\n\r\n            __gameStack.__gameWindow.ctx.clearRect(0, 0, __gameStack.__gameWindow.canvas.width, __gameStack.__gameWindow.canvas.height);\r\n\r\n            __gameStack.__gameWindow.draw();\r\n\r\n        }\r\n        ,\r\n\r\n        start: function () {\r\n\r\n            this.animate();\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        Collision: {\r\n\r\n            spriteRectanglesCollide(obj1, obj2)\r\n            {\r\n\r\n\r\n               var paddingX = Math.round(obj1.padding.x * obj1.size.x),\r\n\r\n                   paddingY =Math.round(obj1.padding.y * obj1.size.y), left = obj1.position.x + paddingX, right = obj1.position.x + obj1.size.x - paddingX,\r\n\r\n               top = obj1.position.y + paddingY, bottom = obj1.position.y + obj1.size.y - paddingY;\r\n\r\n                if (right > obj2.position.x && left < obj2.position.x + obj2.size.x &&\r\n                   bottom > obj2.position.y && top < obj2.position.y + obj2.size.y) {\r\n\r\n                    return true;\r\n\r\n                }\r\n\r\n            }\r\n        }\r\n        ,\r\n\r\n        TWEEN: TWEEN,\r\n\r\n        _gameWindow: {}\r\n        ,\r\n\r\n        setGameWindow: function (gameWindow) {\r\n\r\n            this._gameWindow = gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n        getGameWindow: function () {\r\n\r\n\r\n            return this._gameWindow;\r\n\r\n        }\r\n        ,\r\n\r\n        assignAll: function (object, args, keys) {\r\n\r\n            __gameStack.each(keys, function (ix, item) {\r\n\r\n                object[ix] = args[ix];\r\n\r\n            });\r\n\r\n\r\n        }\r\n        ,\r\n\r\n\r\n        each: function (list, onResult, onComplete) {\r\n            for (var i in list) {\r\n                onResult(i, list[i]);\r\n            }\r\n\r\n            if (typeof(onComplete) === 'function') {\r\n                onComplete(false, list)\r\n            }\r\n            ;\r\n\r\n        }\r\n        ,\r\n\r\n        ready_callstack: [],\r\n\r\n        ready: function (callback) {\r\n\r\n            this.ready_callstack.push(callback);\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        callReady: function () {\r\n\r\n            var funx = this.ready_callstack;\r\n\r\n            var gameWindow = this._gameWindow, lib = this, sprites = this.__gameWindow.sprites;\r\n\r\n            //call every function in the ready_callstack\r\n\r\n\r\n            this.each(funx, function (ix, call) {\r\n\r\n                call(lib, gameWindow, sprites);\r\n\r\n            });\r\n\r\n            this.InputEvents.init();\r\n\r\n\r\n        }\r\n        ,\r\n\r\n        getArg: function (args, key, fallback) {\r\n            if (args && args.hasOwnProperty(key)) {\r\n                return args[key];\r\n            }\r\n            else {\r\n                return fallback;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        add: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            if (obj instanceof GameWindow) {\r\n\r\n                this.__gameWindow = obj;\r\n\r\n            }\r\n\r\n            if (obj instanceof Force) {\r\n\r\n                this.__gameWindow.forces.push(obj);\r\n\r\n            }\r\n\r\n\r\n            if (obj instanceof Camera) {\r\n\r\n                this.__gameWindow.camera = obj;\r\n\r\n            }\r\n\r\n\r\n            if (obj instanceof Sprite) {\r\n\r\n                this.__gameWindow.sprites.push(obj);\r\n\r\n            }\r\n\r\n            this.collect(obj);\r\n\r\n            return obj;\r\n\r\n        }\r\n\r\n        ,\r\n\r\n        remove: function (obj) {\r\n            //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n            if (obj instanceof Sprite) {\r\n\r\n                var ix = this.__gameWindow.sprites.indexOf(obj);\r\n\r\n                this.__gameWindow.sprites.splice(ix, 1);\r\n\r\n            }\r\n\r\n        },\r\n\r\n        all_objects: [],\r\n\r\n        collect: function (obj) {\r\n\r\n            this.all_objects.push(obj);\r\n\r\n        },\r\n\r\n\r\n        isNormalStringMatch: function (str1, str2) {\r\n\r\n            return str1.toLowerCase().replace(' ', '') == str2.toLowerCase().replace(' ', '');\r\n\r\n        },\r\n\r\n        instance_type_pairs: function () {\r\n            //get an array of all instance/type pairs added to the library\r\n\r\n            //example : [ {constructor_name:Sprite, type:enemy_basic}, {constructor_name:Animation, type:enemy_attack}  ];\r\n\r\n            var objectList = [];\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n\r\n                objectList.push({constructor_name: item.constructor.name, type: item.type});\r\n\r\n            });\r\n\r\n            return objectList;\r\n\r\n        },\r\n\r\n        getById:function(id){\r\n\r\n\r\n            for(var x in this.all_objects)\r\n            {\r\n\r\n                if(this.all_objects[x].id == id)\r\n                {\r\n                    return this.all_objects[x];\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n\r\n\r\n        },\r\n\r\n        select: function (constructor_name, name, type /*ignoring spaces and CAPS/CASE on type match*/) {\r\n\r\n\r\n            var objects_out = [];\r\n\r\n\r\n            var __inst = this;\r\n\r\n            this.each(this.all_objects, function (ix, item) {\r\n\r\n                if (constructor_name == '*' || item.constructor.name == constructor_name) {\r\n\r\n                    if (type == '*' || __inst.isNormalStringMatch(type, item.type)) {\r\n\r\n                        if (name == '*' || __inst.isNormalStringMatch(name, item.name)) {\r\n\r\n                            objects_out.push(item);\r\n\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            });\r\n\r\n            return objects_out;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    return lib;\r\n\r\n};\r\n\r\n//GameStack: a main / game lib object::\r\n//TODO: fix the following set of mixed references:: only need to refer to (1) lib instance\r\n\r\nlet GameStack = new GameStackLibrary();\r\n\r\nlet Gamestack = GameStack;\r\n\r\nlet __gameStack = GameStack;\r\n\r\nlet Quick2d = GameStack; //Exposing 'Quick2d' as synonymous reference to GameStack\r\n\r\nlet Quazar = GameStack; //Exposing 'Quazar' as synonymous reference to GameStack\r\n\r\nlet QUAZAR = GameStack; //Exposing 'QUAZAR' as synonymous reference to GameStack\r\n\r\nlet __gameInstance = GameStack;\r\n\r\n/***************\r\n * TODO : fix the above duplicate references, which exist now for backward compatibility with previouslyh authored code\r\n *\r\n *  -apply find and replace accross the codebase\r\n *\r\n * ****************/\r\n\r\n/********\r\n * jstr() : public function for stringified objects and arrays (uses pretty print style)\r\n * *********/\r\n\r\nfunction jstr(obj) {\r\n\r\n    return JSON.stringify(obj);\r\n\r\n};\r\n\r\n/**********\r\n * $Q : Selector Function *in development\r\n *  -allows string selection of library collections, etc...\r\n * Example Calls\r\n * **********/\r\n\r\nfunction $Q(selector) {\r\n\r\n    //declare events:\r\n\r\n\r\n    var $GFunx = {};\r\n\r\n    $GFunx.each = function(callback)\r\n    {\r\n\r\n        var objects = [];\r\n\r\n        for(var x = 0; x < this.length; x++)\r\n        {\r\n            if(typeof x == 'number')\r\n            {\r\n\r\n                callback(x, this[x]);\r\n            }\r\n\r\n        }\r\n\r\n\r\n    };\r\n\r\n    $GFunx.on = function (evt_key, selectorObject, controller_ix, callback) //handle each event such as on('collide') OR on('stick_left_0') << first controller stick_left\r\n    {\r\n\r\n        if(__gameStack.isAtPlay)\r\n        {\r\n            return console.error('Cannot call $Q().on while game is at play. Please rig your events before gameplay.');\r\n\r\n        }\r\n\r\n        var criterion = $Q.between('[', ']', evt_key);\r\n\r\n        if(criterion.indexOf('===') >= 0)\r\n        {\r\n            criterion = criterion.replace('===', '=');\r\n        }\r\n\r\n        if(criterion.indexOf('==') >= 0)\r\n        {\r\n            criterion =  criterion.replace('==', '=').replace('==', 0);\r\n        }\r\n\r\n       var cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n        if(evt_key.indexOf('[') >= 0)\r\n        {\r\n            evt_key = $Q.before('[', evt_key).trim();\r\n\r\n        }\r\n\r\n\r\n        var padding = 0;\r\n\r\n        if(cparts[0].toLowerCase() == 'padding')\r\n        {\r\n\r\n            padding = parseFloat(cparts[1]);\r\n\r\n            alert('padding:' + padding);\r\n\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then controller_ix is the callback aka optional argument\r\n\r\n        if(controller_ix && typeof controller_ix == 'function' && !callback)\r\n        {\r\n            callback = controller_ix;\r\n            controller_ix = 0;\r\n        }\r\n\r\n        //if controller_ix is function, and callback not present, then selectorObject is the callback aka optional argument\r\n\r\n        if(selectorObject && typeof selectorObject == 'function' && !callback)\r\n        {\r\n\r\n            callback = selectorObject;\r\n\r\n            selectorObject = $Q('*');\r\n\r\n            controller_ix = 0;\r\n        };\r\n\r\n        var evt_profile = {};\r\n\r\n        //which controller?\r\n\r\n        evt_profile.cix = controller_ix;\r\n\r\n        //Need the control key: 'left_stick', 'button_0', etc..\r\n\r\n        evt_profile.evt_key = evt_key;\r\n\r\n        if($Q.contains_any(['stick', 'button', 'click', 'key'], evt_profile.evt_key))\r\n        {\r\n\r\n            var button_mode = evt_profile.evt_key.indexOf('button') >= 0;\r\n\r\n            Quazar.GamepadAdapter.on(evt_profile.evt_key, 0, function (x, y) {\r\n\r\n               callback(x, y);\r\n\r\n            });\r\n\r\n            console.info('detected input event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig events');\r\n\r\n        }\r\n\r\n        //TODO: test collision events:\r\n\r\n      else if($Q.contains_any(['collide', 'collision', 'hit', 'touch'],  evt_profile.evt_key))\r\n        {\r\n\r\n            console.info('Rigging a collision event');\r\n\r\n            console.info('detected collision event key in:' +  evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig collision events');\r\n\r\n            this.each(function(ix, item1){\r\n\r\n                selectorObject.each(function(iy, item2){\r\n\r\n                    if(typeof(item1.onUpdate) == 'function')\r\n                    {\r\n\r\n                        item1.onUpdate(function(sprite){\r\n\r\n                            if(item1.collidesRectangular(item2, padding))\r\n                            {\r\n\r\n                              callback(item1, item2);\r\n\r\n                            };\r\n\r\n                        });\r\n\r\n                    }\r\n\r\n\r\n                });\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n       else {\r\n            console.info('Rigging a property event');\r\n\r\n            //TODO: test property-watch events:\r\n\r\n            console.info('detected property threshhold event key in:' + evt_profile.evt_key);\r\n\r\n            console.info('TODO: rig property events');\r\n\r\n            var condition = \"_\", key = evt_profile.evt_key;\r\n\r\n            if(key.indexOf('[') >= 0 || key.indexOf(']') >= 0)\r\n            {\r\n                key = key.replace('[', '').replace('[', ']');\r\n\r\n            }\r\n\r\n            var evt_parts = [];\r\n\r\n            var run = function()\r\n            {\r\n                console.error('Sprite property check was not set correctly');\r\n\r\n            };\r\n\r\n            if(key.indexOf('>=') >= 0)\r\n            {\r\n                condition = \">=\";\r\n\r\n\r\n            }\r\n           else if(key.indexOf('<=') >= 0)\r\n            {\r\n                condition = \"<=\";\r\n            }\r\n           else if(key.indexOf('>') >= 0)\r\n            {\r\n                condition = \">\";\r\n            }\r\n          else if(key.indexOf('<') >= 0)\r\n            {\r\n                condition = \"<\";\r\n            }\r\n\r\n            else if(key.indexOf('=') >= 0)\r\n            {\r\n                condition = \"=\";\r\n            }\r\n\r\n            evt_parts = key.split(condition);\r\n\r\n            for(var x = 0; x < evt_parts.length; x++)\r\n            {\r\n                evt_parts[x] = evt_parts[x].replace('=', '').replace('=', '').trim(); //remove any trailing equals and trim()\r\n\r\n            }\r\n\r\n            var mykey, number;\r\n\r\n           // alert(evt_parts[0]);\r\n\r\n            try{\r\n\r\n            mykey = evt_parts[0];\r\n\r\n            number = parseFloat(evt_parts[1]);\r\n\r\n            }\r\n            catch(e)\r\n            {\r\n                console.log(e);\r\n            }\r\n\r\n            console.info('Processing condition with:' + condition);\r\n\r\n            switch(condition)\r\n            {\r\n\r\n                case \">=\":\r\n\r\n\r\n                    run = function(obj, key){ if(obj[key] >= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] <= number){ callback(); } };\r\n\r\n                    break;\r\n\r\n\r\n                case \">\":\r\n\r\n                    run = function(obj, key){ if(obj[key] > number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"<\":\r\n\r\n                    run = function(obj, key){ if(obj[key] < number){ callback(); } };\r\n\r\n                    break;\r\n\r\n                case \"=\":\r\n\r\n                    run = function(obj, key){ if(obj[key] == number){ callback(); } };\r\n\r\n                    break;\r\n\r\n            }\r\n\r\n\r\n            /************\r\n             * Attach update to each member\r\n             *\r\n             * **************/\r\n\r\n            var keys = mykey.split('.'), propkey = \"\";\r\n\r\n            this.each(function(ix, item){\r\n\r\n                var object = {};\r\n\r\n                if(keys.length == 1)\r\n                {\r\n                    object = item;\r\n\r\n                    propkey = mykey;\r\n\r\n                }\r\n                else if(keys.length == 2)\r\n                {\r\n                    object = item[keys[0]];\r\n\r\n                    propkey = keys[1];\r\n\r\n\r\n                }\r\n\r\n                else if(keys.length == 3)\r\n                {\r\n                    object = item[keys[0]][keys[1]];\r\n\r\n                    propkey = keys[2];\r\n\r\n                }\r\n                else\r\n                {\r\n                    console.error(\":length of '.' notation out of range. We use max length of 3 or prop.prop.key.\");\r\n\r\n                }\r\n\r\n                if(typeof item.onUpdate == 'function')\r\n                {\r\n\r\n\r\n                    var spr = item;\r\n\r\n                    item.onUpdate(function(sprite){\r\n\r\n                        run(object, propkey);\r\n\r\n                    });\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n    };\r\n\r\n\r\n    var object_out = {};\r\n\r\n    //handle selector / selection of objects:\r\n\r\n    if(selector && selector !== '*')\r\n    {\r\n\r\n    var s = selector || '';\r\n\r\n    console.info('selector:' + s);\r\n\r\n    var mainSelector = $Q.before('[', s).trim(), msfChar = mainSelector.substring(0, 1);\r\n\r\n    var __targetClassName = \"*\";\r\n\r\n    var output = [];\r\n\r\n    var cleanSelectorString = function(str)\r\n    {\r\n        return str.replace(\",\", \"\");\r\n    };\r\n\r\n    switch (msfChar.toLowerCase()) {\r\n        case \".\":\r\n\r\n            console.info('Selecting by \".\" or class');\r\n\r\n            __targetClassName = cleanSelectorString($Q.after('.', mainSelector));\r\n\r\n            console.info('Target class is:' + __targetClassName);\r\n\r\n            break;\r\n\r\n        case \"*\":\r\n\r\n            console.info('Selecting by \"*\" or ANY object in the library instance');\r\n\r\n            __targetClassName = \"*\";\r\n\r\n            break;\r\n\r\n    }\r\n\r\n         var criterion = $Q.between('[', ']', s), cparts = criterion.split('=');\r\n\r\n        var  __targetType = \"*\", __targetName = \"*\";\r\n\r\n  var getParts = function() {\r\n\r\n      if(cparts.length >= 2) {\r\n\r\n          switch (cparts[0].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[1]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      if(cparts.length >= 4) {\r\n\r\n          cparts[2] = cparts[2].replace(\",\", \"\");\r\n\r\n          switch (cparts[2].toLowerCase()) {\r\n\r\n              case \"name\":\r\n\r\n                  //get all objects according to name=name\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetName =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n              case  \"type\":\r\n\r\n                  console.log('Detected parts in selector:' + jstr(cparts));\r\n\r\n                  __targetType =  cleanSelectorString(cparts[3]);\r\n\r\n                  break;\r\n\r\n          }\r\n\r\n      }\r\n\r\n      };\r\n\r\n  getParts(cparts);\r\n\r\n\r\n        object_out = GameStack.select(__targetClassName, __targetName, __targetType);\r\n    }\r\n   else if(selector == '*')\r\n    {\r\n        object_out = GameStack.all_objects;\r\n\r\n    }\r\n\r\n   for(var x in $GFunx)\r\n   {\r\n       object_out[x] = $GFunx[x];\r\n\r\n   };\r\n\r\n   return object_out;\r\n\r\n}\r\n\r\n\r\n$Q.each = function (obj, callback, complete) {\r\n\r\n    for(var x in obj)\r\n    {\r\n        callback(obj);\r\n\r\n    }\r\n\r\n    if(typeof(complete) == 'function')\r\n    {\r\n        complete(obj);\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\n$Q.before = function (c1, test_str) {\r\n    var start_pos = 0;\r\n    var end_pos = test_str.indexOf(c1, start_pos);\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n\r\n$Q.contains = function (c1, test_str) {\r\n    return test_str.indexOf(c1) >= 0;\r\n};\r\n\r\n$Q.contains_all = function (cList, test_str) {\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) < 0) {\r\n            return false;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n};\r\n\r\n$Q.contains_any = function (cList, test_str) {\r\n\r\n    for (var x = 0; x < cList.length; x++) {\r\n        if (test_str.indexOf(cList[x]) >= 0) {\r\n            return true;\r\n\r\n        }\r\n    }\r\n\r\n    return false;\r\n\r\n};\r\n\r\n$Q.after = function (c1, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.length;\r\n    return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n$Q.between = function (c1, c2, test_str) {\r\n    var start_pos = test_str.indexOf(c1) + 1;\r\n    var end_pos = test_str.indexOf(c2, start_pos);\r\n    return test_str.substring(start_pos, end_pos)\r\n};\r\n\r\n\r\n$Q.test_selector_method =  function () {\r\n    var Q_TestStrings = ['*', '.Sprite', '*[type=\"enemy_type_0\"]', '.Sprite[type=\"enemy_type_0\"]'];\r\n\r\n    for (var x = 0; x < Q_TestStrings.length; x++) {\r\n        var test = Q_TestStrings[x];\r\n\r\n        console.info('testing:' + test);\r\n\r\n        $Q(test);\r\n    }\r\n\r\n    console.log('Testing stick left');\r\n\r\n    this.on('stick_left_0');\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('button_0');\r\n\r\n\r\n    console.log('Testing collide');\r\n\r\n    this.on('collide');\r\n\r\n\r\n    console.log('Testing button');\r\n\r\n    this.on('collide');\r\n\r\n    console.log('Testing prop');\r\n\r\n    this.on('health>=0');\r\n\r\n\r\n};\r\n\r\n\r\n/********************\r\n * GameStack.InputEvents\r\n * -Various PC Input Events\r\n ********************/\r\n\r\nGameStack.InputEvents = { //PC input events\r\n    mousemove: [],\r\n    leftclick: [],\r\n    rightclick: [],\r\n    middleclick: [],\r\n    wheelup: [],\r\n    wheelDown: [],\r\n    space: [],\r\n    tab: [],\r\n    shift: [],\r\n    1: [], 2: [], 3: [],\r\n    enter: [],\r\n    extend: function (evt_key, callback, onFinish) {\r\n\r\n        if (evt_key.toLowerCase().indexOf('key_') >= 0) {\r\n            //process this as a key event\r\n\r\n            var cleanKey = evt_key.toLowerCase();\r\n            GameStack.InputEvents[cleanKey] = GameStack.InputEvents[cleanKey] || [];\r\n            return GameStack.InputEvents[cleanKey].push({down: callback, up: onFinish});\r\n        } else {\r\n\r\n            GameStack.InputEvents[evt_key] = GameStack.InputEvents[evt_key] || [];\r\n            return GameStack.InputEvents[evt_key].push({down: callback, up: onFinish});\r\n        }\r\n\r\n    },\r\n    init: function () {\r\n\r\n\r\n        function getMousePos(e) {\r\n\r\n            var x;\r\n            var y;\r\n            if (e.pageX || e.pageY) {\r\n                x = e.pageX;\r\n                y = e.pageY;\r\n            } else {\r\n                x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n                y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n            }\r\n            x -= GameStack.canvas.offsetLeft;\r\n            y -= GameStack.canvas.style.top;\r\n            return {x: x, y: y};\r\n        }\r\n\r\n\r\n        function fullMoveInputEvents(event) {\r\n\r\n            var pos = getMousePos(event);\r\n            var InputEvents = GameStack.InputEvents;\r\n            for (var x in InputEvents) {\r\n\r\n\r\n                if (InputEvents[x] instanceof Array && x == 'mousemove') {\r\n\r\n\r\n                    GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                        el.down(pos.x, pos.y);\r\n                    });\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n        ;\r\n        document.onkeydown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            GameStack.log('Got e');\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.log('Got []');\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.down) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.down();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n\r\n        document.onkeyup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = 'key_' + String.fromCharCode(e.keyCode).toLowerCase();\r\n            if (GameStack.InputEvents[value] instanceof Array) {\r\n\r\n                GameStack.each(GameStack.InputEvents[value], function (ix, item) {\r\n\r\n                    if (typeof (item.up) == 'function') {\r\n\r\n                        //   alert('RUNNING');\r\n\r\n                        item.up();\r\n                    }\r\n\r\n\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n\r\n        GameStack.canvas.onmousedown = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.down(pos.x, pos.y);\r\n                            });\r\n\r\n                            return false;\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n            e.preventDefault();\r\n            return 0;\r\n        };\r\n        GameStack.canvas.onmouseup = function (e) {\r\n\r\n            //    alert(JSON.stringify(GameStack.InputEvents, true, 2));\r\n\r\n            var value = e.which;\r\n            var pos = getMousePos(e);\r\n            var InputEvents = GameStack.InputEvents;\r\n\r\n\r\n            e.preventDefault();\r\n\r\n            switch (e.which) {\r\n                case 1:\r\n\r\n                    for (var x in InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                case 2:\r\n                    // alert('Middle Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n                        }\r\n\r\n\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    //  alert('Right Mouse button pressed.');\r\n\r\n\r\n                    for (var x in GameStack.InputEvents) {\r\n\r\n\r\n                        if (InputEvents[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                            GameStack.each(InputEvents[x], function (ix, el) {\r\n\r\n                                el.up(pos.x, pos.y);\r\n                            });\r\n\r\n\r\n                            return false;\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n\r\n                    break;\r\n                default:\r\n\r\n                    return 0;\r\n                //alert('You have a strange Mouse!');\r\n\r\n            }\r\n\r\n\r\n        };\r\n        document.addEventListener(\"mousemove\", fullMoveInputEvents);\r\n    }\r\n\r\n\r\n};\r\n\r\n\r\n__gameStack = QUAZAR;\r\n\r\n//Override the existing window.onload function\r\n\r\nwindow._preGameStack_windowLoad = window.onload;\r\n\r\nwindow.onload = function () {\r\n\r\n    if (typeof(window._preGameStack_windowLoad) == 'function') {\r\n        window._preGameStack_windowLoad();\r\n    }\r\n\r\n    __gameStack.callReady();\r\n\r\n}\r\n\r\n\r\n/*\r\n * Canvas\r\n *    draw animations, textures to the screen\r\n * */\r\n\r\nGameStack.ready(function (lib) {\r\n\r\n    GameStack.log('GameStack:lib :: ready');\r\n\r\n\r\n});\r\n\r\n\r\n/**\r\n *\r\n *  class: GameWindow:\r\n *  args{canvas, ctx, sprites, backgrounds, interactives, forces, update}\r\n */\r\n\r\n\r\nclass GameWindow {\r\n\r\n    constructor({canvas=false, ctx, sprites, backgrounds, interactives, forces, update, camera}={}) {\r\n\r\n        this.sprites = sprites instanceof Array ? sprites : [];\r\n\r\n        this.backgrounds = backgrounds instanceof Array ? backgrounds : [];\r\n\r\n        this.interactives = interactives instanceof Array ? interactives : [];\r\n\r\n        this.forces = forces instanceof Array ? forces : [];\r\n\r\n        this.canvas = canvas|| false;\r\n\r\n        document.body.style.position = \"absolute\";\r\n\r\n        document.body.style.width = \"100%\";\r\n\r\n        document.body.style.height = \"100%\";\r\n\r\n        if(!this.canvas)\r\n        {\r\n            console.info('creating new canvas');\r\n            this.canvas = document.createElement('CANVAS');\r\n\r\n            document.body.append(this.canvas);\r\n\r\n\r\n\r\n        }\r\n\r\n        this.canvas.style.position = 'absolute';\r\n\r\n        this.canvas.style.width = '100%';\r\n\r\n        this.canvas.style.height = '100%';\r\n\r\n        this.canvas.style.background = 'black';\r\n\r\n        var c = this.canvas;\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n\r\n        __gameStack.canvas = this.canvas;\r\n\r\n        __gameStack.ctx = this.ctx;\r\n\r\n\r\n        this.adjustSize();\r\n\r\n        window.onresize = function(){\r\n\r\n            __gameStack.__gameWindow.adjustSize();\r\n\r\n        };\r\n\r\n        this.camera = new Camera();\r\n\r\n        this.camera.target = false;\r\n\r\n        __gameStack.camera = this.camera;\r\n\r\n        if (typeof update == 'function') {\r\n            this.onUpdate(update);\r\n\r\n        }\r\n\r\n       __gameStack.__gameWindow = this;\r\n\r\n}\r\n\r\n    adjustSize(w, h)\r\n    {\r\n\r\n\r\n\r\n        w = w || this.canvas.clientWidth;\r\n\r\n        h = h || this.canvas.clientHeight;\r\n\r\n        __gameStack.WIDTH = w;\r\n\r\n        __gameStack.HEIGHT = h;\r\n\r\n        this.canvas.width = w;\r\n\r\n        this.canvas.height = h;\r\n\r\n    }\r\n\r\n    uniques(list) {\r\n\r\n        var listout = [];\r\n\r\n        $Q.each(list, function (ix, item) {\r\n\r\n            if (!listout.indexOf(item.id) >= 0) {\r\n\r\n                var str = item.name;\r\n\r\n                listout.push({\"sprite\": item});\r\n\r\n            }\r\n\r\n        });\r\n\r\n        return listout;\r\n\r\n    }\r\n\r\n    setPlayer(player) {\r\n        this.player = player;\r\n\r\n        if (!this.sprites.indexOf(player) >= 0) {\r\n            this.sprites.push(player);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            if (typeof(item.update) == 'function') {\r\n                item.update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n                //  console.log('def_update');\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n        });\r\n\r\n\r\n\r\n        GameStack.each(this.forces, function (ix, item) {\r\n\r\n            if (typeof(item.update) == 'function') {\r\n\r\n                item.update(item);\r\n\r\n            }\r\n\r\n            if (typeof(item.def_update) == 'function') {\r\n                //  console.log('def_update');\r\n\r\n                item.def_update(item);\r\n\r\n            }\r\n\r\n        });\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    loadLevelFile(filepath, callback)\r\n    {\r\n\r\n        $.getJSON(filepath, function(data) {\r\n\r\n            callback(false, data);\r\n\r\n        });\r\n    }\r\n\r\n\r\n    draw() {\r\n\r\n        var _gw = this;\r\n\r\n        GameStack.each(this.sprites, function (ix, item) {\r\n\r\n            Canvas.draw(item, _gw.ctx);\r\n\r\n        });\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\n\r\nclass TextDisplay {\r\n\r\n    constructor(args)\r\n    {\r\n        if(!args)\r\n        {\r\n            args = {};\r\n\r\n        }\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.5;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.5;\r\n\r\n        this.topFloat = args.top || 0.25;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, document.body.clientHeight);\r\n\r\n        this.leftFloat = args.left || 0.25;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,document.body.clientWidth);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fadeIn = args.fadeIn || args.fade || true;\r\n\r\n        this.border = \"2px inset \" + this.color;\r\n\r\n        this.fontSize = args.fontSize || \"20px\";\r\n\r\n        this.fromLeft = args.fromLeft || false;\r\n\r\n        if(this.fromLeft){ this.leftFloat = 1.5; }\r\n\r\n        this.fromRight = args.fromRight || false;\r\n\r\n        if(this.fromRight){ this.leftFloat = -0.5; }\r\n\r\n        this.fromTop = args.fromTop || false;\r\n\r\n        if(this.fromTop){ this.topFloat = -0.5; }\r\n\r\n        this.fromBottom = args.fromBottom || false;\r\n\r\n        if(this.fromBottom){ this.topFloat = 1.5; }\r\n\r\n        this.duration = args.duration || 5000;\r\n\r\n        this.stay_duration = Math.round(this.duration / 2);\r\n\r\n        this.complete = args.complete || function(){};\r\n\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    onComplete(fun){\r\n\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    show()\r\n    {\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('P');\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = Math.round(document.body.clientHeight * this.topFloat) + 'px';\r\n\r\n        this.domElement.style.left = Math.round(document.body.clientWidth * this.leftFloat) + 'px';\r\n\r\n        this.domElement.style.width = Math.round(document.body.clientWidth * this.widthFloat) + 'px';\r\n\r\n        this.domElement.style.height = Math.round(document.body.clientHeight * this.heightFloat) + 'px';\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.display = \"block\";\r\n\r\n        this.domElement.style.textAlign = \"center\";\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.innerText = this.text;\r\n\r\n        this.domElement.textContent = this.text;\r\n\r\n        this.domElement.style.opacity = this.fadeIn ?  0 : 1.0;\r\n\r\n        this.domElement.id = GameStack.create_id();\r\n\r\n        document.body.append(this.domElement);\r\n\r\n\r\n        var __inst = this;\r\n\r\n        Velocity(this.domElement, { opacity:1.0, top:this.targetTop, left:this.targetLeft}, { duration: this.duration, easing:\"quadratic\"});\r\n\r\n        window.setTimeout(function(){\r\n\r\n            if(__inst.stay_duration >= 1)\r\n            {\r\n                window.setTimeout(function(){\r\n\r\n                    Velocity(__inst.domElement, { opacity:0, display:'none'}, { duration:300, easing:\"linear\"});\r\n\r\n                    if(typeof(__inst.complete) == 'function')\r\n                    {\r\n                        __inst.complete();\r\n\r\n                    }\r\n\r\n\r\n\r\n                }, __inst.stay_duration);\r\n\r\n            }\r\n\r\n\r\n        }, this.duration);\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n/**TODO:complete the following\r\n *  class: ItemDisplay\r\n */\r\n\r\n\r\nclass ItemDisplay //show an item display (image with text/number to the right\r\n{\r\n    constructor(args) {\r\n\r\n        this.src = args.src || \"__NONE\";\r\n\r\n        this.size = args.size || new Vector3(50, 50);\r\n\r\n        this.topFloat = args.top || 0;\r\n\r\n        this.targetTop = this.get_float_pixels(this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.leftFloat = args.left || 0;\r\n\r\n        this.targetLeft = this.get_float_pixels(this.leftFloat,GameStack.WIDTH);\r\n\r\n        this.color = args.color || '#ffffff';\r\n\r\n        this.text = args.text || \"This is the text\";\r\n\r\n        this.fontFamily = args.font || args.fontFamily || \"GameStack\";\r\n\r\n        this.fontSize = args.fontSize || args.textSize || \"15px\";\r\n\r\n        this.text_id = GameStack.create_id();\r\n\r\n        this.id = GameStack.create_id();\r\n\r\n        this.img_id = GameStack.create_id();\r\n\r\n    }\r\n\r\n    setValue(value)\r\n    {\r\n        document.getElementById(this.text_id)\r\n    }\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n\r\n    get_id()\r\n    {\r\n        return  this.id;\r\n    }\r\n\r\n    update(v)\r\n    {\r\n        var e = document.getElementById(this.text_id);\r\n\r\n        this.text = v + \"\";\r\n\r\n        e.innerText = this.text;\r\n    }\r\n\r\n    show() {\r\n\r\n        //create an html element\r\n\r\n        this.domElement = document.createElement('DIV');\r\n\r\n        this.domElement.setAttribute('class', 'gameStack-stats');\r\n\r\n        this.domElement.innerHTML+='<img style=\"float:left;\" width=\"'+this.size.x+'\" height=\"'+this.size.y+'\" id=\"'+this.img_id+'\" src=\"'+this.src+'\"/>';\r\n\r\n        this.domElement.style.color = this.color;\r\n\r\n        this.domElement.innerHTML+='<span id=\"'+this.text_id+'\" style=\"padding:5px; vertical-align:middle; display:table-cell; font-size:'+this.fontSize+'; color:'+this.color+';\">'+this.text+'</span>';\r\n\r\n        this.domElement.style.position = \"fixed\";\r\n\r\n        //this.domElement.style.padding = \"10px\";\r\n\r\n        this.domElement.style.top = this.targetTop;\r\n\r\n        this.domElement.style.left = this.targetLeft;\r\n\r\n        this.domElement.style.fontFamily = this.fontFamily;\r\n\r\n        this.domElement.style.fontSize = this.fontSize;\r\n\r\n        this.domElement.style.zIndex = \"9999\";\r\n\r\n        this.domElement.id = this.id;\r\n\r\n        document.body.append(this.domElement);\r\n    }\r\n}\r\n\r\n\r\nclass Bar\r\n{\r\n    constructor(background, border)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.position = 'fixed';\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.zIndex = \"9999\";\r\n\r\n        e.style.backgroundSize = \"100% 100%\";\r\n\r\n        e.style.backgroundPosition = \"center bottom\";\r\n\r\n        if(border)\r\n        {\r\n            e.style.border = border;\r\n\r\n        }\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\n\r\nclass BarFill\r\n{\r\n    constructor(background)\r\n    {\r\n        this.background = background;\r\n        var e = document.createElement(\"SPAN\");\r\n\r\n        e.style.background=this.background;\r\n\r\n        e.style.position = 'fixed';\r\n\r\n\r\n        e.style.zIndex = \"9995\";\r\n\r\n\r\n        this.domElement = e;\r\n\r\n    }\r\n\r\n    width(w)\r\n    {\r\n        this.domElement.style.width = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    height(h)\r\n    {\r\n        this.domElement.style.height = h;\r\n\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\n\r\nclass BarDisplay //show a display bar such as health bar\r\n{\r\n    constructor(args={}) {\r\n\r\n        this.border = args.border || \"none\";\r\n\r\n        if(args.fill_src)\r\n        {\r\n            this.fill = new BarFill(args.fill_src).width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.fill = args.fill || new BarFill(args.fill_color || 'green').width(args.fill_width || \"80px\").height(args.fill_height || \"10px\");\r\n        }\r\n\r\n        if(args.bar_src)\r\n        {\r\n            this.bar = new Bar(args.bar_src, this.border).width(args.bar_width || \"80px\").height(args.bar_height  || \"10px\");\r\n        }\r\n        else\r\n        {\r\n            this.bar = new Bar(args.bar_color || 'goldenrod', this.border).width(args.bar_width  || \"80px\").height(args.bar_height || \"10px\");\r\n        }\r\n\r\n\r\n        this.topFloat = args.top || args.topFloat || 0.25;\r\n\r\n        this.leftFloat = args.left || args.leftFloat || 0.25;\r\n\r\n        this.widthFloat = args.width || args.widthFloat || 0.25;\r\n\r\n        this.heightFloat = args.height || args.heightFloat || 0.25;\r\n\r\n        document.body.append(this.fill.domElement);\r\n\r\n        document.body.append(this.bar.domElement);\r\n\r\n\r\n    }\r\n\r\n\r\n    get_float_pixels(float, dimen)\r\n    {\r\n        return  Math.round(dimen * float) + 'px';\r\n    }\r\n\r\n    portion_top(v)\r\n    {\r\n\r\n        this.fill.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.top = this.get_float_pixels(v || this.topFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    portion_left(v)\r\n    {\r\n\r\n        this.fill.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.left = this.get_float_pixels(v || this.leftFloat, GameStack.WIDTH);\r\n\r\n    }\r\n\r\n    portion_width(w)\r\n    {\r\n\r\n        this.fill.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n        this.bar.domElement.style.width = this.get_float_pixels(w || this.widthFloat, GameStack.WIDTH);\r\n\r\n\r\n    }\r\n\r\n    portion_height(h)\r\n    {\r\n        this.fill.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n        this.bar.domElement.style.height = this.get_float_pixels(h || this.heightFloat, GameStack.HEIGHT);\r\n\r\n    }\r\n\r\n    update(f)\r\n    {\r\n        this.fill.domElement.style.width = this.get_float_pixels(f || 0,  parseFloat(this.bar.domElement.style.width));\r\n\r\n    }\r\n\r\n}\r\n\r\nclass VideoDisplay //show a video\r\n{\r\n    constructor({src, size}) {\r\n\r\n        this.domElement = undefined;\r\n\r\n        this.src = src;\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z || 0);\r\n\r\n        GameStack.log('VideoDisplay():: TODO: create dom element');\r\n\r\n    }\r\n\r\n    play() {\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;/**\r\n * Takes an object of arguments and returns Animation() object.\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {string} args.type optional\r\n * @param   {Vector} args.size of the Animation object, has x and y properties\r\n * @param   {Vector} args.frameSize the size of frames in Animation, having x and y properties\r\n * @param   {VectorFrameBounds} args.frameBounds the bounds of the Animation having min, max, and termPoint properties\r\n * @param   {number} args.delay optional, the seconds to delay before running animation when called by engage()\r\n\r\n * @param   {number} args.duration how many milliseconds the animation should take to complete\r\n *\r\n * @returns {Animation} an Animation object\r\n */\r\n\r\nclass Animation {\r\n    constructor(args) {\r\n\r\n        args = args || {};\r\n\r\n        var _anime = this;\r\n\r\n        this.defaultArgs = {\r\n\r\n            name:\"my-animation\",\r\n\r\n            description:\"my-description\",\r\n\r\n            frames:[],\r\n\r\n            type:\"none\",\r\n\r\n            delay:0,\r\n\r\n            frameSize:new Vector3(44, 44, 0),\r\n\r\n            frameBounds:new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0)),\r\n\r\n            frameOffset:new Vector3(0, 0, 0),\r\n\r\n            flipX:false,\r\n\r\n            earlyTerm:false,\r\n\r\n            hang:false,\r\n\r\n            duration:1000,\r\n\r\n            size:new Vector3(20, 20, 20)\r\n        };\r\n\r\n\r\n        for(var x in this.defaultArgs)\r\n        {\r\n            if(!args.hasOwnProperty(x))\r\n            {\r\n                args[x] = this.defaultArgs[x]\r\n\r\n            }\r\n\r\n        };\r\n\r\n        for(var x in this.args)\r\n        {\r\n           this[x] = args[x];\r\n\r\n        }\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.src = this.image.domElement.src;\r\n\r\n        this.domElement = this.image.domElement;\r\n\r\n        this.frameSize = this.getArg(args, 'frameSize', new Vector3(44, 44, 0));\r\n\r\n        this.frameBounds = this.getArg(args, 'frameBounds', new VectorFrameBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n        this.frameOffset = this.getArg(args, 'frameOffset', new Vector3(0, 0, 0));\r\n\r\n        this.extras = this.getArg(args, 'extras', false);\r\n\r\n\r\n      if(typeof(args) == 'object' && args.frameBounds && args.frameSize){  this.apply2DFrames(args.parent || {}) };\r\n\r\n        this.flipX = this.getArg(args, 'flipX', false);\r\n\r\n        this.cix = 0;\r\n\r\n        this.selected_frame = this.frames[0];\r\n\r\n        this.effects = [];\r\n\r\n        this.timer = 0;\r\n\r\n        this.__gameLogic = false;\r\n\r\n        this.setType = function(){  };\r\n\r\n    }\r\n\r\n    singleFrame(frameSize, size)\r\n    {\r\n\r\n        this.__frametype = 'single';\r\n\r\n        this.frameSize = frameSize;\r\n\r\n        this.size = size || this.frameSize;\r\n\r\n        this.selected_frame = {\r\n            image: this.image,\r\n            frameSize: this.frameSize,\r\n            framePos: {x: 0, y: 0}\r\n        };\r\n\r\n        this.frames[0] = this.selected_frame;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    apply2DFrames() {\r\n\r\n        this.frames = [];\r\n\r\n        var fcount = 0;\r\n\r\n        var quitLoop = false;\r\n\r\n        for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n            for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n                let framePos = {x: x * this.frameSize.x + this.frameOffset.x, y: y * this.frameSize.y + this.frameOffset.y};\r\n\r\n                this.frames.push({image: this.image, frameSize: this.frameSize, framePos: framePos});\r\n\r\n                if( x >= this.frameBounds.termPoint.x && y >= this.frameBounds.termPoint.y)\r\n                {\r\n\r\n                    quitLoop = true;\r\n\r\n                    break;\r\n                }\r\n\r\n                fcount += 1;\r\n\r\n                if(quitLoop)\r\n                    break;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.frames[0] = !this.frames[0] ? {\r\n                image: this.image,\r\n                frameSize: this.frameSize,\r\n                framePos: {x: this.frameBounds.min.x, y: this.frameBounds.min.y}\r\n            } : this.frames[0];\r\n\r\n       // this.selected_frame = this.frames[this.cix % this.frames.length] || this.frames[0];\r\n\r\n    }\r\n\r\n    resetFrames() //special reset function:: frames are re-rendered each reset()\r\n    {\r\n\r\n        this.apply2DFrames();\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        this.selected_frame = this.frames[Math.round(this.cix) % this.frames.length];\r\n\r\n\r\n    }\r\n\r\n    reset()\r\n{\r\n\r\n    this.resetFrames();\r\n\r\n    this.cix = 0;\r\n\r\n}\r\n\r\ncontinuous(duration)\r\n{\r\n\r\n    if(this.__frametype == 'single')\r\n    {\r\n        return 0;\r\n\r\n    }\r\n\r\n  this.apply2DFrames();\r\n\r\n    //update once:\r\n    this.update();\r\n\r\n\r\n    if(this.cix == 0)\r\n  {\r\n\r\n      this.engage();\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\nengage(duration, complete)\r\n{\r\n\r\n    if(this.__frametype == 'single')\r\n    {\r\n        return 0;\r\n\r\n    }\r\n\r\n\r\n    let __inst = this;\r\n\r\n    this.complete = complete || this.complete || function(){  };\r\n\r\n    var duration = duration || typeof(this.duration) == 'number' ? this.duration : this.frames.length * 20;\r\n\r\n    if(this.cix == 0 && this.extras)\r\n    {\r\n        this.extras.call(); //fire any extras attached\r\n\r\n    }\r\n\r\n    //we have a target\r\n  this.tween = new TWEEN.Tween(this)\r\n        .easing(__inst.curve || TWEEN.Easing.Linear.None)\r\n\r\n        .to({cix:__inst.frames.length - 1}, duration)\r\n        .onUpdate(function() {\r\n            //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n         //   __inst.cix = Math.ceil(__inst.cix);\r\n\r\n        __inst.update();\r\n\r\n        })\r\n        .onComplete(function() {\r\n            //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n            if(__inst.complete)\r\n            {\r\n\r\n                __inst.complete();\r\n\r\n            }\r\n\r\n            __inst.cix = 0;\r\n\r\n            __inst.isComplete = true;\r\n\r\n        });\r\n\r\n\r\n  this.tween.start();\r\n\r\n\r\n}\r\n\r\nonComplete(fun)\r\n{\r\n    this.complete = fun;\r\n\r\n}\r\n\r\n    animate() {\r\n\r\n        this.apply2DFrames();\r\n\r\n        this.timer += 1;\r\n\r\n        if(this.delay == 0 || this.timer % this.delay == 0) {\r\n\r\n            if(this.hang)\r\n            {\r\n                this.cix = this.cix + 1;\r\n\r\n                if(this.cix > this.frames.length - 1)\r\n                {\r\n                    this.cix =  this.frames.length - 1;\r\n\r\n                }\r\n\r\n            }\r\n            else\r\n            {\r\n\r\n                if(this.cix == 0 && this.extras)\r\n                {\r\n                    this.extras.call(); //fire any extras attached\r\n\r\n                }\r\n\r\n                if(this.cix >= this.frames.length - 1 && typeof(this.complete) == 'function')\r\n                {\r\n                    this.complete(this);\r\n\r\n                }\r\n\r\n                this.cix = this.cix >= this.frames.length - 1 ? this.frameBounds.min.x : this.cix + 1;\r\n            }\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n\r\n;/**\r\n * Camera : has simple x, y, z, position / Vector values\r\n *\r\n * @returns {Vector}\r\n */\r\n\r\n\r\nclass Camera\r\n{\r\n\r\n    constructor(args)\r\n    {\r\n\r\n      this.position = new Vector3(0, 0, 0);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n;\r\n\r\n\r\nclass Extras\r\n{\r\n\r\n    constructor(args)\r\n    {\r\n        this.items = args || [];\r\n\r\n        if(typeof(this.items)== 'object')\r\n        {\r\n            this.items = [this.items]; //assert array from single object\r\n        }\r\n\r\n        var allowedTypes = ['Sound', 'GameText', 'StatDisplay', 'Menu'];\r\n\r\n        if(!(this.items instanceof Array))\r\n        {\r\n\r\n            return console.error('Quick2d.Extras.call(), needs array argument');\r\n\r\n        }\r\n\r\n    }\r\n\r\n    call()\r\n    {\r\n        var items = this.items;\r\n        //a callable item can be one-time executed: it will have any of the following functions attached\r\n\r\n        for(var x = 0; x < items.length; x++)\r\n        {\r\n            var item = items[x];\r\n\r\n            if(typeof(item.play) == 'function')\r\n            {\r\n                item.play();\r\n\r\n            }\r\n\r\n\r\n            if(typeof(item.engage) == 'function')\r\n            {\r\n                item.engage();\r\n\r\n            }\r\n\r\n            if(typeof(item.fire) == 'function')\r\n            {\r\n                item.fire();\r\n\r\n            }\r\n\r\n            if(typeof(item.start) == 'function')\r\n            {\r\n                item.start();\r\n\r\n            }\r\n\r\n            if(typeof(item.run) == 'function')\r\n            {\r\n                item.run();\r\n\r\n            }\r\n\r\n            if(typeof(item.process) == 'function')\r\n            {\r\n                item.process();\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n /**\r\n * GravityForce, calling new GravityForce() is equivalent to calling new Force()\r\n  *\r\n  * Takes an object of arguments and GravityForce() object.\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {Array} args.subjects the subjects to be pulled by the GravityForce\r\n * @param   {Array} args.clasticObjects any clastic object that should have collision-stop behavior with args.subjects when collision occurs\r\n * @param   {Vector} args.max the speed of gravity AKA terminal velocity\r\n * @param   {number} args.accel the increment to use when accelerating speed of fall\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass GravityForce\r\n{\r\n    constructor(args)\r\n    {\r\n\r\n        this.name = args.name || \"\";\r\n\r\n        this.description = args.description || \"\";\r\n\r\n        this.subjects = args.subjects || [];\r\n\r\n        this.clasticObjects = args.clasticObjects || [];\r\n\r\n        this.max = args.max || new Vector3(3, 3, 3);\r\n         this.accel = args.accel || new Vector3(1.3, 1.3, 1.3);\r\n\r\n        for(var x in args)\r\n        {\r\n            this[x] = args[x];\r\n\r\n        }\r\n\r\n\r\n        for(var x in this.clasticObjects)\r\n        {\r\n            if(!this.clasticObjects[x] instanceof Sprite)\r\n            {\r\n                this.clasticObjects[x] = Gamestack.getById(this.clasticObjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n\r\n        for(var x in this.subjects)\r\n        {\r\n            if(!this.subjects[x] instanceof Sprite)\r\n            {\r\n                this.subjects[x] = Gamestack.getById(this.subjects[x].id);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n        if (args.hasOwnProperty(key)) {\r\n\r\n            return args[key];\r\n\r\n        }\r\n        else {\r\n            return fallback;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    update()\r\n    {\r\n\r\n      var  subjects = this.subjects;\r\n\r\n       var clasticObjects =  this.clasticObjects;\r\n\r\n      var  accel =  this.accel || {};\r\n\r\n        var max =  this.max || {};\r\n\r\n        __gameStack.each(subjects, function(ix, itemx){\r\n\r\n           itemx.accelY(accel, max);\r\n\r\n           itemx.__inAir = true;\r\n\r\n            __gameStack.each(clasticObjects, function(iy, itemy){\r\n\r\n                itemx.collide_stop(itemy);\r\n\r\n\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\nlet Force = GravityForce;\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\n/**\r\n * GamepadAdapter()\r\n *\r\n * <ul >\r\n *  <li> supports game-controller input for web-games\r\n *  <li> accesses live gamepad input from the HTML5 Gamepad Api\r\n * </ul>\r\n *\r\n * [See Live Demos with Suggested Usage-Examples]{@link http://www.google.com}\r\n * @returns {GamepadAdapter} object of GamepadAdapter()\r\n * */\r\n\r\nclass GamepadAdapter {\r\n\r\n    constructor() {\r\n\r\n        this.__gamepads = [];\r\n\r\n        this.intervals = [];\r\n\r\n        let controller_stack = this;\r\n\r\n        let _gpinst = this;\r\n\r\n        this.events = [];\r\n\r\n        window.setInterval(function () {\r\n\r\n            var gps = navigator.getGamepads();\r\n\r\n            _gpinst.gps = gps;\r\n\r\n            for(var x = 0; x < gps.length; x++) {\r\n\r\n            var events = _gpinst.__gamepads[x] ? _gpinst.__gamepads[x] : {};\r\n\r\n             _gpinst.process(gps[x], events);\r\n\r\n            }\r\n\r\n\r\n        }, 20);\r\n\r\n    }\r\n\r\n    gamepads()\r\n    {\r\n\r\n        return  navigator.getGamepads();\r\n\r\n    }\r\n\r\n\r\n    disconnect_all() {\r\n\r\n        for (var x = 0; x < this.intervals.length; x++) {\r\n\r\n            window.clearInterval(this.intervals[x]);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    disconnect_by_index(game_pad_index) {\r\n\r\n        window.clearInterval(this.intervals[game_pad_index]);\r\n\r\n    }\r\n\r\n    hasAnyPad() {\r\n        return \"getGamepads\" in navigator;\r\n\r\n    }\r\n\r\n    Event(key, game_pad, callback) {\r\n        return {\r\n\r\n            key: key, game_pad:game_pad, callback: callback\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    GamepadEvents(args)\r\n    {\r\n\r\n        var gp = {};\r\n\r\n        gp.stick_left = args.stick_left || function(x, y)\r\n        {\r\n\r\n          //  console.log('Def call');\r\n\r\n        }\r\n\r\n\r\n        gp.stick_right = args.stick_right ||  function(x, y)\r\n        {\r\n\r\n        }\r\n\r\n        gp.buttons = [];\r\n\r\n        gp.extendFunc = function(f1, f2)\r\n        {\r\n\r\n            var fc = f2;\r\n\r\n           return function(x, y){\r\n\r\n                f2(x, y);\r\n\r\n               f1(x, y);\r\n\r\n            }\r\n\r\n        };\r\n\r\n        gp.on = function(key, callback)\r\n        {\r\n\r\n            if(this[key] && key !== \"on\")\r\n            {\r\n\r\n                var current_cb =  typeof(this[key]) == 'function' ? this[key] : function(x, y){};\r\n\r\n               this[key] = this.extendFunc(callback, current_cb);\r\n\r\n\r\n            }\r\n\r\n            else if(key.indexOf('button') >= 0 && key.indexOf('_') >= 0 )\r\n            {\r\n                var parts = key.split('_');\r\n\r\n                var number;\r\n\r\n                try\r\n                {\r\n\r\n                    number = parseInt(parts[1]);\r\n\r\n\r\n                    var current_cb =  typeof(this['buttons'][number]) == 'function' ? this['buttons'][number] : function(x, y){};\r\n\r\n                    this['buttons'][number] = this.extendFunc(callback, current_cb);\r\n\r\n                }\r\n                catch (e)\r\n                    {\r\n                      console.error('could not parse \"on\" event with ' + key);\r\n\r\n                    }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        this.__gamepads.push(gp);\r\n\r\n        return gp;\r\n\r\n    }\r\n\r\n\r\n\r\n    process(gp, gpEvents)\r\n    {\r\n\r\n        this.process_buttons(gp, gpEvents);\r\n\r\n        this.process_axes(gp, gpEvents);\r\n\r\n    }\r\n\r\n\r\n    process_axes(gp, events)\r\n    {\r\n\r\n        if(!gp || !gp['axes'])\r\n        {\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n        for (var i = 0; i < gp.axes.length; i += 2) {\r\n            var axis1 = gp.axes[i], axia2 = gp.axes[i + 1];\r\n\r\n            var ix = (Math.ceil(i / 2) + 1), x = gp.axes[i], y = gp.axes[i + 1];\r\n\r\n\r\n\r\n            if(ix == 1 && events.stick_left)\r\n            {\r\n                events.stick_left(x, y);\r\n\r\n            }\r\n\r\n            if(ix == 2 && events.stick_right)\r\n            {\r\n                events.stick_right(x, y);\r\n\r\n            }\r\n\r\n            if (this.events && this.events['stick_' + i] && typeof(this.events['stick_' + i].callback) == 'function') {\r\n                this.events['stick_' + i].callback();\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    process_buttons(gp, events) {\r\n\r\n        if(!gp || !gp['buttons'])\r\n        {\r\n             return false;\r\n\r\n        }\r\n\r\n        for (var i = 0; i < gp.buttons.length; i++) {\r\n\r\n\r\n            if (typeof(events.buttons[i]) == 'function') {\r\n                events.buttons[i](gp.buttons[i].pressed);\r\n            }\r\n            else if (typeof( events.buttons[i]) == 'object' && typeof(events.buttons[i].update) == 'function') {\r\n                events.buttons[i].update(events.buttons[i].pressed);\r\n\r\n            }\r\n                var clearance_1 = this.events && this.events[i], gpc, bkey = \"button_\" + i;\r\n\r\n                if (clearance_1) {\r\n                    gpc = this.events[bkey] && !isNaN(this.events[bkey].game_pad) ? this.gamepads[this.events[bkey].game_pad] : this.events[bkey].game_pad;\r\n                }\r\n                ;\r\n\r\n                if (clearance_1 && gpc && typeof(this.events[bkey].callback) == 'function') {\r\n                    //call the callback\r\n                    this.events[i].callback();\r\n\r\n                }\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    on(key, gpix, callback) {\r\n\r\n        if(gpix >= this.__gamepads.length)\r\n        {\r\n\r\n            this.__gamepads.push(this.GamepadEvents({}));\r\n\r\n        }\r\n\r\n        this.__gamepads[gpix].on(key, callback);\r\n\r\n    }\r\n\r\n\r\n};\r\n\r\n\r\n\r\n\r\nif(!__gameInstance.GamepadAdapter)\r\n{\r\n    __gameInstance.GamepadAdapter = new GamepadAdapter();\r\n\r\n    __gameInstance.gamepads = [];\r\n\r\n    GameStack.GamepadAdapter = __gameInstance.GamepadAdapter;\r\n\r\n    GameStack.gamepads = __gameInstance.gamepads;\r\n\r\n    GameStack.GamepadAdapter.on('stick_left', 0, function(x, y){\r\n\r\n        console.log('Gamepad stick left');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_0', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 0');\r\n\r\n    });\r\n\r\n\r\n    GameStack.GamepadAdapter.on('button_1', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 1');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_2', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 2');\r\n\r\n    });\r\n\r\n    GameStack.GamepadAdapter.on('button_3', 0, function(x, y){\r\n\r\n        console.log('Gamepad button 3');\r\n\r\n    });\r\n\r\n   // __gameInstance.gamepads.push(gamepad);\r\n\r\n};\r\n\r\n\r\n\r\n;\r\n\r\n\r\nclass GravityAction\r\n{\r\n    constructor()\r\n    {\r\n\r\n    }\r\n\r\n}\r\n\r\nclass Graviton {\r\n    constructor(args) {\r\n\r\n    }\r\n}\r\n\r\nclass GravitationalRay {\r\n    constructor(args) {\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n/**\r\n * Takes an object of arguments and returns Motion() object. Motion animates movement of position and rotation properties for any Sprite()\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n * @param   {TWEEN.Easing.'objectGroup'.'objectMember'} args.curve the TWEEN.Easing function to be applied (Example: TWEEN.Easing.Quadratic.InOut)\r\n * @param   {Vector} args.targetRotation the targeted rotation result, when using rotation with movement\r\n * @param   {Vector} args.distance the target distance of position change, when moving position\r\n * @param   {number} args.duration the milliseconds duration of the Motion\r\n * @param   {number} args.delay the milliseconds delay before the Motion occurs (on call of Motion.engage())\r\n *\r\n *\r\n * @returns {Motion} a Motion object\r\n */\r\n\r\nclass Motion {\r\n    constructor(args) {\r\n\r\n        this.getArg = $Q.getArg;\r\n\r\n        this.distance = Gamestack.getArg(args, 'distance', Gamestack.getArg(args, 'distances', false));\r\n\r\n        this.curvesList = this.curvesObject(); //Tween.Easing\r\n\r\n        this.parent_id = args.parent_id || args.object_id || \"__blank\"; //The parent object\r\n\r\n        this.curve = Gamestack.getArg(args, 'curve', TWEEN.Easing.Quadratic.InOut);\r\n\r\n        this.targetRotation = Gamestack.getArg(args, 'targetRotation', 0);\r\n\r\n        this.name = Gamestack.getArg(args, 'name', \"__\");\r\n\r\n        this.description = Gamestack.getArg(args, 'description', false);\r\n\r\n        this.curveString = this.getCurveString(); //store a string key for the Tween.Easing || 'curve'\r\n\r\n        this.setCurve(this.curveString);\r\n\r\n        this.line = Gamestack.getArg(args, 'line', false);\r\n\r\n        this.duration = Gamestack.getArg(args, 'duration', 500);\r\n\r\n        this.delay = Gamestack.getArg(args, 'delay', 0);\r\n\r\n    }\r\n\r\n\r\n    curvesObject() {\r\n\r\n        var c = [];\r\n\r\n        GameStack.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            GameStack.each(easing, function (iy, easeType) {\r\n\r\n                if (['in', 'out', 'inout'].indexOf(iy.toLowerCase()) >= 0) {\r\n\r\n                    c.push(ix + \"_\" + iy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n\r\n    getCurveString() {\r\n\r\n        var __inst = this;\r\n\r\n        var c;\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (__inst.curve == TWEEN.Easing[ix][iy]) {\r\n\r\n                    c = ix + \"_\" + iy;\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        return c;\r\n\r\n    }\r\n\r\n\r\n    setCurve(c) {\r\n\r\n        var cps = c.split('_');\r\n\r\n        var s1 = cps[0], s2 = cps[1];\r\n\r\n\r\n        var curve = TWEEN.Easing.Quadratic.InOut;\r\n\r\n\r\n        $.each(TWEEN.Easing, function (ix, easing) {\r\n\r\n            $.each(TWEEN.Easing[ix], function (iy, easeType) {\r\n\r\n\r\n                if (ix == s1 && iy == s2) {\r\n\r\n                    // alert('setting curve');\r\n\r\n                    curve = TWEEN.Easing[ix][iy];\r\n\r\n                }\r\n\r\n            });\r\n\r\n        });\r\n\r\n        this.curve = curve;\r\n\r\n\r\n        return curve;\r\n\r\n    }\r\n\r\n\r\n\r\n    engage() {\r\n\r\n        var tweens = [];\r\n\r\n        //construct a tween::\r\n\r\n        var __inst = this;\r\n\r\n\r\n        var objects = {};\r\n\r\n        $.each(Game.sprites, function (ix, item) {\r\n\r\n            if (item.id == __inst.parent_id) {\r\n\r\n                objects[ix] = item;\r\n\r\n            }\r\n        });\r\n\r\n\r\n        var target = {\r\n\r\n            x: __inst.distance.x + objects[0].position.x,\r\n            y: __inst.distance.y + objects[0].position.y,\r\n            z: __inst.distance.z + objects[0].position.z\r\n\r\n        };\r\n\r\n        if (__inst.targetRotation > 0 || __inst.targetRotation < 0) {\r\n\r\n\r\n            var targetR = __inst.targetRotation + objects[0].rotation.x;\r\n\r\n            //we have a target\r\n            tweens[0] = new TWEEN.Tween(objects[0].rotation)\r\n                .easing(__inst.curve || TWEEN.Easing.Elastic.InOut)\r\n\r\n                .to({x: targetR}, __inst.duration)\r\n                .onUpdate(function () {\r\n                    //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n                })\r\n                .onComplete(function () {\r\n                    //console.log(objects[0].position.x, objects[0].position.y);\r\n                    if (__inst.complete) {\r\n\r\n                        __inst.complete();\r\n\r\n                    }\r\n\r\n\r\n                });\r\n\r\n\r\n        }\r\n\r\n        //we have a target\r\n        tweens.push(new TWEEN.Tween(objects[0].position)\r\n            .easing(__inst.curve || TWEEN.Easing.Elastic.InOut)\r\n\r\n            .to(target, __inst.duration)\r\n            .onUpdate(function () {\r\n                //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n            })\r\n            .onComplete(function () {\r\n                //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n                if (__inst.complete) {\r\n\r\n                    __inst.complete();\r\n\r\n                }\r\n\r\n\r\n            }));\r\n\r\n\r\n        __inst.delay = !isNaN(__inst.delay) && __inst.delay > 0 ? __inst.delay : 0;\r\n\r\n\r\n        return {\r\n\r\n            tweens: tweens,\r\n\r\n            delay: __inst.delay,\r\n\r\n            fire: function () {\r\n\r\n                var __tweenObject = this;\r\n\r\n                window.setTimeout(function () {\r\n\r\n                    for (var x = 0; x < __tweenObject.tweens.length; x++) {\r\n\r\n                        __tweenObject.tweens[x].start();\r\n\r\n                    }\r\n\r\n                }, this.delay);\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * start the Motion transition\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     *\r\n     **********/\r\n\r\n    start() {\r\n        this.engage().fire();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * specify a function to be called when Motion is complete\r\n     *\r\n     * @function\r\n     * @memberof Motion\r\n     * @param {Function} fun the function to be called when complete\r\n     *\r\n     **********/\r\n\r\n    onComplete(fun) {\r\n        this.complete = fun;\r\n\r\n    }\r\n\r\n    // obj.getGraphCanvas( $(c.domElement), value.replace('_', '.'), TWEEN.Easing[parts[0]][parts[1]] );\r\n\r\n    getGraphCanvas( t, f, c) {\r\n\r\n        var canvas = document.createElement('canvas');\r\n\r\n        canvas.id = 'curve-display';\r\n\r\n        canvas.width = 180;\r\n        canvas.height = 100;\r\n\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.fillStyle = \"rgb(250,250,250)\";\r\n        context.fillRect(0, 0, 180, 100);\r\n\r\n        context.lineWidth = 0.5;\r\n        context.strokeStyle = \"rgb(230,230,230)\";\r\n\r\n        context.beginPath();\r\n        context.moveTo(0, 20);\r\n        context.lineTo(180, 20);\r\n        context.moveTo(0, 80);\r\n        context.lineTo(180, 80);\r\n        context.closePath();\r\n        context.stroke();\r\n\r\n        context.lineWidth = 2;\r\n        context.strokeStyle = \"rgb(255,127,127)\";\r\n\r\n        var position = {x: 5, y: 80};\r\n        var position_old = {x: 5, y: 80};\r\n\r\n        new TWEEN.Tween(position).to({x: 175}, 2000).easing(TWEEN.Easing.Linear.None).start();\r\n        new TWEEN.Tween(position).to({y: 20}, 2000).easing(f).onUpdate(function () {\r\n\r\n            context.beginPath();\r\n            context.moveTo(position_old.x, position_old.y);\r\n            context.lineTo(position.x, position.y);\r\n            context.closePath();\r\n            context.stroke();\r\n\r\n            position_old.x = position.x;\r\n            position_old.y = position.y;\r\n\r\n        }).start();\r\n\r\n        return canvas;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n\r\nclass Rectangle {\r\n\r\n    constructor(min, max) {\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\nlet VectorBounds = Rectangle;\r\n\r\nclass VectorFrameBounds extends Rectangle {\r\n\r\n    constructor(min, max, termPoint) {\r\n\r\n        super(min, max);\r\n\r\n        this.termPoint = termPoint || new Vector3(this.max.x, this.max.y, this.max.z);\r\n\r\n    }\r\n\r\n\r\n}\r\n;\r\n\r\nclass Circle\r\n{\r\n    constructor(args) {\r\n\r\n        this.position = this.getArg(args, 'position', new Vector3(0, 0, 0));\r\n\r\n        this.radius = this.getArgs(args, 'radius', 100);\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n;\r\n/**\r\n * Takes an object of arguments and returns Sprite() object. Sprite() is a container for multiple Animations, Motions, and Sounds. Sprites have several behavioral functions for 2d-Game-Objects.\r\n\r\n * @param   {Object} args object of arguments\r\n * @param   {string} args.name optional\r\n * @param   {string} args.description optional\r\n\r\n * @param   {string} args.src the source file for the GameImage:Sprite.image :: use a string / file-path\r\n\r\n * @param   {Vector} args.size the size of the Sprite\r\n * @param   {Vector} args.position the position of the Sprite\r\n * @param   {Vector} args.padding the 'float-type' Vector of x and y padding to use when processing collision on the Sprite. A padding of new Vector(0.2, 0.2) will result in 1/5 of Sprite size for padding\r\n\r\n\r\n\r\n * @param   {Animation} args.selected_animation the selected_animation of the Sprite:: pass during creation or use Sprite.setAnimation after created\r\n *\r\n * @returns {Sprite} a Sprite object\r\n */\r\n\r\nclass Sprite {\r\n    constructor(args) {\r\n\r\n        if (!args) {\r\n            args = {};\r\n        }\r\n\r\n        this.active = true; //active sprites are visible\r\n\r\n        this.name = args.name || \"__\";\r\n\r\n        this.description = args.description || \"__\";\r\n\r\n        this.__initializers = __gameStack.getArg(args, '__initializers', []);\r\n\r\n        var _spr = this;\r\n\r\n        Quazar.each(args, function (ix, item) { //apply all args\r\n\r\n            if (ix !== 'parent') {\r\n                _spr[ix] = item;\r\n            }\r\n\r\n        });\r\n\r\n        this.type = __gameStack.getArg(args, 'type', 'basic');\r\n\r\n        this.animations = __gameStack.getArg(args, 'animations', []);\r\n\r\n        this.motions = __gameStack.getArg(args, 'motions', []);\r\n\r\n        let __inst = this;\r\n\r\n        this.id = __gameStack.getArg(args, 'id', this.create_id());\r\n\r\n        this.sounds = __gameStack.getArg(args, 'sounds', []);\r\n\r\n        this.image = new GameImage(__gameStack.getArg(args, 'src', __gameStack.getArg(args, 'image', false)));\r\n\r\n        this.size = __gameStack.getArg(args, 'size', new Vector3(100, 100));\r\n\r\n        this.position = __gameStack.getArg(args, 'position', new Vector3(0, 0, 0));\r\n\r\n        this.collision_bounds = __gameStack.getArg(args, 'collision_bounds', new VectorBounds(new Vector3(0, 0, 0), new Vector3(0, 0, 0)));\r\n\r\n        this.rotation = __gameStack.getArg(args, 'rotation', new Vector3(0, 0, 0));\r\n\r\n        this.selected_animation = {};\r\n\r\n        this.speed = __gameStack.getArg(args, 'speed', new Vector3(0, 0, 0));\r\n\r\n        this.acceleration = __gameStack.getArg(args, 'acceleration', new Vector3(0, 0, 0));\r\n\r\n        this.rot_speed = __gameStack.getArg(args, 'rot_speed', new Vector3(0, 0, 0));\r\n\r\n        this.rot_accel = __gameStack.getArg(args, 'rot_accel', new Vector3(0, 0, 0));\r\n\r\n\r\n        this.padding = __gameStack.getArg(args, 'padding', new Vector3(0, 0, 0));\r\n\r\n\r\n        //Apply / instantiate Sound(), Motion(), and Animation() args...\r\n\r\n        GameStack.each(this.sounds, function (ix, item) {\r\n\r\n            __inst.sounds[ix] = new Sound(item);\r\n\r\n        });\r\n\r\n        GameStack.each(this.motions, function (ix, item) {\r\n\r\n            __inst.motions[ix] = new Motion(item);\r\n\r\n        });\r\n\r\n\r\n        GameStack.each(this.animations, function (ix, item) {\r\n\r\n            __inst.animations[ix] = new Animation(item);\r\n\r\n        });\r\n\r\n\r\n        //Apply initializers:\r\n\r\n        GameStack.each(this.__initializers, function (ix, item) {\r\n\r\n            __inst.onInit(item);\r\n\r\n        });\r\n\r\n\r\n        if (args.selected_animation) {\r\n            this.selected_animation = new Animation(args.selected_animation);\r\n\r\n        }\r\n        else {\r\n\r\n            this.image.domElement.onload = function(){\r\n\r\n                __inst.setAnimation(__inst.animations[0] || new Animation({\r\n\r\n                        image:  __inst.image,\r\n\r\n                        frameSize: new Vector3( __inst.image.domElement.width,  __inst.image.domElement.height),\r\n\r\n                        frameBounds: new VectorFrameBounds(new Vector3(), new Vector3())\r\n\r\n\r\n                    }));\r\n\r\n            };\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function initializes sprites. Call to trigger all functions previously passed to onInit().\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    init() {\r\n\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends the init() function. Takes single function() argument OR single string argument\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} fun the function to be passed into the init() event of the Sprite()\r\n     **********/\r\n\r\n    onInit(fun) {\r\n\r\n        if (typeof fun == 'string') {\r\n\r\n            if (this.__initializers.indexOf(fun) < 0) {\r\n\r\n                this.__initializers.push(fun)\r\n            }\r\n            ;\r\n\r\n            var __inst = this;\r\n\r\n            var keys = fun.split('.');\r\n\r\n            console.log('finding init from string:' + fun);\r\n\r\n            if (!keys.length >= 2) {\r\n                return console.error('need min 2 string keys separated by \".\"');\r\n            }\r\n\r\n            var f = GameStack.options.SpriteInitializers[keys[0]][keys[1]];\r\n\r\n            if (typeof(f) == 'function') {\r\n\r\n                var __inst = this;\r\n\r\n                var f_init = this.init;\r\n\r\n                this.init = function () {\r\n\r\n                    f_init(__inst);\r\n\r\n                    f(__inst);\r\n\r\n                };\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'function') {\r\n\r\n            console.log('extending init:');\r\n\r\n\r\n            var f_init = this.init;\r\n            var __inst = this;\r\n\r\n            this.init = function () {\r\n\r\n                f_init(__inst);\r\n\r\n                fun(__inst);\r\n\r\n            };\r\n\r\n\r\n        }\r\n\r\n        else if (typeof fun == 'object') {\r\n\r\n            console.log('extending init:');\r\n\r\n            console.info('Quick2D does not yet implement onInit() from arg of object type');\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Getters\r\n     ***************************/\r\n\r\n    /**\r\n     * This function gets the 'id' of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    get_id() {\r\n        return this.id;\r\n    }\r\n\r\n\r\n\r\n    to_map_object(size, framesize) {\r\n\r\n        this.__mapSize = new Vector3(size || this.size);\r\n\r\n        this.frameSize = new Vector3(framesize || this.size);\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Setters and Creators\r\n     ***************************/\r\n\r\n    /**\r\n     * This function creates the 'id' of the Sprite():Called automatically on constructor()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @returns {string}\r\n     **********/\r\n\r\n    create_id() {\r\n\r\n        return Quick2d.create_id();\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * This function sets the size of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setSize(size) {\r\n\r\n        this.size = new Vector3(size.x, size.y, size.z);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sets the position of the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    setPos(pos) {\r\n        this.position = new Vector3(pos.x, pos.y, pos.z || 0);\r\n\r\n    }\r\n\r\n    /**\r\n     * This function sizes the Sprite according to minimum dimensions and existing w/h ratios\r\n     * @param {number} mx the maximum size.x for the resize\r\n     * @param {number} my the maximum size.y for the resize\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n   getCappedSizeXY(mx, my, currentSize)\r\n    {\r\n\r\n        var size = new Vector3(currentSize || this.size);\r\n\r\n        var wth = size.y /  size.x;\r\n\r\n        var htw = size.x /  size.y;\r\n\r\n        if( size.x > mx)\r\n        {\r\n            size.x = mx;\r\n\r\n            size.y = size.x * wth;\r\n\r\n        }\r\n\r\n        if( size.y > my)\r\n        {\r\n            size.y = my;\r\n\r\n            size.x = size.y * htw;\r\n\r\n        }\r\n\r\n        return size;\r\n\r\n    }\r\n\r\n\r\n\r\n    /*****************************\r\n     *  assertSpeed()\r\n     *  -assert the existence of a speed{} object\r\n     ***************************/\r\n\r\n    assertSpeed() {\r\n        if (!this.speed) {\r\n\r\n            this.speed = new Vector3(0, 0, 0);\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    /*****************************\r\n     *  setAnimation(anime)\r\n     *  -set the select_animation of this sprite\r\n     ***************************/\r\n\r\n    /**\r\n     * This function sets the 'selected_animation' property of the Sprite():: *all Sprites must have a 'selected_animation'\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation}\r\n     **********/\r\n\r\n    setAnimation(anime) {\r\n\r\n        if (anime instanceof Animation && this.animations.indexOf(anime) < 0) {\r\n            this.animations.push(anime);\r\n        }\r\n\r\n        this.selected_animation = anime;\r\n\r\n        Quazar.log('declared default animation');\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /**\r\n     * This function indicates if this Sprite is onScreen within the Gamestack.WIDTH && Gamestack.HEIGHT dimensions, OR any w & h passed as arguments\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} w optional WIDTH argument, defaults to Gamestack.WIDTH\r\n     * @param {number} h optional HEIGHT argument, defaults to Gamestack.HEIGHT\r\n     **********/\r\n\r\n    onScreen(w, h) {\r\n\r\n        w = w || __gameStack.WIDTH;\r\n\r\n        h = h || __gameStack.HEIGHT;\r\n\r\n\r\n        var camera = __gameStack.camera ||__gameStack.__gameWindow.camera || new Vector3(0, 0, 0);\r\n\r\n        var p = new Vector3(this.position.x - camera.position.x, this.position.y - camera.position.y, this.position.z - camera.position.z);\r\n\r\n        var onScreen = p.x  > 0 - this.size.x && p.x < w + this.size.x\r\n        &&  p.y  > 0 - this.size.x && p.y < h + this.size.y ? true : false;\r\n\r\n        return onScreen;\r\n\r\n    }\r\n\r\n    /*****************************\r\n     * Updates\r\n     ***************************/\r\n\r\n    /*****************************\r\n     * update()\r\n     * -starts empty:: is used by Quick2d.js as the main sprite update\r\n     ***************************/\r\n\r\n    /**\r\n     * This function is the main update() function for the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n\r\n    update(sprite) {\r\n    }\r\n\r\n    /*****************************\r\n     * def_update()\r\n     * -applies speed and other default factors of movement::\r\n     * -is used by Quick2d.js as the system def_update (default update)\r\n     ***************************/\r\n\r\n    /**\r\n     * This function updates various speed and rotational-speed properties for the Sprite()\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    def_update(sprite) {\r\n\r\n\r\n        for (var x in this.speed) {\r\n\r\n            if (this.speed[x] > 0 || this.speed[x] < 0) {\r\n\r\n                this.position[x] += this.speed[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.acceleration) {\r\n\r\n            if (this.acceleration[x] > 0 || this.acceleration[x] < 0) {\r\n\r\n                this.speed[x] += this.acceleration[x];\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (var x in this.rot_speed) {\r\n\r\n            if (this.rot_speed[x] > 0 || this.rot_speed[x] < 0) {\r\n\r\n                this.rotation[x] += this.rot_speed[x];\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        for (var x in this.rot_accel) {\r\n\r\n\r\n            if (this.rot_accel[x] > 0 || this.rot_accel[x] < 0) {\r\n\r\n                this.rot_speed[x] += this.rot_accel[x];\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This function resolves a function nested in an object, from a string-key, and it is applied by Gamestack.js for persistence of data and Sprite() behaviors\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    resolveFunctionFromDoubleKeys(keyString1, keyString2, obj, callback) {\r\n\r\n        callback(typeof obj[keyString1][keyString2] == 'function' ? obj[keyString1][keyString2] : {});\r\n\r\n    }\r\n\r\n    /**\r\n     * This function extends an existing function, and is applied by Gamestack in onInit();\r\n     * @function\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    extendFunc(fun, extendedFunc) {\r\n\r\n        console.log('extending func');\r\n\r\n        var ef = extendedFunc;\r\n\r\n        var __inst = this;\r\n\r\n        return function () {\r\n\r\n\r\n            ef(__inst);\r\n\r\n            //any new function comes after\r\n\r\n            fun(__inst);\r\n\r\n\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  onUpdate(fun)\r\n     * -args: 1 function(sprite){ } //the self-instance/sprite is passed into the function()\r\n     * -overrides and maintains existing code for update(){} function\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * Extends the update() of this sprite with a new function to be called during update()\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {function} the function to apply to the Sprite:update()\r\n     **********/\r\n\r\n\r\n    onUpdate(fun) {\r\n        fun = fun || function () {\r\n            };\r\n\r\n        let update = this.update;\r\n\r\n        let __inst = this;\r\n\r\n        this.update = function (__inst) {\r\n            update(__inst);\r\n            fun(__inst);\r\n        };\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * <ul>\r\n     *     <li>A rectangular style position</li>\r\n     *      <li>Takes another sprite as argument</li>\r\n     *       <li>Returns basic true || false during runtime</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {sprite}\r\n     **********/\r\n\r\n\r\n    /**\r\n     * Get the true || false results of a Collision between two Sprites(), based on their position Vectors and Sizes\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} sprite the alternate Sprite to process collision with\r\n     **********/\r\n\r\n\r\n    collidesRectangular(sprite) {\r\n\r\n        return Quazar.Collision.spriteRectanglesCollide(this, sprite);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  shoot(sprite)\r\n     *  -fire a shot from the sprite:: as in a firing gun or spaceship\r\n     *  -takes options{} for number of shots anglePerShot etc...\r\n     *  -TODO: complete and test this code\r\n     ***************************/\r\n\r\n    /**\r\n     * Sprite fires a projectile object\r\n     * <ul>\r\n     *     <li>Easy instantiator for bullets and propelled objects in GameStack</li>\r\n     *     <li>*TODO: This function is not-yet implemented in GameStack</li>\r\n     * </ul>\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {options} *numerous args\r\n     **********/\r\n\r\n\r\n    /**\r\n     * fire a projectile-subSprite from the Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} rot_offset the rotational offset to apply: controls direction of the shot\r\n     **********/\r\n\r\n    shoot(options) {\r\n        //character shoots an animation\r\n\r\n        this.prep_key = 'shoot';\r\n\r\n        let animation = options.bullet || options.animation || new Animation();\r\n\r\n        let speed = options.speed || 1;\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let size = options.size || new Vector3(10, 10, 0);\r\n\r\n        let rot_offset = options.rot_offset || new Vector3(0, 0, 0);\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var bx = position.x, by = position.y, bw = size.x, bh = size.y;\r\n\r\n            var shot = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            shot.setAnimation(animation);\r\n\r\n            if (typeof(rot_offset) == 'number') {\r\n                rot_offset = new Vector3(rot_offset, 0, 0);\r\n            }\r\n\r\n            shot.position.x = bx, shot.position.y = by;\r\n            shot.rotation.x = 0 + rot_offset.x;\r\n\r\n            shot.stats = {\r\n                damage: 1\r\n\r\n            };\r\n\r\n            shot.speed.x = Math.cos((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n            shot.speed.y = Math.sin((shot.rotation.x) * 3.14 / 180) * speed;\r\n\r\n            return shot;\r\n\r\n        }\r\n\r\n        return new Error(\"game was not in motion: Gamestack.isAtPlay must be true to create a shot.\");\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * create a subsprite of Sprite belonging to the current Sprite\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} options an object of arguments\r\n     * @param {Animation} animation the animation to fire from the Sprite\r\n     * @param {number} speed the speed of the shot that is projected\r\n     * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n     * @param {Vector} size the Vector size of the shot\r\n     * @param {Vector} offset the positional offset to apply\r\n     **********/\r\n\r\n    subsprite(options) {\r\n\r\n        let animation = options.animation || new Animation();\r\n\r\n        let position = options.position || new Vector3(this.position);\r\n\r\n        let offset = options.offset || new Vector3(0, 0, 0);\r\n\r\n        let size = options.size || this.size;\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            var subsprite = __gameStack.add(new Sprite({\r\n\r\n                active: true,\r\n\r\n                position: position,\r\n\r\n                size: size,\r\n\r\n                offset: offset,\r\n\r\n                image: animation.image,\r\n\r\n                rotation: new Vector3(0, 0, 0),\r\n\r\n                flipX: false\r\n\r\n            }));\r\n\r\n            subsprite.setAnimation(animation);\r\n\r\n            return subsprite;\r\n\r\n        }\r\n        else\r\n        {\r\n            alert('No subsprite when not at play');\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * animate Sprite.selected_animation  by one frame\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Animation} animation to use, defaults to Sprite.selected_animation\r\n     **********/\r\n\r\n    animate(animation) {\r\n\r\n        if (__gameInstance.isAtPlay) {\r\n\r\n            if (animation) {\r\n                this.setAnimation(animation)\r\n            }\r\n\r\n            this.selected_animation.animate();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * run a function when the Sprite.selected_animation is complete\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Function} fun the function to call when the animation is complete\r\n     *\r\n     **********/\r\n\r\n    onAnimationComplete(fun) {\r\n        this.selected_animation.onComplete(fun);\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  accelY\r\n     *  -accelerate on Y-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: gravitation of sprite || up / down movement\r\n     ***************************/\r\n\r\n    /**\r\n     * accelerate speed on the Y-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n    accelY(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {y: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.y - this.speed.y;\r\n\r\n        if (diff > 0) {\r\n            this.speed.y += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.y -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accelX\r\n     *  -accelerate on X-Axis with 'accel' and 'max' (speed) arguments\r\n     *  -example-use: running of sprite || left / right movement\r\n     ***************************/\r\n\r\n\r\n\r\n\r\n    /**\r\n     * accelerate speed on the X-Axis\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} accel the increment of acceleration\r\n     * @param {number} max the maximum for speed\r\n     *\r\n     **********/\r\n\r\n\r\n    accelX(accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        this.assertSpeed();\r\n\r\n        let diff = max.x - this.speed.x;\r\n\r\n        if (diff > 0) {\r\n            this.speed.x += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            this.speed.x -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  accel\r\n     *  -accelerate any acceleration -key\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * accelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} accel the increment of acceleration\r\n     *\r\n     * @param {number} max the max value to accelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    accel(prop, key, accel, max) {\r\n\r\n        accel = Math.abs(accel);\r\n\r\n        if (typeof(max) == 'number') {\r\n            max = {x: max};\r\n\r\n        }\r\n\r\n        let speed = prop[key];\r\n\r\n        // this.assertSpeed();\r\n\r\n        let diff = max.x - prop[key];\r\n\r\n        if (diff > 0) {\r\n            prop[key] += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n        if (diff < 0) {\r\n            prop[key] -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n        }\r\n        ;\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  decel\r\n     *  -deceleration -key\r\n     ***************************/\r\n\r\n    /**\r\n     * decelerate toward a max value on any object-property:: intended for self-use\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Object} prop The object to control\r\n     * @param {string} key the property-key for targeted property of prop argument\r\n     *\r\n     * @param {number} decel the increment of deceleration\r\n     *\r\n     * @param {number} max the max value to decelerate towards\r\n     *\r\n     *\r\n     **********/\r\n\r\n    decel(prop, key, rate) {\r\n        if (typeof(rate) == 'object') {\r\n\r\n            rate = rate.rate;\r\n\r\n        }\r\n\r\n        rate = Math.abs(rate);\r\n\r\n        if (Math.abs(prop[key]) <= rate) {\r\n            prop[key] = 0;\r\n        }\r\n\r\n        else if (prop[key] > 0) {\r\n            prop[key] -= rate;\r\n\r\n        }\r\n        else if (prop[key] < 0) {\r\n            prop[key] += rate;\r\n\r\n        }\r\n        else {\r\n\r\n            prop[key] = 0;\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    /*****************************\r\n     *  decelY\r\n     *  -decelerate on the Y axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the Y-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelY(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n        if (Math.abs(this.speed.y) <= amt) {\r\n            this.speed.y = 0;\r\n\r\n        }\r\n        else if (this.speed.y > amt) {\r\n\r\n            this.speed.y -= amt;\r\n        }\r\n        else if (this.speed.y < amt * -1) {\r\n\r\n            this.speed.y += amt;\r\n        }\r\n\r\n    }\r\n\r\n    /*****************************\r\n     *  decelX\r\n     *  -decelerate on the X axis\r\n     *  -args: 1 float:amt\r\n     ***************************/\r\n\r\n\r\n    /**\r\n     * decelerate speed on the X-Axis, toward zero\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {number} amt the increment of deceleration, negatives ignored\r\n     *\r\n     **********/\r\n\r\n    decelX(amt) {\r\n\r\n        amt = Math.abs(amt);\r\n\r\n\r\n        if (this.speed.x > amt) {\r\n\r\n            this.speed.x -= amt;\r\n        }\r\n        else if (this.speed.x < amt * -1) {\r\n\r\n            this.speed.x += amt;\r\n        }\r\n\r\n        if (Math.abs(this.speed.x) <= amt) {\r\n\r\n            this.speed.x = 0;\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    shortest_stop(item, callback) {\r\n        var diff_min_y = item.min ? item.min.y : Math.abs(item.position.y - this.position.y + this.size.y);\r\n\r\n        var diff_min_x = item.min ? item.min.x : Math.abs(item.position.x - this.position.x + this.size.x);\r\n\r\n        var diff_max_y = item.max ? item.max.y : Math.abs(item.position.y + item.size.y - this.position.y);\r\n\r\n        var diff_max_x = item.max ? item.max.x : Math.abs(item.position.x + item.size.x - this.position.y);\r\n\r\n        var dimens = {top: diff_min_y, left: diff_min_x, bottom: diff_max_y, right: diff_max_x};\r\n\r\n        var minkey = \"\", min = 10000000;\r\n\r\n        for (var x in dimens) {\r\n            if (dimens[x] < min) {\r\n                min = dimens[x];\r\n                minkey = x; // a key of top left bottom or right\r\n\r\n            }\r\n        }\r\n\r\n        callback(minkey);\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * get the center of a Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Vector)\r\n     *\r\n     **********/\r\n\r\n    center() {\r\n        return new Vector3(this.position.x + this.size.x / 2, this.position.y + this.size.y / 2);\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on X axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns {var} a true || false var\r\n     *\r\n     **********/\r\n\r\n    overlap_x(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return right > item.position.x && left < item.position.x + item.size.x;\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * determine if Sprite overlaps on Y axis with another Sprite\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n     * @returns (true || false}\r\n     *\r\n     **********/\r\n\r\n    overlap_y(item, padding) {\r\n        if (!padding) {\r\n            padding = 0;\r\n        }\r\n\r\n        var paddingX = Math.round(padding * this.size.x),\r\n\r\n            paddingY = Math.round(padding * this.size.y), left = this.position.x + paddingX,\r\n            right = this.position.x + this.size.x - paddingX,\r\n\r\n            top = this.position.y + paddingY, bottom = this.position.y + this.size.y - paddingY;\r\n\r\n        return bottom > item.position.y && top < item.position.y + item.size.y;\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n\r\n    collide_stop_x(item)\r\n    {\r\n\r\n        var apart = false;\r\n\r\n            var ct = 10000;\r\n\r\n            while (!apart && ct > 0) {\r\n\r\n                ct--;\r\n\r\n                var diffX = this.center().sub(item.center()).x;\r\n\r\n                var distX = Math.abs(this.size.x / 2 + item.size.x / 2 - Math.round(this.size.x * this.padding.x));\r\n\r\n                if (Math.abs(diffX) < distX) {\r\n\r\n                    this.position.x -= diffX > 0 ? -1 : 1;\r\n\r\n\r\n\r\n                }\r\n                else\r\n                {\r\n\r\n                    apart = true;\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /*************\r\n     * #BE CAREFUL\r\n     * -with this function :: change sensitive / tricky / 4 way collision\r\n     * *************/\r\n\r\n\r\n    /**\r\n     * cause a fourway collision-stop between this and another Sprite :: objects will behave clastically and resist passing through one another\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     * @param {Sprite} item the Sprite to compare with\r\n     *\r\n     **********/\r\n\r\n    collide_stop(item) {\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n       // this.position = this.position.sub(this.speed);\r\n\r\n        if(this.collidesRectangular(item)) {\r\n\r\n            var diff = this.center().sub(item.center());\r\n\r\n            if(this.overlap_x(item, this.padding.x + 0.1) && Math.abs(diff.x) < Math.abs(diff.y))\r\n           {\r\n\r\n               var apart = false;\r\n\r\n                   var ct = 10000;\r\n\r\n                   while (!apart && ct > 0) {\r\n\r\n                       ct--;\r\n\r\n                       var diffY = this.center().sub(item.center()).y;\r\n\r\n                       var distY = Math.abs(this.size.y / 2 + item.size.y / 2- Math.round(this.size.y * this.padding.y));\r\n\r\n                       if (Math.abs(diffY) < distY) {\r\n\r\n                           this.position.y -= diffY > 0 ? -1 : 1;\r\n\r\n                       }\r\n\r\n                     else {\r\n\r\n                           if (diffY <= 0){\r\n                               this.__inAir = false;\r\n                           };\r\n\r\n\r\n                          return apart = true;\r\n\r\n\r\n                       }\r\n\r\n\r\n               }\r\n\r\n\r\n\r\n           }\r\n\r\n\r\n            if(this.overlap_y(item, this.padding.y ) && Math.abs(diff.y) < Math.abs(diff.x)) {\r\n\r\n                this.collide_stop_x(item);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    collide_stop_top()\r\n    {\r\n\r\n        if(this.id == item.id)\r\n        {\r\n            return false;\r\n\r\n        }\r\n\r\n        if(this.collidesRectangular(item)) {\r\n\r\n            var diff = this.center().sub(item.center());\r\n\r\n            if (this.overlap_x(item, 0.3) && Math.abs(diff.y) < 0) {\r\n\r\n                var apart = false;\r\n\r\n                var ct = 10000;\r\n\r\n                while (!apart && ct > 0) {\r\n\r\n                    ct--;\r\n\r\n                    var diffY = this.center().sub(item.center()).y;\r\n\r\n                    var distY = Math.abs(this.size.y / 2 + item.size.y / 2);\r\n\r\n                    if (Math.abs(diffY) < distY) {\r\n\r\n                        this.position.y -= diffY > 0 ? -1 : 1;\r\n\r\n\r\n                    }\r\n\r\n                    else {\r\n\r\n                        if (diffY < 0) {\r\n                            this.__inAir = false;\r\n                        }\r\n                        ;\r\n\r\n\r\n                        apart = true;\r\n\r\n\r\n                    }\r\n\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Restore a sprite from saved .json data\r\n     *\r\n     * @function\r\n     * @memberof Sprite\r\n     *\r\n     * @returns (Sprite)\r\n     **********/\r\n\r\n    restoreFrom(data) {\r\n        data.image = new GameImage(data.src || data.image.src);\r\n\r\n        return new Sprite(data);\r\n\r\n    }\r\n\r\n\r\n    /*****************************\r\n     *  fromFile(file_path)\r\n     *  -TODO : complete this function based on code to load Sprite() from file, located in the spritemaker.html file\r\n     *  -TODO: test this function\r\n     ***************************/\r\n\r\n    fromFile(file_path) {\r\n\r\n        if (typeof file_path == 'string') {\r\n\r\n            var __inst = this;\r\n\r\n            $.getJSON(file_path, function (data) {\r\n\r\n                __inst = new Sprite(data);\r\n\r\n            });\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\n/****************\r\n * TODO : Complete SpritePresetsOptions::\r\n *  Use these as options for Sprite Control, etc...\r\n ****************/\r\n\r\n\r\nlet SpriteInitializersOptions = {\r\n\r\n    Collideables:{\r\n        top_collideable:function(sprite)\r\n        {\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        fourside_collideable:function(sprite)\r\n        {\r\n\r\n            for(var x in Gamestack.__gameWindow.forces)\r\n            {\r\n                var force = Gamestack.__gameWindow.forces[x];\r\n\r\n                force.clasticObjects.push(sprite);\r\n\r\n            }\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n\r\n        }\r\n    },\r\n\r\n    MainGravity:{\r\n\r\n        very_light:function(sprite)\r\n        {\r\n            //Add a gravity to the game\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"very_light_grav\",\r\n                accel:0.05,\r\n                max:new Vector3(0, 3.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        light:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"light_grav\",\r\n                accel:0.1,\r\n                max:new Vector3(0, 4.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        medium:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"medium_grav\",\r\n                accel:0.2,\r\n                max:new Vector3(0, 7.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n\r\n        strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.4,\r\n                max:new Vector3(0, 10.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n        very_strong:function(sprite)\r\n        {\r\n\r\n            var gravity = Gamestack.add(new Force({\r\n                name:\"strong_grav\",\r\n                accel:0.5,\r\n                max:new Vector3(0, 12.5, 0),\r\n                subjects:[sprite], //sprite is the subject of this Force, sprite is pulled by this force\r\n                clasticObjects:[] //an empty array of collideable objects\r\n\r\n            }));\r\n\r\n            sprite.onUpdate(function(){\r\n\r\n\r\n            });\r\n\r\n        },\r\n\r\n    },\r\n\r\n\r\n    ControllerStickMotion: {\r\n\r\n        __args: {},\r\n\r\n        player_move_x: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Quazar || Quick2d;\r\n\r\n            Quazar.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                spr.decelX(0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_move_xy: function (sprite) {\r\n\r\n            alert('applying initializer');\r\n\r\n            console.log('side_scroll_player_run:init-ing');\r\n\r\n            let __lib = Quazar || Quick2d;\r\n\r\n            Quazar.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    x = 0;\r\n                }\r\n\r\n                if (Math.abs(y) < 0.2) {\r\n                    y = 0;\r\n                }\r\n\r\n                var accel = 0.2; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accelX(accel, x * max);\r\n\r\n                sprite.accelY(accel, y * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.speed, 'x', 0.1);\r\n\r\n                sprite.decel(sprite.speed, 'y', 0.1);\r\n\r\n            });\r\n\r\n\r\n        },\r\n\r\n        player_rotate_x: function (sprite) {\r\n\r\n            let __lib = Quazar || Quick2d;\r\n\r\n            Quazar.GamepadAdapter.on('stick_left', 0, function (x, y) {\r\n\r\n                console.log('stick-x:' + x);\r\n\r\n                if (Math.abs(x) < 0.2) {\r\n                    return 0;\r\n                }\r\n\r\n                var accel = 0.25; //todo : options for accel\r\n                var max = 7;\r\n\r\n                sprite.accel(sprite.rot_speed, 'x', accel, x * max);\r\n\r\n                if (x < -0.2) {\r\n                    sprite.flipX = true;\r\n\r\n                }\r\n                else if (x > 0.2) {\r\n                    sprite.flipX = false;\r\n\r\n                }\r\n\r\n            });\r\n\r\n            sprite.onUpdate(function (spr) {\r\n\r\n                sprite.decel(sprite.rot_speed, 'x', 0.1);\r\n\r\n                if (!spr.__falling) {\r\n                    spr.decelY(0.2)\r\n                }\r\n                ;\r\n\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\nGameStack.options = GameStack.options || {};\r\n\r\nGameStack.options.SpriteInitializers = SpriteInitializersOptions;;\r\n/**\r\n * Takes arguments of x, y, and (optionally) z, AND returns a Vector object\r\n\r\n <ul>\r\n <li>Optional: use a Vector as the 'x' argument, and instantiate new distinct Vector from the argument</li>\r\n </ul>\r\n\r\n * @param   {number} x the x coordinate\r\n * @param   {number} y the y coordinate\r\n * @param   {number} z the z coordinate\r\n * @returns {Vector} a Vector object\r\n */\r\n\r\n\r\nclass Vector {\r\n    constructor(x, y, z, r) {\r\n\r\n        if(typeof(x) == 'object' && x.hasOwnProperty('x') && x.hasOwnProperty('y')) //optionally pass vector3\r\n        {\r\n            this.x = x.x;\r\n            this.y = x.y;\r\n            this.z = x.z || 0;\r\n\r\n            return this;\r\n        }\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.r = r;\r\n\r\n    }\r\n\r\n\r\n    sub(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector3(this.x - v.x, this.y - v.y, this.z - v.z);\r\n\r\n    }\r\n\r\n    add(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector3(this.x + v.x, this.y + v.y, this.z + v.z);\r\n\r\n    }\r\n\r\n    mult(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector3(this.x * v.x, this.y * v.y, this.z * v.z);\r\n\r\n    }\r\n    div(v)\r\n    {\r\n        if(typeof(v) == 'number')\r\n        {\r\n            v = {x:v, y:v, z:v};\r\n        };\r\n\r\n        return new Vector3(this.x / v.x, this.y / v.y, this.z / v.z);\r\n    }\r\n\r\n    round()\r\n    {\r\n        return new Vector3(Math.round(this.x), Math.round(this.y), Math.round(this.z));\r\n\r\n    }\r\n    floor()\r\n    {\r\n        return new Vector3(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z));\r\n\r\n    }\r\n    ceil()\r\n    {\r\n        return new Vector3(Math.ceil(this.x), Math.ceil(this.y), Math.ceil(this.z));\r\n\r\n    }\r\n\r\n    diff()\r\n    {\r\n        //TODO:this function\r\n\r\n\r\n    }\r\n\r\n    abs_diff()\r\n    {\r\n        //TODO:this function\r\n\r\n    }\r\n\r\n    is_between(v1, v2)\r\n    {\r\n       //TODO : overlap vectors return boolean\r\n\r\n    }\r\n\r\n}\r\n;\r\n\r\nlet Vector3 = Vector, Pos = Vector, Size = Vector, Position = Vector, Vector2 = Vector, Rotation = Vector;\r\n\r\n//The above are a list of synonymous expressions for Vector. All of these do the same thing in this library (store x,y,z values)\r\n;/**\r\n * Created by The Blakes on 04-13-2017\r\n *\r\n */\r\n\r\n\r\nclass InterfaceCallback\r\n{\r\n    constructor({name, description, callback})\r\n    {\r\n\r\n       this.name = name;\r\n\r\n       this.description = description;\r\n\r\n       this.callback = callback || function(){ console.info('The call was empty'); };\r\n\r\n    }\r\n\r\n    run()\r\n    {\r\n\r\n        this.callback();\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nclass SpeechInterfaceStructure\r\n{\r\n    constructor({name, description})\r\n    {\r\n        this.name = name || \"Program helper.\";\r\n\r\n        this.description = description || \"An interface for the game-builder program.\";\r\n\r\n        this.options_structure = {\r\n\r\n        scroll:function(x, y){}, //simple scroll controller\r\n\r\n\r\n\r\n        create_object_resource:{\r\n\r\n            constructors:Quazar.IF.__allConstructors(),\r\n\r\n            selectedType:false,\r\n\r\n            selectByName:Quazar.IF.selectByName,\r\n\r\n            apply_speech_value:Quazar.IF.applySpeechValue()\r\n\r\n        }, //apply each class in the program, with means of creating / instantiating\r\n\r\n        save_object_resource:{\r\n\r\n            selected_object:false,\r\n\r\n            confirm:Quazar.IF.confirmation()\r\n\r\n        }, //apply each class in the program, with means of saving\r\n\r\n        retrieve_object_resource:{}, //retrieve\r\n\r\n        browse_object_resources:{}, //browsing\r\n\r\n        search_object_resources:{}, //searching\r\n\r\n        delete_object_resources:{}, //delete\r\n\r\n        apply_value:{} //apply a value to an object resource\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}