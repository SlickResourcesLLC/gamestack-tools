"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function jstr(obj){return JSON.stringify(obj)}function $Q(selector){var $GFunx={};$GFunx.each=function(callback){for(var x=0;x<this.length;x++)"number"==typeof x&&callback(x,this[x])},$GFunx.on=function(evt_key,selectorObject,controller_ix,callback){if(__gameStack.isAtPlay)return console.error("Cannot call $Q().on while game is at play. Please rig your events before gameplay.");var criterion=$Q.between("[","]",evt_key);criterion.indexOf("===")>=0&&(criterion=criterion.replace("===","=")),criterion.indexOf("==")>=0&&(criterion=criterion.replace("==","=").replace("==",0));var cparts=criterion.split("=");evt_key.indexOf("[")>=0&&(evt_key=$Q.before("[",evt_key).trim());var padding=0;"padding"==cparts[0].toLowerCase()&&(padding=parseFloat(cparts[1]),alert("padding:"+padding)),controller_ix&&"function"==typeof controller_ix&&!callback&&(callback=controller_ix,controller_ix=0),selectorObject&&"function"==typeof selectorObject&&!callback&&(callback=selectorObject,selectorObject=$Q("*"),controller_ix=0);var evt_profile={};if(evt_profile.cix=controller_ix,evt_profile.evt_key=evt_key,$Q.contains_any(["stick","button","click","key"],evt_profile.evt_key)){evt_profile.evt_key.indexOf("button")>=0;Gamestack.GamepadAdapter.on(evt_profile.evt_key,0,function(x,y){callback(x,y)}),console.info("detected input event key in:"+evt_profile.evt_key),console.info("TODO: rig events")}else if($Q.contains_any(["collide","collision","hit","touch"],evt_profile.evt_key))console.info("Rigging a collision event"),console.info("detected collision event key in:"+evt_profile.evt_key),console.info("TODO: rig collision events"),this.each(function(ix,item1){selectorObject.each(function(iy,item2){"function"==typeof item1.onUpdate&&item1.onUpdate(function(sprite){item1.collidesRectangular(item2,padding)&&callback(item1,item2)})})});else{console.info("Rigging a property event"),console.info("detected property threshhold event key in:"+evt_profile.evt_key),console.info("TODO: rig property events");var condition="_",key=criterion||evt_profile.evt_key;(key.indexOf("[")>=0||key.indexOf("]")>=0)&&(key=$Q.between("[","]",key));var evt_parts=[],run=function(){console.error("Sprite property check was not set correctly")};key.indexOf(">=")>=0?condition=">=":key.indexOf("<=")>=0?condition="<=":key.indexOf(">")>=0?condition=">":key.indexOf("<")>=0?condition="<":key.indexOf("=")>=0&&(condition="="),evt_parts=key.split(condition);for(var x=0;x<evt_parts.length;x++)evt_parts[x]=evt_parts[x].replace("=","").replace("=","").trim();var mykey,number;try{mykey=evt_parts[0],number=parseFloat(evt_parts[1])}catch(e){console.log(e)}switch(console.info("Processing condition with:"+condition),condition){case">=":run=function(obj,key){obj[key]>=number&&callback()};break;case"<=":run=function(obj,key){obj[key]<=number&&callback()};break;case">":run=function(obj,key){obj[key]>number&&callback()};break;case"<":run=function(obj,key){obj[key]<number&&callback()};break;case"=":run=function(obj,key){obj[key]==number&&callback()}}var keys=mykey.split("."),propkey="";this.each(function(ix,item){var object={};if(1==keys.length?(object=item,propkey=mykey):2==keys.length?(object=item[keys[0]],propkey=keys[1]):3==keys.length?(object=item[keys[0]][keys[1]],propkey=keys[2]):console.error(":length of '.' notation out of range. We use max length of 3 or prop.prop.key."),"function"==typeof item.onUpdate){item.onUpdate(function(sprite){run(object,propkey)})}})}};var object_out={};if(selector&&"*"!==selector){var s=selector||"";console.info("selector:"+s);var mainSelector=$Q.before("[",s).trim(),msfChar=mainSelector.substring(0,1),__targetClassName="*",cleanSelectorString=function(str){return str.replace(",","")};switch(msfChar.toLowerCase()){case".":console.info('Selecting by "." or class'),__targetClassName=cleanSelectorString($Q.after(".",mainSelector)),console.info("Target class is:"+__targetClassName);break;case"*":console.info('Selecting by "*" or ANY object in the library instance'),__targetClassName="*"}var criterion=$Q.between("[","]",s),cparts=criterion.split("="),__targetType="*",__targetName="*",getParts=function(){if(cparts.length>=2)switch(cparts[0].toLowerCase()){case"name":console.log("Detected parts in selector:"+jstr(cparts)),__targetName=cleanSelectorString(cparts[1]);break;case"type":console.log("Detected parts in selector:"+jstr(cparts)),__targetType=cleanSelectorString(cparts[1])}if(cparts.length>=4)switch(cparts[2]=cparts[2].replace(",",""),cparts[2].toLowerCase()){case"name":console.log("Detected parts in selector:"+jstr(cparts)),__targetName=cleanSelectorString(cparts[3]);break;case"type":console.log("Detected parts in selector:"+jstr(cparts)),__targetType=cleanSelectorString(cparts[3])}};getParts(cparts),object_out=GameStack.select(__targetClassName,__targetName,__targetType)}else"*"==selector&&(object_out=GameStack.all_objects);for(var x in $GFunx)object_out[x]=$GFunx[x];return object_out}function FilterUtils(){this.HSVtoRGB=function(h,s,v){var r,g,b,i=Math.floor(6*h),f=6*h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return[255*r,255*g,255*b]},this.RGBtoHSV=function(r,g,b){r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),v=max,d=max-min;if(s=0===max?0:d/max,max===min)h=0;else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[h,s,v]},this.getPixel=function(pixels,x,y,width,height){var pix=4*(y*width+x);return x<0||x>=width||y<0||y>=height?[pixels[4*(this.clampPixel(y,0,height-1)*width+this.clampPixel(x,0,width-1))],pixels[4*(this.clampPixel(y,0,height-1)*width+this.clampPixel(x,0,width-1))+1],pixels[4*(this.clampPixel(y,0,height-1)*width+this.clampPixel(x,0,width-1))+2],pixels[4*(this.clampPixel(y,0,height-1)*width+this.clampPixel(x,0,width-1))+3]]:[pixels[pix],pixels[pix+1],pixels[pix+2],pixels[pix+3]]};var nextGaussian,haveNextGaussian=!1;this.gaussianRandom=function(){if(haveNextGaussian)return haveNextGaussian=!1,nextGaussian;var v1,v2,s;do v1=2*Math.random()-1,v2=2*Math.random()-1,s=v1*v1+v2*v2;while(s>=1||0===s);var mult=Math.sqrt(-2*Math.log(s)/s);return nextGaussian=v2*mult,haveNextGaussian=!0,v1*mult},this.clampPixel=function(x,a,b){return x<a?a:x>b?b:x},this.triangle=function(x){var r=this.mod(x,1);return 2*(r<.5?r:1-r)},this.mod=function(a,b){var n=parseInt(a/b,10);return a-=n*b,a<0?a+b:a},this.mixColors=function(t,rgb1,rgb2){var r=this.linearInterpolate(t,rgb1[0],rgb2[0]),g=this.linearInterpolate(t,rgb1[1],rgb2[1]),b=this.linearInterpolate(t,rgb1[2],rgb2[2]),a=this.linearInterpolate(t,rgb1[3],rgb2[3]);return[r,g,b,a]},this.linearInterpolate=function(t,a,b){return a+t*(b-a)},this.bilinearInterpolate=function(x,y,nw,ne,sw,se){var m0,m1,r0=nw[0],g0=nw[1],b0=nw[2],a0=nw[3],r1=ne[0],g1=ne[1],b1=ne[2],a1=ne[3],r2=sw[0],g2=sw[1],b2=sw[2],a2=sw[3],r3=se[0],g3=se[1],b3=se[2],a3=se[3],cx=1-x,cy=1-y;m0=cx*a0+x*a1,m1=cx*a2+x*a3;var a=cy*m0+y*m1;m0=cx*r0+x*r1,m1=cx*r2+x*r3;var r=cy*m0+y*m1;m0=cx*g0+x*g1,m1=cx*g2+x*g3;var g=cy*m0+y*m1;m0=cx*b0+x*b1,m1=cx*b2+x*b3;var b=cy*m0+y*m1;return[r,g,b,a]},this.tableFilter=function(inputData,table,width,height){for(var y=0;y<height;y++)for(var x=0;x<width;x++)for(var pixel=4*(y*width+x),i=0;i<3;i++)inputData[pixel+i]=table[inputData[pixel+i]]},this.convolveFilter=function(inputData,matrix,width,height){var rows,cols,outputData=[];rows=cols=Math.sqrt(matrix.length);for(var rows2=parseInt(rows/2,10),cols2=parseInt(cols/2,10),y=0;y<height;y++)for(var x=0;x<width;x++){for(var pixel=4*(y*width+x),r=0,g=0,b=0,row=-rows2;row<=rows2;row++){var ioffset,iy=y+row;ioffset=0<=iy&&iy<height?iy*width:y*width;for(var moffset=cols*(row+rows2)+cols2,col=-cols2;col<=cols2;col++){var f=matrix[moffset+col];if(0!==f){var ix=x+col;0<=ix&&ix<width||(ix=x);var iPixel=4*(ioffset+ix);r+=f*inputData[iPixel],g+=f*inputData[iPixel+1],b+=f*inputData[iPixel+2]}}}outputData[pixel]=parseInt(r+.5,10),outputData[pixel+1]=parseInt(g+.5,10),outputData[pixel+2]=parseInt(b+.5,10),outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]},this.transformFilter=function(inputData,transformInverse,width,height){for(var out=[],outputData=[],j=0;j<inputData.length;j++)outputData[j]=inputData[j];for(var y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x);transformInverse.apply(this,[x,y,out]);var nw,ne,sw,se,srcX=Math.floor(out[0]),srcY=Math.floor(out[1]),xWeight=out[0]-srcX,yWeight=out[1]-srcY;if(srcX>=0&&srcX<width-1&&srcY>=0&&srcY<height-1){var i=4*(width*srcY+srcX);nw=[inputData[i],inputData[i+1],inputData[i+2],inputData[i+3]],ne=[inputData[i+4],inputData[i+5],inputData[i+6],inputData[i+7]],sw=[inputData[i+4*width],inputData[i+4*width+1],inputData[i+4*width+2],inputData[i+4*width+3]],se=[inputData[i+4*(width+1)],inputData[i+4*(width+1)+1],inputData[i+4*(width+1)+2],inputData[i+4*(width+1)+3]]}else nw=this.getPixel(inputData,srcX,srcY,width,height),ne=this.getPixel(inputData,srcX+1,srcY,width,height),sw=this.getPixel(inputData,srcX,srcY+1,width,height),se=this.getPixel(inputData,srcX+1,srcY+1,width,height);var rgba=this.bilinearInterpolate(xWeight,yWeight,nw,ne,sw,se);outputData[pixel]=rgba[0],outputData[pixel+1]=rgba[1],outputData[pixel+2]=rgba[2],outputData[pixel+3]=rgba[3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function BlurFilter(){this.name="Blur",this.isDirAnimatable=!1,this.defaultValues={amount:3},this.valueRanges={amount:{min:0,max:10}},this.filter=function(input,values){var q,width=input.width,width4=width<<2,height=input.height,inputData=input.data,amount=values.amount;amount<0&&(amount=0),q=amount>=2.5?.98711*amount-.9633:amount>=.5?3.97156-4.14554*Math.sqrt(1-.26891*amount):2*amount*(3.97156-4.14554*Math.sqrt(.865545));var index,indexLast,pixel,ppixel,pppixel,ppppixel,qq=q*q,qqq=qq*q,b0=1.57825+2.44413*q+1.4281*qq+.422205*qqq,b1=(2.44413*q+2.85619*qq+1.26661*qqq)/b0,b2=-(1.4281*qq+1.26661*qqq)/b0,b3=.422205*qqq/b0,bigB=1-(b1+b2+b3),c=0;for(c=0;c<3;c++)for(var y=0;y<height;y++){for(index=y*width4+c,indexLast=y*width4+(width-1<<2)+c,pixel=inputData[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index<=indexLast;index+=4)pixel=bigB*inputData[index]+b1*ppixel+b2*pppixel+b3*ppppixel,inputData[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel;for(index=y*width4+(width-1<<2)+c,indexLast=y*width4+c,pixel=inputData[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index>=indexLast;index-=4)pixel=bigB*inputData[index]+b1*ppixel+b2*pppixel+b3*ppppixel,inputData[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel}for(c=0;c<3;c++)for(var x=0;x<width;x++){for(index=(x<<2)+c,indexLast=(height-1)*width4+(x<<2)+c,pixel=inputData[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index<=indexLast;index+=width4)pixel=bigB*inputData[index]+b1*ppixel+b2*pppixel+b3*ppppixel,inputData[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel;for(index=(height-1)*width4+(x<<2)+c,indexLast=(x<<2)+c,pixel=inputData[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index>=indexLast;index-=width4)pixel=bigB*inputData[index]+b1*ppixel+b2*pppixel+b3*ppppixel,inputData[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel}}}function BrightnessFilter(){this.name="Brightness",this.isDirAnimatable=!0,this.defaultValues={amount:0},this.valueRanges={amount:{min:-1,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var amount=void 0===values.amount?this.defaultValues.amount:values.amount,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),hsv=filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);hsv[2]+=amount,hsv[2]<0?hsv[2]=0:hsv[2]>1&&(hsv[2]=1);for(var rgb=filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]),i=0;i<3;i++)inputData[pixel+i]=rgb[i]}}}function BumpFilter(){this.name="Bump",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data,matrix=[-1,-1,0,-1,1,1,0,1,1];filterUtils.convolveFilter(inputData,matrix,width,height)}}function CircleSmearFilter(){this.name="Circle Smear",this.isDirAnimatable=!1,this.defaultValues={size:4,density:.5,mix:.5},this.valueRanges={size:{min:1,max:10},density:{min:0,max:1},mix:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],j=0;j<inputData.length;j++)outputData[j]=inputData[j];void 0===values&&(values=this.defaultValues);var size=void 0===values.size?this.defaultValues.size:values.size;size<1&&(size=1),size=parseInt(size,10);for(var density=void 0===values.density?this.defaultValues.density:values.density,mix=void 0===values.mix?this.defaultValues.mix:values.mix,radius=size+1,radius2=radius*radius,numShapes=parseInt(2*density/30*width*height/2,10),i=0;i<numShapes;i++)for(var sx=(Math.random()*Math.pow(2,32)&2147483647)%width,sy=(Math.random()*Math.pow(2,32)&2147483647)%height,rgb2=[inputData[4*(sy*width+sx)],inputData[4*(sy*width+sx)+1],inputData[4*(sy*width+sx)+2],inputData[4*(sy*width+sx)+3]],x=sx-radius;x<sx+radius+1;x++)for(var y=sy-radius;y<sy+radius+1;y++){var f=(x-sx)*(x-sx)+(y-sy)*(y-sy);if(x>=0&&x<width&&y>=0&&y<height&&f<=radius2)for(var rgb1=[outputData[4*(y*width+x)],outputData[4*(y*width+x)+1],outputData[4*(y*width+x)+2],outputData[4*(y*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y*width+x)+k]=mixedRGB[k]}for(var l=0;l<outputData.length;l++)inputData[l]=outputData[l]}}function ContrastFilter(){if(this.name="Contrast",this.isDirAnimatable=!0,this.defaultValues={amount:1},this.valueRanges={amount:{min:0,max:2}},!FilterUtils)return void(console&&console.error("Unable to find filterutils.js, please include this file! (Required by "+this.name+" filter)"));var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var amount=void 0===values.amount?this.defaultValues.amount:values.amount;amount<0&&(amount=0);for(var table=[],i=0;i<256;i++)table[i]=parseInt(255*((i/255-.5)*amount+.5),10);filterUtils.tableFilter(inputData,table,width,height)}}function CrossSmearFilter(){this.name="Cross Smear",this.isDirAnimatable=!1,this.defaultValues={distance:8,density:.5,mix:.5},this.valueRanges={distance:{min:0,max:30},density:{min:0,max:1},mix:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],j=0;j<inputData.length;j++)outputData[j]=inputData[j];void 0===values&&(values=this.defaultValues);var distance=void 0===values.distance?this.defaultValues.distance:values.distance;distance<0&&(distance=0),distance=parseInt(distance,10);for(var density=void 0===values.density?this.defaultValues.density:values.density,mix=void 0===values.mix?this.defaultValues.mix:values.mix,numShapes=parseInt(2*density*width*height/(distance+1),10),i=0;i<numShapes;i++){for(var rgb1,mixedRGB,k,x=(Math.random()*Math.pow(2,32)&2147483647)%width,y=(Math.random()*Math.pow(2,32)&2147483647)%height,length=Math.random()*Math.pow(2,32)%distance+1,rgb2=[inputData[4*(y*width+x)],inputData[4*(y*width+x)+1],inputData[4*(y*width+x)+2],inputData[4*(y*width+x)+3]],x1=x-length;x1<x+length+1;x1++)if(x1>=0&&x1<width)for(rgb1=[outputData[4*(y*width+x1)],outputData[4*(y*width+x1)+1],outputData[4*(y*width+x1)+2],outputData[4*(y*width+x1)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y*width+x1)+k]=mixedRGB[k];for(var y1=y-length;y1<y+length+1;y1++)if(y1>=0&&y1<height)for(rgb1=[outputData[4*(y1*width+x)],outputData[4*(y1*width+x)+1],outputData[4*(y1*width+x)+2],outputData[4*(y1*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y1*width+x)+k]=mixedRGB[k]}for(var l=0;l<outputData.length;l++)inputData[l]=outputData[l]}}function DiffusionFilter(){this.name="Diffusion",this.isDirAnimatable=!1,this.defaultValues={scale:4},this.valueRanges={scale:{min:1,max:100}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var scale=void 0===values.scale?this.defaultValues.scale:values.scale,sinTable=[],cosTable=[],i=0;i<256;i++){var angle=2*Math.PI*i/256;sinTable[i]=scale*Math.sin(angle),cosTable[i]=scale*Math.cos(angle)}transInverse=function(x,y,out){var angle=parseInt(255*Math.random(),10),distance=Math.random();out[0]=x+distance*sinTable[angle],out[1]=y+distance*cosTable[angle]},filterUtils.transformFilter(inputData,transInverse,width,height)}}function DitherFilter(){this.name="Dither",this.isDirAnimatable=!1,this.defaultValues={levels:3,color:!0},this.valueRanges={levels:{min:2,max:30},color:{min:!1,max:!0}};new FilterUtils;this.filter=function(input,values){var i,j,width=input.width,height=input.height,inputData=input.data,outputData=[];for(j=0;j<inputData.length;j++)outputData[j]=0;void 0===values&&(values=this.defaultValues);var levels=void 0===values.levels?this.defaultValues.levels:values.levels,color=void 0===values.color?this.defaultValues.color:values.color;levels<=1&&(levels=1);var matrix=[0,0,0,0,0,7,3,5,1],sum=16,index=0,map=[];for(i=0;i<levels;i++)map[i]=parseInt(255*i/(levels-1),10);var div=[];for(i=0;i<256;i++)div[i]=parseInt(levels*i/256,10);for(var y=0;y<height;y++){var direction,reverse=1==(1&y);reverse?(index=4*(y*width+width-1),direction=-1):(index=y*width*4,direction=1);for(var x=0;x<width;x++){var r1=inputData[index],g1=inputData[index+1],b1=inputData[index+2];color||(r1=g1=b1=parseInt((r1+g1+b1)/3,10));var r2=map[div[r1]],g2=map[div[g1]],b2=map[div[b1]];outputData[index]=r2,outputData[index+1]=g2,outputData[index+2]=b2,outputData[index+3]=inputData[index+3];var er=r1-r2,eg=g1-g2,eb=b1-b2;for(i=-1;i<=1;i++){var iy=i+y;if(0<=iy&&iy<height)for(j=-1;j<=1;j++){var jx=j+x;if(0<=jx&&jx<width){var w;if(w=reverse?matrix[3*(i+1)-j+1]:matrix[3*(i+1)+j+1],0!==w){var k=reverse?index-4*j:index+4*j;r1=inputData[k],g1=inputData[k+1],b1=inputData[k+2];var factor=w/sum;r1+=er*factor,g1+=eg*factor,b1+=eb*factor,inputData[k]=r1,inputData[k+1]=g1,inputData[k+2]=b1}}}}index+=4*direction}}for(j=0;j<outputData.length;j++)inputData[j]=outputData[j]}}function EdgeFilter(){this.name="Edge Detection",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={};var matrixH=[-1,-2,-1,0,0,0,1,2,1],matrixV=[-1,0,1,-2,0,2,-1,0,1];this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),rh=0;gh=0,bh=0;var rv=0;gv=0,bv=0;for(var row=-1;row<=1;row++){var ioffset,iy=y+row;ioffset=iy>=0&&iy<height?iy*width*4:y*width*4;for(var moffset=3*(row+1)+1,col=-1;col<=1;col++){var ix=x+col;ix>=0&&ix<width||(ix=x),ix*=4;var r=inputData[ioffset+ix],g=inputData[ioffset+ix+1],b=inputData[ioffset+ix+2],h=matrixH[moffset+col],v=matrixV[moffset+col];rh+=parseInt(h*r,10),bh+=parseInt(h*g,10),gh+=parseInt(h*b,10),rv+=parseInt(v*r,10),gv+=parseInt(v*g,10),bv+=parseInt(v*b,10)}}r=parseInt(Math.sqrt(rh*rh+rv*rv)/1.8,10),g=parseInt(Math.sqrt(gh*gh+gv*gv)/1.8,10),b=parseInt(Math.sqrt(bh*bh+bv*bv)/1.8,10),outputData[pixel]=r,outputData[pixel+1]=g,outputData[pixel+2]=b,outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function EmbossFilter(){this.name="Emboss",this.isDirAnimatable=!1,this.defaultValues={height:1,angle:135,elevation:30},this.valueRanges={height:{min:1,max:10},angle:{min:0,max:360},elevation:{min:0,max:180}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var bumpHeight=void 0===values.height?this.defaultValues.height:values.height,angle=void 0===values.angle?this.defaultValues.angle:values.angle,elevation=void 0===values.elevation?this.defaultValues.elevation:values.elevation;angle=angle/180*Math.PI,elevation=elevation/180*Math.PI;for(var width45=3*bumpHeight,pixelScale=255.9,bumpPixels=[],bumpMapWidth=width,i=0;i<inputData.length;i+=4)bumpPixels[i/4]=(inputData[i]+inputData[i+1]+inputData[i+2])/3;var Nx,Ny,Nz,Lx,Ly,Lz,Nz2,NzLz,NdotL,shade,background;Lx=parseInt(Math.cos(angle)*Math.cos(elevation)*pixelScale,10),Ly=parseInt(Math.sin(angle)*Math.cos(elevation)*pixelScale,10),Lz=parseInt(Math.sin(elevation)*pixelScale,10),Nz=parseInt(1530/width45,10),Nz2=Nz*Nz,NzLz=Nz*Lz,background=Lz;for(var bumpIndex=0,y=0;y<height;y++,bumpIndex+=bumpMapWidth)for(var s1=bumpIndex,s2=s1+bumpMapWidth,s3=s2+bumpMapWidth,x=0;x<width;x++,s1++,s2++,s3++){var pixel=4*(y*width+x);0!==y&&y<height-2&&0!==x&&x<width-2?(Nx=bumpPixels[s1-1]+bumpPixels[s2-1]+bumpPixels[s3-1]-bumpPixels[s1+1]-bumpPixels[s2+1]-bumpPixels[s3+1],Ny=bumpPixels[s3-1]+bumpPixels[s3]+bumpPixels[s3+1]-bumpPixels[s1-1]-bumpPixels[s1]-bumpPixels[s1+1],shade=0===Nx&&0===Ny?background:(NdotL=Nx*Lx+Ny*Ly+NzLz)<0?0:parseInt(NdotL/Math.sqrt(Nx*Nx+Ny*Ny+Nz2),10)):shade=background,inputData[pixel]=inputData[pixel+1]=inputData[pixel+2]=shade}}}function ExposureFilter(){this.name="Exposure",this.isDirAnimatable=!0,this.defaultValues={exposure:1},this.valueRanges={exposure:{min:0,max:5}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var exposure=void 0===values.exposure?this.defaultValues.exposure:values.exposure,table=[],i=0;i<256;i++)table[i]=parseInt(255*(1-Math.exp(-(i/255)*exposure)),10);filterUtils.tableFilter(inputData,table,width,height)}}function GainFilter(){this.name="Gain/Bias",this.isDirAnimatable=!0,this.defaultValues={gain:.5,bias:.5},this.valueRanges={gain:{min:0,max:1},bias:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var gain=void 0===values.gain?this.defaultValues.gain:values.gain,bias=void 0===values.bias?this.defaultValues.bias:values.bias,table=[],i=0;i<256;i++){var val=i/255,k=(1/gain-2)*(1-2*val);val=val<.5?val/(k+1):(k-val)/(k-1),val/=(1/bias-2)*(1-val)+1,table[i]=parseInt(255*val,10)}filterUtils.tableFilter(inputData,table,width,height)}}function GammaFilter(){this.name="Gamma",this.isDirAnimatable=!0,this.defaultValues={amount:1},this.valueRanges={amount:{min:0,max:2}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var amount=void 0===values.amount?this.defaultValues.amount:values.amount;if(amount<0&&(amount=0),!FilterUtils)return void(console&&console.error("Unable to find filterutils.js, please include this file! (Required by "+this.name+" filter)"));for(var filterUtils=new FilterUtils,table=[],i=0;i<256;i++)table[i]=255*Math.pow(i/255,1/amount)+.5;filterUtils.tableFilter(inputData,table,width,height)}}function GrayscaleFilter(){this.name="Grayscale",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={},this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),luma=.3*inputData[pixel]+.59*inputData[pixel+1]+.11*inputData[pixel+2];inputData[pixel]=inputData[pixel+1]=inputData[pixel+2]=luma}}}function HueFilter(){this.name="Hue",this.isDirAnimatable=!0,this.defaultValues={amount:0},this.valueRanges={amount:{min:-1,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var amount=void 0===values.amount?this.defaultValues.amount:values.amount,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),hsv=filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);for(hsv[0]+=amount;hsv[0]<0;)hsv[0]+=360;for(var rgb=filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]),i=0;i<3;i++)inputData[pixel+i]=rgb[i]}}}function InvertFilter(){this.name="Invert",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={},this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,y=0;y<height;y++)for(var x=0;x<width;x++)for(var pixel=4*(y*width+x),i=0;i<3;i++)inputData[pixel+i]=255-inputData[pixel+i]}}function KaleidoscopeFilter(){this.name="Kaleidoscope",this.isDirAnimatable=!1,this.defaultValues={angle:0,rotation:0,sides:3,centerX:.5,centerY:.5},this.valueRanges={angle:{min:0,max:360},rotation:{min:0,max:360},sides:{min:1,max:30},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var angle=void 0===values.angle?this.defaultValues.angle:values.angle,rotation=void 0===values.rotation?this.defaultValues.rotation:values.rotation,sides=void 0===values.sides?this.defaultValues.sides:values.sides,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,iCenterX=width*centerX,iCenterY=height*centerY;angle=angle/180*Math.PI,rotation=rotation/180*Math.PI;var transInverse=function(x,y,out){var dx=x-iCenterX,dy=y-iCenterY,r=Math.sqrt(dx*dx+dy*dy),theta=Math.atan2(dy,dx)-angle-rotation;theta=filterUtils.triangle(theta/Math.PI*sides*.5),theta+=angle,out[0]=iCenterX+r*Math.cos(theta),out[1]=iCenterY+r*Math.sin(theta)};filterUtils.transformFilter(inputData,transInverse,width,height)}}function LensDistortionFilter(){this.name="Lens Distortion",this.isDirAnimatable=!1,this.defaultValues={refraction:1.5,radius:50,centerX:.5,centerY:.5},this.valueRanges={refraction:{min:1,max:10},radius:{min:1,max:200},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var refraction=void 0===values.refraction?this.defaultValues.refraction:values.refraction,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,radius=void 0===values.radius?this.defaultValues.radius:values.radius,radius2=radius*radius,iCenterX=width*centerX,iCenterY=height*centerY,transInverse=function(x,y,out){var dx=x-iCenterX,dy=y-iCenterY,x2=dx*dx,y2=dy*dy;if(y2>=radius2-radius2*x2/radius2)out[0]=x,out[1]=y;else{var rRefraction=1/refraction,z=Math.sqrt((1-x2/radius2-y2/radius2)*radius2),z2=z*z,xAngle=Math.acos(dx/Math.sqrt(x2+z2)),angle1=Math.PI/2-xAngle,angle2=Math.asin(Math.sin(angle1)*rRefraction);angle2=Math.PI/2-xAngle-angle2,out[0]=x-Math.tan(angle2)*z;var yAngle=Math.acos(dy/Math.sqrt(y2+z2));angle1=Math.PI/2-yAngle,angle2=Math.asin(Math.sin(angle1)*rRefraction),angle2=Math.PI/2-yAngle-angle2,out[1]=y-Math.tan(angle2)*z}};filterUtils.transformFilter(inputData,transInverse,width,height)}}function LineSmearFilter(){this.name="Line Smear",this.isDirAnimatable=!1,this.defaultValues={distance:8,density:.5,angle:0,mix:.5},this.valueRanges={distance:{min:1,max:30},density:{min:0,max:1},angle:{min:0,max:360},mix:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var k,width=input.width,height=input.height,inputData=input.data,outputData=[];for(k=0;k<inputData.length;k++)outputData[k]=inputData[k];void 0===values&&(values=this.defaultValues);var distance=void 0===values.distance?this.defaultValues.distance:values.distance;distance<1&&(distance=1),distance=parseInt(distance,10);var density=void 0===values.density?this.defaultValues.density:values.density,angle=void 0===values.angle?this.defaultValues.angle:values.angle,mix=void 0===values.mix?this.defaultValues.mix:values.mix;angle=angle/180*Math.PI;for(var sinAngle=Math.sin(angle),cosAngle=Math.cos(angle),numShapes=parseInt(2*density*width*height/2,10),i=0;i<numShapes;i++){var x,y,d,incrE,incrNE,ddx,ddy,sx=(Math.random()*Math.pow(2,32)&2147483647)%width,sy=(Math.random()*Math.pow(2,32)&2147483647)%height,length=(Math.random()*Math.pow(2,32)&2147483647)%distance+1,rgb2=[inputData[4*(sy*width+sx)],inputData[4*(sy*width+sx)+1],inputData[4*(sy*width+sx)+2],inputData[4*(sy*width+sx)+3]],dx=parseInt(length*cosAngle,10),dy=parseInt(length*sinAngle,10),x0=sx-dx,y0=sy-dy,x1=sx+dx,y1=sy+dy;ddx=x1<x0?-1:1,ddy=y1<y0?-1:1,dx=x1-x0,dy=y1-y0,dx=Math.abs(dx),dy=Math.abs(dy),x=x0,y=y0;var rgb1,mixedRGB;if(x<width&&x>=0&&y<height&&y>=0)for(rgb1=[outputData[4*(y*width+x)],outputData[4*(y*width+x)+1],outputData[4*(y*width+x)+2],outputData[4*(y*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y*width+x)+k]=mixedRGB[k];if(Math.abs(dx)>Math.abs(dy)){for(d=2*dy-dx,incrE=2*dy,incrNE=2*(dy-dx);x!=x1;)if(d<=0?d+=incrE:(d+=incrNE,y+=ddy),x+=ddx,x<width&&x>=0&&y<height&&y>=0)for(rgb1=[outputData[4*(y*width+x)],outputData[4*(y*width+x)+1],outputData[4*(y*width+x)+2],outputData[4*(y*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y*width+x)+k]=mixedRGB[k]}else for(d=2*dx-dy,incrE=2*dx,incrNE=2*(dx-dy);y!=y1;)if(d<=0?d+=incrE:(d+=incrNE,x+=ddx),y+=ddy,x<width&&x>=0&&y<height&&y>=0)for(rgb1=[outputData[4*(y*width+x)],outputData[4*(y*width+x)+1],outputData[4*(y*width+x)+2],outputData[4*(y*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2),k=0;k<3;k++)outputData[4*(y*width+x)+k]=mixedRGB[k]}for(k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function MaximumFilter(){this.name="Maximum",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={},this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],y=0;y<height;y++)for(var x=0;x<width;x++){for(var pixel=4*(y*width+x),maxR=0,maxG=0,maxB=0,dy=-1;dy<=1;dy++){var iy=y+dy;if(iy>=0&&iy<height)for(var dx=-1;dx<=1;dx++){var ix=x+dx;if(ix>=0&&ix<width){var iPixel=4*(iy*width+ix);maxR=Math.max(maxR,inputData[iPixel]),maxG=Math.max(maxG,inputData[iPixel+1]),maxB=Math.max(maxB,inputData[iPixel+2])}}}outputData[pixel]=maxR,outputData[pixel+1]=maxG,outputData[pixel+2]=maxB,outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function MedianFilter(){this.name="Median",this.isDirAnimatable=!1,this.defaultValues={},this.valueRanges={},this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],y=0;y<height;y++)for(var x=0;x<width;x++){for(var pixel=4*(y*width+x),rList=[],gList=[],bList=[],dy=-1;dy<=1;dy++){var iy=y+dy;if(iy>=0&&iy<height)for(var dx=-1;dx<=1;dx++){var ix=x+dx;if(ix>=0&&ix<width){var iPixel=4*(iy*width+ix);rList.push(inputData[iPixel]),gList.push(inputData[iPixel+1]),
bList.push(inputData[iPixel+2])}}}var sortFunc=function(a,b){return a-b};rList.sort(sortFunc),gList.sort(sortFunc),bList.sort(sortFunc),outputData[pixel]=rList[4],outputData[pixel+1]=gList[4],outputData[pixel+2]=bList[4],outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function MinimumFilter(){this.name="Minimum",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={},this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,outputData=[],y=0;y<height;y++)for(var x=0;x<width;x++){for(var pixel=4*(y*width+x),minR=255,minG=255,minB=255,dy=-1;dy<=1;dy++){var iy=y+dy;if(iy>=0&&iy<height)for(var dx=-1;dx<=1;dx++){var ix=x+dx;if(ix>=0&&ix<width){var iPixel=4*(iy*width+ix);minR=Math.min(minR,inputData[iPixel]),minG=Math.min(minG,inputData[iPixel+1]),minB=Math.min(minB,inputData[iPixel+2])}}}outputData[pixel]=minR,outputData[pixel+1]=minG,outputData[pixel+2]=minB,outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function NoiseFilter(){this.name="Noise",this.isDirAnimatable=!0,this.defaultValues={amount:25,density:1,monochrome:!0},this.valueRanges={amount:{min:0,max:100},density:{min:0,max:1},monochrome:{min:!1,max:!0}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var amount=void 0===values.amount?this.defaultValues.amount:values.amount,density=void 0===values.density?this.defaultValues.density:values.density,monochrome=void 0===values.monochrome?this.defaultValues.monochrome:values.monochrome,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x);if(Math.random()<=density){var n;if(monochrome)n=parseInt((2*Math.random()-1)*amount,10),inputData[pixel]+=n,inputData[pixel+1]+=n,inputData[pixel+2]+=n;else for(var i=0;i<3;i++)n=parseInt((2*Math.random()-1)*amount,10),inputData[pixel+i]+=n}}}}function OilFilter(){this.name="Oil Painting",this.isDirAnimatable=!1,this.defaultValues={range:3},this.valueRanges={range:{min:0,max:5}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data,outputData=[];void 0===values&&(values=this.defaultValues);var range=void 0===values.range?this.defaultValues.range:values.range;range=parseInt(range,10);for(var rHistogram=[],gHistogram=[],bHistogram=[],rTotal=[],gTotal=[],bTotal=[],levels=256,y=0;y<height;y++)for(var x=0;x<width;x++){for(var pixel=4*(y*width+x),j=0;j<levels;j++)rHistogram[j]=gHistogram[j]=bHistogram[j]=rTotal[j]=gTotal[j]=bTotal[j]=0;for(var row=-range;row<=range;row++){var ioffset,iy=y+row;if(0<=iy&&iy<height){ioffset=iy*width;for(var col=-range;col<=range;col++){var ix=x+col;if(0<=ix&&ix<width){var ro=inputData[4*(ioffset+ix)],go=inputData[4*(ioffset+ix)+1],bo=inputData[4*(ioffset+ix)+2],ri=ro*levels/256,gi=go*levels/256,bi=bo*levels/256;rTotal[ri]+=ro,gTotal[gi]+=go,bTotal[bi]+=bo,rHistogram[ri]++,gHistogram[gi]++,bHistogram[bi]++}}}}for(var r=0,g=0,b=0,i=1;i<levels;i++)rHistogram[i]>rHistogram[r]&&(r=i),gHistogram[i]>gHistogram[g]&&(g=i),bHistogram[i]>bHistogram[b]&&(b=i);r=rTotal[r]/rHistogram[r],g=gTotal[g]/gHistogram[g],b=bTotal[b]/bHistogram[b],outputData[pixel]=r,outputData[pixel+1]=g,outputData[pixel+2]=b,outputData[pixel+3]=inputData[pixel+3]}for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function OpacityFilter(){this.name="Opacity",this.isDirAnimatable=!0,this.defaultValues={amount:1},this.valueRanges={amount:{min:0,max:1}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var amount=void 0===values.amount?this.defaultValues.amount:values.amount,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x);inputData[pixel+3]=255*amount}}}function PinchFilter(){this.name="Pinch/Whirl",this.isDirAnimatable=!1,this.defaultValues={amount:.5,radius:100,angle:0,centerX:.5,centerY:.5},this.valueRanges={amount:{min:-1,max:1},radius:{min:1,max:200},angle:{min:0,max:360},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var amount=void 0===values.amount?this.defaultValues.amount:values.amount,angle=void 0===values.angle?this.defaultValues.angle:values.angle,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,radius=void 0===values.radius?this.defaultValues.radius:values.radius,radius2=radius*radius;angle=angle/180*Math.PI;var iCenterX=width*centerX,iCenterY=height*centerY,transInverse=function(x,y,out){var dx=x-iCenterX,dy=y-iCenterY,distance=dx*dx+dy*dy;if(distance>radius2||0===distance)out[0]=x,out[1]=y;else{var d=Math.sqrt(distance/radius2),t=Math.pow(Math.sin(.5*Math.PI*d),-amount);dx*=t,dy*=t;var e=1-d,a=angle*e*e,s=Math.sin(a),c=Math.cos(a);out[0]=iCenterX+c*dx-s*dy,out[1]=iCenterY+s*dx+c*dy}};filterUtils.transformFilter(inputData,transInverse,width,height)}}function PixelationFilter(){this.name="Pixelation",this.isDirAnimatable=!1,this.defaultValues={size:5},this.valueRanges={size:{min:1,max:50}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var size=void 0===values.size?this.defaultValues.size:values.size;size=parseInt(size,10);for(var by,bx,bPixel,y=0;y<height;y+=size)for(var x=0;x<width;x+=size){var w=Math.min(size,width-x),h=Math.min(size,height-y),t=w*h,r=0,g=0,b=0;for(by=y;by<y+h;by++)for(bx=x;bx<x+w;bx++)bPixel=4*(by*width+bx),r+=inputData[bPixel],g+=inputData[bPixel+1],b+=inputData[bPixel+2];for(by=y;by<y+h;by++)for(bx=x;bx<x+w;bx++)bPixel=4*(by*width+bx),inputData[bPixel]=r/t,inputData[bPixel+1]=g/t,inputData[bPixel+2]=b/t}}}function PosterizeFilter(){this.name="Posterize",this.isDirAnimatable=!1,this.defaultValues={levels:6},this.valueRanges={levels:{min:2,max:30}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var levels=void 0===values.levels?this.defaultValues.levels:parseInt(values.levels,10);if(!(levels<=1)){for(var table=[],i=0;i<256;i++)table[i]=parseInt(255*parseInt(i*levels/256,10)/(levels-1),10);filterUtils.tableFilter(inputData,table,width,height)}}}function RGBAdjustFilter(){this.name="RGBAdjust",this.isDirAnimatable=!0,this.defaultValues={red:1,green:1,blue:1},this.valueRanges={red:{min:0,max:2},green:{min:0,max:2},blue:{min:0,max:2}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var red=void 0===values.red?this.defaultValues.red:values.red,green=void 0===values.green?this.defaultValues.green:values.green,blue=void 0===values.blue?this.defaultValues.blue:values.blue;red<0&&(red=0),green<0&&(green=0),blue<0&&(blue=0);for(var y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x);inputData[pixel]*=red,inputData[pixel+1]*=green,inputData[pixel+2]*=blue}}}function SaturationFilter(){this.name="Saturation",this.isDirAnimatable=!0,this.defaultValues={amount:1},this.valueRanges={amount:{min:0,max:2}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var amount=void 0===values.amount?this.defaultValues.amount:values.amount,RW=.3,RG=.59,RB=.11,a=(1-amount)*RW+amount,b=(1-amount)*RW,c=(1-amount)*RW,d=(1-amount)*RG,e=(1-amount)*RG+amount,f=(1-amount)*RG,g=(1-amount)*RB,h=(1-amount)*RB,i=(1-amount)*RB+amount,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),pR=inputData[pixel],pG=inputData[pixel+1],pB=inputData[pixel+2];inputData[pixel]=a*pR+d*pG+g*pB,inputData[pixel+1]=b*pR+e*pG+h*pB,inputData[pixel+2]=c*pR+f*pG+i*pB}}}function SawtoothRippleFilter(){this.name="Sawtooth Ripples",this.isDirAnimatable=!1,this.defaultValues={xAmplitude:5,yAmplitude:5,xWavelength:16,yWavelength:16},this.valueRanges={xAmplitude:{min:0,max:30},yAmplitude:{min:0,max:30},xWavelength:{min:1,max:50},yWavelength:{min:1,max:50}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var xAmplitude=void 0===values.xAmplitude?this.defaultValues.xAmplitude:values.xAmplitude,yAmplitude=void 0===values.yAmplitude?this.defaultValues.yAmplitude:values.yAmplitude,xWavelength=void 0===values.xWavelength?this.defaultValues.xWavelength:values.xWavelength,yWavelength=void 0===values.yWavelength?this.defaultValues.yWavelength:values.yWavelength,transInverse=function(x,y,out){var nx=y/xWavelength,ny=x/yWavelength,fx=filterUtils.mod(nx,1),fy=filterUtils.mod(ny,1);out[0]=x+xAmplitude*fx,out[1]=y+yAmplitude*fy};filterUtils.transformFilter(inputData,transInverse,width,height)}}function SepiaFilter(){this.name="Sepia",this.isDirAnimatable=!0,this.defaultValues={amount:10},this.valueRanges={amount:{min:0,max:30}};new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var amount=void 0===values.amount?this.defaultValues.amount:values.amount;amount*=2.55;for(var y=0;y<height;y++)for(var x=0;x<width;x++){var r,g,b,pixel=4*(y*width+x),luma=.3*inputData[pixel]+.59*inputData[pixel+1]+.11*inputData[pixel+2];r=g=b=luma,r+=40,g+=20,b-=amount,inputData[pixel]=r,inputData[pixel+1]=g,inputData[pixel+2]=b}}}function SharpenFilter(){this.name="Sharpen",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data,matrix=[0,-.2,0,-.2,1.8,-.2,0,-.2,0];filterUtils.convolveFilter(inputData,matrix,width,height)}}function SineRippleFilter(){this.name="Sine Ripples",this.isDirAnimatable=!1,this.defaultValues={xAmplitude:5,yAmplitude:5,xWavelength:16,yWavelength:16},this.valueRanges={xAmplitude:{min:0,max:30},yAmplitude:{min:0,max:30},xWavelength:{min:1,max:50},yWavelength:{min:1,max:50}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var xAmplitude=void 0===values.xAmplitude?this.defaultValues.xAmplitude:values.xAmplitude,yAmplitude=void 0===values.yAmplitude?this.defaultValues.yAmplitude:values.yAmplitude,xWavelength=void 0===values.xWavelength?this.defaultValues.xWavelength:values.xWavelength,yWavelength=void 0===values.yWavelength?this.defaultValues.yWavelength:values.yWavelength,transInverse=function(x,y,out){var nx=y/xWavelength,ny=x/yWavelength,fx=Math.sin(nx),fy=Math.sin(ny);out[0]=x+xAmplitude*fx,out[1]=y+yAmplitude*fy};filterUtils.transformFilter(inputData,transInverse,width,height)}}function SolarizeFilter(){this.name="Solarize",this.isDirAnimatable=!0,this.defaultValues={},this.valueRanges={};var filterUtils=new FilterUtils;this.filter=function(input,values){for(var width=input.width,height=input.height,inputData=input.data,table=[],i=0;i<256;i++){var val=i/255>.5?2*(i/255-.5):2*(.5-i/255);table[i]=parseInt(255*val,10)}filterUtils.tableFilter(inputData,table,width,height)}}function SparkleFilter(){this.name="Sparkle",this.isDirAnimatable=!1,this.defaultValues={rays:50,size:25,amount:50,randomness:25,centerX:.5,centerY:.5},this.valueRanges={rays:{min:1,max:100},size:{min:1,max:200},amount:{min:0,max:100},randomness:{min:0,max:50},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var rays=void 0===values.rays?this.defaultValues.rays:values.rays;rays=parseInt(rays,10);for(var size=void 0===values.size?this.defaultValues.size:values.size,amount=void 0===values.amount?this.defaultValues.amount:values.amount,randomness=void 0===values.randomness?this.defaultValues.randomness:values.randomness,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,iCenterX=centerX*width,iCenterY=centerY*height,rayLengths=[],j=0;j<rays;j++)rayLengths[j]=size+randomness/100*size*filterUtils.gaussianRandom();for(var y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),dx=x-iCenterX,dy=y-iCenterY,distance=dx*dx+dy*dy,angle=Math.atan2(dy,dx),d=(angle+Math.PI)/(2*Math.PI)*rays,i=parseInt(d,10),f=d-i;if(0!==size){var length=filterUtils.linearInterpolate(f,rayLengths[i%rays],rayLengths[(i+1)%rays]),g=length*length/(distance+1e-4);g=Math.pow(g,(100-amount)/50),f-=.5,f=1-f*f,f*=g}f=filterUtils.clampPixel(f,0,1);for(var mixedRGB=filterUtils.mixColors(f,[inputData[pixel],inputData[pixel+1],inputData[pixel+2],inputData[pixel+3]],[255,255,255,255]),k=0;k<3;k++)inputData[pixel+k]=mixedRGB[k]}}}function SquareSmearFilter(){this.name="Square Smear",this.isDirAnimatable=!1,this.defaultValues={size:4,density:.5,mix:.5},this.valueRanges={size:{min:1,max:10},density:{min:0,max:1},mix:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var k,width=input.width,height=input.height,inputData=input.data,outputData=[];for(k=0;k<inputData.length;k++)outputData[k]=inputData[k];void 0===values&&(values=this.defaultValues);var size=void 0===values.size?this.defaultValues.size:values.size;size<1&&(size=1),size=parseInt(size,10);for(var density=void 0===values.density?this.defaultValues.density:values.density,mix=void 0===values.mix?this.defaultValues.mix:values.mix,radius=size+1,numShapes=parseInt(2*density/30*width*height/2,10),i=0;i<numShapes;i++)for(var sx=(Math.random()*Math.pow(2,32)&2147483647)%width,sy=(Math.random()*Math.pow(2,32)&2147483647)%height,rgb2=[inputData[4*(sy*width+sx)],inputData[4*(sy*width+sx)+1],inputData[4*(sy*width+sx)+2],inputData[4*(sy*width+sx)+3]],x=sx-radius;x<sx+radius+1;x++)for(var y=sy-radius;y<sy+radius+1;y++)if(x>=0&&x<width&&y>=0&&y<height){var rgb1=[outputData[4*(y*width+x)],outputData[4*(y*width+x)+1],outputData[4*(y*width+x)+2],outputData[4*(y*width+x)+3]],mixedRGB=filterUtils.mixColors(mix,rgb1,rgb2);for(k=0;k<3;k++)outputData[4*(y*width+x)+k]=mixedRGB[k]}for(k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function ThresholdFilter(){this.name="Black & White",this.isDirAnimatable=!0,this.defaultValues={threshold:127},this.valueRanges={threshold:{min:0,max:255}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);for(var threshold=void 0===values.threshold?this.defaultValues.threshold:values.threshold,y=0;y<height;y++)for(var x=0;x<width;x++){var pixel=4*(y*width+x),brightness=(inputData[pixel]+inputData[pixel+1]+inputData[pixel+2])/3,colorVal=0;brightness>threshold&&(colorVal=255),inputData[pixel]=inputData[pixel+1]=inputData[pixel+2]=colorVal}}}function TriangleRippleFilter(){this.name="Triangle Ripples",this.isDirAnimatable=!1,this.defaultValues={xAmplitude:5,yAmplitude:5,xWavelength:16,yWavelength:16},this.valueRanges={xAmplitude:{min:0,max:30},yAmplitude:{min:0,max:30},xWavelength:{min:1,max:50},yWavelength:{min:1,max:50}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var xAmplitude=void 0===values.xAmplitude?this.defaultValues.xAmplitude:values.xAmplitude,yAmplitude=void 0===values.yAmplitude?this.defaultValues.yAmplitude:values.yAmplitude,xWavelength=void 0===values.xWavelength?this.defaultValues.xWavelength:values.xWavelength,yWavelength=void 0===values.yWavelength?this.defaultValues.yWavelength:values.yWavelength,transInverse=function(x,y,out){var nx=y/xWavelength,ny=x/yWavelength,fx=filterUtils.triangle(nx,1),fy=filterUtils.triangle(ny,1);out[0]=x+xAmplitude*fx,out[1]=y+yAmplitude*fy};filterUtils.transformFilter(inputData,transInverse,width,height)}}function TwirlFilter(){this.name="Twirl",this.isDirAnimatable=!1,this.defaultValues={radius:100,angle:180,centerX:.5,centerY:.5},this.valueRanges={radius:{min:1,max:200},angle:{min:0,max:360},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var angle=void 0===values.angle?this.defaultValues.angle:values.angle,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,radius=void 0===values.radius?this.defaultValues.radius:values.radius,radius2=radius*radius;angle=angle/180*Math.PI;var iCenterX=width*centerX,iCenterY=height*centerY,transInverse=function(x,y,out){var dx=x-iCenterX,dy=y-iCenterY,distance=dx*dx+dy*dy;if(distance>radius2)out[0]=x,out[1]=y;else{distance=Math.sqrt(distance);var a=Math.atan2(dy,dx)+angle*(radius-distance)/radius;out[0]=iCenterX+distance*Math.cos(a),out[1]=iCenterY+distance*Math.sin(a)}};filterUtils.transformFilter(inputData,transInverse,width,height)}}function VignetteFilter(){this.name="Vignette",this.isDirAnimatable=!1,this.defaultValues={amount:.3},this.valueRanges={amount:{min:0,max:1}},this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data,outputData=[];void 0===values&&(values=this.defaultValues);var amount=void 0===values.amount?this.defaultValues.amount:values.amount,canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;var gradient,context=canvas.getContext("2d"),radius=Math.sqrt(Math.pow(width/2,2)+Math.pow(height/2,2));context.putImageData(input,0,0),context.globalCompositeOperation="source-over",gradient=context.createRadialGradient(width/2,height/2,0,width/2,height/2,radius),gradient.addColorStop(0,"rgba(0,0,0,0)"),gradient.addColorStop(.5,"rgba(0,0,0,0)"),gradient.addColorStop(1,"rgba(0,0,0,"+amount+")"),context.fillStyle=gradient,context.fillRect(0,0,width,height),outputData=context.getImageData(0,0,width,height).data;for(var k=0;k<outputData.length;k++)inputData[k]=outputData[k]}}function WaterRippleFilter(){this.name="Water Ripples",this.isDirAnimatable=!1,this.defaultValues={phase:0,radius:50,wavelength:16,amplitude:10,centerX:.5,centerY:.5},this.valueRanges={phase:{min:0,max:100},radius:{min:1,max:200},wavelength:{min:1,max:100},amplitude:{min:1,max:100},centerX:{min:0,max:1},centerY:{min:0,max:1}};var filterUtils=new FilterUtils;this.filter=function(input,values){var width=input.width,height=input.height,inputData=input.data;void 0===values&&(values=this.defaultValues);var wavelength=void 0===values.wavelength?this.defaultValues.wavelength:values.wavelength,amplitude=void 0===values.amplitude?this.defaultValues.amplitude:values.amplitude,phase=void 0===values.phase?this.defaultValues.phase:values.phase,centerX=void 0===values.centerX?this.defaultValues.centerX:values.centerX,centerY=void 0===values.centerY?this.defaultValues.centerY:values.centerY,radius=void 0===values.radius?this.defaultValues.radius:values.radius,radius2=radius*radius,iCenterX=width*centerX,iCenterY=height*centerY,transInverse=function(x,y,out){var dx=x-iCenterX,dy=y-iCenterY,distance2=dx*dx+dy*dy;if(distance2>radius2)out[0]=x,out[1]=y;else{var distance=Math.sqrt(distance2),amount=amplitude*Math.sin(distance/wavelength*Math.PI*2-phase);amount*=(radius-distance)/radius,0!==distance&&(amount*=wavelength/distance),out[0]=x+dx*amount,out[1]=y+dy*amount}};filterUtils.transformFilter(inputData,transInverse,width,height)}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Gamestack={},GameStackLibrary=function(){var lib={DEBUG:!1,gui_mode:!0,__gameWindow:{},__sprites:[],__animations:[],spriteTypes:[],systemSpriteTypes:["player","enemy","background","interactive"],systemAnimationTypes:{attack_0:"System.attack_0",attack_1:"System.attack_1",attack_2:"System.attack_2",attack_3:"System.attack_3",attack_4:"System.attack_4",defend_0:"System.defend_0",defend_1:"System.defend_1",defend_2:"System.defend_2",defend_3:"System.defend_3",defend_4:"System.defend_4",heal_0:"System.heal_0",heal_1:"System.heal_1",heal_2:"System.heal_2",heal_3:"System.heal_3",heal_4:"System.heal_4"},samples:{},log_modes:["reqs","info","warning"],log_mode:"all",recursionCount:0,__gameWindowList:[],create_id:function(){var d=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})},getObjectById:function(id){for(var x=0;x<this.all_objects.length;x++)if(this.all_objects[x].id==id)return this.all_objects[x]},getAllCallables:function(){var actionables=[];$Q.each(this.sprites,function(ix,item){actionables.concat(item.sounds),actionables.concat(item.motionstacks),actionables.concat(item.animations)})},interlog:function(message,div){this.recursionCount++,!isNaN(div)&&this.recursionCount%div==0},error:function(quit,message){if(quit)throw new Error(message);console.error("E!"+message)},info:function(m){GameStack.DEBUG&&console.info("Info:"+m)},log:function(m){GameStack.DEBUG&&console.log("GameStack:"+m)},animate:function(time){__gameStack.isAtPlay=!0,TWEEN.update(time),requestAnimationFrame(__gameStack.animate),__gameStack.__gameWindow.update(),__gameStack.__gameWindow.ctx.clearRect(0,0,__gameStack.__gameWindow.canvas.width,__gameStack.__gameWindow.canvas.height),__gameStack.__gameWindow.draw()},start:function(){this.animate()},Collision:{spriteRectanglesCollide:function(obj1,obj2){var paddingX=Math.round(obj1.padding.x*obj1.size.x),paddingY=Math.round(obj1.padding.y*obj1.size.y),left=obj1.position.x+paddingX,right=obj1.position.x+obj1.size.x-paddingX,top=obj1.position.y+paddingY,bottom=obj1.position.y+obj1.size.y-paddingY;if(right>obj2.position.x&&left<obj2.position.x+obj2.size.x&&bottom>obj2.position.y&&top<obj2.position.y+obj2.size.y)return!0}},TWEEN:TWEEN,_gameWindow:{},setGameWindow:function(gameWindow){this._gameWindow=gameWindow},ExtendEvents:function(extendedObject,extendedKey,extendor,extendorKey,extendorFunc){function EventLink(extendedObject,extendedKey,extendor,extendorKey){this.parent_id=extendedObject.id,this.child_id=extendor.id,this.parent_key=extendedKey,this.child_key=extendorKey}new EventLink(extendedObject,extendedKey,extendor,extendorKey);this.all_objects.push(new EventLink(extendedObject,extendedKey,extendor,extendorKey));var parent=extendedObject;console.log(parent),parent&&(console.log("EXTENDING EVENTS:"+extendedKey+":"+extendorKey),parent.onRun&&parent.onRun(extendor,extendorKey))},getGameWindow:function(){return this._gameWindow},assignAll:function(object,args,keys){__gameStack.each(keys,function(ix,item){object[ix]=args[ix]})},each:function(list,onResult,onComplete){for(var i in list)onResult(i,list[i]);"function"==typeof onComplete&&onComplete(!1,list)},ready_callstack:[],ready:function(callback){this.ready_callstack.push(callback)},reload:function(){this.callReady()},callReady:function(){var funx=this.ready_callstack,gameWindow=this._gameWindow,lib=this,sprites=this.__gameWindow.sprites;this.each(funx,function(ix,call){call(lib,gameWindow,sprites)}),this.InputEvents.init(),this.__running=!0},getArg:function(args,key,fallback){return args&&args.hasOwnProperty(key)?args[key]:fallback},add:function(obj){if(obj instanceof GameWindow&&(this.__gameWindow=obj),obj instanceof Force&&this.__gameWindow.forces.push(obj),obj instanceof Camera&&(this.__gameWindow.camera=obj),obj instanceof Sprite&&this.__gameWindow.sprites.push(obj),obj instanceof GSEvent){if(__gameStack.__running)return console.error("Events can only be added before Gamstack.animate() is called::aka before the main update / loop begins");obj.apply()}return this.collect(obj),obj},remove:function(obj){if(obj instanceof Sprite){var ix=this.__gameWindow.sprites.indexOf(obj);this.__gameWindow.sprites.splice(ix,1)}},all_objects:[],collect:function(obj){this.all_objects.push(obj)},isNormalStringMatch:function(str1,str2){return str1.toLowerCase().replace(" ","")==str2.toLowerCase().replace(" ","")},instance_type_pairs:function(){var objectList=[];return this.each(this.all_objects,function(ix,item){objectList.push({constructor_name:item.constructor.name,type:item.type})}),objectList},getById:function(id){for(var x in this.all_objects)if(this.all_objects[x].id==id)return this.all_objects[x]},select:function(constructor_name,name,type){var objects_out=[],__inst=this;return this.each(this.all_objects,function(ix,item){"*"!=constructor_name&&item.constructor.name!=constructor_name||("*"==type||__inst.isNormalStringMatch(type,item.type))&&("*"==name||__inst.isNormalStringMatch(name,item.name))&&objects_out.push(item)}),objects_out}};return lib},Sound=function(){function Sound(src,data){if(_classCallCheck(this,Sound),"object"==("undefined"==typeof src?"undefined":_typeof(src))?(this.sound=document.createElement("audio"),this.sound.src=src.src,this.src=src.src):"string"==typeof src&&(this.sound=document.createElement("audio"),this.sound.src=src,this.src=src),"object"==("undefined"==typeof data?"undefined":_typeof(data)))for(var x in data)"sound"!==x&&(this[x]=data[x]);this.onLoad=this.onLoad||function(){},"function"==typeof this.onLoad&&this.onLoad(this.sound)}return _createClass(Sound,[{key:"volume",value:function(val){return this.sound.volume=val,this}},{key:"play",value:function(){"object"==_typeof(this.sound)&&"function"==typeof this.sound.play&&this.sound.play()}}]),Sound}(),SoundList=function(){function SoundList(list){if(_classCallCheck(this,SoundList),this.cix=1,this.sounds=[],list instanceof Array)for(var x in list)list[x].src?this.sounds.push(new Sound(list[x].src,list[x])):"string"==typeof list[x]&&this.sounds.push(new Sound(list[x]))}return _createClass(SoundList,[{key:"add",value:function(src,name){if("object"==("undefined"==typeof src?"undefined":_typeof(src))&&src.src)this.sounds.push(new Sound(src.src,src));else if("string"==typeof src){var data={};name&&(data.name=name),this.sounds.push(new Sound(list[x],data))}}},{key:"playNext",value:function(){this.sounds[this.cix%this.sounds.length].play(),this.cix+=1}},{key:"play",value:function(){this.sounds[this.cix%this.sounds.length].play(),this.cix+=1}}]),SoundList}(),GameImage=function(){function GameImage(src,onCreate){if(_classCallCheck(this,GameImage),src instanceof Object)this.image=document.createElement("IMG"),this.image.src=src.src,this.src=src.src;else if("string"==typeof src){src.substring(src.lastIndexOf("."),src.length);this.image=document.createElement("IMG"),this.image.src=src,this.src=this.image.src}this.image?this.image.onerror=function(){this.__error=!0}:this.image={error:"Image not instantiated, set to object by default"},this.domElement=this.image,this.image.onload=function(){"function"==typeof this.onCreate&&this.onCreate(this.image)}}return _createClass(GameImage,[{key:"getImage",value:function(){return this.image}}]),GameImage}(),GameStack=new GameStackLibrary;Gamestack=GameStack;var __gameStack=GameStack,Quick2d=GameStack,__gameInstance=Gamestack;Gamestack.Sound=Sound,Gamestack.GameImage=GameImage,"undefined"!=typeof module&&module.exports&&(module.exports=Gamestack),Gamestack.jstr=jstr,$Q.each=function(obj,callback,complete){for(var x in obj)callback(obj);"function"==typeof complete&&complete(obj)},$Q.before=function(c1,test_str){var start_pos=0,end_pos=test_str.indexOf(c1,start_pos);return test_str.substring(start_pos,end_pos)},$Q.contains=function(c1,test_str){return test_str.indexOf(c1)>=0},$Q.contains_all=function(cList,test_str){for(var x=0;x<cList.length;x++)if(test_str.indexOf(cList[x])<0)return!1;return!0},$Q.contains_any=function(cList,test_str){for(var x=0;x<cList.length;x++)if(test_str.indexOf(cList[x])>=0)return!0;return!1},$Q.after=function(c1,test_str){var start_pos=test_str.indexOf(c1)+1,end_pos=test_str.length;return test_str.substring(start_pos,end_pos)},$Q.between=function(c1,c2,test_str){var start_pos=test_str.indexOf(c1)+1,end_pos=test_str.indexOf(c2,start_pos);return test_str.substring(start_pos,end_pos)},$Q.test_selector_method=function(){for(var Q_TestStrings=["*",".Sprite",'*[type="enemy_type_0"]','.Sprite[type="enemy_type_0"]'],x=0;x<Q_TestStrings.length;x++){var test=Q_TestStrings[x];console.info("testing:"+test),$Q(test)}console.log("Testing stick left"),this.on("stick_left_0"),console.log("Testing button"),this.on("button_0"),console.log("Testing collide"),this.on("collide"),console.log("Testing button"),this.on("collide"),console.log("Testing prop"),this.on("health>=0")},Gamestack.$Q=$Q,Gamestack.query=$Q,Gamestack.InputEvents={mousemove:[],leftclick:[],rightclick:[],middleclick:[],wheelup:[],wheelDown:[],space:[],tab:[],shift:[],1:[],2:[],3:[],enter:[],extend:function(evt_key,callback,onFinish){if(evt_key.toLowerCase().indexOf("key_")>=0){var cleanKey=evt_key.toLowerCase();return GameStack.InputEvents[cleanKey]=GameStack.InputEvents[cleanKey]||[],GameStack.InputEvents[cleanKey].push({down:callback,up:onFinish})}return GameStack.InputEvents[evt_key]=GameStack.InputEvents[evt_key]||[],GameStack.InputEvents[evt_key].push({down:callback,up:onFinish})},init:function(){function getMousePos(e){var x,y;return e.pageX||e.pageY?(x=e.pageX,y=e.pageY):(x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),x-=GameStack.canvas.offsetLeft,y-=GameStack.canvas.style.top,{x:x,y:y}}function fullMoveInputEvents(event){var pos=getMousePos(event),InputEvents=GameStack.InputEvents;for(var x in InputEvents)InputEvents[x]instanceof Array&&"mousemove"==x&&GameStack.each(InputEvents[x],function(ix,el){el.down(pos.x,pos.y)})}document.onkeydown=function(e){GameStack.log("Got e");var value="key_"+String.fromCharCode(e.keyCode).toLowerCase();GameStack.InputEvents[value]instanceof Array&&(GameStack.log("Got []"),GameStack.each(GameStack.InputEvents[value],function(ix,item){"function"==typeof item.down&&item.down()}))},document.onkeyup=function(e){var value="key_"+String.fromCharCode(e.keyCode).toLowerCase();GameStack.InputEvents[value]instanceof Array&&GameStack.each(GameStack.InputEvents[value],function(ix,item){"function"==typeof item.up&&item.up()})},GameStack.canvas.onmousedown=function(e){var pos=(e.which,getMousePos(e)),InputEvents=GameStack.InputEvents;switch(e.preventDefault(),e.which){case 1:for(var x in InputEvents)InputEvents[x]instanceof Array&&"leftclick"==x&&GameStack.each(InputEvents[x],function(ix,el){el.down(pos.x,pos.y)});break;case 2:for(var x in GameStack.InputEvents)InputEvents[x]instanceof Array&&"middleclick"==x&&GameStack.each(InputEvents[x],function(ix,el){el.down(pos.x,pos.y)});break;case 3:for(var x in GameStack.InputEvents)if(InputEvents[x]instanceof Array&&"rightclick"==x)return GameStack.each(InputEvents[x],function(ix,el){el.down(pos.x,pos.y)}),!1;break;default:return 0}return e.preventDefault(),
0},GameStack.canvas.onmouseup=function(e){var pos=(e.which,getMousePos(e)),InputEvents=GameStack.InputEvents;switch(e.preventDefault(),e.which){case 1:for(var x in InputEvents)InputEvents[x]instanceof Array&&"leftclick"==x&&GameStack.each(InputEvents[x],function(ix,el){el.up(pos.x,pos.y)});break;case 2:for(var x in GameStack.InputEvents)InputEvents[x]instanceof Array&&"middleclick"==x&&GameStack.each(InputEvents[x],function(ix,el){el.up(pos.x,pos.y)});break;case 3:for(var x in GameStack.InputEvents)if(InputEvents[x]instanceof Array&&"rightclick"==x)return GameStack.each(InputEvents[x],function(ix,el){el.up(pos.x,pos.y)}),!1;break;default:return 0}},document.addEventListener("mousemove",fullMoveInputEvents)}},window._preGameStack_windowLoad=window.onload,window.onload=function(){"function"==typeof window._preGameStack_windowLoad&&window._preGameStack_windowLoad(),__gameStack.callReady()},Gamestack.ready(function(lib){Gamestack.log("GameStack:lib :: ready")});var GameWindow=function(){function GameWindow(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$canvas=_ref.canvas,canvas=void 0!==_ref$canvas&&_ref$canvas,sprites=(_ref.ctx,_ref.sprites),backgrounds=_ref.backgrounds,interactives=_ref.interactives,forces=_ref.forces,update=_ref.update;_ref.camera;_classCallCheck(this,GameWindow),this.sprites=sprites instanceof Array?sprites:[],this.backgrounds=backgrounds instanceof Array?backgrounds:[],this.interactives=interactives instanceof Array?interactives:[],this.forces=forces instanceof Array?forces:[],this.canvas=canvas||!1,document.body.style.position="absolute",document.body.style.width="100%",document.body.style.height="100%",this.canvas||(console.info("creating new canvas"),this.canvas=document.createElement("CANVAS"),document.body.append(this.canvas)),this.canvas.style.position="absolute",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.background="black";this.canvas;this.ctx=this.canvas.getContext("2d"),__gameStack.canvas=this.canvas,__gameStack.ctx=this.ctx,this.adjustSize(),window.onresize=function(){__gameStack.__gameWindow.adjustSize()},this.camera=new Camera,this.camera.target=!1,__gameStack.camera=this.camera,"function"==typeof update&&this.onUpdate(update),__gameStack.__gameWindow=this}return _createClass(GameWindow,[{key:"adjustSize",value:function(w,h){w=w||this.canvas.clientWidth,h=h||this.canvas.clientHeight;var c=document.getElementById("#gs-container");c&&c.setAttribute("width",w),c&&c.setAttribute("height",h),__gameStack.WIDTH=w,__gameStack.HEIGHT=h,this.canvas.width=w,this.canvas.height=h}},{key:"uniques",value:function(list){var listout=[];return $Q.each(list,function(ix,item){if(!listout.indexOf(item.id)>=0){item.name;listout.push({sprite:item})}}),listout}},{key:"setPlayer",value:function(player){this.player=player,!this.sprites.indexOf(player)>=0&&this.sprites.push(player)}},{key:"update",value:function(){GameStack.each(this.sprites,function(ix,item){"function"==typeof item.def_update&&item.def_update(item),"function"==typeof item.update&&item.update(item)}),GameStack.each(this.forces,function(ix,item){"function"==typeof item.update&&item.update(item),"function"==typeof item.def_update&&item.def_update(item)})}},{key:"loadLevelFile",value:function(filepath,callback){$.getJSON(filepath,function(data){callback(!1,data)})}},{key:"draw",value:function(){var _gw=this;GameStack.each(this.sprites,function(ix,item){Canvas.draw(item,_gw.ctx)})}}]),GameWindow}();Gamestack.GameWindow=GameWindow;var TextDisplay=function(){function TextDisplay(args){_classCallCheck(this,TextDisplay),args||(args={}),this.widthFloat=args.width||args.widthFloat||.5,this.heightFloat=args.height||args.heightFloat||.5,this.topFloat=args.top||.25,this.targetTop=this.get_float_pixels(this.topFloat,document.body.clientHeight),this.leftFloat=args.left||.25,this.targetLeft=this.get_float_pixels(this.leftFloat,document.body.clientWidth),this.color=args.color||"#ffffff",this.text=args.text||"This is the text",this.fontFamily=args.font||args.fontFamily||"GameStack",this.fadeIn=args.fadeIn||args.fade||!0,this.border="2px inset "+this.color,this.fontSize=args.fontSize||"20px",this.fromLeft=args.fromLeft||!1,this.fromLeft&&(this.leftFloat=1.5),this.fromRight=args.fromRight||!1,this.fromRight&&(this.leftFloat=-.5),this.fromTop=args.fromTop||!1,this.fromTop&&(this.topFloat=-.5),this.fromBottom=args.fromBottom||!1,this.fromBottom&&(this.topFloat=1.5),this.duration=args.duration||5e3,this.stay_duration=Math.round(this.duration/2),this.complete=args.complete||function(){}}return _createClass(TextDisplay,[{key:"get_float_pixels",value:function(float,dimen){return Math.round(dimen*float)+"px"}},{key:"onComplete",value:function(fun){this.complete=fun}},{key:"show",value:function(){this.domElement=document.createElement("P"),this.domElement.style.position="fixed",this.domElement.style.color=this.color,this.domElement.style.padding="10px",this.domElement.style.top=Math.round(document.body.clientHeight*this.topFloat)+"px",this.domElement.style.left=Math.round(document.body.clientWidth*this.leftFloat)+"px",this.domElement.style.width=Math.round(document.body.clientWidth*this.widthFloat)+"px",this.domElement.style.height=Math.round(document.body.clientHeight*this.heightFloat)+"px",this.domElement.style.fontFamily=this.fontFamily,this.domElement.style.fontSize=this.fontSize,this.domElement.style.display="block",this.domElement.style.textAlign="center",this.domElement.style.zIndex="9999",this.domElement.innerText=this.text,this.domElement.textContent=this.text,this.domElement.style.opacity=this.fadeIn?0:1,this.domElement.id=GameStack.create_id(),document.body.append(this.domElement);var __inst=this;Velocity(this.domElement,{opacity:1,top:this.targetTop,left:this.targetLeft},{duration:this.duration,easing:"quadratic"}),window.setTimeout(function(){__inst.stay_duration>=1&&window.setTimeout(function(){Velocity(__inst.domElement,{opacity:0,display:"none"},{duration:300,easing:"linear"}),"function"==typeof __inst.complete&&__inst.complete()},__inst.stay_duration)},this.duration)}}]),TextDisplay}();Gamestack.TextDisplay=TextDisplay;var ItemDisplay=function(){function ItemDisplay(args){_classCallCheck(this,ItemDisplay),this.src=args.src||"__NONE",this.size=args.size||new Vector3(50,50),this.topFloat=args.top||0,this.targetTop=this.get_float_pixels(this.topFloat,GameStack.HEIGHT),this.leftFloat=args.left||0,this.targetLeft=this.get_float_pixels(this.leftFloat,GameStack.WIDTH),this.color=args.color||"#ffffff",this.text=args.text||"This is the text",this.fontFamily=args.font||args.fontFamily||"GameStack",this.fontSize=args.fontSize||args.textSize||"15px",this.text_id=GameStack.create_id(),this.id=GameStack.create_id(),this.img_id=GameStack.create_id()}return _createClass(ItemDisplay,[{key:"setValue",value:function(value){document.getElementById(this.text_id)}},{key:"get_float_pixels",value:function(float,dimen){return Math.round(dimen*float)+"px"}},{key:"get_id",value:function(){return this.id}},{key:"update",value:function(v){var e=document.getElementById(this.text_id);this.text=v+"",e.innerText=this.text}},{key:"show",value:function(){this.domElement=document.createElement("DIV"),this.domElement.setAttribute("class","gameStack-stats"),this.domElement.innerHTML+='<img style="float:left;" width="'+this.size.x+'" height="'+this.size.y+'" id="'+this.img_id+'" src="'+this.src+'"/>',this.domElement.style.color=this.color,this.domElement.innerHTML+='<span id="'+this.text_id+'" style="padding:5px; vertical-align:middle; display:table-cell; font-size:'+this.fontSize+"; color:"+this.color+';">'+this.text+"</span>",this.domElement.style.position="fixed",this.domElement.style.top=this.targetTop,this.domElement.style.left=this.targetLeft,this.domElement.style.fontFamily=this.fontFamily,this.domElement.style.fontSize=this.fontSize,this.domElement.style.zIndex="9999",this.domElement.id=this.id,document.body.append(this.domElement)}}]),ItemDisplay}();Gamestack.ItemDisplay=ItemDisplay;var Bar=function(){function Bar(background,border){_classCallCheck(this,Bar),this.background=background;var e=document.createElement("SPAN");e.style.position="fixed",e.style.background=this.background,e.style.zIndex="9999",e.style.backgroundSize="100% 100%",e.style.backgroundPosition="center bottom",border&&(e.style.border=border),this.domElement=e}return _createClass(Bar,[{key:"width",value:function(w){return this.domElement.style.width=w,this}},{key:"height",value:function(h){return this.domElement.style.height=h,this}}]),Bar}();Gamestack.Bar=Bar;var BarFill=function(){function BarFill(background){_classCallCheck(this,BarFill),this.background=background;var e=document.createElement("SPAN");e.style.background=this.background,e.style.position="fixed",e.style.zIndex="9995",this.domElement=e}return _createClass(BarFill,[{key:"width",value:function(w){return this.domElement.style.width=w,this}},{key:"height",value:function(h){return this.domElement.style.height=h,this}}]),BarFill}();Gamestack.BarFill=BarFill;var BarDisplay=function(){function BarDisplay(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,BarDisplay),this.border=args.border||"none",args.fill_src?this.fill=new BarFill(args.fill_src).width(args.fill_width||"80px").height(args.fill_height||"10px"):this.fill=args.fill||new BarFill(args.fill_color||"green").width(args.fill_width||"80px").height(args.fill_height||"10px"),args.bar_src?this.bar=new Bar(args.bar_src,this.border).width(args.bar_width||"80px").height(args.bar_height||"10px"):this.bar=new Bar(args.bar_color||"goldenrod",this.border).width(args.bar_width||"80px").height(args.bar_height||"10px"),this.topFloat=args.top||args.topFloat||.25,this.leftFloat=args.left||args.leftFloat||.25,this.widthFloat=args.width||args.widthFloat||.25,this.heightFloat=args.height||args.heightFloat||.25,document.body.append(this.fill.domElement),document.body.append(this.bar.domElement)}return _createClass(BarDisplay,[{key:"get_float_pixels",value:function(float,dimen){return Math.round(dimen*float)+"px"}},{key:"portion_top",value:function(v){this.fill.domElement.style.top=this.get_float_pixels(v||this.topFloat,GameStack.HEIGHT),this.bar.domElement.style.top=this.get_float_pixels(v||this.topFloat,GameStack.HEIGHT)}},{key:"portion_left",value:function(v){this.fill.domElement.style.left=this.get_float_pixels(v||this.leftFloat,GameStack.WIDTH),this.bar.domElement.style.left=this.get_float_pixels(v||this.leftFloat,GameStack.WIDTH)}},{key:"portion_width",value:function(w){this.fill.domElement.style.width=this.get_float_pixels(w||this.widthFloat,GameStack.WIDTH),this.bar.domElement.style.width=this.get_float_pixels(w||this.widthFloat,GameStack.WIDTH)}},{key:"portion_height",value:function(h){this.fill.domElement.style.height=this.get_float_pixels(h||this.heightFloat,GameStack.HEIGHT),this.bar.domElement.style.height=this.get_float_pixels(h||this.heightFloat,GameStack.HEIGHT)}},{key:"update",value:function(f){this.fill.domElement.style.width=this.get_float_pixels(f||0,parseFloat(this.bar.domElement.style.width))}}]),BarDisplay}();Gamestack.BarDisplay=BarDisplay;var VideoDisplay=function(){function VideoDisplay(_ref2){var src=_ref2.src,size=_ref2.size;_classCallCheck(this,VideoDisplay),this.domElement=void 0,this.src=src,this.size=new Vector3(size.x,size.y,size.z||0),GameStack.log("VideoDisplay():: TODO: create dom element")}return _createClass(VideoDisplay,[{key:"play",value:function(){}}]),VideoDisplay}();Gamestack.VideoDisplay=VideoDisplay;var JSManipulate={blur:new BlurFilter,brightness:new BrightnessFilter,bump:new BumpFilter,circlesmear:new CircleSmearFilter,contrast:new ContrastFilter,crosssmear:new CrossSmearFilter,diffusion:new DiffusionFilter,dither:new DitherFilter,edge:new EdgeFilter,emboss:new EmbossFilter,exposure:new ExposureFilter,gain:new GainFilter,gamma:new GammaFilter,grayscale:new GrayscaleFilter,hue:new HueFilter,invert:new InvertFilter,kaleidoscope:new KaleidoscopeFilter,lensdistortion:new LensDistortionFilter,linesmear:new LineSmearFilter,maximum:new MaximumFilter,median:new MedianFilter,minimum:new MinimumFilter,noise:new NoiseFilter,oil:new OilFilter,opacity:new OpacityFilter,pinch:new PinchFilter,pixelate:new PixelationFilter,posterize:new PosterizeFilter,rgbadjust:new RGBAdjustFilter,saturation:new SaturationFilter,sawtoothripple:new SawtoothRippleFilter,sepia:new SepiaFilter,sharpen:new SharpenFilter,sineripple:new SineRippleFilter,solarize:new SolarizeFilter,sparkle:new SparkleFilter,squaresmear:new SquareSmearFilter,threshold:new ThresholdFilter,triangleripple:new TriangleRippleFilter,twirl:new TwirlFilter,vignette:new VignetteFilter,waterripple:new WaterRippleFilter},MyJSManipulate={};for(var x in JSManipulate)JSManipulate[x].hasOwnProperty("defaultValues")&&(MyJSManipulate[x]=JSManipulate[x]);Gamestack.JSManipulate=MyJSManipulate;var CanvasLib=function CanvasLib(){return _classCallCheck(this,CanvasLib),{__levelMaker:!1,draw:function(sprite,ctx){sprite.active&&(this.__levelMaker||sprite.onScreen(__gameStack.WIDTH,__gameStack.HEIGHT))&&this.drawPortion(sprite,ctx)},drawFrameWithRotation:function(img,fx,fy,fw,fh,x,y,width,height,deg,canvasContextObj,flip){canvasContextObj.save(),deg=Math.round(deg),deg%=360;var rad=deg*Math.PI/180;canvasContextObj.translate(x,y),canvasContextObj.rotate(rad),canvasContextObj.translate(0,canvasContextObj.width),flip&&canvasContextObj.scale(-1,1),canvasContextObj.drawImage(img,fx,fy,fw,fh,width/2*-1,height/2*-1,width,height),canvasContextObj.restore()},drawData:function(x,y,w,h,data,ctx){ctx.putImageData(data,x,y,0,0,w,h)},drawPortion:function(sprite,ctx){var frame;if(sprite.active){sprite.selected_animation&&sprite.selected_animation.selected_frame?frame=sprite.selected_animation.selected_frame:console.error("Sprite is missing arguments");var p=sprite.position,camera=__gameStack.__gameWindow.camera||{x:0,y:0,z:0},x=p.x,y=p.y;x-=camera.x||0,y-=camera.y||0;var targetSize=sprite.size||sprite.selected_animation.size,realWidth=targetSize.x,realHeight=targetSize.y;sprite.selected_animation&&sprite.selected_animation.hasOwnProperty("offset")&&(x+=sprite.selected_animation.offset.x,y+=sprite.selected_animation.offset.y);var rotation;rotation="object"==_typeof(sprite.rotation)?sprite.rotation.x:sprite.rotation;var frame=sprite.selected_animation.selected_frame;frame&&frame.image&&frame.image.data?ctx.putImageData(frame.image.data,x,y):this.drawFrameWithRotation(sprite.selected_animation.image.domElement,frame.framePos.x,frame.framePos.y,frame.frameSize.x,frame.frameSize.y,Math.round(x+realWidth/2),Math.round(y+realHeight/2),realWidth,realHeight,rotation%360,ctx,sprite.flipX)}}}},Canvas=new CanvasLib;Gamestack.Canvas=Canvas;var Animation=function(){function Animation(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Animation),args=args||{};this.defaultArgs={name:"my-animation",description:"my-description",frames:[],type:"none",delay:0,frameSize:new Vector3(44,44,0),frameBounds:new VectorFrameBounds(new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0)),frameOffset:new Vector3(0,0,0),flipX:!1,duration:1e3,size:new Vector3(20,20,20)};for(var x in this.defaultArgs)args.hasOwnProperty(x)||(args[x]=this.defaultArgs[x]);for(var x in this.args)this[x]=args[x];this.name=args.name||"__",this.description=args.description||"__",this.image=new GameImage(__gameStack.getArg(args,"src",__gameStack.getArg(args,"image",!1))),this.src=this.image.domElement.src,this.domElement=this.image.domElement,this.frameSize=new Vector(args.frameSize||new Vector3(44,44,0)),args.frameBounds?this.frameBounds=new VectorFrameBounds(args.frameBounds.min,args.frameBounds.max,args.frameBounds.termPoint):this.frameBounds=new VectorFrameBounds(new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0)),this.frameOffset=this.getArg(args,"frameOffset",new Vector3(0,0,0)),this.extras=this.getArg(args,"extras",!1),"object"==("undefined"==typeof args?"undefined":_typeof(args))&&args.frameBounds&&args.frameSize&&this.apply2DFrames(args.parent||{}),this.flipX=this.getArg(args,"flipX",!1),this.cix=0,this.selected_frame=this.frames[0],this.timer=0,this.duration=args.duration||2e3,this.seesaw_mode=args.seesaw_mode||!1,this.run_ext=args.run_ext||[]}return _createClass(Animation,[{key:"singleFrame",value:function(frameSize,size){return this.__frametype="single",this.frameSize=frameSize,this.size=size||this.frameSize,this.selected_frame={image:this.image,frameSize:this.frameSize,framePos:{x:0,y:0}},this.frames[0]=this.selected_frame,this}},{key:"getArg",value:function(args,key,fallback){return args.hasOwnProperty(key)?args[key]:fallback}},{key:"apply2DFrames",value:function(){this.frames=[];for(var fcount=0,quitLoop=!1,y=this.frameBounds.min.y;y<=this.frameBounds.max.y;y++)for(var _x4=this.frameBounds.min.x;_x4<=this.frameBounds.max.x;_x4++){var framePos={x:_x4*this.frameSize.x+this.frameOffset.x,y:y*this.frameSize.y+this.frameOffset.y};if(this.frames.push({image:this.image,frameSize:this.frameSize,framePos:framePos}),_x4>=this.frameBounds.termPoint.x&&y>=this.frameBounds.termPoint.y){quitLoop=!0;break}if(fcount+=1,quitLoop)break}if(this.frames[0]=this.frames[0]?this.frames[0]:{image:this.image,frameSize:this.frameSize,framePos:{x:this.frameBounds.min.x,y:this.frameBounds.min.y}},this.seesaw_mode){console.log("ANIMATION: applying seesaw");var frames_reversed=this.frames.slice().reverse();this.frames.pop(),this.frames=this.frames.concat(frames_reversed)}}},{key:"resetFrames",value:function(){this.apply2DFrames()}},{key:"update",value:function(){this.selected_frame=this.frames[Math.round(this.cix)%this.frames.length]}},{key:"reset",value:function(){this.resetFrames(),this.cix=0}},{key:"continuous",value:function(duration){return"single"==this.__frametype?0:(this.apply2DFrames(),this.update(),void(0==this.cix&&this.engage()))}},{key:"onRun",value:function(caller,callkey){this.run_ext=this.run_ext||[],this.run_ext.push({caller:caller,callkey:callkey})}},{key:"engage",value:function(duration,complete){for(var x=0;x<this.run_ext.length;x++)this.run_ext[x].caller[this.run_ext[x].callkey]();if(duration=duration||2e3,"single"==this.__frametype)return 0;var __inst=this;this.complete=complete||this.complete||function(){};var duration=duration||"number"==typeof this.duration?this.duration:20*this.frames.length;0==this.cix&&this.extras&&this.extras.call(),this.tween=new TWEEN.Tween(this).easing(__inst.curve||TWEEN.Easing.Linear.None).to({cix:__inst.frames.length-1},duration).onUpdate(function(){__inst.update()}).onComplete(function(){__inst.complete&&__inst.complete(),__inst.cix=0,__inst.isComplete=!0}),this.tween.start()}},{key:"onComplete",value:function(fun){this.complete=fun}},{key:"animate",value:function(){this.apply2DFrames(),this.timer+=1,0!=this.delay&&this.timer%this.delay!=0||(0==this.cix&&this.extras&&this.extras.call(),this.cix>=this.frames.length-1&&"function"==typeof this.complete&&this.complete(this),this.cix=this.cix>=this.frames.length-1?this.frameBounds.min.x:this.cix+1,this.update())}}]),Animation}();Gamestack.Animation=Animation;var Camera=function Camera(args){_classCallCheck(this,Camera),this.position=new Vector3(0,0,0)},EffectSequence=function(){function EffectSequence(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,EffectSequence),console.log("Effect Sequence"),this.animation=args.animation||!1,this.effects=Gamestack.JSManipulate,this.selected_effect=this.effects.triangleripple,this.effects_list=[],this.effects_list[0]=this.selected_effect,this.effect_guis=[],this.numberSteps=10,this.curve=args.curve||TWEEN.Easing.Linear.None,this.counter=0,this.duration=3e3,this.loopBack=!0,this.canvas=document.createElement("canvas"),this.testCtx=this.canvas.getContext("2d"),this.values={},this.initValues(),this.minFloat=function(portion){for(var x in this.startValues)this.startValues[x]=this.valueRanges[x].max*portion},this.maxFloat=function(portion){for(var x in this.endValues)this.endValues[x]=this.valueRanges[x].max*portion}}return _createClass(EffectSequence,[{key:"initValues",value:function(){this.startValues={},this.endValues={};for(var x in this.selected_effect.valueRanges)this.startValues[x]=this.selected_effect.valueRanges[x].min,this.endValues[x]=this.selected_effect.valueRanges[x].max;this.values=JSON.parse(jstr(this.startValues)),this.valueRanges=this.selected_effect.valueRanges}},{key:"Effect",value:function(key){if("object"==("undefined"==typeof key?"undefined":_typeof(key)))this.selected_effect=key;else if("string"==typeof key)for(var x in this.effects)x.toLowerCase()==key.toLowerCase()&&(this.selected_effect=this.effects[key]);return this.initValues(),this}},{key:"foldLeft",value:function(){return this.foldLeft=!0,this}},{key:"foldTop",value:function(){return this.foldTop=!0,this}},{key:"guiCallback",value:function(effect,callback){this.selected_effect=effect||this.effects.triangleripple,dat.GUI.prototype.removeFolder=function(name){var folder=this.__folders[name];folder&&(folder.close(),this.__ul.removeChild(folder.domElement.parentNode),delete this.__folders[name],this.onResize())};var __inst=this;__inst.gui=__inst.gui||!1;var setValues=function(my_gui){my_gui.removeFolder("start-values"),my_gui.removeFolder("end-values");var startValuesGUI=my_gui.addFolder("start-values"),endValuesGUI=my_gui.addFolder("end-values");for(var x in __inst.startValues)__inst.valueRanges.hasOwnProperty(x)&&(startValuesGUI.add(__inst.startValues,x).min(__inst.valueRanges[x].min).max(__inst.valueRanges[x].max),endValuesGUI.add(__inst.endValues,x).min(__inst.valueRanges[x].min).max(__inst.valueRanges[x].max))};if(__inst.gui);else{__inst.gui=new dat.GUI;var effect_select=__inst.gui.add(__inst,"selected_effect",Object.keys(__inst.effects));effect||(effect_select.setValue("triangleripple"),__inst.selected_effect=__inst.effects.triangleripple),effect_select.onFinishChange(function(value){__inst.selected_effect=__inst.effects[value],__inst.guiCallback(__inst.selected_effect,callback)});var lp=__inst.gui.add(__inst,"loopBack");lp.onChange(function(value){__inst.loopBack=value}),DatGui.addTweenCurveSelect(__inst,__inst.gui)}return setValues(this.gui),DatGui.updateableAnimationObjectToGui(__inst.gui,__inst),window.setTimeout(function(){callback(__inst.gui)},200),this.gui}},{key:"get_image_data_array",value:function(sourceImageData,dataListCallback){if(__inst.image_data_list=[],sourceImageData&&this.selected_effect.hasOwnProperty("filter")){this.values=JSON.parse(jstr(this.startValues));var __inst=this;new TWEEN.Tween(this.values).to(this.endValues,this.duration).easing(this.curve).onUpdate(function(){__inst.counter+=1;var img={data:__inst.image_data_list.data.slice(0)};__inst.selected_effect.filter(img,__inst.values),__inst.image_data_list.push(img),console.log("tween update")}).onComplete(function(){__inst.counter=0,__inst.image_data_list=__inst.loopBack?__inst.image_data_list.concat(__inst.image_data_list.slice().reverse()):__inst.image_data_list,dataListCallback&&dataListCallback(image_data_list)}).start()}}},{key:"get_canvas_array",value:function(sourceImageData,canvasCallback){if(this.canvasList=[],sourceImageData&&this.selected_effect.hasOwnProperty("filter")){var __inst=this;this.image_ix=0;var copyImageData=function(ctx,src){var dst=ctx.createImageData(src.width,src.height);return dst.data.set(src.data),dst};this.complete||(this.values=JSON.parse(jstr(this.startValues)),__inst.tween=new TWEEN.Tween(this.values).to(this.endValues,this.duration).easing(this.curve).onUpdate(function(){var c=document.createElement("CANVAS"),ct=c.getContext("2d");c.width=sourceImageData.width,c.height=sourceImageData.height,c.style.background="blue",ct.restore(),ct.save();var img=copyImageData(ct,sourceImageData);if(__inst.selected_effect.filter(img,__inst.values),ct.putImageData(img,0,0),__inst.foldLeft){var left=ct.getImageData(0,0,c.width/2,c.height);ct.translate(c.width/2,0),ct.scale(-1,1),ct.putImageData(left,0,0)}if(__inst.foldTop){var top=ct.getImageData(0,0,c.width,c.height/2);ct.translate(0,c.height/2),ct.scale(1,-1),ct.putImageData(top,0,0)}__inst.canvasList.push(c),console.log("tween update")}).onComplete(function(){console.log("complete"),__inst.complete||(__inst.complete=!0,__inst.canvasList=__inst.loopBack?__inst.canvasList.concat(__inst.canvasList.slice().reverse()):__inst.canvasList,canvasCallback&&canvasCallback(__inst.canvasList),__inst.tween.stop())}).start())}var animate=function animate(){__inst.complete||(TWEEN.update(),requestAnimationFrame(animate))};animate()}},{key:"apply",value:function(sprite,canvas){if(this.sprite=sprite,this.canvas=canvas,0==this.counter&&canvas&&this.selected_effect&&this.selected_effect.hasOwnProperty("filter")){var copyImageData=function(ctx,src){var dst=ctx.createImageData(src.width,src.height);return dst.data.set(src.data),dst};this.timer_diff=0;var ctx=canvas.getContext("2d");this.source_image=this.source_image||!1,this.values=JSON.parse(jstr(this.startValues));var __inst=this;__inst.image_data_list=[];new TWEEN.Tween(this.values).to(this.endValues,this.duration).easing(this.curve).onUpdate(function(){__inst.source_image||(__inst.source_image=ctx.getImageData(sprite.position.x,sprite.position.y,sprite.size.x,sprite.size.y),console.log("image is set")),sprite.selected_animation.selected_frame.image.data=!1;var img=copyImageData(ctx,__inst.source_image);__inst.selected_effect.filter(img,__inst.values),__inst.image_data_list.push(img),sprite.selected_animation.selected_frame.image.data=img,__inst.counter+=1}).onComplete(function(){if(__inst.loopBack){new TWEEN.Tween(__inst.values).to(__inst.startValues,__inst.duration).easing(__inst.curve).onUpdate(function(){__inst.source_image||(__inst.source_image=ctx.getImageData(sprite.position.x,sprite.position.y,sprite.size.x,sprite.size.y)),sprite.selected_animation.selected_frame.image.data=!1;var img=copyImageData(ctx,__inst.source_image);__inst.selected_effect.filter(img,__inst.values),__inst.image_data_list.push(img),sprite.selected_animation.selected_frame.image.data=img}).onComplete(function(){__inst.counter=0}).start()}else __inst.counter=0}).start()}}}]),EffectSequence}(),Extras=function(){function Extras(args){_classCallCheck(this,Extras),this.items=args||[],"object"==_typeof(this.items)&&(this.items=[this.items]);if(!(this.items instanceof Array))return console.error("Quick2d.Extras.call(), needs array argument")}return _createClass(Extras,[{key:"call",value:function(){for(var items=this.items,x=0;x<items.length;x++){var item=items[x];"function"==typeof item.play&&item.play(),"function"==typeof item.engage&&item.engage(),"function"==typeof item.fire&&item.fire(),"function"==typeof item.start&&item.start(),"function"==typeof item.run&&item.run(),"function"==typeof item.process&&item.process()}}}]),Extras}(),GravityForce=function(){function GravityForce(args){_classCallCheck(this,GravityForce),this.name=args.name||"",this.description=args.description||"",this.subjects=args.subjects||[],this.clasticObjects=args.clasticObjects||[],this.topClastics=args.topClastics||[],this.max=args.max||new Vector3(3,3,3),this.accel=args.accel||new Vector3(1.3,1.3,1.3);for(var x in this.clasticObjects)!this.clasticObjects[x]instanceof Sprite&&(this.clasticObjects[x]=Gamestack.getById(this.clasticObjects[x].id));for(var x in this.topClastics)!this.topClastics[x]instanceof Sprite&&(this.topClastics[x]=Gamestack.getById(this.topClastics[x].id));for(var x in this.subjects)!this.subjects[x]instanceof Sprite&&(this.subjects[x]=Gamestack.getById(this.subjects[x].id))}return _createClass(GravityForce,[{key:"getArg",value:function(args,key,fallback){return args.hasOwnProperty(key)?args[key]:fallback}},{key:"update",value:function(){var subjects=this.subjects,clasticObjects=this.clasticObjects,topClastics=this.topClastics,accel=this.accel||{},max=this.max||{};__gameStack.each(subjects,function(ix,itemx){itemx.accelY(accel,max),itemx.__inAir=!0,itemx.position.y>=itemx.groundMaxY&&(itemx.position.y=itemx.groundMaxY),itemx.groundMaxY=3e6,__gameStack.each(clasticObjects,function(iy,itemy){itemx.collide_stop(itemy)}),__gameStack.each(topClastics,function(iy,itemy){itemx.collide_stop_top(itemy)})})}}]),GravityForce}(),Force=GravityForce;Gamestack.Force=Force,Gamestack.GravityForce=GravityForce;var ControllerEventKeys=function ControllerEventKeys(){return _classCallCheck(this,ControllerEventKeys),{left_stick:!1,right_stick:!1,0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,10:!1,11:!1,12:!1,13:!1,14:!1,15:!1,16:!1,17:!1,18:!1,19:!1}};Gamestack.ControllerEventKeys=ControllerEventKeys,GameStack.gamepads=GameStack.gamepads||__gameInstance.gamepads;var GamepadAdapter=function(){function GamepadAdapter(){_classCallCheck(this,GamepadAdapter),this.__gamepads=[],this.intervals=[];var _gpinst=this;this.events=[],window.setInterval(function(){var gps=navigator.getGamepads();_gpinst.gps=gps;for(var x=0;x<gps.length;x++){var events=_gpinst.__gamepads[x]?_gpinst.__gamepads[x]:{};_gpinst.process(gps[x],events)}},20)}return _createClass(GamepadAdapter,[{key:"gamepads",value:function(){return navigator.getGamepads()}},{key:"disconnect_all",value:function(){for(var x=0;x<this.intervals.length;x++)window.clearInterval(this.intervals[x])}},{key:"disconnect_by_index",value:function(game_pad_index){window.clearInterval(this.intervals[game_pad_index])}},{key:"hasAnyPad",value:function(){return"getGamepads"in navigator}},{key:"Event",value:function(key,game_pad,callback){return{key:key,game_pad:game_pad,callback:callback}}},{key:"GamepadEvents",value:function(args){var gp={};return gp.stick_left=args.stick_left||function(x,y){},gp.stick_right=args.stick_right||function(x,y){},gp.buttons=[],gp.extendFunc=function(f1,f2){return function(x,y){f2(x,y),f1(x,y)}},gp.on=function(key,callback){if(this[key]&&"on"!==key){var current_cb="function"==typeof this[key]?this[key]:function(x,y){};this[key]=this.extendFunc(callback,current_cb)}else if(key.indexOf("button")>=0&&key.indexOf("_")>=0){var number,parts=key.split("_");try{number=parseInt(parts[1]);var current_cb="function"==typeof this.buttons[number]?this.buttons[number]:function(x,y){};this.buttons[number]=this.extendFunc(callback,current_cb)}catch(e){console.error('could not parse "on" event with '+key)}}},gp.constructor={name:"GamepadEvents"},this.__gamepads.push(gp),Gamestack.gamepads=this.__gamepads,gp}},{key:"getGamepads",value:function(){return Gamestack.gamepads}},{key:"process",value:function(gp,gpEvents){this.process_buttons(gp,gpEvents),this.process_axes(gp,gpEvents)}},{key:"process_axes",value:function(gp,events){if(!gp||!gp.axes)return!1;for(var i=0;i<gp.axes.length;i+=2){var ix=(gp.axes[i],gp.axes[i+1],Math.ceil(i/2)+1),x=gp.axes[i],y=gp.axes[i+1];1==ix&&events.stick_left&&events.stick_left(x,y),2==ix&&events.stick_right&&events.stick_right(x,y),this.events&&this.events["stick_"+i]&&"function"==typeof this.events["stick_"+i].callback&&this.events["stick_"+i].callback()}}},{key:"process_buttons",value:function(gp,events){if(!gp||!gp.buttons)return!1;for(var i=0;i<gp.buttons.length;i++){"function"==typeof events.buttons[i]?events.buttons[i](gp.buttons[i].pressed):"object"==_typeof(events.buttons[i])&&"function"==typeof events.buttons[i].update&&events.buttons[i].update(events.buttons[i].pressed);var gpc,clearance_1=this.events&&this.events[i],bkey="button_"+i;clearance_1&&(gpc=this.events[bkey]&&!isNaN(this.events[bkey].game_pad)?this.gamepads[this.events[bkey].game_pad]:this.events[bkey].game_pad),clearance_1&&gpc&&"function"==typeof this.events[bkey].callback&&this.events[i].callback()}}},{key:"on",value:function(key,gpix,callback){gpix>=this.__gamepads.length&&this.__gamepads.push(this.GamepadEvents({})),this.__gamepads[gpix].on(key,callback)}}]),GamepadAdapter}();__gameInstance.GamepadAdapter||(Gamestack.GamepadAdapter=new GamepadAdapter,GameStack.GamepadAdapter.on("stick_left",0,function(x,y){console.log("Gamepad stick left")}),GameStack.GamepadAdapter.on("button_0",0,function(x,y){
console.log("Gamepad button 0")}),GameStack.GamepadAdapter.on("button_1",0,function(x,y){console.log("Gamepad button 1")}),GameStack.GamepadAdapter.on("button_2",0,function(x,y){console.log("Gamepad button 2")}),GameStack.GamepadAdapter.on("button_3",0,function(x,y){console.log("Gamepad button 3")}));var GSEvent=function(){function GSEvent(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,GSEvent),this.name=args.name||"blankEvent",this.on=args.on||"collision",this.object=args.object||{},this.gpix=args.gpix||0,this.ix=args.ix||0,this.targets=args.targets||[],this.triggered=args.triggered||function(){},this.statKey=args.statKey||!1,this.lessThan=args.lessThan||!1,this.greaterThan=args.greaterThan||!1}return _createClass(GSEvent,[{key:"apply",value:function(){var __inst=this;switch(this.on){case"collision":case"collide":$Q(this.object).on("collision",this.targets,function(obj1,obj2){__inst.triggered(obj1,obj2)});break;case"button":$Q(this.object).on("button"+this.ix,function(pressed){__inst.triggered(pressed)});break;case"stick_left":case"stick_right":case"right_stick":case"left_stick":$Q(this.object).on(this.on,function(x,y){__inst.triggered(x,y)});break;case"stat":console.error("STAT CALLS ARE NOT SET-UP YET. Please add this to the Gamestack library");var isStrOrNum=function(str){return"string"==typeof str||"number"==typeof str},onKey="["+this.statKey+(isStrOrNum(this.greaterThan)?">":"")+(isStrOrNum(this.lessThan)?"<":"")+(this.greaterThan||this.lessThan);$Q(this.object).on(onKey,function(x,y){__inst.triggered(x,y)})}}},{key:"triggered",value:function(){}},{key:"onTriggered",value:function(fun){this.triggered=function(){fun()}}},{key:"rejected",value:function(){}},{key:"onRejected",value:function(fun){this.rejected=function(){fun()}}}]),GSEvent}(),Motion=function(){function Motion(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Motion),this.getArg=$Q.getArg,this.distance=new Vector(Gamestack.getArg(args,"distance",new Vector(0,0))),this.curvesList=this.curvesToArray(),this.lineCurvesList=this.lineCurvesToArray(),args.parent instanceof Sprite?(this.parent=args.parent,this.parent_id=args.parent.id):(this.parent_id=args.parent_id||args.object_id||"__blank",this.parent=Gamestack.getObjectById(this.parent_id)),this.motion_curve=Gamestack.getArg(args,"curve",TWEEN.Easing.Quadratic.InOut),this.line_curve=Gamestack.getArg(args,"line_curve",TWEEN.Easing.Linear.None),this.rotation=Gamestack.getArg(args,"rotation",0),this.targetRotation=Gamestack.getArg(args,"targetRotation",0),this.name=Gamestack.getArg(args,"name","__"),this.description=Gamestack.getArg(args,"description",!1),this.motionCurveString=this.getMotionCurveString(),this.lineCurveString=this.getLineCurveString(),this.setMotionCurve(this.motionCurveString),this.setLineCurve(this.lineCurveString),this.duration=Gamestack.getArg(args,"duration",500),this.delay=Gamestack.getArg(args,"delay",0),this.animation=args.animation||!1,this.run_ext=args.run_ext||[]}return _createClass(Motion,[{key:"curvesToArray",value:function(){var c=[];return GameStack.each(TWEEN.Easing,function(ix,easing){GameStack.each(easing,function(iy,easeType){["in","out","inout","none"].indexOf(iy.toLowerCase())>=0&&c.push(ix+"_"+iy)})}),c}},{key:"lineCurvesToArray",value:function(){var c=[];return GameStack.each(TWEEN.Easing,function(ix,easing){GameStack.each(easing,function(iy,easeType){["linear","cubic","quadratic","quartic","quintic"].indexOf(ix.toLowerCase())>=0&&c.push(ix+"_"+iy)})}),c}},{key:"getMotionCurveString",value:function(){var c,__inst=this;return $.each(TWEEN.Easing,function(ix,easing){$.each(TWEEN.Easing[ix],function(iy,easeType){__inst.motion_curve==TWEEN.Easing[ix][iy]&&(c=ix+"_"+iy)})}),c}},{key:"getLineCurveString",value:function(){var c,__inst=this;return $.each(TWEEN.Easing,function(ix,easing){$.each(TWEEN.Easing[ix],function(iy,easeType){__inst.line_curve==TWEEN.Easing[ix][iy]&&(c=ix+"_"+iy)})}),c}},{key:"setLineCurve",value:function(c){var cps=c.split("_"),s1=cps[0],s2=cps[1],curve=TWEEN.Easing.Quadratic.InOut;return $.each(TWEEN.Easing,function(ix,easing){$.each(TWEEN.Easing[ix],function(iy,easeType){ix==s1&&iy==s2&&(curve=TWEEN.Easing[ix][iy])})}),this.line_curve=curve,curve}},{key:"setMotionCurve",value:function(c){var cps=c.split("_"),s1=cps[0],s2=cps[1],curve=TWEEN.Easing.Quadratic.InOut;return $.each(TWEEN.Easing,function(ix,easing){$.each(TWEEN.Easing[ix],function(iy,easeType){ix==s1&&iy==s2&&(curve=TWEEN.Easing[ix][iy])})}),this.motion_curve=curve,curve}},{key:"onRun",value:function(caller,callkey){this.run_ext=this.run_ext||[],this.run_ext.push({caller:caller,callkey:callkey})}},{key:"engage",value:function(){for(var x=0;x<this.run_ext.length;x++)this.run_ext[x].caller[this.run_ext[x].callkey]();var __inst=this,tweens=[],objects={};$.each(Game.sprites,function(ix,item){item.id==__inst.parent_id&&(objects[ix]=item,__inst.animation&&(objects[ix].selected_animation=__inst.animation))});var target={x:__inst.distance.x+objects[0].position.x,y:__inst.distance.y+objects[0].position.y,z:__inst.distance.z+objects[0].position.z};if(__inst.targetRotation>0||__inst.targetRotation<0){var targetR=__inst.targetRotation+objects[0].rotation.x;tweens[0]=new TWEEN.Tween(objects[0].rotation).easing(__inst.curve||__inst.motion_curve).to({x:targetR},__inst.duration).onUpdate(function(){}).onComplete(function(){__inst.complete&&__inst.complete()})}return tweens.push(new TWEEN.Tween(objects[0].position).easing(__inst.motion_curve).to(target,__inst.duration).onUpdate(function(){}).onComplete(function(){__inst.complete&&__inst.complete()})),__inst.delay=!isNaN(__inst.delay)&&__inst.delay>0?__inst.delay:0,{tweens:tweens,delay:__inst.delay,fire:function(){var __tweenObject=this;window.setTimeout(function(){for(var x=0;x<__tweenObject.tweens.length;x++)__tweenObject.tweens[x].start()},this.delay)}}}},{key:"start",value:function(){this.engage().fire()}},{key:"onComplete",value:function(fun){this.complete=fun}},{key:"getGraphCanvas",value:function(t,f,c){var canvas=c||document.createElement("canvas");canvas.style.position="relative",canvas.id="curve-display",canvas.setAttribute("class","motion-curve"),canvas.width=180,canvas.height=100,canvas.style.background="black";var context=canvas.getContext("2d");context.fillStyle="rgb(0,0,0)",context.fillRect(0,0,180,100),context.lineWidth=.5,context.strokeStyle="rgb(230,230,230)",context.beginPath(),context.moveTo(0,20),context.lineTo(180,20),context.moveTo(0,80),context.lineTo(180,80),context.closePath(),context.stroke(),context.lineWidth=2,context.strokeStyle="rgb(255,127,127)";var position={x:5,y:80},position_old={x:5,y:80};return new TWEEN.Tween(position).to({x:175},2e3).easing(TWEEN.Easing.Linear.None).start(),new TWEEN.Tween(position).to({y:20},2e3).easing(f).onUpdate(function(){context.beginPath(),context.moveTo(position_old.x,position_old.y),context.lineTo(position.x,position.y),context.closePath(),context.stroke(),position_old.x=position.x,position_old.y=position.y}).start(),canvas}},{key:"getTweenPoints",value:function(size,line){var points=(line.curve,line.duration,[]),position=new Vector(line.position);new Vector(position).add(size),new Vector(position),new Vector(0,0,0);return points}}]),Motion}();Gamestack.Motion=Motion;var Parallax=function(){function Parallax(options){_classCallCheck(this,Parallax),this.grid=options.grid,this.position=options.position||new Vector,this.scrollCall=options.callback||options.scrollCall||options.scrollCallback||function(){},this.focus=options.object||options.focus||options.sprite||function(){}}return _createClass(Parallax,[{key:"scrollX",value:function(){}},{key:"scrollY",value:function(){}},{key:"scroll",value:function(){}}]),Parallax}(),Projectile=function(){function Projectile(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Projectile),this.getArg=$Q.getArg;for(var x in args)this[x]=args[x];this.name=args.name||"__",this.description=args.description||"__",this.line=new Line(Gamestack.getArg(args,"line",new Line)),this.animation=Gamestack.getArg(args,"animation",new Animation),this.parent_id=args.parent_id||args.object_id||"__blank",this.name=Gamestack.getArg(args,"name","__"),this.size=Gamestack.getArg(args,"size",new Vector),this.origin=args.origin||!1,this.description=Gamestack.getArg(args,"description",!1),this.duration=Gamestack.getArg(args,"duration",500),this.delay=Gamestack.getArg(args,"delay",0),this.position=Gamestack.getArg(args,"position",new Vector(0,0,0)),this.motion_curve=Gamestack.getArg(args,"motion_curve",TWEEN.Easing.Linear.None),this.highlighted=!1,this.sprites=[],this.run_ext=args.run_ext||[]}return _createClass(Projectile,[{key:"onComplete",value:function(fun){this.complete=fun}},{key:"onCollide",value:function(fun){this.collide=fun}},{key:"setAnimation",value:function(anime){return this.animation=anime,this}},{key:"setMotionCurve",value:function(c){return this.motion_curve=c,this}},{key:"kill_one",value:function(){var spr=this.sprites[this.sprites.length-1];Gamestack.remove(spr)}},{key:"onRun",value:function(caller,callkey){this.run_ext=this.run_ext||[],this.run_ext.push({caller:caller,callkey:callkey})}},{key:"fire",value:function(origin){for(var x=0;x<this.run_ext.length;x++)this.run_ext[x].caller[this.run_ext[x].callkey]();origin||(origin=this.origin),console.log("FIRING FROM:"+jstr(origin));var sprite=new Sprite({image:this.animation.image});sprite.setAnimation(this.animation),sprite.setSize(this.size),sprite.position=new Vector(0,0,0);var __inst=this,lp=__inst.line.transpose(origin);sprite.position=new Vector(lp[0].sub(sprite.size.div(2))),sprite.onUpdate(function(sprite){for(var x=0;x<lp.length;x++){if(sprite.center().equals(lp[x])&&x<lp.length-1){sprite.position=new Vector(lp[x+1].sub(sprite.size.div(2)));break}x==lp.length-1&&Gamestack.remove(sprite)}}),Gamestack.add(sprite),this.sprites.push(sprite)}}]),Projectile}();Gamestack.Projectile=Projectile;var Rectangle=function Rectangle(min,max){_classCallCheck(this,Rectangle),this.min=new Vector(min),this.max=new Vector(max)},VectorBounds=Rectangle;Gamestack.Rectangle=Rectangle;var VectorFrameBounds=function(_Rectangle){function VectorFrameBounds(min,max,termPoint){_classCallCheck(this,VectorFrameBounds);var _this=_possibleConstructorReturn(this,(VectorFrameBounds.__proto__||Object.getPrototypeOf(VectorFrameBounds)).call(this,min,max));return _this.termPoint=termPoint||new Vector3(_this.max.x,_this.max.y,_this.max.z),_this}return _inherits(VectorFrameBounds,_Rectangle),VectorFrameBounds}(Rectangle);Gamestack.VectorFrameBounds=VectorFrameBounds;var Curves={linearNone:function(t){return t},easeInQuadratic:function(t){return t*t},easeOutQuadratic:function(t){return t*(2-t)},easeInOutQuadratic:function(t){return t<.5?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuartic:function(t){return t*t*t*t},easeOutQuartic:function(t){return 1- --t*t*t*t},easeInOutQuartic:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuintic:function(t){return t*t*t*t*t},easeOutQuintic:function(t){return 1+--t*t*t*t*t},easeInOutQuintic:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}};Gamestack.Curves=Curves;var Shapes={circle:function(radius,freq){return{radius:radius,points:[],fill:function(center,freq){}}},square:function(s,freq){return console.error("STILL NEED TO BUILD THIS SQUARE IN GS-API"),{size:new Vector(s,s),width:w,height:h,freq:freq,points:[],fill:function(start,freq){}}},rect:function(w,h,freq){return console.error("STILL NEED TO BUILD THIS TRIANGLE"),{size:new Vector(w,h),width:w,height:h,freq:freq,points:[],fill:function(start,freq){}}},triangle:function(base,h,freq){return console.error("STILL NEED TO BUILD THIS TRIANGLE"),{base:base,height:height,freq:freq,points:[],fill:function(start,freq){}}}};Gamestack.Shapes=Shapes;var Line=function(){function Line(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Line),this.curve_string=args.curve_string||"Linear_None",this.curve=this.get_curve_from_string(this.curve_string),this.motion_curve=args.motion_curve||TWEEN.Easing.Linear.None,"function"==typeof args.curve&&(this.curve=args.curve),this.points=[],this.position=args.position||new Vector,this.is_highlighted=args.is_highlighted||!1,this.offset=args.offset||new Vector,this.pointDist=5,this.size=args.size||new Vector,this.rotation=args.rotation||0,this.iterations=1,this.growth=args.growth||1.2,this.curve_options=Curves}return _createClass(Line,[{key:"Iterations",value:function(n){return this.iterations=n,this}},{key:"Growth",value:function(n){return this.growth=n,this}},{key:"Pos",value:function(p){return this.position=p,this}},{key:"PointDisp",value:function(num){return this.minPointDist=num,this}},{key:"Curve",value:function(c){return this.curve=c,this.curve_string=this.get_curve_string(c),this}},{key:"Duration",value:function(d){return this.duration=d,this}},{key:"Rotation",value:function(r){return this.rotation=r,this}},{key:"next",value:function(position){for(var found=!1,x=0;x<this.points.length;x++){if(position.equals(this.points[x])&&x<this.points.length-1)return found=!0,new Vector(this.points[x+1]);if(x==this.points.length-1&&!found)return new Vector(this.points[0])}}},{key:"get_curve_from_string",value:function(str){for(var x in this.curve_options)if(x.toLowerCase()==str.toLowerCase().replace("_",""))return this.curve_options[x]}},{key:"get_curve_string",value:function(c){for(var x in this.curve_options)if(this.curve_options[x]==c)return x}},{key:"getGraphCanvas",value:function(curveCall,existing_canvas){var canvas=existing_canvas||document.createElement("canvas");canvas.style.position="relative",canvas.id="curve-display",canvas.setAttribute("class","motion-curve"),canvas.width=180,canvas.height=100,canvas.style.background="black";var context=canvas.getContext("2d");context.fillStyle="rgb(0,0,0)",context.fillRect(0,0,180,100),context.lineWidth=.5,context.strokeStyle="rgb(230,230,230)",context.beginPath(),context.moveTo(0,20),context.lineTo(180,20),context.moveTo(0,80),context.lineTo(180,80),context.closePath(),context.stroke(),context.lineWidth=2,context.strokeStyle="rgb(255,127,127)";var position={x:0,y:80},position_old={x:0,y:80};this.test_graph_size=new Vector(185,60);var points=this.get_line_segment(this.test_graph_size,5,curveCall);for(var x in points){var position=new Vector(points[x].x,this.test_graph_size.y+20-points[x].y);context.beginPath(),context.moveTo(position_old.x,position_old.y),context.lineTo(position.x,position.y),context.closePath(),context.stroke(),position_old.x=position.x,position_old.y=position.y}return canvas}},{key:"get_line_segment",value:function(size,pointDist,curveCall){if(!size||!pointDist)return 0;var points=[],current_point=new Vector(0,0,0),position=new Vector(current_point),target=new Vector(position.add(size)),start=new Vector(position),curveMethod=curveCall,ptrack=new Vector(start);for(position.x=position.x;position.x<target.x;position.x+=1){var dist=position.sub(start),pct=dist.x/size.x;if(console.log(pct),position.y=Math.round(curveMethod(pct)*size.y),ptrack.trig_distance_xy(position)>=pointDist){var p=new Vector(Gamestack.GeoMath.rotatePointsXY(position.x,position.y,0));points.push(p),current_point=new Vector(position),ptrack=new Vector(current_point)}}return points}},{key:"fill",value:function(size,pointDist){if(!size||!pointDist)return 0;this.size=size,this.pointDist=pointDist;this.points=[];for(var current_point=new Vector(this.position),x=0;x<=this.iterations;x++){var position=new Vector(current_point),target=new Vector(position.add(size)),start=new Vector(position),curveMethod=this.curve;new Vector(start);for(position.x=position.x;position.x<target.x;position.x+=1){var dist=position.sub(start),pct=dist.x/size.x;if(position.y=start.y+Math.round(curveMethod(pct)*size.y),current_point.trig_distance_xy(position)>=this.pointDist){var p=new Vector(Gamestack.GeoMath.rotatePointsXY(position.x,position.y,this.rotation));this.points.push(p),current_point=new Vector(position)}}size=size.mult(this.growth)}}},{key:"transpose",value:function(origin){for(var t_points=[],x=0;x<this.points.length;x++)t_points.push(this.points[x].add(origin));return t_points}},{key:"add_segment",value:function(next_segment,offset){for(var x=0;x<next_segment.length;x++)next_segment[x]=new Vector(next_segment[x]).add(offset),this.points.push(next_segment[x])}},{key:"get_flipped_segment",value:function(points){for(var t_points=points.slice(),t_len=t_points.length,x=0;x<points.length;x++)t_points[t_len-x].x=points[x].x;return t_points}},{key:"Highlight",value:function(origin,ctx){ctx=ctx||Gamestack.ctx;for(var x in this.points){var point=origin.add(this.points[x]).sub(Gamestack.point_highlighter.size.mult(.5)),dist=point.sub(Gamestack.point_highlighter.position),d=Math.sqrt(dist.x*dist.x+dist.y*dist.y);d>=10&&(Gamestack.point_highlighter.position=new Vector2(origin.add(this.points[x]).sub(Gamestack.point_highlighter.size.mult(.5)))),Canvas.draw(Gamestack.point_highlighter,ctx)}return this}}]),Line}(),GeoMath={rotatePointsXY:function(x,y,angle){var theta=angle*Math.PI/180,point={};return point.x=x*Math.cos(theta)-y*Math.sin(theta),point.y=x*Math.sin(theta)+y*Math.cos(theta),point.z=0,point}};Gamestack.GeoMath=GeoMath;var Sprite=function(){function Sprite(args){_classCallCheck(this,Sprite),args||(args={}),args instanceof Animation&&(args={selected_animation:args,size:new Vector(args.frameSize)}),this.active=!0,this.name=args.name||"__",this.description=args.description||"__",this.gravity="medium",this.__initializers=__gameStack.getArg(args,"__initializers",[]);var _spr=this;Gamestack.each(args,function(ix,item){"parent"!==ix&&(_spr[ix]=item)}),this.type=__gameStack.getArg(args,"type","basic"),this.animations=__gameStack.getArg(args,"animations",[]),this.motions=__gameStack.getArg(args,"motions",[]),this.projectiles=__gameStack.getArg(args,"projectiles",[]);var __inst=this;this.id=__gameStack.getArg(args,"id",this.create_id()),this.sounds=__gameStack.getArg(args,"sounds",[]),this.image=new GameImage(__gameStack.getArg(args,"src",__gameStack.getArg(args,"image",!1))),this.size=new Vector(__gameStack.getArg(args,"size",new Vector3(100,100))),this.position=new Vector(__gameStack.getArg(args,"position",new Vector3(0,0,0))),this.collision_bounds=__gameStack.getArg(args,"collision_bounds",new VectorBounds(new Vector3(0,0,0),new Vector3(0,0,0))),this.rotation=new Vector(__gameStack.getArg(args,"rotation",new Vector3(0,0,0))),this.selected_animation={},this.speed=__gameStack.getArg(args,"speed",new Vector3(0,0,0)),this.acceleration=__gameStack.getArg(args,"acceleration",new Vector3(0,0,0)),this.rot_speed=__gameStack.getArg(args,"rot_speed",new Vector3(0,0,0)),this.rot_accel=__gameStack.getArg(args,"rot_accel",new Vector3(0,0,0)),this.padding=__gameStack.getArg(args,"padding",new Vector3(0,0,0)),GameStack.each(this.sounds,function(ix,item){__inst.sounds[ix]=new Sound(item)}),GameStack.each(this.motions,function(ix,item){__inst.motions[ix]=new Motion(item)}),GameStack.each(this.animations,function(ix,item){__inst.animations[ix]=new Animation(item)}),GameStack.each(this.projectiles,function(ix,item){__inst.projectiles[ix]=new Projectile(item)}),GameStack.each(this.__initializers,function(ix,item){__inst.onInit(item)}),args.selected_animation?this.selected_animation=new Animation(args.selected_animation):this.image.domElement.onload=function(){__inst.setAnimation(__inst.animations[0]||new Animation({image:__inst.image,frameSize:new Vector3(__inst.image.domElement.width,__inst.image.domElement.height),frameBounds:new VectorFrameBounds(new Vector3,new Vector3)}))}}return _createClass(Sprite,[{key:"add",value:function(obj){switch(obj.constructor.name){case"Animation":this.animations.push(obj);break;case"Projectile":obj.origin=obj.origin||this.position,this.projectiles.push(obj)}}},{key:"init",value:function(){}},{key:"onInit",value:function(fun){if("string"==typeof fun){this.__initializers.indexOf(fun)<0&&this.__initializers.push(fun);var __inst=this,keys=fun.split(".");if(console.log("finding init from string:"+fun),!keys.length>=2)return console.error('need min 2 string keys separated by "."');var f=GameStack.options.SpriteInitializers[keys[0]][keys[1]];if("function"==typeof f){var __inst=this,f_init=this.init;this.init=function(){f_init(__inst),f(__inst)}}}else if("function"==typeof fun){console.log("extending init:");var f_init=this.init,__inst=this;this.init=function(){f_init(__inst),fun(__inst)}}else"object"==("undefined"==typeof fun?"undefined":_typeof(fun))&&(console.log("extending init:"),console.info("Quick2D does not yet implement onInit() from arg of object type"))}},{key:"get_id",value:function(){return this.id}},{key:"to_map_object",value:function(size,framesize){return this.__mapSize=new Vector3(size||this.size),this.frameSize=new Vector3(framesize||this.size),this}},{key:"create_id",value:function(){return Quick2d.create_id()}},{key:"setSize",value:function(size){this.size=new Vector3(size.x,size.y,size.z)}},{key:"setPos",value:function(pos){this.position=new Vector3(pos.x,pos.y,pos.z||0)}},{key:"getCappedSizeXY",value:function(mx,my,currentSize){var size=new Vector3(currentSize||this.size),wth=size.y/size.x,htw=size.x/size.y;return size.x>mx&&(size.x=mx,size.y=size.x*wth),size.y>my&&(size.y=my,size.x=size.y*htw),size}},{key:"assertSpeed",value:function(){this.speed||(this.speed=new Vector3(0,0,0))}},{key:"setAnimation",value:function(anime){return anime instanceof Animation&&this.animations.indexOf(anime)<0&&this.animations.push(anime),this.selected_animation=anime,Gamestack.log("declared default animation"),this}},{key:"onScreen",value:function onScreen(w,h){w=w||__gameStack.WIDTH,h=h||__gameStack.HEIGHT;var camera=__gameStack.camera||__gameStack.__gameWindow.camera||new Vector3(0,0,0),p=new Vector3(this.position.x-camera.position.x,this.position.y-camera.position.y,this.position.z-camera.position.z),onScreen=p.x>0-this.size.x&&p.x<w+this.size.x&&p.y>0-this.size.x&&p.y<h+this.size.y;return onScreen}},{key:"update",value:function(sprite){}},{key:"def_update",value:function(sprite){for(var x in this.speed)(this.speed[x]>0||this.speed[x]<0)&&(this.position[x]+=this.speed[x]);for(var x in this.acceleration)(this.acceleration[x]>0||this.acceleration[x]<0)&&(this.speed[x]+=this.acceleration[x]);for(var x in this.rot_speed)(this.rot_speed[x]>0||this.rot_speed[x]<0)&&(this.rotation[x]+=this.rot_speed[x]);for(var x in this.rot_accel)(this.rot_accel[x]>0||this.rot_accel[x]<0)&&(this.rot_speed[x]+=this.rot_accel[x])}},{key:"resolveFunctionFromDoubleKeys",value:function(keyString1,keyString2,obj,callback){callback("function"==typeof obj[keyString1][keyString2]?obj[keyString1][keyString2]:{})}},{key:"extendFunc",value:function(fun,extendedFunc){console.log("extending func");var ef=extendedFunc,__inst=this;return function(){ef(__inst),fun(__inst)}}},{key:"onUpdate",value:function(fun){fun=fun||function(){};var update=this.update;this.update=function(__inst){update(__inst),fun(__inst)}}},{key:"collidesRectangular",value:function(sprite){return Gamestack.Collision.spriteRectanglesCollide(this,sprite)}},{key:"shoot",value:function(options){this.prep_key="shoot";var animation=options.bullet||options.animation||new Animation,speed=options.speed||1,position=options.position||new Vector3(this.position),size=options.size||new Vector3(10,10,0),rot_offset=options.rot_offset||new Vector3(0,0,0),__playerInst=this;if(__gameInstance.isAtPlay){var bx=position.x,by=position.y,shot=(size.x,size.y,__gameStack.add(new Sprite({active:!0,position:position,size:size,image:animation.image,rotation:new Vector3(0,0,0),flipX:!1})));if(shot.setAnimation(animation),"number"==typeof rot_offset&&(rot_offset=new Vector3(rot_offset,0,0)),shot.position.x=bx,shot.position.y=by,shot.rotation.x=0+rot_offset.x,shot.stats={damage:1},options.line){options.line.fill(new Vector(500,500),4);var nextPos=new Vector(0,0,0);shot.onUpdate(function(spr){nextPos=options.line.next(nextPos),spr.position=__playerInst.position.add(nextPos),console.log(spr.position)})}else shot.speed.x=Math.cos(3.14*shot.rotation.x/180)*speed,shot.speed.y=Math.sin(3.14*shot.rotation.x/180)*speed;return shot}return new Error("game was not in motion: Gamestack.isAtPlay must be true to create a shot.")}},{key:"subsprite",value:function subsprite(options){var animation=options.animation||new Animation,position=options.position||new Vector3(this.position),offset=options.offset||new Vector3(0,0,0),size=options.size||this.size;if(__gameInstance.isAtPlay){var subsprite=__gameStack.add(new Sprite({active:!0,position:position,size:size,offset:offset,image:animation.image,rotation:new Vector3(0,0,0),flipX:!1}));return subsprite.setAnimation(animation),subsprite}alert("No subsprite when not at play")}},{key:"animate",value:function(animation){__gameInstance.isAtPlay&&(animation&&this.setAnimation(animation),this.selected_animation.animate())}},{key:"onAnimationComplete",value:function(fun){this.selected_animation.onComplete(fun)}},{key:"accelY",value:function(accel,max){accel=Math.abs(accel),"number"==typeof max&&(max={y:max}),this.assertSpeed();var diff=max.y-this.speed.y;diff>0&&(this.speed.y+=Math.abs(diff)>=accel?accel:diff),diff<0&&(this.speed.y-=Math.abs(diff)>=accel?accel:diff)}},{key:"accelX",value:function(accel,max){accel=Math.abs(accel),"number"==typeof max&&(max={x:max}),this.assertSpeed();var diff=max.x-this.speed.x;diff>0&&(this.speed.x+=Math.abs(diff)>=accel?accel:diff),diff<0&&(this.speed.x-=Math.abs(diff)>=accel?accel:diff)}},{key:"accel",value:function(prop,key,_accel,max){_accel=Math.abs(_accel),"number"==typeof max&&(max={x:max});var diff=(prop[key],max.x-prop[key]);diff>0&&(prop[key]+=Math.abs(diff)>=_accel?_accel:diff),diff<0&&(prop[key]-=Math.abs(diff)>=_accel?_accel:diff)}},{key:"decel",value:function(prop,key,rate){"object"==("undefined"==typeof rate?"undefined":_typeof(rate))&&(rate=rate.rate),rate=Math.abs(rate),Math.abs(prop[key])<=rate?prop[key]=0:prop[key]>0?prop[key]-=rate:prop[key]<0?prop[key]+=rate:prop[key]=0}},{key:"decelY",value:function(amt){amt=Math.abs(amt),Math.abs(this.speed.y)<=amt?this.speed.y=0:this.speed.y>amt?this.speed.y-=amt:this.speed.y<amt*-1&&(this.speed.y+=amt)}},{key:"decelX",value:function(amt){amt=Math.abs(amt),this.speed.x>amt?this.speed.x-=amt:this.speed.x<amt*-1&&(this.speed.x+=amt),Math.abs(this.speed.x)<=amt&&(this.speed.x=0)}},{key:"shortest_stop",value:function(item,callback){var diff_min_y=item.min?item.min.y:Math.abs(item.position.y-this.position.y+this.size.y),diff_min_x=item.min?item.min.x:Math.abs(item.position.x-this.position.x+this.size.x),diff_max_y=item.max?item.max.y:Math.abs(item.position.y+item.size.y-this.position.y),diff_max_x=item.max?item.max.x:Math.abs(item.position.x+item.size.x-this.position.y),dimens={top:diff_min_y,left:diff_min_x,bottom:diff_max_y,right:diff_max_x},minkey="",min=1e7;for(var x in dimens)dimens[x]<min&&(min=dimens[x],minkey=x);callback(minkey)}},{key:"center",value:function(){return new Vector(this.position.x+this.size.x/2,this.position.y+this.size.y/2,0)}},{key:"overlap_x",value:function(item,padding){padding||(padding=0);var paddingX=Math.round(padding*this.size.x),paddingY=Math.round(padding*this.size.y),left=this.position.x+paddingX,right=this.position.x+this.size.x-paddingX;this.position.y+paddingY,this.position.y+this.size.y-paddingY;return right>item.position.x&&left<item.position.x+item.size.x}},{key:"overlap_y",value:function(item,padding){padding||(padding=0);var paddingX=Math.round(padding*this.size.x),paddingY=Math.round(padding*this.size.y),top=(this.position.x+paddingX,this.position.x+this.size.x-paddingX,this.position.y+paddingY),bottom=this.position.y+this.size.y-paddingY;return bottom>item.position.y&&top<item.position.y+item.size.y}},{key:"collide_stop_x",value:function(item){for(var apart=!1,ct=1e4;!apart&&ct>0;){ct--;var diffX=this.center().sub(item.center()).x,distX=Math.abs(this.size.x/2+item.size.x/2-Math.round(this.size.x*this.padding.x));Math.abs(diffX)<distX?this.position.x-=diffX>0?-1:1:apart=!0}}},{key:"collide_stop",value:function(item){if(this.id==item.id)return!1;if(this.collidesRectangular(item)){var diff=this.center().sub(item.center());if(this.overlap_x(item,this.padding.x+.1)&&Math.abs(diff.x)<Math.abs(diff.y))for(var apart=!1,ct=1e4;!apart&&ct>0;){ct--;var diffY=this.center().sub(item.center()).y,distY=Math.abs(this.size.y/2+item.size.y/2-Math.round(this.size.y*this.padding.y));if(!(Math.abs(diffY)<distY))return diffY<=0&&(this.__inAir=!1),apart=!0;this.position.y-=diffY>0?-1:diffY<0?1:0,this.position.y=Math.round(this.position.y)}this.overlap_y(item,this.padding.y)&&Math.abs(diff.y)<Math.abs(diff.x)&&this.collide_stop_x(item)}}},{key:"collide_stop_top",value:function(item){if(this.id==item.id)return!1;if(this.overlap_x(item,this.padding.x+.1)){console.log("OVERLAP_X");var paddingY=this.padding.y*this.size.y;this.position.y+this.size.y-paddingY<=item.position.y&&(this.groundMaxY=item.position.y-this.size.y+paddingY)}}},{key:"restoreFrom",value:function(data){return data.image=new GameImage(data.src||data.image.src),new Sprite(data)}},{key:"fromFile",value:function(file_path){if("string"==typeof file_path){var __inst=this;$.getJSON(file_path,function(data){__inst=new Sprite(data)})}}},{key:"toJSONString",value:function(){for(var x=0;x<this.motions.length;x++)this.motions[x].parent=!1;return jstr(this)}}]),Sprite}();Gamestack.Sprite=Sprite;var SpriteInitializersOptions={Clastics:{top_collideable:function(sprite){for(var x in Gamestack.__gameWindow.forces){var force=Gamestack.__gameWindow.forces[x];force.topClastics.push(sprite)}sprite.onUpdate(function(){})},fourside_collideable:function(sprite){for(var x in Gamestack.__gameWindow.forces){var force=Gamestack.__gameWindow.forces[x];force.clasticObjects.push(sprite)}sprite.onUpdate(function(){})}},MainGravity:{very_light:function(sprite){Gamestack.add(new Force({name:"very_light_grav",accel:.05,max:new Vector3(0,3.5,0),subjects:[sprite],clasticObjects:[]}));sprite.onUpdate(function(){})},light:function(sprite){Gamestack.add(new Force({name:"light_grav",accel:.1,max:new Vector3(0,4.5,0),subjects:[sprite],clasticObjects:[]}));sprite.onUpdate(function(){})},medium:function(sprite){Gamestack.add(new Force({name:"medium_grav",accel:.2,max:new Vector3(0,7.5,0),subjects:[sprite],clasticObjects:[]}));sprite.onUpdate(function(){})},strong:function(sprite){Gamestack.add(new Force({name:"strong_grav",accel:.4,max:new Vector3(0,10.5,0),subjects:[sprite],clasticObjects:[]}));sprite.onUpdate(function(){})},very_strong:function(sprite){Gamestack.add(new Force({name:"strong_grav",accel:.5,max:new Vector3(0,12.5,0),subjects:[sprite],clasticObjects:[]}));sprite.onUpdate(function(){})}},ControllerStickMotion:{player_move_x:function(sprite){alert("applying initializer"),console.log("side_scroll_player_run:init-ing");Gamestack.GamepadAdapter.on("stick_left",0,function(x,y){if(console.log("stick-x:"+x),Math.abs(x)<.2)return 0;var accel=.2,max=7;sprite.accelX(accel,x*max),x<-.2?sprite.flipX=!0:x>.2&&(sprite.flipX=!1)}),sprite.onUpdate(function(spr){spr.decelX(.1),spr.__falling||spr.decelY(.2)})},player_move_xy:function(sprite){alert("applying initializer"),console.log("side_scroll_player_run:init-ing");Gamestack.GamepadAdapter.on("stick_left",0,function(x,y){console.log("stick-x:"+x),Math.abs(x)<.2&&(x=0),Math.abs(y)<.2&&(y=0);var accel=.2,max=7;sprite.accelX(accel,x*max),sprite.accelY(accel,y*max),x<-.2?sprite.flipX=!0:x>.2&&(sprite.flipX=!1)}),sprite.onUpdate(function(spr){sprite.decel(sprite.speed,"x",.1),sprite.decel(sprite.speed,"y",.1)})},player_rotate_x:function(sprite){Gamestack.GamepadAdapter.on("stick_left",0,function(x,y){if(console.log("stick-x:"+x),Math.abs(x)<.2)return 0;var accel=.25,max=7;sprite.accel(sprite.rot_speed,"x",accel,x*max),
x<-.2?sprite.flipX=!0:x>.2&&(sprite.flipX=!1)}),sprite.onUpdate(function(spr){sprite.decel(sprite.rot_speed,"x",.1),spr.__falling||spr.decelY(.2)})}}};Gamestack.options=Gamestack.options||{},Gamestack.options.SpriteInitializers=SpriteInitializersOptions;var Vector=function(){function Vector(x,y,z,r){return _classCallCheck(this,Vector),"object"==("undefined"==typeof x?"undefined":_typeof(x))&&x.hasOwnProperty("x")&&x.hasOwnProperty("y")?(this.x=x.x,this.y=x.y,this.z=x.z||0,null==this.z&&(this.z=0),this):(null==z&&(z=0),this.x=x,this.y=y,this.z=z,void(this.r=r))}return _createClass(Vector,[{key:"sub",value:function(v){return"number"==typeof v&&(v={x:v,y:v,z:v}),new Vector(this.x-v.x,this.y-v.y,this.z-v.z)}},{key:"add",value:function(v){return"number"==typeof v&&(v={x:v,y:v,z:v}),new Vector(this.x+v.x,this.y+v.y,this.z+v.z)}},{key:"mult",value:function(v){return"number"==typeof v&&(v={x:v,y:v,z:v}),new Vector(this.x*v.x,this.y*v.y,this.z*v.z)}},{key:"div",value:function(v){return"number"==typeof v&&(v={x:v,y:v,z:v}),new Vector(this.x/v.x,this.y/v.y,this.z/v.z)}},{key:"round",value:function(){return new Vector(Math.round(this.x),Math.round(this.y),Math.round(this.z))}},{key:"floor",value:function(){return new Vector(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"ceil",value:function(){return new Vector(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}},{key:"equals",value:function(v){return this.x==v.x&&this.y==v.y&&this.z==v.z}},{key:"trig_distance_xy",value:function(v){var dist=this.sub(v);return Math.sqrt(dist.x*dist.x+dist.y*dist.y)}},{key:"diff",value:function(){}},{key:"abs_diff",value:function(){}},{key:"is_between",value:function(v1,v2){return this.x>=v1.x&&this.x<=v2.x&&this.y>=v1.y&&this.y<=v2.y&&this.z>=v1.z&&this.z<=v2.z}}]),Vector}(),Vector3=Vector,Pos=Vector,Size=Vector,Position=Vector,Vector2=Vector,Rotation=Vector;Gamestack.Vector=Vector;